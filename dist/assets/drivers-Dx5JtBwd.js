import{r as _,R as o,j as e,b as je}from"./index-CF_moJuI.js";import{T as ue}from"./ThemeAwareDashboardLayout-C8c2BfhP.js";import{c as ve,L as j,I as k,B as h,C as D,b as T,d as F,e as b}from"./index-DTGwnuui.js";import{l as le,m as ie,n as re,o as te,p as ne,d as $,e as z,g as M,h as I,i as C,Y as ce,q as pe,a as L,a6 as U,T as A,aa as ge,F as fe,ae as q,Z as H,_ as Z,$ as O,a0 as X,a1 as S,B as Y}from"./DashboardLayout-CKMHQjoS.js";import{T as Ne,a as we,b as G,c as J}from"./tabs-D8InaDQk.js";import{T as K,a as Q,b as V,c as t,d as W,e as n}from"./table-dafBRNiR.js";import{g as de,L as De,a as R,d as be,p as ke}from"./LoadingSpinner-KqaDx3Fq.js";import{C as ee}from"./circle-x-Bqg4jt-4.js";import{F as Ce}from"./filter-CmfUkVjz.js";import{M as se}from"./mail-Dz_k9LGV.js";import{M as ae}from"./map-pin-DG9QdLrP.js";import{T as ye}from"./triangle-alert-BvGIUNPI.js";/**
 * @license lucide-react v0.394.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=ve("Delete",[["path",{d:"M20 5H9l-7 7 7 7h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Z",key:"1oy587"}],["line",{x1:"18",x2:"12",y1:"9",y2:"15",key:"1olkx5"}],["line",{x1:"12",x2:"18",y1:"9",y2:"15",key:"1n50pc"}]]),Te=({open:x,onOpenChange:g,onSave:m})=>{const[r,u]=o.useState({name:"",email:"",phone:"",address:"",citizenship:"",language:"",password:""}),a=(l,y)=>{u(v=>({...v,[l]:y}))},f=()=>{m(r),u({name:"",email:"",phone:"",address:"",citizenship:"",language:"",password:""})};return e.jsx(le,{open:x,onOpenChange:g,children:e.jsxs(ie,{children:[e.jsxs(re,{children:[e.jsx(te,{children:"Add New Driver"}),e.jsx(ne,{children:"Enter the details for the new driver. Click save when you're done."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"name",children:"Name"}),e.jsx(k,{id:"name",placeholder:"Driver full name",value:r.name,onChange:l=>a("name",l.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"email",children:"Email"}),e.jsx(k,{id:"email",placeholder:"Driver email",type:"email",value:r.email,onChange:l=>a("email",l.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"phone",children:"Phone"}),e.jsx(k,{id:"phone",type:"tel",placeholder:"Driver phone number",value:r.phone,onChange:l=>a("phone",l.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"address",children:"Address"}),e.jsx(k,{id:"address",placeholder:"City, State",value:r.address,onChange:l=>a("address",l.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"password",children:"Password"}),e.jsx(k,{id:"password",value:r.password,onChange:l=>a("password",l.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"citizenship",children:"Citizenship"}),e.jsxs($,{value:r.citizenship,onValueChange:l=>a("citizenship",l),children:[e.jsx(z,{children:e.jsx(M,{placeholder:""})}),e.jsxs(I,{children:[e.jsx(C,{value:"citizen",children:"Citizen"}),e.jsx(C,{value:"resident",children:"Resident"}),e.jsx(C,{value:"NL",children:"NL"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"language",children:"Language"}),e.jsxs($,{value:r.language,onValueChange:l=>a("language",l),children:[e.jsx(z,{children:e.jsx(M,{placeholder:""})}),e.jsxs(I,{children:[e.jsx(C,{value:"EN",children:"EN"}),e.jsx(C,{value:"RU",children:"RU"})]})]})]})]})]}),e.jsxs(ce,{children:[e.jsx(h,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(h,{onClick:f,children:"Save Driver"})]})]})})},Fe=_.memo(Te),Ae=({driverId:x,open:g,onOpenChange:m,onSave:r})=>{const[u,a]=o.useState({truck_id:0}),[f,l]=o.useState([]);_.useEffect(()=>{(async()=>{const N=await de("https://api.mjdatsolutions.com/api/trucks"),p=await N.json();N.ok&&l(p)})()},[]);const y=(c,N)=>{a(p=>({...p,[c]:N}))},v=()=>{r(u,x),a({truck_id:0})};return e.jsx(le,{open:g,onOpenChange:m,children:e.jsxs(ie,{children:[e.jsxs(re,{children:[e.jsx(te,{children:"Assign Truck"}),e.jsx(ne,{children:"Select truck for the driver. Click save when you're done."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(j,{htmlFor:"truck_id",children:"Trucks"}),e.jsxs($,{value:u.truck_id.toString(),onValueChange:c=>y("truck_id",Number(c)),children:[e.jsx(z,{children:e.jsx(M,{placeholder:""})}),e.jsx(I,{children:f.length==0?e.jsx("p",{children:"No trucks registered"}):f.map(c=>e.jsxs(C,{value:c.id.toString(),children:["#",c.id," ",c.model]},c.id))})]})]})}),e.jsxs(ce,{children:[e.jsx(h,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(h,{onClick:v,children:"Assign Truck"})]})]})})},Ve=_.memo(Ae),He=()=>{const[x,g]=o.useState([]),[m,r]=o.useState([]),[u,a]=o.useState(!1),[f,l]=o.useState(!1),[y,v]=o.useState(!1),[c,N]=o.useState(null),{user:p}=je(),w=async()=>{a(!0);const s=await de("https://api.mjdatsolutions.com/api/drivers"),i=await s.json();if(s.ok){const d=i.data;g(d.filter(E=>E.is_active)),r(d.filter(E=>!E.is_active))}else console.error("Failed to fetch drivers:",i);a(!1)};_.useEffect(()=>{w()},[]);const oe=async s=>{a(!0);const i={name:s.name,email:s.email,phone:s.phone,language:s.language,citizenship:s.citizenship,address:s.address,password:s.password},d=await ke("https://api.mjdatsolutions.com/api/drivers",i);d.ok?(a(!1),v(!1),w()):console.error("Failed to add driver:",await d.json()),a(!1)},he=async(s,i)=>{a(!0);const d=await R(`https://api.mjdatsolutions.com/api/drivers/${i}`,{truck_id:s.truck_id});if(d.ok)a(!1),l(!1),w();else throw console.error("Failed to assign vehicle:",await d.json()),new Error("Failed to assign vehicle");a(!1)},xe=async s=>{a(!0);const i=await R(`https://api.mjdatsolutions.com/api/drivers/${s}`,{is_active:!1});if(i.ok)a(!1),w();else throw console.error("Failed to deactivate user:",await i.json()),new Error("Failed to deactivate driver");a(!1)},me=async s=>{a(!0);const i=await R(`https://api.mjdatsolutions.com/api/drivers/${s}`,{is_active:!0});if(i.ok)a(!1),w();else throw console.error("Failed to reactivate user:",await i.json()),new Error("Failed to reactivate driver");a(!1)},B=async s=>{a(!0);const i=await be(`https://api.mjdatsolutions.com/api/drivers/${s}`);if(i.ok)a(!1),w();else throw console.error("Failed to delete driver:",await i.json()),a(!1),new Error("Failed to delete driver")};if(u)return e.jsx(De,{});const P=s=>s?e.jsx(Y,{className:"bg-green-500",children:"Available"}):e.jsx(Y,{variant:"outline",children:"Not Available"});return e.jsx(ue,{pageTitle:"Driver Management",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Drivers"}),p.role=="admin"&&e.jsxs(h,{onClick:()=>v(!0),children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),"Add Driver"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(D,{children:[e.jsx(T,{className:"pb-2",children:e.jsx(F,{className:"text-sm font-medium text-muted-foreground",children:"Total Drivers"})}),e.jsx(b,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"h-5 w-5 text-blue-500 mr-2"}),e.jsx("span",{className:"text-2xl font-bold",children:x.length+m.length})]})})]}),e.jsxs(D,{children:[e.jsx(T,{className:"pb-2",children:e.jsx(F,{className:"text-sm font-medium text-muted-foreground",children:"Active Drivers"})}),e.jsx(b,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{className:"h-5 w-5 text-green-500 mr-2"}),e.jsx("span",{className:"text-2xl font-bold",children:x.length})]})})]}),e.jsxs(D,{children:[e.jsx(T,{className:"pb-2",children:e.jsx(F,{className:"text-sm font-medium text-muted-foreground",children:"Unavailable"})}),e.jsx(b,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{className:"h-5 w-5 text-blue-500 mr-2"}),e.jsx("span",{className:"text-2xl font-bold",children:x.filter(s=>!s.is_available).length})]})})]}),e.jsxs(D,{children:[e.jsx(T,{className:"pb-2",children:e.jsx(F,{className:"text-sm font-medium text-muted-foreground",children:"Inactive/On Leave"})}),e.jsx(b,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{className:"h-5 w-5 text-gray-500 mr-2"}),e.jsx("span",{className:"text-2xl font-bold",children:m.length})]})})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(k,{placeholder:"Search drivers...",className:"w-full pl-10"}),e.jsx("div",{className:"absolute left-3 top-2.5",children:e.jsx(ge,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{variant:"outline",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"})," Filter"]}),e.jsxs(h,{variant:"outline",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"})," Export"]})]})]}),e.jsxs(Ne,{defaultValue:"active",className:"w-full",children:[e.jsxs(we,{className:"grid w-full grid-cols-2 mb-6 max-w-md",children:[e.jsx(G,{value:"active",children:"Active Drivers"}),e.jsx(G,{value:"inactive",children:"Inactive Drivers"})]}),e.jsx(J,{value:"active",children:e.jsx(D,{children:e.jsx(b,{className:"p-0",children:e.jsxs(K,{children:[e.jsx(Q,{children:e.jsxs(V,{children:[e.jsx(t,{children:"Driver"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Contact"}),e.jsx(t,{children:"Location"}),e.jsx(t,{children:"Vehicle"}),e.jsx(t,{className:"text-right",children:"Actions"})]})}),e.jsx(W,{children:x.map(s=>{var i;return e.jsxs(V,{children:[e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-100 flex items-center justify-center overflow-hidden",children:s.avatar?e.jsx("img",{src:s.avatar,alt:s.name,className:"h-full w-full object-cover"}):e.jsx(L,{className:"h-5 w-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["DRV-",s.id]})]})]})}),e.jsx(n,{children:P(s.is_available)}),e.jsx(n,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(q,{className:"h-3 w-3 mr-1 text-muted-foreground"}),s.phone]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(se,{className:"h-3 w-3 mr-1 text-muted-foreground"}),s.email]})]})}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:"h-4 w-4 mr-1 text-muted-foreground"}),s.address??"Unknown"]})}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{className:"h-4 w-4 mr-1 text-muted-foreground"}),((i=s.truck)==null?void 0:i.id)??"Not Assigned"]})}),e.jsx(n,{className:"text-right",children:e.jsx("div",{className:"flex justify-end gap-2",children:e.jsxs(H,{children:[e.jsx(Z,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"icon",children:e.jsx(O,{className:"h-4 w-4"})})}),p.role=="admin"&&e.jsxs(X,{align:"end",children:[e.jsxs(S,{onClick:()=>{l(!0),N(s.id)},children:[e.jsx(A,{className:"h-4 w-4 mr-2"})," Assign Vehicle"]}),e.jsxs(S,{onClick:()=>xe(s.id),children:[e.jsx(ye,{className:"h-4 w-4 mr-2"})," ","Mark Inactive"]}),e.jsxs(S,{onClick:()=>B(s.id),children:[e.jsx(Se,{className:"h-4 w-4 mr-2"})," Delete Driver"]})]})]})})})]},s.id)})})]})})})}),e.jsx(J,{value:"inactive",children:e.jsx(D,{children:e.jsx(b,{className:"p-0",children:e.jsxs(K,{children:[e.jsx(Q,{children:e.jsxs(V,{children:[e.jsx(t,{children:"Driver"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Contact"}),e.jsx(t,{children:"Location"}),e.jsx(t,{children:"Vehicle"}),e.jsx(t,{className:"text-right",children:"Actions"})]})}),e.jsx(W,{children:m.map(s=>{var i,d;return e.jsxs(V,{children:[e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-100 flex items-center justify-center overflow-hidden",children:s.avatar?e.jsx("img",{src:s.avatar,alt:s.name,className:"h-full w-full object-cover"}):e.jsx(L,{className:"h-5 w-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.id})]})]})}),e.jsx(n,{children:P(s.is_available)}),e.jsx(n,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(q,{className:"h-3 w-3 mr-1 text-muted-foreground"}),s.phone]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(se,{className:"h-3 w-3 mr-1 text-muted-foreground"}),s.email]})]})}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:"h-4 w-4 mr-1 text-muted-foreground"}),((i=s.truck)==null?void 0:i.address)??"Unknown"]})}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{className:"h-4 w-4 mr-1 text-muted-foreground"}),((d=s.truck)==null?void 0:d.id)??"Not Assigned"]})}),e.jsx(n,{className:"text-right",children:e.jsx("div",{className:"flex justify-end gap-2",children:p.role=="admin"&&e.jsxs(H,{children:[e.jsx(Z,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"icon",children:e.jsx(O,{className:"h-4 w-4"})})}),e.jsxs(X,{align:"end",children:[e.jsxs(S,{onClick:()=>me(s.id),children:[e.jsx(U,{className:"h-4 w-4 mr-2"})," ","Reactivate"]}),e.jsxs(S,{onClick:()=>B(s.id),children:[e.jsx(ee,{className:"h-4 w-4 mr-2 text-red-500"})," ","Delete"]})]})]})})})]},s.id)})})]})})})})]}),y&&e.jsx(Fe,{onOpenChange:s=>v(s),onSave:oe,open:!0}),f&&e.jsx(Ve,{driverId:c,onOpenChange:s=>l(s),onSave:he,open:!0})]})})};export{He as default};
