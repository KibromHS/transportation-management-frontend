import{r as m,R as L,j as e,b as E}from"./index-CF_moJuI.js";import{l as M,m as V,n as $,o as P,p as q,d as y,e as O,g as T,h as D,i as h,Y as B,D as H,q as I,ad as S,T as F,aa as _,ae as U,Z as W,_ as Y,$ as Z,a0 as G,a1 as J}from"./DashboardLayout-CKMHQjoS.js";import{L as r,I as d,B as g,C as w,b as z,d as k,e as N}from"./index-DTGwnuui.js";import{T as K,c as Q}from"./tabs-D8InaDQk.js";import{T as X,a as ee,b as A,c as t,d as se,e as c}from"./table-dafBRNiR.js";import{L as ae,g as le,d as ne,p as R}from"./LoadingSpinner-KqaDx3Fq.js";import{M as ie}from"./mail-Dz_k9LGV.js";import{M as re}from"./map-pin-DG9QdLrP.js";import{T as te}from"./triangle-alert-BvGIUNPI.js";const ce=({open:o,onOpenChange:x,onSave:f})=>{const[l,j]=L.useState({name:"",email:"",phone:"",address:"",citizenship:"",language:"",password:""}),n=(a,v)=>{j(s=>({...s,[a]:v}))},p=()=>{f(l),j({name:"",email:"",phone:"",address:"",citizenship:"",language:"",password:""})};return e.jsx(M,{open:o,onOpenChange:x,children:e.jsxs(V,{children:[e.jsxs($,{children:[e.jsx(P,{children:"Add New Owner"}),e.jsx(q,{children:"Enter the details for the new owner. Click save when you're done."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"name",children:"Name"}),e.jsx(d,{id:"name",placeholder:"Owner full name",value:l.name,onChange:a=>n("name",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"email",children:"Email"}),e.jsx(d,{id:"email",placeholder:"Owner email",type:"email",value:l.email,onChange:a=>n("email",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"phone",children:"Phone"}),e.jsx(d,{id:"phone",type:"tel",placeholder:"Owner phone number",value:l.phone,onChange:a=>n("phone",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"address",children:"Address"}),e.jsx(d,{id:"address",placeholder:"City, State",value:l.address,onChange:a=>n("address",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"password",children:"Password"}),e.jsx(d,{id:"password",value:l.password,onChange:a=>n("password",a.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"citizenship",children:"Citizenship"}),e.jsxs(y,{value:l.citizenship,onValueChange:a=>n("citizenship",a),children:[e.jsx(O,{children:e.jsx(T,{placeholder:""})}),e.jsxs(D,{children:[e.jsx(h,{value:"citizen",children:"Citizen"}),e.jsx(h,{value:"resident",children:"Resident"}),e.jsx(h,{value:"NL",children:"NL"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"language",children:"Language"}),e.jsxs(y,{value:l.language,onValueChange:a=>n("language",a),children:[e.jsx(O,{children:e.jsx(T,{placeholder:""})}),e.jsxs(D,{children:[e.jsx(h,{value:"EN",children:"EN"}),e.jsx(h,{value:"RU",children:"RU"})]})]})]})]})]}),e.jsxs(B,{children:[e.jsx(g,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(g,{onClick:p,children:"Save Owner"})]})]})})},de=m.memo(ce),ve=()=>{const[o,x]=m.useState([]),[f,l]=m.useState(!1),[j,n]=m.useState(!1),{user:p}=E();m.useEffect(()=>{(async()=>{const i=await le("https://api.mjdatsolutions.com/api/owners"),u=await i.json();i.ok?x(u.data):console.log("Failed to fetch owners:",u)})()},[]);const a=async s=>{const i=await ne(`https://api.mjdatsolutions.com/api/owners/${s}`);i.ok?window.location.reload():console.error("Couldn't delete owner:",i)},v=async s=>{n(!0);const i={name:s.name,email:s.email,phone:s.phone,address:s.address,citizenship:s.citizenship,language:s.language},u={name:s.name,email:s.email,phone:s.phone,language:s.language,citizenship:s.citizenship,password:s.password,is_active:1,is_available:1},C=await R("https://api.mjdatsolutions.com/api/owners",i),b=await R("https://api.mjdatsolutions.com/api/drivers",u);C.ok?b.ok?(l(!1),window.location.reload()):console.error("Failed to create driver account for this owner:",await b.json()):console.error("Failed to add owner:",C),n(!1)};return j?e.jsx(ae,{}):e.jsx(H,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Owners"}),p.role=="admin"&&e.jsxs(g,{onClick:()=>l(!0),children:[e.jsx(I,{className:"mr-2 h-4 w-4"}),"Add Owner"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(w,{children:[e.jsx(z,{className:"pb-2",children:e.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"Total Owners"})}),e.jsx(N,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(S,{className:"h-5 w-5 text-blue-500 mr-2"}),e.jsx("span",{className:"text-2xl font-bold",children:o.length})]})})]}),e.jsxs(w,{children:[e.jsx(z,{className:"pb-2",children:e.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"Total Vehicles"})}),e.jsx(N,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(F,{className:"h-5 w-5 text-teal-500 mr-2"}),e.jsx("span",{className:"text-2xl font-bold",children:o.reduce((s,i)=>s+i.trucks.length,0)})]})})]})]}),e.jsx("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(d,{placeholder:"Search owners...",className:"w-full pl-10"}),e.jsx("div",{className:"absolute left-3 top-2.5",children:e.jsx(_,{className:"h-4 w-4 text-muted-foreground"})})]})}),e.jsx(K,{defaultValue:"active",className:"w-full",children:e.jsx(Q,{value:"active",children:e.jsx(w,{children:e.jsx(N,{className:"p-0",children:e.jsxs(X,{children:[e.jsx(ee,{children:e.jsxs(A,{children:[e.jsx(t,{children:"Company"}),e.jsx(t,{children:"Name"}),e.jsx(t,{children:"Contact"}),e.jsx(t,{children:"Location"}),e.jsx(t,{children:"Vehicles"}),e.jsx(t,{className:"text-right",children:"Actions"})]})}),e.jsx(se,{children:o.map(s=>e.jsxs(A,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-100 flex items-center justify-center overflow-hidden",children:s.avatar?e.jsx("img",{src:s.avatar,alt:s.company.name,className:"h-full w-full object-cover"}):e.jsx(S,{className:"h-5 w-5 text-gray-600"})}),e.jsx("div",{children:e.jsx("div",{className:"font-medium",children:s.company.name??"Not Registered"})})]})}),e.jsxs(c,{children:[e.jsx("div",{className:"flex items-center",children:s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["OWN-",s.id]})]}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(U,{className:"h-3 w-3 mr-1 text-muted-foreground"}),s.phone]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(ie,{className:"h-3 w-3 mr-1 text-muted-foreground"}),s.email]})]})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(re,{className:"h-4 w-4 mr-1 text-muted-foreground"}),s.address]})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(F,{className:"h-4 w-4 mr-1 text-muted-foreground"}),s.trucks.length]})}),e.jsx(c,{className:"text-right",children:e.jsx("div",{className:"flex justify-end gap-2",children:e.jsxs(W,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",children:e.jsx(Z,{className:"h-4 w-4"})})}),p.role=="admin"&&e.jsx(G,{align:"end",children:e.jsxs(J,{onClick:()=>a(s.id),children:[e.jsx(te,{className:"h-4 w-4 mr-2"})," ",e.jsx("span",{className:"text-red",children:"Delete Owner"})]})})]})})})]},s.id))})]})})})})}),f&&e.jsx(de,{onOpenChange:s=>l(s),onSave:v,open:!0})]})})};export{ve as default};
