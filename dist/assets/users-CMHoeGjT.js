import{r as w,R as g,j as e,b as K}from"./index-CF_moJuI.js";import{T as O}from"./ThemeAwareDashboardLayout-C8c2BfhP.js";import{c as z,L as x,I as j,B as i,C as N,b as U,d as F,e as b,S as Y}from"./index-DTGwnuui.js";import{l as A,m as P,n as E,o as $,p as L,d as Z,e as _,g as G,h as J,i as D,Y as M,q as Q,U as R,aa as W,F as X,a as ee,ae as se,Z as ae,_ as re,$ as le,a0 as te,a1 as T,B as f}from"./DashboardLayout-CKMHQjoS.js";import{T as ne,c as ie}from"./tabs-D8InaDQk.js";import{T as de,a as ce,b as k,c as C,d as oe,e as y}from"./table-dafBRNiR.js";import{L as he,g as me,d as xe,p as je,a as pe}from"./LoadingSpinner-KqaDx3Fq.js";import{F as ue}from"./filter-CmfUkVjz.js";import{M as fe}from"./mail-Dz_k9LGV.js";import{T as we}from"./triangle-alert-BvGIUNPI.js";/**
 * @license lucide-react v0.394.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=z("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),ve=({open:n,onOpenChange:h,onSave:m})=>{const[a,d]=g.useState({name:"",email:"",phone:"",role:"dispatcher",password:""}),l=(r,c)=>{d(o=>({...o,[r]:c}))},p=()=>{m(a),d({name:"",email:"",phone:"",role:"",password:""})};return e.jsx(A,{open:n,onOpenChange:h,children:e.jsxs(P,{children:[e.jsxs(E,{children:[e.jsx($,{children:"Add New User"}),e.jsx(L,{children:"Enter the details for the new user. Click save when you're done."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"name",children:"Name"}),e.jsx(j,{id:"name",placeholder:"user full name",value:a.name,onChange:r=>l("name",r.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"email",children:"Email"}),e.jsx(j,{id:"email",placeholder:"user email",type:"email",value:a.email,onChange:r=>l("email",r.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"phone",children:"Phone"}),e.jsx(j,{id:"phone",type:"tel",placeholder:"user phone number",value:a.phone,onChange:r=>l("phone",r.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"role",children:"Role"}),e.jsxs(Z,{value:a.role,onValueChange:r=>l("role",r),children:[e.jsx(_,{children:e.jsx(G,{placeholder:""})}),e.jsxs(J,{children:[e.jsx(D,{value:"dispatcher",children:"Dispatcher"}),e.jsx(D,{value:"admin",children:"Admin"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"password",children:"Password"}),e.jsx(j,{id:"password",value:a.password,onChange:r=>l("password",r.target.value)})]})]}),e.jsxs(M,{children:[e.jsx(i,{variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsx(i,{onClick:p,children:"Save User"})]})]})})},Ne=w.memo(ve),be=({userId:n,open:h,onOpenChange:m,onSave:a})=>{const[d,l]=g.useState({password:""}),p=(c,o)=>{l(S=>({...S,[c]:o}))},r=()=>{a(d,n),l({password:""})};return e.jsx(A,{open:h,onOpenChange:m,children:e.jsxs(P,{children:[e.jsxs(E,{children:[e.jsx($,{children:"Reset Password"}),e.jsx(L,{children:"Set password for the user. Click save when you're done."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"password",children:"New Password"}),e.jsx(j,{id:"password",value:d.password,onChange:c=>p("password",c.target.value)})]})}),e.jsxs(M,{children:[e.jsx(i,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(i,{onClick:r,children:"Change Password"})]})]})})},Ce=w.memo(be),Ee=()=>{const[n,h]=w.useState([]),[m,a]=w.useState(!1),{user:d}=K(),l=d,[p,r]=g.useState(!1),[c,o]=g.useState(!1),[S,I]=g.useState(null),v=async()=>{a(!0);const s=await me("https://api.mjdatsolutions.com/api/users"),t=await s.json();s.ok?h(t.data):console.error("Failed to fetch users:",t),a(!1)};w.useEffect(()=>{v()},[]);const q=async s=>{a(!0);const t=await xe(`https://api.mjdatsolutions.com/api/users/${s}`);if(t.ok)a(!1),v();else throw a(!1),console.error(`Failed to delete user #${s}:`,await t.json()),new Error("Failed to delete user");a(!1)},B=async s=>{a(!0);const t={name:s.name,email:s.email,phone:s.phone,role:s.role,password:s.password},u=await je("https://api.mjdatsolutions.com/api/users",t);if(u.ok)a(!1),o(!1),v();else throw console.error("Failed to add user:",await u.json()),new Error("Failed to add user")},H=async(s,t)=>{a(!0);const u=await pe(`https://api.mjdatsolutions.com/api/users/${t}`,{password:s.password});if(u.ok)a(!1),r(!1),v();else throw a(!1),console.error("Failed to reset password",u),new Error("Failed to reset password");a(!1)};if(m)return e.jsx(he,{});const V=s=>{switch(s){case"admin":return e.jsx(f,{className:"bg-purple-500",children:"Admin"});case"dispatcher":return e.jsx(f,{className:"bg-blue-500",children:"Dispatcher"});case"Officer":return e.jsx(f,{className:"bg-green-500",children:"Officer"});case"Reviewer":return e.jsx(f,{className:"bg-yellow-500",children:"Reviewer"});default:return e.jsx(f,{variant:"outline",children:s})}};return e.jsx(O,{pageTitle:"User Management",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"User Management"}),l.role=="admin"&&e.jsxs(i,{onClick:()=>o(!0),children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Add User"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(N,{children:[e.jsx(U,{className:"pb-2",children:e.jsx(F,{className:"text-sm font-medium text-muted-foreground",children:"Total Users"})}),e.jsx(b,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(R,{className:"h-5 w-5 text-blue-500 mr-2"}),e.jsx("span",{className:"text-2xl font-bold",children:n.length})]})})]}),e.jsxs(N,{children:[e.jsx(U,{className:"pb-2",children:e.jsx(F,{className:"text-sm font-medium text-muted-foreground",children:"Admins"})}),e.jsx(b,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{className:"h-5 w-5 text-purple-500 mr-2"}),e.jsx("span",{className:"text-2xl font-bold",children:n.filter(s=>s.role==="admin").length})]})})]}),e.jsxs(N,{children:[e.jsx(U,{className:"pb-2",children:e.jsx(F,{className:"text-sm font-medium text-muted-foreground",children:"Dispatchers"})}),e.jsx(b,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(R,{className:"h-5 w-5 text-blue-500 mr-2"}),e.jsx("span",{className:"text-2xl font-bold",children:n.filter(s=>s.role==="dispatcher").length})]})})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(j,{placeholder:"Search users...",className:"w-full pl-10"}),e.jsx("div",{className:"absolute left-3 top-2.5",children:e.jsx(W,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:"outline",children:[e.jsx(ue,{className:"h-4 w-4 mr-2"})," Filter"]}),e.jsxs(i,{variant:"outline",children:[e.jsx(X,{className:"h-4 w-4 mr-2"})," Export"]})]})]}),e.jsxs(ne,{defaultValue:"active",className:"w-full",children:[e.jsx(ie,{value:"active",children:e.jsx(N,{children:e.jsx(b,{className:"p-0",children:e.jsxs(de,{children:[e.jsx(ce,{children:e.jsxs(k,{children:[e.jsx(C,{children:"User"}),e.jsx(C,{children:"Role"}),e.jsx(C,{children:"Contact"}),e.jsx(C,{className:"text-right",children:"Actions"})]})}),e.jsx(oe,{children:n.map(s=>e.jsxs(k,{children:[e.jsx(y,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-100 flex items-center justify-center overflow-hidden",children:s.avatar?e.jsx("img",{src:s.avatar,alt:s.name,className:"h-full w-full object-cover"}):e.jsx(ee,{className:"h-5 w-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["USR-",s.id]})]})]})}),e.jsx(y,{children:V(s.role)}),e.jsx(y,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(se,{className:"h-3 w-3 mr-1 text-muted-foreground"}),s.phone]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(fe,{className:"h-3 w-3 mr-1 text-muted-foreground"}),s.email]})]})}),e.jsx(y,{className:"text-right",children:e.jsx("div",{className:"flex justify-end gap-2",children:e.jsxs(ae,{children:[e.jsx(re,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",children:e.jsx(le,{className:"h-4 w-4"})})}),l.role=="admin"&&e.jsxs(te,{align:"end",children:[e.jsxs(T,{onClick:()=>{I(s.id),r(!0)},children:[e.jsx(ge,{className:"h-4 w-4 mr-2"})," Reset Password"]}),s.role!="admin"&&e.jsxs(T,{onClick:()=>q(s.id),children:[e.jsx(we,{className:"h-4 w-4 mr-2 text-red-500"})," ","Delete User"]})]})]})})})]},s.id))})]})})})}),c&&e.jsx(Ne,{open:!0,onOpenChange:s=>o(s),onSave:B}),p&&e.jsx(Ce,{userId:S,open:!0,onOpenChange:s=>r(s),onSave:H})]})]})})};export{Ee as default};
