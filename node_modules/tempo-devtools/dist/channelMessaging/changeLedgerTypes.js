"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.reconstructChangeLedgerClass = exports.UnknownChange = exports.UpdateClassesChange = exports.RedoChange = exports.UndoChange = exports.EditTextChange = exports.RemoveClassChange = exports.AddClassChange = exports.ChangeTagChange = exports.DuplicateChange = exports.WrapDivChange = exports.ChangePropChange = exports.RemoveJsxChange = exports.MoveJsxChange = exports.AddJsxChange = exports.StylingChange = exports.ChangeLedgerItem = exports.CHANGE_TYPES_WITH_INSTANT_UNDO = exports.ChangeType = exports.StylingFramework = void 0;
const tempoElement_1 = require("./tempoElement");
const uuid_1 = require("uuid");
// Matches the file in tempo-devtools
var StylingFramework;
(function (StylingFramework) {
    StylingFramework["INLINE"] = "Inline";
    StylingFramework["CSS"] = "CSS";
    StylingFramework["TAILWIND"] = "Tailwind";
})(StylingFramework || (exports.StylingFramework = StylingFramework = {}));
var ChangeType;
(function (ChangeType) {
    ChangeType["STYLING"] = "STYLING";
    ChangeType["ADD_JSX"] = "ADD_JSX";
    ChangeType["MOVE_JSX"] = "MOVE_JSX";
    ChangeType["REMOVE_JSX"] = "REMOVE_JSX";
    ChangeType["CHANGE_PROP"] = "CHANGE_PROP";
    ChangeType["ADD_CLASS"] = "ADD_CLASS";
    ChangeType["REMOVE_CLASS"] = "REMOVE_CLASS";
    ChangeType["UPDATE_CLASSES"] = "UPDATE_CLASSES";
    ChangeType["EDIT_TEXT"] = "EDIT_TEXT";
    ChangeType["WRAP_DIV"] = "WRAP_DIV";
    ChangeType["CHANGE_TAG"] = "CHANGE_TAG";
    ChangeType["DUPLICATE"] = "DUPLICATE";
    ChangeType["UNDO"] = "UNDO";
    ChangeType["REDO"] = "REDO";
    ChangeType["UNKNOWN"] = "UNKNOWN";
})(ChangeType || (exports.ChangeType = ChangeType = {}));
// Make sure to match this in both tempo-devtools & ** tempo-api ** (in the undo/redo file)
exports.CHANGE_TYPES_WITH_INSTANT_UNDO = [
    ChangeType.REMOVE_JSX,
    ChangeType.ADD_CLASS,
    ChangeType.STYLING,
    ChangeType.UPDATE_CLASSES,
];
class ChangeLedgerItem {
    constructor(type, changeName, changeFields, id) {
        this.prevIdToNewIdMap = {};
        this.id = id || (0, uuid_1.v4)();
        this.type = type;
        this.changeFields = changeFields;
        this.changeName = changeName;
        this._consumed = false;
        this._failed = false;
        this._instantUpdateSent = false;
        this._instantUpdateFinished = false;
        this._instantUpdateSuccessful = false;
        this._sendInstantUpdate = true;
        this.canInstantUpdateWhileFlushing = false;
        this._apiPromise = new Promise((resolve, reject) => {
            this._resolveApi = resolve;
            this._rejectApi = reject;
        });
    }
    resolveApi(data) {
        var _a;
        (_a = this._resolveApi) === null || _a === void 0 ? void 0 : _a.call(this, data);
    }
    rejectApi(reason) {
        var _a;
        if (this._apiRejectionAdded) {
            (_a = this._rejectApi) === null || _a === void 0 ? void 0 : _a.call(this, reason);
        }
    }
    needsToSendInstantUpdate() {
        return !this._instantUpdateSent && this._sendInstantUpdate;
    }
    markInstantUpdateSent() {
        this._instantUpdateSent = true;
    }
    markInstantUpdateFinished(instantUpdateData, instantUpdateSuccessful) {
        this._instantUpdateFinished = true;
        this._instantUpdateSuccessful = instantUpdateSuccessful;
        this._instantUpdateData = instantUpdateData;
    }
    getInstantUpdateData() {
        return this._instantUpdateData;
    }
    wasInstantUpdateSuccessful() {
        return this._instantUpdateSuccessful;
    }
    isInstantUpdateFinished() {
        return this._instantUpdateFinished;
    }
    markProcessedSucceeded() {
        this._consumed = true;
    }
    markProcessedFailed() {
        this._failed = true;
        this._consumed = true;
    }
    isFailed() {
        return this._failed;
    }
    needToProcessChange() {
        return !this._consumed;
    }
    onApiResolve(onFulfilled) {
        return this._apiPromise.then(onFulfilled);
    }
    onApiReject(onRejected) {
        this._apiRejectionAdded = true;
        return this._apiPromise.catch(onRejected);
    }
    doNotSendInstantUpdate() {
        this._sendInstantUpdate = false;
    }
    // For selecting/deslecting new elements after instant updates
    clearSelectedElementsAfterInstantUpdate() {
        this.elementKeyToSelectAfterInstantUpdate = null;
        this.elementKeysToMultiselectAfterInstantUpdate = null;
    }
    setSelectedElementsAfterInstantUpdate(selectedElementKey, multiselectedElementKeys) {
        this.elementKeyToSelectAfterInstantUpdate = selectedElementKey;
        this.elementKeysToMultiselectAfterInstantUpdate = multiselectedElementKeys;
    }
    clearSelectedElementsAfterUndoInstantUpdate() {
        this.elementKeyToSelectAfterUndoInstantUpdate = null;
        this.elementKeysToMultiselectAfterUndoInstantUpdate = null;
    }
    setSelectedElementsAfterUndoInstantUpdate(selectedElementKey, multiselectedElementKeys) {
        this.elementKeyToSelectAfterUndoInstantUpdate = selectedElementKey;
        this.elementKeysToMultiselectAfterUndoInstantUpdate =
            multiselectedElementKeys;
    }
    getElementKeyToSelectAfterInstantUpdate() {
        return this.elementKeyToSelectAfterInstantUpdate;
    }
    getElementKeysToMultiselectAfterInstantUpdate() {
        return this.elementKeysToMultiselectAfterInstantUpdate;
    }
    getElementKeyToSelectAfterUndoInstantUpdate() {
        return this.elementKeyToSelectAfterUndoInstantUpdate;
    }
    getElementKeysToMultiselectAfterUndoInstantUpdate() {
        return this.elementKeysToMultiselectAfterUndoInstantUpdate;
    }
    applyAllCodebaseIdChanges(prevIdToNewIdMap) {
        var _a, _b;
        const getNewKey = (prevKey) => {
            if (!prevKey) {
                return null;
            }
            const tempoElement = tempoElement_1.TempoElement.fromKey(prevKey);
            const codebaseId = tempoElement.codebaseId;
            const newCodebaseId = prevIdToNewIdMap[codebaseId];
            if (newCodebaseId) {
                return new tempoElement_1.TempoElement(newCodebaseId, tempoElement.storyboardId, tempoElement.uniquePath).getKey();
            }
            return null;
        };
        /*
         * Instant update fields
         */
        if (this.elementKeyToSelectAfterInstantUpdate) {
            const newElementKey = getNewKey(this.elementKeyToSelectAfterInstantUpdate);
            this.elementKeyToSelectAfterInstantUpdate =
                newElementKey || this.elementKeyToSelectAfterInstantUpdate;
        }
        if (this.elementKeysToMultiselectAfterInstantUpdate) {
            this.elementKeysToMultiselectAfterInstantUpdate =
                (_a = this.elementKeysToMultiselectAfterInstantUpdate) === null || _a === void 0 ? void 0 : _a.map((key) => {
                    const newKey = getNewKey(key);
                    return newKey || key;
                });
        }
        /*
         * Undo instant update fields
         */
        if (this.elementKeyToSelectAfterUndoInstantUpdate) {
            const newElementKey = getNewKey(this.elementKeyToSelectAfterUndoInstantUpdate);
            this.elementKeyToSelectAfterUndoInstantUpdate =
                newElementKey || this.elementKeyToSelectAfterUndoInstantUpdate;
        }
        if (this.elementKeysToMultiselectAfterUndoInstantUpdate) {
            this.elementKeysToMultiselectAfterUndoInstantUpdate =
                (_b = this.elementKeysToMultiselectAfterUndoInstantUpdate) === null || _b === void 0 ? void 0 : _b.map((key) => {
                    const newKey = getNewKey(key);
                    return newKey || key;
                });
        }
        this.applyCodebaseIdChanges(prevIdToNewIdMap);
    }
}
exports.ChangeLedgerItem = ChangeLedgerItem;
class StylingChange extends ChangeLedgerItem {
    constructor(changeFields, id) {
        super(ChangeType.STYLING, 'Styling', changeFields, id);
        // Allow instant updates while flushing
        this.canInstantUpdateWhileFlushing = true;
    }
    prepareApiRequest(canvasId, treeElementLookup) {
        const { codebaseId, stylingChanges, stylingFramework, modifiers, customProperties, } = this.changeFields;
        return {
            urlPath: `canvases/${canvasId}/parseAndMutate/mutate/styling`,
            body: {
                reactElement: treeElementLookup[codebaseId],
                styling: stylingChanges,
                stylingFramework,
                modifiers,
                customProperties,
            },
        };
    }
    applyCodebaseIdChanges(prevIdToNewIdMap) {
        const newCodebaseId = prevIdToNewIdMap[this.changeFields.codebaseId];
        if (newCodebaseId) {
            this.changeFields.codebaseId = newCodebaseId;
        }
    }
}
exports.StylingChange = StylingChange;
class AddJsxChange extends ChangeLedgerItem {
    constructor(changeFields, id) {
        super(ChangeType.ADD_JSX, 'Add Element', changeFields, id);
    }
    prepareApiRequest(canvasId, treeElementLookup) {
        const { codebaseIdToAddTo, beforeCodebaseId, afterCodebaseId, addCodebaseId, addNativeTag, fileContentsToSourceFrom, fileContentsSourceFilename, propsToSet, deletedStoryboardId, htmlForInstantUpdate, extraPathToContents, } = this.changeFields;
        const body = {
            destinationElement: treeElementLookup[codebaseIdToAddTo],
            beforeElement: treeElementLookup[beforeCodebaseId || ''],
            afterElement: treeElementLookup[afterCodebaseId || ''],
            newElement: {},
            canvasId,
            deletedStoryboardId,
            fileContentsToSourceFrom,
            fileContentsSourceFilename,
            extraFiles: extraPathToContents,
        };
        if (addCodebaseId) {
            body.newElement = Object.assign({}, treeElementLookup[addCodebaseId]);
        }
        else if (addNativeTag) {
            body.newElement['type'] = 'native';
            body.newElement['nativeTag'] = addNativeTag;
            body.newElement['componentName'] = addNativeTag;
        }
        if (propsToSet) {
            body.newElement['propsToSet'] = propsToSet;
        }
        if (!Object.keys(body.newElement).length) {
            delete body.newElement;
        }
        const hasInstantUpdate = Boolean(htmlForInstantUpdate);
        body['hasInstantUpdate'] = hasInstantUpdate;
        return {
            urlPath: `canvases/${canvasId}/parseAndMutate/mutate/addJsxElement`,
            body,
            // Only show the success message if we do not have instant updates
            successToastMessage: hasInstantUpdate ? undefined : 'Successfully added',
        };
    }
    applyCodebaseIdChanges(prevIdToNewIdMap) {
        const fieldsToApply = [
            'codebaseIdToAddTo',
            'beforeCodebaseId',
            'afterCodebaseId',
            'addCodebaseId',
        ];
        fieldsToApply.forEach((field) => {
            // @ts-ignore
            const newCodebaseId = prevIdToNewIdMap[this.changeFields[field]];
            if (newCodebaseId) {
                // @ts-ignore
                this.changeFields[field] = newCodebaseId;
            }
        });
    }
}
exports.AddJsxChange = AddJsxChange;
class MoveJsxChange extends ChangeLedgerItem {
    constructor(changeFields, id) {
        super(ChangeType.MOVE_JSX, 'Move Element', changeFields, id);
    }
    prepareApiRequest(canvasId, treeElementLookup) {
        const { codebaseIdToMoveTo, codebaseIdToMove, afterCodebaseId, beforeCodebaseId, expectedCurrentParentCodebaseId, } = this.changeFields;
        return {
            urlPath: `canvases/${canvasId}/parseAndMutate/mutate/moveJsxElement`,
            body: {
                elementToMove: treeElementLookup[codebaseIdToMove],
                newContainerElement: treeElementLookup[codebaseIdToMoveTo],
                afterElement: treeElementLookup[afterCodebaseId || ''],
                beforeElement: treeElementLookup[beforeCodebaseId || ''],
                expectedCurrentParent: treeElementLookup[expectedCurrentParentCodebaseId || ''],
            },
        };
    }
    applyCodebaseIdChanges(prevIdToNewIdMap) {
        const fieldsToApply = [
            'codebaseIdToMoveTo',
            'codebaseIdToMove',
            'afterCodebaseId',
            'beforeCodebaseId',
            'expectedCurrentParentCodebaseId',
        ];
        fieldsToApply.forEach((field) => {
            // @ts-ignore
            const newCodebaseId = prevIdToNewIdMap[this.changeFields[field]];
            if (newCodebaseId) {
                // @ts-ignore
                this.changeFields[field] = newCodebaseId;
            }
        });
    }
}
exports.MoveJsxChange = MoveJsxChange;
class RemoveJsxChange extends ChangeLedgerItem {
    constructor(changeFields, id) {
        // Deduplicate the codebaseIdsToRemove
        changeFields.codebaseIdsToRemove = Array.from(new Set(changeFields.codebaseIdsToRemove));
        super(ChangeType.REMOVE_JSX, 'Delete Element', changeFields, id);
    }
    prepareApiRequest(canvasId, treeElementLookup) {
        const { codebaseIdsToRemove } = this.changeFields;
        return {
            urlPath: `canvases/${canvasId}/parseAndMutate/mutate/removeJsxElement`,
            body: {
                elementsToRemove: codebaseIdsToRemove
                    .map((codebaseId) => treeElementLookup[codebaseId])
                    .filter((element) => element),
            },
        };
    }
    applyCodebaseIdChanges(prevIdToNewIdMap) {
        this.changeFields.codebaseIdsToRemove =
            this.changeFields.codebaseIdsToRemove.map((codebaseId) => {
                const newCodebaseId = prevIdToNewIdMap[codebaseId];
                if (newCodebaseId) {
                    return newCodebaseId;
                }
                return codebaseId;
            });
    }
}
exports.RemoveJsxChange = RemoveJsxChange;
class ChangePropChange extends ChangeLedgerItem {
    constructor(changeFields, id) {
        super(ChangeType.CHANGE_PROP, 'Change Prop', changeFields, id);
    }
    prepareApiRequest(canvasId, treeElementLookup) {
        const { codebaseIdToChange, propName, propValue } = this.changeFields;
        return {
            urlPath: `canvases/${canvasId}/parseAndMutate/mutate/changePropValue`,
            body: {
                elementToModify: treeElementLookup[codebaseIdToChange],
                propName,
                propValue,
            },
            successToastMessage: 'Prop changed',
        };
    }
    applyCodebaseIdChanges(prevIdToNewIdMap) {
        const newCodebaseId = prevIdToNewIdMap[this.changeFields.codebaseIdToChange];
        if (newCodebaseId) {
            this.changeFields.codebaseIdToChange = newCodebaseId;
        }
    }
}
exports.ChangePropChange = ChangePropChange;
class WrapDivChange extends ChangeLedgerItem {
    constructor(changeFields, id) {
        // Deduplicate the codebaseIdsToWrap
        changeFields.codebaseIdsToWrap = Array.from(new Set(changeFields.codebaseIdsToWrap));
        super(ChangeType.WRAP_DIV, 'Wrap In Div', changeFields, id);
    }
    prepareApiRequest(canvasId, treeElementLookup) {
        const { codebaseIdsToWrap } = this.changeFields;
        return {
            urlPath: `canvases/${canvasId}/parseAndMutate/mutate/wrapInDiv`,
            body: {
                reactElements: codebaseIdsToWrap.map((codebaseId) => treeElementLookup[codebaseId]),
            },
        };
    }
    applyCodebaseIdChanges(prevIdToNewIdMap) {
        this.changeFields.codebaseIdsToWrap =
            this.changeFields.codebaseIdsToWrap.map((codebaseId) => {
                const newCodebaseId = prevIdToNewIdMap[codebaseId];
                if (newCodebaseId) {
                    return newCodebaseId;
                }
                return codebaseId;
            });
    }
}
exports.WrapDivChange = WrapDivChange;
class DuplicateChange extends ChangeLedgerItem {
    constructor(changeFields, id) {
        // Deduplicate the codebaseIdsToDuplicate
        changeFields.codebaseIdsToDuplicate = Array.from(new Set(changeFields.codebaseIdsToDuplicate));
        super(ChangeType.DUPLICATE, 'Duplicate', changeFields, id);
    }
    prepareApiRequest(canvasId, treeElementLookup) {
        const { codebaseIdsToDuplicate } = this.changeFields;
        return {
            urlPath: `canvases/${canvasId}/parseAndMutate/mutate/duplicate`,
            body: {
                reactElements: codebaseIdsToDuplicate.map((codebaseId) => treeElementLookup[codebaseId]),
            },
        };
    }
    applyCodebaseIdChanges(prevIdToNewIdMap) {
        this.changeFields.codebaseIdsToDuplicate =
            this.changeFields.codebaseIdsToDuplicate.map((codebaseId) => {
                const newCodebaseId = prevIdToNewIdMap[codebaseId];
                if (newCodebaseId) {
                    return newCodebaseId;
                }
                return codebaseId;
            });
    }
}
exports.DuplicateChange = DuplicateChange;
class ChangeTagChange extends ChangeLedgerItem {
    constructor(changeFields, id) {
        super(ChangeType.CHANGE_TAG, 'Change Tag Name', changeFields, id);
    }
    prepareApiRequest(canvasId, treeElementLookup) {
        const { codebaseIdToChange, newTagName } = this.changeFields;
        return {
            urlPath: `canvases/${canvasId}/parseAndMutate/mutate/changeElementTag`,
            body: {
                elementToModify: treeElementLookup[codebaseIdToChange],
                newTag: newTagName,
            },
        };
    }
    applyCodebaseIdChanges(prevIdToNewIdMap) {
        const newCodebaseId = prevIdToNewIdMap[this.changeFields.codebaseIdToChange];
        if (newCodebaseId) {
            this.changeFields.codebaseIdToChange = newCodebaseId;
        }
    }
}
exports.ChangeTagChange = ChangeTagChange;
class AddClassChange extends ChangeLedgerItem {
    constructor(changeFields, id) {
        super(ChangeType.ADD_CLASS, 'Add Class', changeFields, id);
        this.canInstantUpdateWhileFlushing = true;
    }
    prepareApiRequest(canvasId, treeElementLookup) {
        const { codebaseIdToAddClass, className, addingTailwindClass, modifiers, customProperties, } = this.changeFields;
        return {
            urlPath: `canvases/${canvasId}/parseAndMutate/mutate/addClass`,
            body: {
                reactElement: treeElementLookup[codebaseIdToAddClass],
                className,
                stylingFramework: addingTailwindClass
                    ? StylingFramework.TAILWIND
                    : null,
                modifiers,
                customProperties,
            },
        };
    }
    applyCodebaseIdChanges(prevIdToNewIdMap) {
        const newCodebaseId = prevIdToNewIdMap[this.changeFields.codebaseIdToAddClass];
        if (newCodebaseId) {
            this.changeFields.codebaseIdToAddClass = newCodebaseId;
        }
    }
}
exports.AddClassChange = AddClassChange;
class RemoveClassChange extends ChangeLedgerItem {
    constructor(changeFields, id) {
        super(ChangeType.REMOVE_CLASS, 'Remove Class', changeFields, id);
    }
    prepareApiRequest(canvasId, treeElementLookup) {
        const { codebaseIdToRemoveClass, className } = this.changeFields;
        return {
            urlPath: `canvases/${canvasId}/parseAndMutate/mutate/removeClass`,
            body: {
                reactElement: treeElementLookup[codebaseIdToRemoveClass],
                className,
            },
        };
    }
    applyCodebaseIdChanges(prevIdToNewIdMap) {
        const newCodebaseId = prevIdToNewIdMap[this.changeFields.codebaseIdToRemoveClass];
        if (newCodebaseId) {
            this.changeFields.codebaseIdToRemoveClass = newCodebaseId;
        }
    }
}
exports.RemoveClassChange = RemoveClassChange;
class EditTextChange extends ChangeLedgerItem {
    constructor(changeFields, id) {
        super(ChangeType.EDIT_TEXT, 'Edit Text', changeFields, id);
    }
    prepareApiRequest(canvasId, treeElementLookup) {
        const { codebaseIdToEditText, newText, oldText } = this.changeFields;
        return {
            urlPath: `canvases/${canvasId}/parseAndMutate/mutate/editText`,
            body: {
                element: treeElementLookup[codebaseIdToEditText],
                newText,
                oldText,
            },
        };
    }
    applyCodebaseIdChanges(prevIdToNewIdMap) {
        const newCodebaseId = prevIdToNewIdMap[this.changeFields.codebaseIdToEditText];
        if (newCodebaseId) {
            this.changeFields.codebaseIdToEditText = newCodebaseId;
        }
    }
}
exports.EditTextChange = EditTextChange;
class UndoChange extends ChangeLedgerItem {
    constructor(changeFields, id) {
        var _a;
        super(ChangeType.UNDO, 'Undo', changeFields, id);
        if ((_a = changeFields.changeToUndo) === null || _a === void 0 ? void 0 : _a.canInstantUpdateWhileFlushing) {
            this.canInstantUpdateWhileFlushing = true;
        }
    }
    prepareApiRequest(canvasId, treeElementLookup) {
        return {
            urlPath: `canvases/${canvasId}/parseAndMutate/activities/undoChangeToFiles`,
            body: {},
        };
    }
    applyCodebaseIdChanges(prevIdToNewIdMap) {
        // Do nothing
    }
}
exports.UndoChange = UndoChange;
class RedoChange extends ChangeLedgerItem {
    constructor(changeFields, id) {
        var _a;
        super(ChangeType.REDO, 'Redo', changeFields, id);
        if ((_a = changeFields.changeToRedo) === null || _a === void 0 ? void 0 : _a.canInstantUpdateWhileFlushing) {
            this.canInstantUpdateWhileFlushing = true;
        }
    }
    prepareApiRequest(canvasId, treeElementLookup) {
        return {
            urlPath: `canvases/${canvasId}/parseAndMutate/activities/redoChangeToFiles`,
            body: {},
        };
    }
    applyCodebaseIdChanges(prevIdToNewIdMap) {
        // Do nothing
    }
}
exports.RedoChange = RedoChange;
class UpdateClassesChange extends ChangeLedgerItem {
    constructor(changeFields, id) {
        super(ChangeType.UPDATE_CLASSES, 'Update Classes', changeFields, id);
        this.canInstantUpdateWhileFlushing = true;
    }
    prepareApiRequest(canvasId, treeElementLookup) {
        const { codebaseIdToUpdateClass, newClasses, oldClasses, involvedClasses } = this.changeFields;
        return {
            urlPath: `canvases/${canvasId}/parseAndMutate/mutate/updateClasses`,
            body: {
                reactElement: treeElementLookup[codebaseIdToUpdateClass],
                newClasses,
                oldClasses,
                involvedClasses,
            },
        };
    }
    applyCodebaseIdChanges(prevIdToNewIdMap) {
        const newCodebaseId = prevIdToNewIdMap[this.changeFields.codebaseIdToUpdateClass];
        if (newCodebaseId) {
            this.changeFields.codebaseIdToUpdateClass = newCodebaseId;
        }
    }
}
exports.UpdateClassesChange = UpdateClassesChange;
class UnknownChange extends ChangeLedgerItem {
    constructor(changeFields, id) {
        super(ChangeType.UNKNOWN, '', changeFields, id);
        // Do not process unknown changes
        this.markProcessedSucceeded();
        this.doNotSendInstantUpdate();
    }
    prepareApiRequest(canvasId, treeElementLookup) {
        throw Error('Unsupported operation');
        // For typing
        return {
            urlPath: ``,
            body: {},
        };
    }
    applyCodebaseIdChanges(prevIdToNewIdMap) {
        // Do nothing
    }
}
exports.UnknownChange = UnknownChange;
/**
 * When serializing a change ledger item to a plain JS object, the class functions
 * are lost. This recreates the change item that was lost
 */
const reconstructChangeLedgerClass = (plainJsObject) => {
    if (!plainJsObject || !plainJsObject.type) {
        return null;
    }
    const changeType = plainJsObject.type;
    const changeFields = plainJsObject.changeFields;
    const id = plainJsObject.id;
    const getChangeForType = () => {
        switch (changeType) {
            case ChangeType.STYLING:
                return new StylingChange(changeFields, id);
            case ChangeType.ADD_JSX:
                return new AddJsxChange(changeFields, id);
            case ChangeType.REMOVE_JSX:
                return new RemoveJsxChange(changeFields, id);
            case ChangeType.MOVE_JSX:
                return new MoveJsxChange(changeFields, id);
            case ChangeType.CHANGE_PROP:
                return new ChangePropChange(changeFields, id);
            case ChangeType.ADD_CLASS:
                return new AddClassChange(changeFields, id);
            case ChangeType.REMOVE_CLASS:
                return new RemoveClassChange(changeFields, id);
            case ChangeType.UPDATE_CLASSES:
                return new UpdateClassesChange(changeFields, id);
            case ChangeType.WRAP_DIV:
                return new WrapDivChange(changeFields, id);
            case ChangeType.CHANGE_TAG:
                return new ChangeTagChange(changeFields, id);
            case ChangeType.DUPLICATE:
                return new DuplicateChange(changeFields, id);
            case ChangeType.EDIT_TEXT:
                return new EditTextChange(changeFields, id);
            case ChangeType.UNDO:
                changeFields.changeToUndo = (0, exports.reconstructChangeLedgerClass)(changeFields.changeToUndo);
                return new UndoChange(changeFields, id);
            case ChangeType.REDO:
                changeFields.changeToRedo = (0, exports.reconstructChangeLedgerClass)(changeFields.changeToRedo);
                return new RedoChange(changeFields, id);
            case ChangeType.UNKNOWN:
                return new UnknownChange(changeFields, id);
            default:
                throw new Error(`Unknown change type: ${changeType}`);
        }
    };
    // Set all the other fields on the change object
    const change = getChangeForType();
    Object.keys(plainJsObject).forEach((key) => {
        if (['type', 'changeFields', 'id'].includes(key)) {
            return;
        }
        // @ts-ignore
        change[key] = plainJsObject[key];
    });
    return change;
};
exports.reconstructChangeLedgerClass = reconstructChangeLedgerClass;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhbmdlTGVkZ2VyVHlwZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvY2hhbm5lbE1lc3NhZ2luZy9jaGFuZ2VMZWRnZXJUeXBlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxpREFBOEM7QUFDOUMsK0JBQW9DO0FBRXBDLHFDQUFxQztBQUNyQyxJQUFZLGdCQUlYO0FBSkQsV0FBWSxnQkFBZ0I7SUFDMUIscUNBQWlCLENBQUE7SUFDakIsK0JBQVcsQ0FBQTtJQUNYLHlDQUFxQixDQUFBO0FBQ3ZCLENBQUMsRUFKVyxnQkFBZ0IsZ0NBQWhCLGdCQUFnQixRQUkzQjtBQU9ELElBQVksVUFnQlg7QUFoQkQsV0FBWSxVQUFVO0lBQ3BCLGlDQUFtQixDQUFBO0lBQ25CLGlDQUFtQixDQUFBO0lBQ25CLG1DQUFxQixDQUFBO0lBQ3JCLHVDQUF5QixDQUFBO0lBQ3pCLHlDQUEyQixDQUFBO0lBQzNCLHFDQUF1QixDQUFBO0lBQ3ZCLDJDQUE2QixDQUFBO0lBQzdCLCtDQUFpQyxDQUFBO0lBQ2pDLHFDQUF1QixDQUFBO0lBQ3ZCLG1DQUFxQixDQUFBO0lBQ3JCLHVDQUF5QixDQUFBO0lBQ3pCLHFDQUF1QixDQUFBO0lBQ3ZCLDJCQUFhLENBQUE7SUFDYiwyQkFBYSxDQUFBO0lBQ2IsaUNBQW1CLENBQUE7QUFDckIsQ0FBQyxFQWhCVyxVQUFVLDBCQUFWLFVBQVUsUUFnQnJCO0FBRUQsMkZBQTJGO0FBQzlFLFFBQUEsOEJBQThCLEdBQUc7SUFDNUMsVUFBVSxDQUFDLFVBQVU7SUFDckIsVUFBVSxDQUFDLFNBQVM7SUFDcEIsVUFBVSxDQUFDLE9BQU87SUFDbEIsVUFBVSxDQUFDLGNBQWM7Q0FDMUIsQ0FBQztBQUVGLE1BQXNCLGdCQUFnQjtJQXVEcEMsWUFDRSxJQUFnQixFQUNoQixVQUFrQixFQUNsQixZQUFlLEVBQ2YsRUFBVztRQTdDTixxQkFBZ0IsR0FBaUMsRUFBRSxDQUFDO1FBK0N6RCxJQUFJLENBQUMsRUFB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QVUsQ0FBQyxPQUFPO2dCQUNyQixPQUFPLElBQUksYUFBYSxDQUFDLFlBQVksRUFBRSxFQUFFLENBQUMsQ0FBQztZQUM3QztnQkFDRSxNQUFNLElBQUksS0FBSyxDQUFDLHdCQUF3QixVQUFVLEVBQUUsQ0FBQyxDQUFDO1NBQ3pEO0lBQ0gsQ0FBQyxDQUFDO0lBRUYsZ0RBQWdEO0lBQ2hELE1BQU0sTUFBTSxHQUFHLGdCQUFnQixFQUFFLENBQUM7SUFDbEMsTUFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFXLEVBQUUsRUFBRTtRQUNqRCxJQUFJLENBQUMsTUFBTSxFQUFFLGNBQWMsRUFBRSxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDaEQsT0FBTztTQUNSO1FBRUQsYUFBYTtRQUNiLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDbkMsQ0FBQyxDQUFDLENBQUM7SUFFSCxPQUFPLE1BQU0sQ0FBQztBQUNoQixDQUFDLENBQUM7QUFsRVcsUUFBQSw0QkFBNEIsZ0NBa0V2QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlbXBvRWxlbWVudCB9IGZyb20gJy4vdGVtcG9FbGVtZW50JztcbmltcG9ydCB7IHY0IGFzIHV1aWR2NCB9IGZyb20gJ3V1aWQnO1xuXG4vLyBNYXRjaGVzIHRoZSBmaWxlIGluIHRlbXBvLWRldnRvb2xzXG5leHBvcnQgZW51bSBTdHlsaW5nRnJhbWV3b3JrIHtcbiAgSU5MSU5FID0gJ0lubGluZScsXG4gIENTUyA9ICdDU1MnLFxuICBUQUlMV0lORCA9ICdUYWlsd2luZCcsXG59XG5cbnR5cGUgQ2xhc3NUeXBlID0ge1xuICB0YWlsd2luZDogc3RyaW5nO1xuICBjc3M6IHN0cmluZztcbn07XG5cbmV4cG9ydCBlbnVtIENoYW5nZVR5cGUge1xuICBTVFlMSU5HID0gJ1NUWUxJTkcnLFxuICBBRERfSlNYID0gJ0FERF9KU1gnLFxuICBNT1ZFX0pTWCA9ICdNT1ZFX0pTWCcsXG4gIFJFTU9WRV9KU1ggPSAnUkVNT1ZFX0pTWCcsXG4gIENIQU5HRV9QUk9QID0gJ0NIQU5HRV9QUk9QJyxcbiAgQUREX0NMQVNTID0gJ0FERF9DTEFTUycsXG4gIFJFTU9WRV9DTEFTUyA9ICdSRU1PVkVfQ0xBU1MnLFxuICBVUERBVEVfQ0xBU1NFUyA9ICdVUERBVEVfQ0xBU1NFUycsXG4gIEVESVRfVEVYVCA9ICdFRElUX1RFWFQnLFxuICBXUkFQX0RJViA9ICdXUkFQX0RJVicsXG4gIENIQU5HRV9UQUcgPSAnQ0hBTkdFX1RBRycsXG4gIERVUExJQ0FURSA9ICdEVVBMSUNBVEUnLFxuICBVTkRPID0gJ1VORE8nLFxuICBSRURPID0gJ1JFRE8nLFxuICBVTktOT1dOID0gJ1VOS05PV04nLFxufVxuXG4vLyBNYWtlIHN1cmUgdG8gbWF0Y2ggdGhpcyBpbiBib3RoIHRlbXBvLWRldnRvb2xzICYgKiogdGVtcG8tYXBpICoqIChpbiB0aGUgdW5kby9yZWRvIGZpbGUpXG5leHBvcnQgY29uc3QgQ0hBTkdFX1RZUEVTX1dJVEhfSU5TVEFOVF9VTkRPID0gW1xuICBDaGFuZ2VUeXBlLlJFTU9WRV9KU1gsXG4gIENoYW5nZVR5cGUuQUREX0NMQVNTLFxuICBDaGFuZ2VUeXBlLlNUWUxJTkcsXG4gIENoYW5nZVR5cGUuVVBEQVRFX0NMQVNTRVMsXG5dO1xuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQ2hhbmdlTGVkZ2VySXRlbTxUPiB7XG4gIHB1YmxpYyBpZDogc3RyaW5nO1xuICBwdWJsaWMgdHlwZTogQ2hhbmdlVHlwZTtcbiAgcHVibGljIGNoYW5nZU5hbWU6IHN0cmluZztcbiAgcHVibGljIGluZGV4SW5MZWRnZXI/OiBudW1iZXI7XG4gIHB1YmxpYyBjaGFuZ2VGaWVsZHM6IFQ7XG5cbiAgcHVibGljIGNhbkluc3RhbnRVcGRhdGVXaGlsZUZsdXNoaW5nOiBib29sZWFuO1xuXG4gIHB1YmxpYyBhc1VuZG9PZkFjdGl2aXR5SWQ/OiBzdHJpbmc7XG4gIHB1YmxpYyBhc1JlZG9PZkFjdGl2aXR5SWQ/OiBzdHJpbmc7XG5cbiAgLy8gVGhlc2UgdHdvIGZpZWxkcyBhcmUgc2V0IGFmdGVyIHRoZSBBUEkgcmVxdWVzdCBjb21wbGV0ZXNcbiAgcHVibGljIGFjdGl2aXR5SWQ/OiBzdHJpbmc7XG4gIHB1YmxpYyBwcmV2SWRUb05ld0lkTWFwOiB7IFtwcmV2SWQ6IHN0cmluZ106IHN0cmluZyB9ID0ge307XG5cbiAgcHVibGljIGNoYW5nZVVuZG9uZT86IGJvb2xlYW47XG4gIHB1YmxpYyB0b2FzdElkPzogc3RyaW5nIHwgbnVtYmVyO1xuICBwdWJsaWMgc2hvd2VkVG9hc3RJbnN0ZWFkT2ZJbnN0YW50VXBkYXRlPzogYm9vbGVhbjtcblxuICBwcml2YXRlIF9jb25zdW1lZDogYm9vbGVhbjtcbiAgcHJpdmF0ZSBfZmFpbGVkOiBib29sZWFuO1xuXG4gIHByaXZhdGUgX2luc3RhbnRVcGRhdGVTZW50OiBib29sZWFuO1xuICBwcml2YXRlIF9pbnN0YW50VXBkYXRlRmluaXNoZWQ6IGJvb2xlYW47XG4gIHByaXZhdGUgX2luc3RhbnRVcGRhdGVTdWNjZXNzZnVsOiBib29sZWFuO1xuICBwcml2YXRlIF9zZW5kSW5zdGFudFVwZGF0ZTogYm9vbGVhbjtcblxuICAvLyBFeHRyYSBkYXRhIGdpdmVuIGFmdGVyIHRoZSBpbnN0YW50IHVwZGF0ZSAoZS5nLiB0aGUgaW5uZXIgSFRNTCBmb3IgZGVsZXRlZCBlbGVtZW50cylcbiAgcHJpdmF0ZSBfaW5zdGFudFVwZGF0ZURhdGE/OiBhbnk7XG5cbiAgLy8gQWZ0ZXIgaW5zdGFudCB1cGRhdGUsIHdoaWNoIHNlbGVjdGVkIGVsZW1lbnQga2V5ICYgbXVsdGlzZWxlY3RlZCBlbGVtZW50IGtleXMgdG8gc2V0XG4gIC8vIE5vdGUgLT4gd2UgYXJlIG5vdCB1c2luZyBjYWxsYmFja3MgZm9yIHRoZSB1bmRvIGluc3RhbnQgdXBkYXRlIGJlY2F1c2Ugd2Ugc3RvcmUgdGhpcyBpblxuICAvLyBsb2NhbCBzdG9yYWdlIHRoZW4gZGVzZXJpYWxpemUgaXQsIHNvIHRoZSBjYWxsYmFja3MgYXJlIGxvc3RcbiAgLy8gQWxzbyBOb3RlIC0+IHRoZXNlIGVsZW1lbnQga2V5cyBhcmUgc2VsZWN0ZWQgZXhwbGljaXRseSBpbiB0ZW1wby1kZXZ0b29sc1xuICAvLyB3aGVyZSB0aGUgaW5zdGFudCB1cGRhdGVzIGFyZSBwZXJmb3JtZWQgKGNoYW5nZSBpdGVtIGZ1bmN0aW9ucylcblxuICAvLyBGb3IgaW5zdGFudCB1cGRhdGVcbiAgLy8gTnVsbCB3aWxsIGJlIHNldCwgd2hpbGUgdW5kZWZpbmVkIHdpbGwgYmUgaWdub3JlZFxuICBwcml2YXRlIGVsZW1lbnRLZXlUb1NlbGVjdEFmdGVySW5zdGFudFVwZGF0ZT86IHN0cmluZyB8IG51bGw7XG4gIHByaXZhdGUgZWxlbWVudEtleXNUb011bHRpc2VsZWN0QWZ0ZXJJbnN0YW50VXBkYXRlPzogc3RyaW5nW10gfCBudWxsO1xuXG4gIC8vIEZvciB1bmRvIGluc3RhbnQgdXBkYXRlXG4gIC8vIE51bGwgd2lsbCBiZSBzZXQsIHdoaWxlIHVuZGVmaW5lZCB3aWxsIGJlIGlnbm9yZWRcbiAgcHJpdmF0ZSBlbGVtZW50S2V5VG9TZWxlY3RBZnRlclVuZG9JbnN0YW50VXBkYXRlPzogc3RyaW5nIHwgbnVsbDtcbiAgcHJpdmF0ZSBlbGVtZW50S2V5c1RvTXVsdGlzZWxlY3RBZnRlclVuZG9JbnN0YW50VXBkYXRlPzogc3RyaW5nW10gfCBudWxsO1xuXG4gIC8vIFJlc29sdmVycyBhZnRlciBBUEkgY2FsbFxuXG4gIHByaXZhdGUgX3Jlc29sdmVBcGk/OiAoZGF0YT86IGFueSkgPT4gdm9pZDtcbiAgcHJpdmF0ZSBfcmVqZWN0QXBpPzogKHJlYXNvbj86IGFueSkgPT4gdm9pZDtcbiAgcHJpdmF0ZSBfYXBpUmVqZWN0aW9uQWRkZWQ/OiBib29sZWFuO1xuXG4gIHByaXZhdGUgX2FwaVByb21pc2U6IFByb21pc2U8dm9pZD47XG5cbiAgY29uc3RydWN0b3IoXG4gICAgdHlwZTogQ2hhbmdlVHlwZSxcbiAgICBjaGFuZ2VOYW1lOiBzdHJpbmcsXG4gICAgY2hhbmdlRmllbGRzOiBULFxuICAgIGlkPzogc3RyaW5nLFxuICApIHtcbiAgICB0aGlzLmlkID0gaWQgfHwgdXVpZHY0KCk7XG4gICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICB0aGlzLmNoYW5nZUZpZWxkcyA9IGNoYW5nZUZpZWxkcztcbiAgICB0aGlzLmNoYW5nZU5hbWUgPSBjaGFuZ2VOYW1lO1xuICAgIHRoaXMuX2NvbnN1bWVkID0gZmFsc2U7XG4gICAgdGhpcy5fZmFpbGVkID0gZmFsc2U7XG4gICAgdGhpcy5faW5zdGFudFVwZGF0ZVNlbnQgPSBmYWxzZTtcbiAgICB0aGlzLl9pbnN0YW50VXBkYXRlRmluaXNoZWQgPSBmYWxzZTtcbiAgICB0aGlzLl9pbnN0YW50VXBkYXRlU3VjY2Vzc2Z1bCA9IGZhbHNlO1xuICAgIHRoaXMuX3NlbmRJbnN0YW50VXBkYXRlID0gdHJ1ZTtcbiAgICB0aGlzLmNhbkluc3RhbnRVcGRhdGVXaGlsZUZsdXNoaW5nID0gZmFsc2U7XG5cbiAgICB0aGlzLl9hcGlQcm9taXNlID0gbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5fcmVzb2x2ZUFwaSA9IHJlc29sdmU7XG4gICAgICB0aGlzLl9yZWplY3RBcGkgPSByZWplY3Q7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgcmVzb2x2ZUFwaShkYXRhPzogYW55KSB7XG4gICAgdGhpcy5fcmVzb2x2ZUFwaT8uKGRhdGEpO1xuICB9XG5cbiAgcHVibGljIHJlamVjdEFwaShyZWFzb24/OiBhbnkpIHtcbiAgICBpZiAodGhpcy5fYXBpUmVqZWN0aW9uQWRkZWQpIHtcbiAgICAgIHRoaXMuX3JlamVjdEFwaT8uKHJlYXNvbik7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIG5lZWRzVG9TZW5kSW5zdGFudFVwZGF0ZSgpIHtcbiAgICByZXR1cm4gIXRoaXMuX2luc3RhbnRVcGRhdGVTZW50ICYmIHRoaXMuX3NlbmRJbnN0YW50VXBkYXRlO1xuICB9XG5cbiAgcHVibGljIG1hcmtJbnN0YW50VXBkYXRlU2VudCgpIHtcbiAgICB0aGlzLl9pbnN0YW50VXBkYXRlU2VudCA9IHRydWU7XG4gIH1cblxuICBwdWJsaWMgbWFya0luc3RhbnRVcGRhdGVGaW5pc2hlZChcbiAgICBpbnN0YW50VXBkYXRlRGF0YTogYW55LFxuICAgIGluc3RhbnRVcGRhdGVTdWNjZXNzZnVsOiBib29sZWFuLFxuICApIHtcbiAgICB0aGlzLl9pbnN0YW50VXBkYXRlRmluaXNoZWQgPSB0cnVlO1xuICAgIHRoaXMuX2luc3RhbnRVcGRhdGVTdWNjZXNzZnVsID0gaW5zdGFudFVwZGF0ZVN1Y2Nlc3NmdWw7XG4gICAgdGhpcy5faW5zdGFudFVwZGF0ZURhdGEgPSBpbnN0YW50VXBkYXRlRGF0YTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRJbnN0YW50VXBkYXRlRGF0YSgpIHtcbiAgICByZXR1cm4gdGhpcy5faW5zdGFudFVwZGF0ZURhdGE7XG4gIH1cblxuICBwdWJsaWMgd2FzSW5zdGFudFVwZGF0ZVN1Y2Nlc3NmdWwoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2luc3RhbnRVcGRhdGVTdWNjZXNzZnVsO1xuICB9XG5cbiAgcHVibGljIGlzSW5zdGFudFVwZGF0ZUZpbmlzaGVkKCkge1xuICAgIHJldHVybiB0aGlzLl9pbnN0YW50VXBkYXRlRmluaXNoZWQ7XG4gIH1cblxuICBwdWJsaWMgbWFya1Byb2Nlc3NlZFN1Y2NlZWRlZCgpIHtcbiAgICB0aGlzLl9jb25zdW1lZCA9IHRydWU7XG4gIH1cblxuICBwdWJsaWMgbWFya1Byb2Nlc3NlZEZhaWxlZCgpIHtcbiAgICB0aGlzLl9mYWlsZWQgPSB0cnVlO1xuICAgIHRoaXMuX2NvbnN1bWVkID0gdHJ1ZTtcbiAgfVxuXG4gIHB1YmxpYyBpc0ZhaWxlZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fZmFpbGVkO1xuICB9XG5cbiAgcHVibGljIG5lZWRUb1Byb2Nlc3NDaGFuZ2UoKSB7XG4gICAgcmV0dXJuICF0aGlzLl9jb25zdW1lZDtcbiAgfVxuXG4gIHB1YmxpYyBvbkFwaVJlc29sdmUob25GdWxmaWxsZWQ6IChkYXRhPzogYW55KSA9PiB2b2lkKSB7XG4gICAgcmV0dXJuIHRoaXMuX2FwaVByb21pc2UudGhlbihvbkZ1bGZpbGxlZCk7XG4gIH1cblxuICBwdWJsaWMgb25BcGlSZWplY3Qob25SZWplY3RlZDogKHJlYXNvbj86IGFueSkgPT4gdm9pZCkge1xuICAgIHRoaXMuX2FwaVJlamVjdGlvbkFkZGVkID0gdHJ1ZTtcbiAgICByZXR1cm4gdGhpcy5fYXBpUHJvbWlzZS5jYXRjaChvblJlamVjdGVkKTtcbiAgfVxuXG4gIGFic3RyYWN0IHByZXBhcmVBcGlSZXF1ZXN0KFxuICAgIGNhbnZhc0lkOiBzdHJpbmcsXG4gICAgdHJlZUVsZW1lbnRMb29rdXA6IHsgW2NvZGViYXNlSWQ6IHN0cmluZ106IGFueSB9LFxuICApOiB7XG4gICAgdXJsUGF0aDogc3RyaW5nO1xuICAgIGJvZHk6IHtcbiAgICAgIFtrZXk6IHN0cmluZ106IGFueTtcbiAgICB9O1xuICAgIHN1Y2Nlc3NUb2FzdE1lc3NhZ2U/OiBzdHJpbmc7XG4gIH07XG5cbiAgcHVibGljIGRvTm90U2VuZEluc3RhbnRVcGRhdGUoKSB7XG4gICAgdGhpcy5fc2VuZEluc3RhbnRVcGRhdGUgPSBmYWxzZTtcbiAgfVxuXG4gIC8vIEZvciBzZWxlY3RpbmcvZGVzbGVjdGluZyBuZXcgZWxlbWVudHMgYWZ0ZXIgaW5zdGFudCB1cGRhdGVzXG5cbiAgcHVibGljIGNsZWFyU2VsZWN0ZWRFbGVtZW50c0FmdGVySW5zdGFudFVwZGF0ZSgpIHtcbiAgICB0aGlzLmVsZW1lbnRLZXlUb1NlbGVjdEFmdGVySW5zdGFudFVwZGF0ZSA9IG51bGw7XG4gICAgdGhpcy5lbGVtZW50S2V5c1RvTXVsdGlzZWxlY3RBZnRlckluc3RhbnRVcGRhdGUgPSBudWxsO1xuICB9XG5cbiAgcHVibGljIHNldFNlbGVjdGVkRWxlbWVudHNBZnRlckluc3RhbnRVcGRhdGUoXG4gICAgc2VsZWN0ZWRFbGVtZW50S2V5OiBzdHJpbmcsXG4gICAgbXVsdGlzZWxlY3RlZEVsZW1lbnRLZXlzOiBzdHJpbmdbXSxcbiAgKSB7XG4gICAgdGhpcy5lbGVtZW50S2V5VG9TZWxlY3RBZnRlckluc3RhbnRVcGRhdGUgPSBzZWxlY3RlZEVsZW1lbnRLZXk7XG4gICAgdGhpcy5lbGVtZW50S2V5c1RvTXVsdGlzZWxlY3RBZnRlckluc3RhbnRVcGRhdGUgPSBtdWx0aXNlbGVjdGVkRWxlbWVudEtleXM7XG4gIH1cblxuICBwdWJsaWMgY2xlYXJTZWxlY3RlZEVsZW1lbnRzQWZ0ZXJVbmRvSW5zdGFudFVwZGF0ZSgpIHtcbiAgICB0aGlzLmVsZW1lbnRLZXlUb1NlbGVjdEFmdGVyVW5kb0luc3RhbnRVcGRhdGUgPSBudWxsO1xuICAgIHRoaXMuZWxlbWVudEtleXNUb011bHRpc2VsZWN0QWZ0ZXJVbmRvSW5zdGFudFVwZGF0ZSA9IG51bGw7XG4gIH1cblxuICBwdWJsaWMgc2V0U2VsZWN0ZWRFbGVtZW50c0FmdGVyVW5kb0luc3RhbnRVcGRhdGUoXG4gICAgc2VsZWN0ZWRFbGVtZW50S2V5OiBzdHJpbmcsXG4gICAgbXVsdGlzZWxlY3RlZEVsZW1lbnRLZXlzOiBzdHJpbmdbXSxcbiAgKSB7XG4gICAgdGhpcy5lbGVtZW50S2V5VG9TZWxlY3RBZnRlclVuZG9JbnN0YW50VXBkYXRlID0gc2VsZWN0ZWRFbGVtZW50S2V5O1xuICAgIHRoaXMuZWxlbWVudEtleXNUb011bHRpc2VsZWN0QWZ0ZXJVbmRvSW5zdGFudFVwZGF0ZSA9XG4gICAgICBtdWx0aXNlbGVjdGVkRWxlbWVudEtleXM7XG4gIH1cblxuICBwdWJsaWMgZ2V0RWxlbWVudEtleVRvU2VsZWN0QWZ0ZXJJbnN0YW50VXBkYXRlKCkge1xuICAgIHJldHVybiB0aGlzLmVsZW1lbnRLZXlUb1NlbGVjdEFmdGVySW5zdGFudFVwZGF0ZTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRFbGVtZW50S2V5c1RvTXVsdGlzZWxlY3RBZnRlckluc3RhbnRVcGRhdGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudEtleXNUb011bHRpc2VsZWN0QWZ0ZXJJbnN0YW50VXBkYXRlO1xuICB9XG5cbiAgcHVibGljIGdldEVsZW1lbnRLZXlUb1NlbGVjdEFmdGVyVW5kb0luc3RhbnRVcGRhdGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudEtleVRvU2VsZWN0QWZ0ZXJVbmRvSW5zdGFudFVwZGF0ZTtcbiAgfVxuXG4gIHB1YmxpYyBnZXRFbGVtZW50S2V5c1RvTXVsdGlzZWxlY3RBZnRlclVuZG9JbnN0YW50VXBkYXRlKCkge1xuICAgIHJldHVybiB0aGlzLmVsZW1lbnRLZXlzVG9NdWx0aXNlbGVjdEFmdGVyVW5kb0luc3RhbnRVcGRhdGU7XG4gIH1cblxuICBhYnN0cmFjdCBhcHBseUNvZGViYXNlSWRDaGFuZ2VzKHByZXZJZFRvTmV3SWRNYXA6IHtcbiAgICBbcHJldklkOiBzdHJpbmddOiBzdHJpbmc7XG4gIH0pOiB2b2lkO1xuXG4gIHB1YmxpYyBhcHBseUFsbENvZGViYXNlSWRDaGFuZ2VzKHByZXZJZFRvTmV3SWRNYXA6IHtcbiAgICBbcHJldklkOiBzdHJpbmddOiBzdHJpbmc7XG4gIH0pIHtcbiAgICBjb25zdCBnZXROZXdLZXkgPSAocHJldktleTogc3RyaW5nKSA9PiB7XG4gICAgICBpZiAoIXByZXZLZXkpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHRlbXBvRWxlbWVudCA9IFRlbXBvRWxlbWVudC5mcm9tS2V5KHByZXZLZXkpO1xuICAgICAgY29uc3QgY29kZWJhc2VJZCA9IHRlbXBvRWxlbWVudC5jb2RlYmFzZUlkO1xuICAgICAgY29uc3QgbmV3Q29kZWJhc2VJZCA9IHByZXZJZFRvTmV3SWRNYXBbY29kZWJhc2VJZF07XG5cbiAgICAgIGlmIChuZXdDb2RlYmFzZUlkKSB7XG4gICAgICAgIHJldHVybiBuZXcgVGVtcG9FbGVtZW50KFxuICAgICAgICAgIG5ld0NvZGViYXNlSWQsXG4gICAgICAgICAgdGVtcG9FbGVtZW50LnN0b3J5Ym9hcmRJZCxcbiAgICAgICAgICB0ZW1wb0VsZW1lbnQudW5pcXVlUGF0aCxcbiAgICAgICAgKS5nZXRLZXkoKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfTtcblxuICAgIC8qXG4gICAgICogSW5zdGFudCB1cGRhdGUgZmllbGRzXG4gICAgICovXG5cbiAgICBpZiAodGhpcy5lbGVtZW50S2V5VG9TZWxlY3RBZnRlckluc3RhbnRVcGRhdGUpIHtcbiAgICAgIGNvbnN0IG5ld0VsZW1lbnRLZXkgPSBnZXROZXdLZXkoXG4gICAgICAgIHRoaXMuZWxlbWVudEtleVRvU2VsZWN0QWZ0ZXJJbnN0YW50VXBkYXRlLFxuICAgICAgKTtcbiAgICAgIHRoaXMuZWxlbWVudEtleVRvU2VsZWN0QWZ0ZXJJbnN0YW50VXBkYXRlID1cbiAgICAgICAgbmV3RWxlbWVudEtleSB8fCB0aGlzLmVsZW1lbnRLZXlUb1NlbGVjdEFmdGVySW5zdGFudFVwZGF0ZTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5lbGVtZW50S2V5c1RvTXVsdGlzZWxlY3RBZnRlckluc3RhbnRVcGRhdGUpIHtcbiAgICAgIHRoaXMuZWxlbWVudEtleXNUb011bHRpc2VsZWN0QWZ0ZXJJbnN0YW50VXBkYXRlID1cbiAgICAgICAgdGhpcy5lbGVtZW50S2V5c1RvTXVsdGlzZWxlY3RBZnRlckluc3RhbnRVcGRhdGU/Lm1hcCgoa2V5KSA9PiB7XG4gICAgICAgICAgY29uc3QgbmV3S2V5ID0gZ2V0TmV3S2V5KGtleSk7XG4gICAgICAgICAgcmV0dXJuIG5ld0tleSB8fCBrZXk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qXG4gICAgICogVW5kbyBpbnN0YW50IHVwZGF0ZSBmaWVsZHNcbiAgICAgKi9cbiAgICBpZiAodGhpcy5lbGVtZW50S2V5VG9TZWxlY3RBZnRlclVuZG9JbnN0YW50VXBkYXRlKSB7XG4gICAgICBjb25zdCBuZXdFbGVtZW50S2V5ID0gZ2V0TmV3S2V5KFxuICAgICAgICB0aGlzLmVsZW1lbnRLZXlUb1NlbGVjdEFmdGVyVW5kb0luc3RhbnRVcGRhdGUsXG4gICAgICApO1xuICAgICAgdGhpcy5lbGVtZW50S2V5VG9TZWxlY3RBZnRlclVuZG9JbnN0YW50VXBkYXRlID1cbiAgICAgICAgbmV3RWxlbWVudEtleSB8fCB0aGlzLmVsZW1lbnRLZXlUb1NlbGVjdEFmdGVyVW5kb0luc3RhbnRVcGRhdGU7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZWxlbWVudEtleXNUb011bHRpc2VsZWN0QWZ0ZXJVbmRvSW5zdGFudFVwZGF0ZSkge1xuICAgICAgdGhpcy5lbGVtZW50S2V5c1RvTXVsdGlzZWxlY3RBZnRlclVuZG9JbnN0YW50VXBkYXRlID1cbiAgICAgICAgdGhpcy5lbGVtZW50S2V5c1RvTXVsdGlzZWxlY3RBZnRlclVuZG9JbnN0YW50VXBkYXRlPy5tYXAoKGtleSkgPT4ge1xuICAgICAgICAgIGNvbnN0IG5ld0tleSA9IGdldE5ld0tleShrZXkpO1xuICAgICAgICAgIHJldHVybiBuZXdLZXkgfHwga2V5O1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICB0aGlzLmFwcGx5Q29kZWJhc2VJZENoYW5nZXMocHJldklkVG9OZXdJZE1hcCk7XG4gIH1cbn1cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogU3R5bGluZyBDaGFuZ2VcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbmV4cG9ydCBpbnRlcmZhY2UgU3R5bGluZ0NoYW5nZUZpZWxkcyB7XG4gIGNvZGViYXNlSWQ6IHN0cmluZztcbiAgc3R5bGluZ0NoYW5nZXM6IHsgW2Nzc0tleTogc3RyaW5nXTogc3RyaW5nIH07XG5cbiAgLy8gQ3VycmVudGx5IG9ubHkgb25lIHN1cHBvcnRlZFxuICBzdHlsaW5nRnJhbWV3b3JrOiBTdHlsaW5nRnJhbWV3b3JrLlRBSUxXSU5EO1xuICBtb2RpZmllcnM6IHN0cmluZ1tdO1xuICBjdXN0b21Qcm9wZXJ0aWVzOiBDbGFzc1R5cGVbXTtcbn1cblxuZXhwb3J0IGNsYXNzIFN0eWxpbmdDaGFuZ2UgZXh0ZW5kcyBDaGFuZ2VMZWRnZXJJdGVtPFN0eWxpbmdDaGFuZ2VGaWVsZHM+IHtcbiAgY29uc3RydWN0b3IoY2hhbmdlRmllbGRzOiBTdHlsaW5nQ2hhbmdlRmllbGRzLCBpZD86IHN0cmluZykge1xuICAgIHN1cGVyKENoYW5nZVR5cGUuU1RZTElORywgJ1N0eWxpbmcnLCBjaGFuZ2VGaWVsZHMsIGlkKTtcblxuICAgIC8vIEFsbG93IGluc3RhbnQgdXBkYXRlcyB3aGlsZSBmbHVzaGluZ1xuICAgIHRoaXMuY2FuSW5zdGFudFVwZGF0ZVdoaWxlRmx1c2hpbmcgPSB0cnVlO1xuICB9XG5cbiAgcHVibGljIHByZXBhcmVBcGlSZXF1ZXN0KFxuICAgIGNhbnZhc0lkOiBzdHJpbmcsXG4gICAgdHJlZUVsZW1lbnRMb29rdXA6IHsgW2NvZGViYXNlSWQ6IHN0cmluZ106IGFueSB9LFxuICApIHtcbiAgICBjb25zdCB7XG4gICAgICBjb2RlYmFzZUlkLFxuICAgICAgc3R5bGluZ0NoYW5nZXMsXG4gICAgICBzdHlsaW5nRnJhbWV3b3JrLFxuICAgICAgbW9kaWZpZXJzLFxuICAgICAgY3VzdG9tUHJvcGVydGllcyxcbiAgICB9ID0gdGhpcy5jaGFuZ2VGaWVsZHM7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdXJsUGF0aDogYGNhbnZhc2VzLyR7Y2FudmFzSWR9L3BhcnNlQW5kTXV0YXRlL211dGF0ZS9zdHlsaW5nYCxcbiAgICAgIGJvZHk6IHtcbiAgICAgICAgcmVhY3RFbGVtZW50OiB0cmVlRWxlbWVudExvb2t1cFtjb2RlYmFzZUlkXSxcbiAgICAgICAgc3R5bGluZzogc3R5bGluZ0NoYW5nZXMsXG4gICAgICAgIHN0eWxpbmdGcmFtZXdvcmssXG4gICAgICAgIG1vZGlmaWVycyxcbiAgICAgICAgY3VzdG9tUHJvcGVydGllcyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIHB1YmxpYyBhcHBseUNvZGViYXNlSWRDaGFuZ2VzKHByZXZJZFRvTmV3SWRNYXA6IHtcbiAgICBbcHJldklkOiBzdHJpbmddOiBzdHJpbmc7XG4gIH0pIHtcbiAgICBjb25zdCBuZXdDb2RlYmFzZUlkID0gcHJldklkVG9OZXdJZE1hcFt0aGlzLmNoYW5nZUZpZWxkcy5jb2RlYmFzZUlkXTtcblxuICAgIGlmIChuZXdDb2RlYmFzZUlkKSB7XG4gICAgICB0aGlzLmNoYW5nZUZpZWxkcy5jb2RlYmFzZUlkID0gbmV3Q29kZWJhc2VJZDtcbiAgICB9XG4gIH1cbn1cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogQWRkIEpzeCBDaGFuZ2VcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbmV4cG9ydCBpbnRlcmZhY2UgQWRkSnN4Q2hhbmdlRmllbGRzIHtcbiAgY29kZWJhc2VJZFRvQWRkVG86IHN0cmluZztcbiAgYmVmb3JlQ29kZWJhc2VJZD86IHN0cmluZztcbiAgYWZ0ZXJDb2RlYmFzZUlkPzogc3RyaW5nO1xuXG4gIC8vIFRoZSBlbGVtZW50IHRvIGFkZFxuICBhZGRDb2RlYmFzZUlkPzogc3RyaW5nO1xuICBhZGROYXRpdmVUYWc/OiBzdHJpbmc7XG4gIGZpbGVDb250ZW50c1RvU291cmNlRnJvbT86IHN0cmluZztcbiAgZmlsZUNvbnRlbnRzU291cmNlRmlsZW5hbWU/OiBzdHJpbmc7XG5cbiAgcHJvcHNUb1NldD86IHsgW2tleTogc3RyaW5nXTogYW55IH07XG5cbiAgLy8gVXNlZCB0byB0cmFjayB0aGUgc3Rvcnlib2FyZCBpbiBhY3Rpdml0eSBzdHJlYW1cbiAgZGVsZXRlZFN0b3J5Ym9hcmRJZD86IHN0cmluZztcblxuICAvLyBGb3IgaW5zdGFudCB1cGRhdGVcbiAgaHRtbEZvckluc3RhbnRVcGRhdGU/OiBzdHJpbmc7XG5cbiAgLy8gRXh0cmEgZmlsZXMgdG8gY3JlYXRlIGFsb25nc2lkZSB0aGUgbWFpbiBjb21wb25lbnRcbiAgZXh0cmFQYXRoVG9Db250ZW50cz86IHsgW3BhdGg6IHN0cmluZ106IHN0cmluZyB9O1xufVxuXG5leHBvcnQgY2xhc3MgQWRkSnN4Q2hhbmdlIGV4dGVuZHMgQ2hhbmdlTGVkZ2VySXRlbTxBZGRKc3hDaGFuZ2VGaWVsZHM+IHtcbiAgY29uc3RydWN0b3IoY2hhbmdlRmllbGRzOiBBZGRKc3hDaGFuZ2VGaWVsZHMsIGlkPzogc3RyaW5nKSB7XG4gICAgc3VwZXIoQ2hhbmdlVHlwZS5BRERfSlNYLCAnQWRkIEVsZW1lbnQnLCBjaGFuZ2VGaWVsZHMsIGlkKTtcbiAgfVxuXG4gIHB1YmxpYyBwcmVwYXJlQXBpUmVxdWVzdChcbiAgICBjYW52YXNJZDogc3RyaW5nLFxuICAgIHRyZWVFbGVtZW50TG9va3VwOiB7IFtjb2RlYmFzZUlkOiBzdHJpbmddOiBhbnkgfSxcbiAgKSB7XG4gICAgY29uc3Qge1xuICAgICAgY29kZWJhc2VJZFRvQWRkVG8sXG4gICAgICBiZWZvcmVDb2RlYmFzZUlkLFxuICAgICAgYWZ0ZXJDb2RlYmFzZUlkLFxuICAgICAgYWRkQ29kZWJhc2VJZCxcbiAgICAgIGFkZE5hdGl2ZVRhZyxcbiAgICAgIGZpbGVDb250ZW50c1RvU291cmNlRnJvbSxcbiAgICAgIGZpbGVDb250ZW50c1NvdXJjZUZpbGVuYW1lLFxuICAgICAgcHJvcHNUb1NldCxcbiAgICAgIGRlbGV0ZWRTdG9yeWJvYXJkSWQsXG4gICAgICBodG1sRm9ySW5zdGFudFVwZGF0ZSxcbiAgICAgIGV4dHJhUGF0aFRvQ29udGVudHMsXG4gICAgfSA9IHRoaXMuY2hhbmdlRmllbGRzO1xuXG4gICAgY29uc3QgYm9keTogYW55ID0ge1xuICAgICAgZGVzdGluYXRpb25FbGVtZW50OiB0cmVlRWxlbWVudExvb2t1cFtjb2RlYmFzZUlkVG9BZGRUb10sXG4gICAgICBiZWZvcmVFbGVtZW50OiB0cmVlRWxlbWVudExvb2t1cFtiZWZvcmVDb2RlYmFzZUlkIHx8ICcnXSxcbiAgICAgIGFmdGVyRWxlbWVudDogdHJlZUVsZW1lbnRMb29rdXBbYWZ0ZXJDb2RlYmFzZUlkIHx8ICcnXSxcbiAgICAgIG5ld0VsZW1lbnQ6IHt9LFxuICAgICAgY2FudmFzSWQsXG4gICAgICBkZWxldGVkU3Rvcnlib2FyZElkLFxuICAgICAgZmlsZUNvbnRlbnRzVG9Tb3VyY2VGcm9tLFxuICAgICAgZmlsZUNvbnRlbnRzU291cmNlRmlsZW5hbWUsXG4gICAgICBleHRyYUZpbGVzOiBleHRyYVBhdGhUb0NvbnRlbnRzLFxuICAgIH07XG5cbiAgICBpZiAoYWRkQ29kZWJhc2VJZCkge1xuICAgICAgYm9keS5uZXdFbGVtZW50ID0ge1xuICAgICAgICAuLi50cmVlRWxlbWVudExvb2t1cFthZGRDb2RlYmFzZUlkXSxcbiAgICAgIH07XG4gICAgfSBlbHNlIGlmIChhZGROYXRpdmVUYWcpIHtcbiAgICAgIGJvZHkubmV3RWxlbWVudFsndHlwZSddID0gJ25hdGl2ZSc7XG4gICAgICBib2R5Lm5ld0VsZW1lbnRbJ25hdGl2ZVRhZyddID0gYWRkTmF0aXZlVGFnO1xuICAgICAgYm9keS5uZXdFbGVtZW50Wydjb21wb25lbnROYW1lJ10gPSBhZGROYXRpdmVUYWc7XG4gICAgfVxuXG4gICAgaWYgKHByb3BzVG9TZXQpIHtcbiAgICAgIGJvZHkubmV3RWxlbWVudFsncHJvcHNUb1NldCddID0gcHJvcHNUb1NldDtcbiAgICB9XG5cbiAgICBpZiAoIU9iamVjdC5rZXlzKGJvZHkubmV3RWxlbWVudCkubGVuZ3RoKSB7XG4gICAgICBkZWxldGUgYm9keS5uZXdFbGVtZW50O1xuICAgIH1cblxuICAgIGNvbnN0IGhhc0luc3RhbnRVcGRhdGUgPSBCb29sZWFuKGh0bWxGb3JJbnN0YW50VXBkYXRlKTtcbiAgICBib2R5WydoYXNJbnN0YW50VXBkYXRlJ10gPSBoYXNJbnN0YW50VXBkYXRlO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHVybFBhdGg6IGBjYW52YXNlcy8ke2NhbnZhc0lkfS9wYXJzZUFuZE11dGF0ZS9tdXRhdGUvYWRkSnN4RWxlbWVudGAsXG4gICAgICBib2R5LFxuXG4gICAgICAvLyBPbmx5IHNob3cgdGhlIHN1Y2Nlc3MgbWVzc2FnZSBpZiB3ZSBkbyBub3QgaGF2ZSBpbnN0YW50IHVwZGF0ZXNcbiAgICAgIHN1Y2Nlc3NUb2FzdE1lc3NhZ2U6IGhhc0luc3RhbnRVcGRhdGUgPyB1bmRlZmluZWQgOiAnU3VjY2Vzc2Z1bGx5IGFkZGVkJyxcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIGFwcGx5Q29kZWJhc2VJZENoYW5nZXMocHJldklkVG9OZXdJZE1hcDoge1xuICAgIFtwcmV2SWQ6IHN0cmluZ106IHN0cmluZztcbiAgfSkge1xuICAgIGNvbnN0IGZpZWxkc1RvQXBwbHkgPSBbXG4gICAgICAnY29kZWJhc2VJZFRvQWRkVG8nLFxuICAgICAgJ2JlZm9yZUNvZGViYXNlSWQnLFxuICAgICAgJ2FmdGVyQ29kZWJhc2VJZCcsXG4gICAgICAnYWRkQ29kZWJhc2VJZCcsXG4gICAgXTtcblxuICAgIGZpZWxkc1RvQXBwbHkuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIGNvbnN0IG5ld0NvZGViYXNlSWQgPSBwcmV2SWRUb05ld0lkTWFwW3RoaXMuY2hhbmdlRmllbGRzW2ZpZWxkXV07XG5cbiAgICAgIGlmIChuZXdDb2RlYmFzZUlkKSB7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgdGhpcy5jaGFuZ2VGaWVsZHNbZmllbGRdID0gbmV3Q29kZWJhc2VJZDtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiBNb3ZlIEpTWCBDaGFuZ2VcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbmV4cG9ydCBpbnRlcmZhY2UgTW92ZUpzeENoYW5nZUZpZWxkcyB7XG4gIGNvZGViYXNlSWRUb01vdmVUbzogc3RyaW5nO1xuICBjb2RlYmFzZUlkVG9Nb3ZlOiBzdHJpbmc7XG4gIGFmdGVyQ29kZWJhc2VJZD86IHN0cmluZztcbiAgYmVmb3JlQ29kZWJhc2VJZD86IHN0cmluZztcblxuICBleHBlY3RlZEN1cnJlbnRQYXJlbnRDb2RlYmFzZUlkPzogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgTW92ZUpzeENoYW5nZSBleHRlbmRzIENoYW5nZUxlZGdlckl0ZW08TW92ZUpzeENoYW5nZUZpZWxkcz4ge1xuICBjb25zdHJ1Y3RvcihjaGFuZ2VGaWVsZHM6IE1vdmVKc3hDaGFuZ2VGaWVsZHMsIGlkPzogc3RyaW5nKSB7XG4gICAgc3VwZXIoQ2hhbmdlVHlwZS5NT1ZFX0pTWCwgJ01vdmUgRWxlbWVudCcsIGNoYW5nZUZpZWxkcywgaWQpO1xuICB9XG5cbiAgcHVibGljIHByZXBhcmVBcGlSZXF1ZXN0KFxuICAgIGNhbnZhc0lkOiBzdHJpbmcsXG4gICAgdHJlZUVsZW1lbnRMb29rdXA6IHsgW2NvZGViYXNlSWQ6IHN0cmluZ106IGFueSB9LFxuICApIHtcbiAgICBjb25zdCB7XG4gICAgICBjb2RlYmFzZUlkVG9Nb3ZlVG8sXG4gICAgICBjb2RlYmFzZUlkVG9Nb3ZlLFxuICAgICAgYWZ0ZXJDb2RlYmFzZUlkLFxuICAgICAgYmVmb3JlQ29kZWJhc2VJZCxcbiAgICAgIGV4cGVjdGVkQ3VycmVudFBhcmVudENvZGViYXNlSWQsXG4gICAgfSA9IHRoaXMuY2hhbmdlRmllbGRzO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHVybFBhdGg6IGBjYW52YXNlcy8ke2NhbnZhc0lkfS9wYXJzZUFuZE11dGF0ZS9tdXRhdGUvbW92ZUpzeEVsZW1lbnRgLFxuICAgICAgYm9keToge1xuICAgICAgICBlbGVtZW50VG9Nb3ZlOiB0cmVlRWxlbWVudExvb2t1cFtjb2RlYmFzZUlkVG9Nb3ZlXSxcbiAgICAgICAgbmV3Q29udGFpbmVyRWxlbWVudDogdHJlZUVsZW1lbnRMb29rdXBbY29kZWJhc2VJZFRvTW92ZVRvXSxcbiAgICAgICAgYWZ0ZXJFbGVtZW50OiB0cmVlRWxlbWVudExvb2t1cFthZnRlckNvZGViYXNlSWQgfHwgJyddLFxuICAgICAgICBiZWZvcmVFbGVtZW50OiB0cmVlRWxlbWVudExvb2t1cFtiZWZvcmVDb2RlYmFzZUlkIHx8ICcnXSxcblxuICAgICAgICBleHBlY3RlZEN1cnJlbnRQYXJlbnQ6XG4gICAgICAgICAgdHJlZUVsZW1lbnRMb29rdXBbZXhwZWN0ZWRDdXJyZW50UGFyZW50Q29kZWJhc2VJZCB8fCAnJ10sXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBwdWJsaWMgYXBwbHlDb2RlYmFzZUlkQ2hhbmdlcyhwcmV2SWRUb05ld0lkTWFwOiB7XG4gICAgW3ByZXZJZDogc3RyaW5nXTogc3RyaW5nO1xuICB9KSB7XG4gICAgY29uc3QgZmllbGRzVG9BcHBseSA9IFtcbiAgICAgICdjb2RlYmFzZUlkVG9Nb3ZlVG8nLFxuICAgICAgJ2NvZGViYXNlSWRUb01vdmUnLFxuICAgICAgJ2FmdGVyQ29kZWJhc2VJZCcsXG4gICAgICAnYmVmb3JlQ29kZWJhc2VJZCcsXG4gICAgICAnZXhwZWN0ZWRDdXJyZW50UGFyZW50Q29kZWJhc2VJZCcsXG4gICAgXTtcblxuICAgIGZpZWxkc1RvQXBwbHkuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIGNvbnN0IG5ld0NvZGViYXNlSWQgPSBwcmV2SWRUb05ld0lkTWFwW3RoaXMuY2hhbmdlRmllbGRzW2ZpZWxkXV07XG5cbiAgICAgIGlmIChuZXdDb2RlYmFzZUlkKSB7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgdGhpcy5jaGFuZ2VGaWVsZHNbZmllbGRdID0gbmV3Q29kZWJhc2VJZDtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiBSZW1vdmUgSlNYIENoYW5nZVxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuZXhwb3J0IGludGVyZmFjZSBSZW1vdmVKc3hDaGFuZ2VGaWVsZHMge1xuICBjb2RlYmFzZUlkc1RvUmVtb3ZlOiBzdHJpbmdbXTtcbn1cblxuZXhwb3J0IGNsYXNzIFJlbW92ZUpzeENoYW5nZSBleHRlbmRzIENoYW5nZUxlZGdlckl0ZW08UmVtb3ZlSnN4Q2hhbmdlRmllbGRzPiB7XG4gIGNvbnN0cnVjdG9yKGNoYW5nZUZpZWxkczogUmVtb3ZlSnN4Q2hhbmdlRmllbGRzLCBpZD86IHN0cmluZykge1xuICAgIC8vIERlZHVwbGljYXRlIHRoZSBjb2RlYmFzZUlkc1RvUmVtb3ZlXG4gICAgY2hhbmdlRmllbGRzLmNvZGViYXNlSWRzVG9SZW1vdmUgPSBBcnJheS5mcm9tKFxuICAgICAgbmV3IFNldChjaGFuZ2VGaWVsZHMuY29kZWJhc2VJZHNUb1JlbW92ZSksXG4gICAgKTtcbiAgICBzdXBlcihDaGFuZ2VUeXBlLlJFTU9WRV9KU1gsICdEZWxldGUgRWxlbWVudCcsIGNoYW5nZUZpZWxkcywgaWQpO1xuICB9XG5cbiAgcHVibGljIHByZXBhcmVBcGlSZXF1ZXN0KFxuICAgIGNhbnZhc0lkOiBzdHJpbmcsXG4gICAgdHJlZUVsZW1lbnRMb29rdXA6IHsgW2NvZGViYXNlSWQ6IHN0cmluZ106IGFueSB9LFxuICApIHtcbiAgICBjb25zdCB7IGNvZGViYXNlSWRzVG9SZW1vdmUgfSA9IHRoaXMuY2hhbmdlRmllbGRzO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHVybFBhdGg6IGBjYW52YXNlcy8ke2NhbnZhc0lkfS9wYXJzZUFuZE11dGF0ZS9tdXRhdGUvcmVtb3ZlSnN4RWxlbWVudGAsXG4gICAgICBib2R5OiB7XG4gICAgICAgIGVsZW1lbnRzVG9SZW1vdmU6IGNvZGViYXNlSWRzVG9SZW1vdmVcbiAgICAgICAgICAubWFwKChjb2RlYmFzZUlkOiBzdHJpbmcpID0+IHRyZWVFbGVtZW50TG9va3VwW2NvZGViYXNlSWRdKVxuICAgICAgICAgIC5maWx0ZXIoKGVsZW1lbnQ6IGFueSkgPT4gZWxlbWVudCksXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBwdWJsaWMgYXBwbHlDb2RlYmFzZUlkQ2hhbmdlcyhwcmV2SWRUb05ld0lkTWFwOiB7XG4gICAgW3ByZXZJZDogc3RyaW5nXTogc3RyaW5nO1xuICB9KSB7XG4gICAgdGhpcy5jaGFuZ2VGaWVsZHMuY29kZWJhc2VJZHNUb1JlbW92ZSA9XG4gICAgICB0aGlzLmNoYW5nZUZpZWxkcy5jb2RlYmFzZUlkc1RvUmVtb3ZlLm1hcCgoY29kZWJhc2VJZDogc3RyaW5nKSA9PiB7XG4gICAgICAgIGNvbnN0IG5ld0NvZGViYXNlSWQgPSBwcmV2SWRUb05ld0lkTWFwW2NvZGViYXNlSWRdO1xuXG4gICAgICAgIGlmIChuZXdDb2RlYmFzZUlkKSB7XG4gICAgICAgICAgcmV0dXJuIG5ld0NvZGViYXNlSWQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY29kZWJhc2VJZDtcbiAgICAgIH0pO1xuICB9XG59XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqIENoYW5nZSBQcm9wIENoYW5nZVxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuZXhwb3J0IGludGVyZmFjZSBDaGFuZ2VQcm9wQ2hhbmdlRmllbGRzIHtcbiAgY29kZWJhc2VJZFRvQ2hhbmdlOiBzdHJpbmc7XG4gIHByb3BOYW1lOiBzdHJpbmc7XG4gIHByb3BWYWx1ZTogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgQ2hhbmdlUHJvcENoYW5nZSBleHRlbmRzIENoYW5nZUxlZGdlckl0ZW08Q2hhbmdlUHJvcENoYW5nZUZpZWxkcz4ge1xuICBjb25zdHJ1Y3RvcihjaGFuZ2VGaWVsZHM6IENoYW5nZVByb3BDaGFuZ2VGaWVsZHMsIGlkPzogc3RyaW5nKSB7XG4gICAgc3VwZXIoQ2hhbmdlVHlwZS5DSEFOR0VfUFJPUCwgJ0NoYW5nZSBQcm9wJywgY2hhbmdlRmllbGRzLCBpZCk7XG4gIH1cblxuICBwdWJsaWMgcHJlcGFyZUFwaVJlcXVlc3QoXG4gICAgY2FudmFzSWQ6IHN0cmluZyxcbiAgICB0cmVlRWxlbWVudExvb2t1cDogeyBbY29kZWJhc2VJZDogc3RyaW5nXTogYW55IH0sXG4gICkge1xuICAgIGNvbnN0IHsgY29kZWJhc2VJZFRvQ2hhbmdlLCBwcm9wTmFtZSwgcHJvcFZhbHVlIH0gPSB0aGlzLmNoYW5nZUZpZWxkcztcblxuICAgIHJldHVybiB7XG4gICAgICB1cmxQYXRoOiBgY2FudmFzZXMvJHtjYW52YXNJZH0vcGFyc2VBbmRNdXRhdGUvbXV0YXRlL2NoYW5nZVByb3BWYWx1ZWAsXG4gICAgICBib2R5OiB7XG4gICAgICAgIGVsZW1lbnRUb01vZGlmeTogdHJlZUVsZW1lbnRMb29rdXBbY29kZWJhc2VJZFRvQ2hhbmdlXSxcbiAgICAgICAgcHJvcE5hbWUsXG4gICAgICAgIHByb3BWYWx1ZSxcbiAgICAgIH0sXG4gICAgICBzdWNjZXNzVG9hc3RNZXNzYWdlOiAnUHJvcCBjaGFuZ2VkJyxcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIGFwcGx5Q29kZWJhc2VJZENoYW5nZXMocHJldklkVG9OZXdJZE1hcDoge1xuICAgIFtwcmV2SWQ6IHN0cmluZ106IHN0cmluZztcbiAgfSkge1xuICAgIGNvbnN0IG5ld0NvZGViYXNlSWQgPVxuICAgICAgcHJldklkVG9OZXdJZE1hcFt0aGlzLmNoYW5nZUZpZWxkcy5jb2RlYmFzZUlkVG9DaGFuZ2VdO1xuXG4gICAgaWYgKG5ld0NvZGViYXNlSWQpIHtcbiAgICAgIHRoaXMuY2hhbmdlRmllbGRzLmNvZGViYXNlSWRUb0NoYW5nZSA9IG5ld0NvZGViYXNlSWQ7XG4gICAgfVxuICB9XG59XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqIFdyYXAgaW4gZGl2IGNoYW5nZVxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuZXhwb3J0IGludGVyZmFjZSBXcmFwRGl2Q2hhbmdlRmllbGRzIHtcbiAgY29kZWJhc2VJZHNUb1dyYXA6IHN0cmluZ1tdO1xufVxuXG5leHBvcnQgY2xhc3MgV3JhcERpdkNoYW5nZSBleHRlbmRzIENoYW5nZUxlZGdlckl0ZW08V3JhcERpdkNoYW5nZUZpZWxkcz4ge1xuICBjb25zdHJ1Y3RvcihjaGFuZ2VGaWVsZHM6IFdyYXBEaXZDaGFuZ2VGaWVsZHMsIGlkPzogc3RyaW5nKSB7XG4gICAgLy8gRGVkdXBsaWNhdGUgdGhlIGNvZGViYXNlSWRzVG9XcmFwXG4gICAgY2hhbmdlRmllbGRzLmNvZGViYXNlSWRzVG9XcmFwID0gQXJyYXkuZnJvbShcbiAgICAgIG5ldyBTZXQoY2hhbmdlRmllbGRzLmNvZGViYXNlSWRzVG9XcmFwKSxcbiAgICApO1xuICAgIHN1cGVyKENoYW5nZVR5cGUuV1JBUF9ESVYsICdXcmFwIEluIERpdicsIGNoYW5nZUZpZWxkcywgaWQpO1xuICB9XG5cbiAgcHVibGljIHByZXBhcmVBcGlSZXF1ZXN0KFxuICAgIGNhbnZhc0lkOiBzdHJpbmcsXG4gICAgdHJlZUVsZW1lbnRMb29rdXA6IHsgW2NvZGViYXNlSWQ6IHN0cmluZ106IGFueSB9LFxuICApIHtcbiAgICBjb25zdCB7IGNvZGViYXNlSWRzVG9XcmFwIH0gPSB0aGlzLmNoYW5nZUZpZWxkcztcblxuICAgIHJldHVybiB7XG4gICAgICB1cmxQYXRoOiBgY2FudmFzZXMvJHtjYW52YXNJZH0vcGFyc2VBbmRNdXRhdGUvbXV0YXRlL3dyYXBJbkRpdmAsXG4gICAgICBib2R5OiB7XG4gICAgICAgIHJlYWN0RWxlbWVudHM6IGNvZGViYXNlSWRzVG9XcmFwLm1hcChcbiAgICAgICAgICAoY29kZWJhc2VJZDogc3RyaW5nKSA9PiB0cmVlRWxlbWVudExvb2t1cFtjb2RlYmFzZUlkXSxcbiAgICAgICAgKSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIHB1YmxpYyBhcHBseUNvZGViYXNlSWRDaGFuZ2VzKHByZXZJZFRvTmV3SWRNYXA6IHtcbiAgICBbcHJldklkOiBzdHJpbmddOiBzdHJpbmc7XG4gIH0pIHtcbiAgICB0aGlzLmNoYW5nZUZpZWxkcy5jb2RlYmFzZUlkc1RvV3JhcCA9XG4gICAgICB0aGlzLmNoYW5nZUZpZWxkcy5jb2RlYmFzZUlkc1RvV3JhcC5tYXAoKGNvZGViYXNlSWQ6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCBuZXdDb2RlYmFzZUlkID0gcHJldklkVG9OZXdJZE1hcFtjb2RlYmFzZUlkXTtcblxuICAgICAgICBpZiAobmV3Q29kZWJhc2VJZCkge1xuICAgICAgICAgIHJldHVybiBuZXdDb2RlYmFzZUlkO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNvZGViYXNlSWQ7XG4gICAgICB9KTtcbiAgfVxufVxuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiBEdXBsaWNhdGUgY2hhbmdlXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG5leHBvcnQgaW50ZXJmYWNlIER1cGxpY2F0ZUNoYW5nZUZpZWxkcyB7XG4gIGNvZGViYXNlSWRzVG9EdXBsaWNhdGU6IHN0cmluZ1tdO1xufVxuXG5leHBvcnQgY2xhc3MgRHVwbGljYXRlQ2hhbmdlIGV4dGVuZHMgQ2hhbmdlTGVkZ2VySXRlbTxEdXBsaWNhdGVDaGFuZ2VGaWVsZHM+IHtcbiAgY29uc3RydWN0b3IoY2hhbmdlRmllbGRzOiBEdXBsaWNhdGVDaGFuZ2VGaWVsZHMsIGlkPzogc3RyaW5nKSB7XG4gICAgLy8gRGVkdXBsaWNhdGUgdGhlIGNvZGViYXNlSWRzVG9EdXBsaWNhdGVcbiAgICBjaGFuZ2VGaWVsZHMuY29kZWJhc2VJZHNUb0R1cGxpY2F0ZSA9IEFycmF5LmZyb20oXG4gICAgICBuZXcgU2V0KGNoYW5nZUZpZWxkcy5jb2RlYmFzZUlkc1RvRHVwbGljYXRlKSxcbiAgICApO1xuICAgIHN1cGVyKENoYW5nZVR5cGUuRFVQTElDQVRFLCAnRHVwbGljYXRlJywgY2hhbmdlRmllbGRzLCBpZCk7XG4gIH1cblxuICBwdWJsaWMgcHJlcGFyZUFwaVJlcXVlc3QoXG4gICAgY2FudmFzSWQ6IHN0cmluZyxcbiAgICB0cmVlRWxlbWVudExvb2t1cDogeyBbY29kZWJhc2VJZDogc3RyaW5nXTogYW55IH0sXG4gICkge1xuICAgIGNvbnN0IHsgY29kZWJhc2VJZHNUb0R1cGxpY2F0ZSB9ID0gdGhpcy5jaGFuZ2VGaWVsZHM7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdXJsUGF0aDogYGNhbnZhc2VzLyR7Y2FudmFzSWR9L3BhcnNlQW5kTXV0YXRlL211dGF0ZS9kdXBsaWNhdGVgLFxuICAgICAgYm9keToge1xuICAgICAgICByZWFjdEVsZW1lbnRzOiBjb2RlYmFzZUlkc1RvRHVwbGljYXRlLm1hcChcbiAgICAgICAgICAoY29kZWJhc2VJZDogc3RyaW5nKSA9PiB0cmVlRWxlbWVudExvb2t1cFtjb2RlYmFzZUlkXSxcbiAgICAgICAgKSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIHB1YmxpYyBhcHBseUNvZGViYXNlSWRDaGFuZ2VzKHByZXZJZFRvTmV3SWRNYXA6IHtcbiAgICBbcHJldklkOiBzdHJpbmddOiBzdHJpbmc7XG4gIH0pIHtcbiAgICB0aGlzLmNoYW5nZUZpZWxkcy5jb2RlYmFzZUlkc1RvRHVwbGljYXRlID1cbiAgICAgIHRoaXMuY2hhbmdlRmllbGRzLmNvZGViYXNlSWRzVG9EdXBsaWNhdGUubWFwKChjb2RlYmFzZUlkOiBzdHJpbmcpID0+IHtcbiAgICAgICAgY29uc3QgbmV3Q29kZWJhc2VJZCA9IHByZXZJZFRvTmV3SWRNYXBbY29kZWJhc2VJZF07XG5cbiAgICAgICAgaWYgKG5ld0NvZGViYXNlSWQpIHtcbiAgICAgICAgICByZXR1cm4gbmV3Q29kZWJhc2VJZDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjb2RlYmFzZUlkO1xuICAgICAgfSk7XG4gIH1cbn1cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogQ2hhbmdlIFRhZyBDaGFuZ2VcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2hhbmdlVGFnQ2hhbmdlRmllbGRzIHtcbiAgY29kZWJhc2VJZFRvQ2hhbmdlOiBzdHJpbmc7XG4gIG5ld1RhZ05hbWU6IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIENoYW5nZVRhZ0NoYW5nZSBleHRlbmRzIENoYW5nZUxlZGdlckl0ZW08Q2hhbmdlVGFnQ2hhbmdlRmllbGRzPiB7XG4gIGNvbnN0cnVjdG9yKGNoYW5nZUZpZWxkczogQ2hhbmdlVGFnQ2hhbmdlRmllbGRzLCBpZD86IHN0cmluZykge1xuICAgIHN1cGVyKENoYW5nZVR5cGUuQ0hBTkdFX1RBRywgJ0NoYW5nZSBUYWcgTmFtZScsIGNoYW5nZUZpZWxkcywgaWQpO1xuICB9XG5cbiAgcHVibGljIHByZXBhcmVBcGlSZXF1ZXN0KFxuICAgIGNhbnZhc0lkOiBzdHJpbmcsXG4gICAgdHJlZUVsZW1lbnRMb29rdXA6IHsgW2NvZGViYXNlSWQ6IHN0cmluZ106IGFueSB9LFxuICApIHtcbiAgICBjb25zdCB7IGNvZGViYXNlSWRUb0NoYW5nZSwgbmV3VGFnTmFtZSB9ID0gdGhpcy5jaGFuZ2VGaWVsZHM7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdXJsUGF0aDogYGNhbnZhc2VzLyR7Y2FudmFzSWR9L3BhcnNlQW5kTXV0YXRlL211dGF0ZS9jaGFuZ2VFbGVtZW50VGFnYCxcbiAgICAgIGJvZHk6IHtcbiAgICAgICAgZWxlbWVudFRvTW9kaWZ5OiB0cmVlRWxlbWVudExvb2t1cFtjb2RlYmFzZUlkVG9DaGFuZ2VdLFxuICAgICAgICBuZXdUYWc6IG5ld1RhZ05hbWUsXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBwdWJsaWMgYXBwbHlDb2RlYmFzZUlkQ2hhbmdlcyhwcmV2SWRUb05ld0lkTWFwOiB7XG4gICAgW3ByZXZJZDogc3RyaW5nXTogc3RyaW5nO1xuICB9KSB7XG4gICAgY29uc3QgbmV3Q29kZWJhc2VJZCA9XG4gICAgICBwcmV2SWRUb05ld0lkTWFwW3RoaXMuY2hhbmdlRmllbGRzLmNvZGViYXNlSWRUb0NoYW5nZV07XG5cbiAgICBpZiAobmV3Q29kZWJhc2VJZCkge1xuICAgICAgdGhpcy5jaGFuZ2VGaWVsZHMuY29kZWJhc2VJZFRvQ2hhbmdlID0gbmV3Q29kZWJhc2VJZDtcbiAgICB9XG4gIH1cbn1cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogQWRkIGNsYXNzIENoYW5nZVxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuZXhwb3J0IGludGVyZmFjZSBBZGRDbGFzc0NoYW5nZUZpZWxkcyB7XG4gIGNvZGViYXNlSWRUb0FkZENsYXNzOiBzdHJpbmc7XG4gIGNsYXNzTmFtZTogc3RyaW5nO1xuICBtb2RpZmllcnM6IHN0cmluZ1tdO1xuICBjdXN0b21Qcm9wZXJ0aWVzOiBDbGFzc1R5cGVbXTtcbiAgYWRkaW5nVGFpbHdpbmRDbGFzcz86IGJvb2xlYW47XG5cbiAgLy8gVXNlZCBpbiBpbnN0YW50IHVwZGF0ZWRcbiAgY3NzRXF1aXZhbGVudD86IHN0cmluZztcblxuICAvLyBOb3QgaW4gdGhlIGNoYW5nZSBsZWRnZXIsIG9ubHkgdXNlZCBmb3IgZHJhZ2dpbmcgaW5zdGFudCB1cGRhdGVzXG4gIHRlbXBvcmFyeU9ubHk/OiBib29sZWFuO1xufVxuXG5leHBvcnQgY2xhc3MgQWRkQ2xhc3NDaGFuZ2UgZXh0ZW5kcyBDaGFuZ2VMZWRnZXJJdGVtPEFkZENsYXNzQ2hhbmdlRmllbGRzPiB7XG4gIGNvbnN0cnVjdG9yKGNoYW5nZUZpZWxkczogQWRkQ2xhc3NDaGFuZ2VGaWVsZHMsIGlkPzogc3RyaW5nKSB7XG4gICAgc3VwZXIoQ2hhbmdlVHlwZS5BRERfQ0xBU1MsICdBZGQgQ2xhc3MnLCBjaGFuZ2VGaWVsZHMsIGlkKTtcblxuICAgIHRoaXMuY2FuSW5zdGFudFVwZGF0ZVdoaWxlRmx1c2hpbmcgPSB0cnVlO1xuICB9XG5cbiAgcHVibGljIHByZXBhcmVBcGlSZXF1ZXN0KFxuICAgIGNhbnZhc0lkOiBzdHJpbmcsXG4gICAgdHJlZUVsZW1lbnRMb29rdXA6IHsgW2NvZGViYXNlSWQ6IHN0cmluZ106IGFueSB9LFxuICApIHtcbiAgICBjb25zdCB7XG4gICAgICBjb2RlYmFzZUlkVG9BZGRDbGFzcyxcbiAgICAgIGNsYXNzTmFtZSxcbiAgICAgIGFkZGluZ1RhaWx3aW5kQ2xhc3MsXG4gICAgICBtb2RpZmllcnMsXG4gICAgICBjdXN0b21Qcm9wZXJ0aWVzLFxuICAgIH0gPSB0aGlzLmNoYW5nZUZpZWxkcztcblxuICAgIHJldHVybiB7XG4gICAgICB1cmxQYXRoOiBgY2FudmFzZXMvJHtjYW52YXNJZH0vcGFyc2VBbmRNdXRhdGUvbXV0YXRlL2FkZENsYXNzYCxcbiAgICAgIGJvZHk6IHtcbiAgICAgICAgcmVhY3RFbGVtZW50OiB0cmVlRWxlbWVudExvb2t1cFtjb2RlYmFzZUlkVG9BZGRDbGFzc10sXG4gICAgICAgIGNsYXNzTmFtZSxcbiAgICAgICAgc3R5bGluZ0ZyYW1ld29yazogYWRkaW5nVGFpbHdpbmRDbGFzc1xuICAgICAgICAgID8gU3R5bGluZ0ZyYW1ld29yay5UQUlMV0lORFxuICAgICAgICAgIDogbnVsbCxcbiAgICAgICAgbW9kaWZpZXJzLFxuICAgICAgICBjdXN0b21Qcm9wZXJ0aWVzLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIGFwcGx5Q29kZWJhc2VJZENoYW5nZXMocHJldklkVG9OZXdJZE1hcDoge1xuICAgIFtwcmV2SWQ6IHN0cmluZ106IHN0cmluZztcbiAgfSkge1xuICAgIGNvbnN0IG5ld0NvZGViYXNlSWQgPVxuICAgICAgcHJldklkVG9OZXdJZE1hcFt0aGlzLmNoYW5nZUZpZWxkcy5jb2RlYmFzZUlkVG9BZGRDbGFzc107XG5cbiAgICBpZiAobmV3Q29kZWJhc2VJZCkge1xuICAgICAgdGhpcy5jaGFuZ2VGaWVsZHMuY29kZWJhc2VJZFRvQWRkQ2xhc3MgPSBuZXdDb2RlYmFzZUlkO1xuICAgIH1cbiAgfVxufVxuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiBSZW1vdmUgY2xhc3MgY2hhbmdlXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG5leHBvcnQgaW50ZXJmYWNlIFJlbW92ZUNsYXNzQ2hhbmdlRmllbGRzIHtcbiAgY29kZWJhc2VJZFRvUmVtb3ZlQ2xhc3M6IHN0cmluZztcbiAgY2xhc3NOYW1lOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjbGFzcyBSZW1vdmVDbGFzc0NoYW5nZSBleHRlbmRzIENoYW5nZUxlZGdlckl0ZW08UmVtb3ZlQ2xhc3NDaGFuZ2VGaWVsZHM+IHtcbiAgY29uc3RydWN0b3IoY2hhbmdlRmllbGRzOiBSZW1vdmVDbGFzc0NoYW5nZUZpZWxkcywgaWQ/OiBzdHJpbmcpIHtcbiAgICBzdXBlcihDaGFuZ2VUeXBlLlJFTU9WRV9DTEFTUywgJ1JlbW92ZSBDbGFzcycsIGNoYW5nZUZpZWxkcywgaWQpO1xuICB9XG5cbiAgcHVibGljIHByZXBhcmVBcGlSZXF1ZXN0KFxuICAgIGNhbnZhc0lkOiBzdHJpbmcsXG4gICAgdHJlZUVsZW1lbnRMb29rdXA6IHsgW2NvZGViYXNlSWQ6IHN0cmluZ106IGFueSB9LFxuICApIHtcbiAgICBjb25zdCB7IGNvZGViYXNlSWRUb1JlbW92ZUNsYXNzLCBjbGFzc05hbWUgfSA9IHRoaXMuY2hhbmdlRmllbGRzO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHVybFBhdGg6IGBjYW52YXNlcy8ke2NhbnZhc0lkfS9wYXJzZUFuZE11dGF0ZS9tdXRhdGUvcmVtb3ZlQ2xhc3NgLFxuICAgICAgYm9keToge1xuICAgICAgICByZWFjdEVsZW1lbnQ6IHRyZWVFbGVtZW50TG9va3VwW2NvZGViYXNlSWRUb1JlbW92ZUNsYXNzXSxcbiAgICAgICAgY2xhc3NOYW1lLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIGFwcGx5Q29kZWJhc2VJZENoYW5nZXMocHJldklkVG9OZXdJZE1hcDoge1xuICAgIFtwcmV2SWQ6IHN0cmluZ106IHN0cmluZztcbiAgfSkge1xuICAgIGNvbnN0IG5ld0NvZGViYXNlSWQgPVxuICAgICAgcHJldklkVG9OZXdJZE1hcFt0aGlzLmNoYW5nZUZpZWxkcy5jb2RlYmFzZUlkVG9SZW1vdmVDbGFzc107XG5cbiAgICBpZiAobmV3Q29kZWJhc2VJZCkge1xuICAgICAgdGhpcy5jaGFuZ2VGaWVsZHMuY29kZWJhc2VJZFRvUmVtb3ZlQ2xhc3MgPSBuZXdDb2RlYmFzZUlkO1xuICAgIH1cbiAgfVxufVxuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiBFZGl0IHRleHQgY2hhbmdlXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuZXhwb3J0IGludGVyZmFjZSBFZGl0VGV4dENoYW5nZUZpZWxkcyB7XG4gIGNvZGViYXNlSWRUb0VkaXRUZXh0OiBzdHJpbmc7XG4gIG5ld1RleHQ6IHN0cmluZztcbiAgb2xkVGV4dD86IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIEVkaXRUZXh0Q2hhbmdlIGV4dGVuZHMgQ2hhbmdlTGVkZ2VySXRlbTxFZGl0VGV4dENoYW5nZUZpZWxkcz4ge1xuICBjb25zdHJ1Y3RvcihjaGFuZ2VGaWVsZHM6IEVkaXRUZXh0Q2hhbmdlRmllbGRzLCBpZD86IHN0cmluZykge1xuICAgIHN1cGVyKENoYW5nZVR5cGUuRURJVF9URVhULCAnRWRpdCBUZXh0JywgY2hhbmdlRmllbGRzLCBpZCk7XG4gIH1cblxuICBwdWJsaWMgcHJlcGFyZUFwaVJlcXVlc3QoXG4gICAgY2FudmFzSWQ6IHN0cmluZyxcbiAgICB0cmVlRWxlbWVudExvb2t1cDogeyBbY29kZWJhc2VJZDogc3RyaW5nXTogYW55IH0sXG4gICkge1xuICAgIGNvbnN0IHsgY29kZWJhc2VJZFRvRWRpdFRleHQsIG5ld1RleHQsIG9sZFRleHQgfSA9IHRoaXMuY2hhbmdlRmllbGRzO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHVybFBhdGg6IGBjYW52YXNlcy8ke2NhbnZhc0lkfS9wYXJzZUFuZE11dGF0ZS9tdXRhdGUvZWRpdFRleHRgLFxuICAgICAgYm9keToge1xuICAgICAgICBlbGVtZW50OiB0cmVlRWxlbWVudExvb2t1cFtjb2RlYmFzZUlkVG9FZGl0VGV4dF0sXG4gICAgICAgIG5ld1RleHQsXG4gICAgICAgIG9sZFRleHQsXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBwdWJsaWMgYXBwbHlDb2RlYmFzZUlkQ2hhbmdlcyhwcmV2SWRUb05ld0lkTWFwOiB7XG4gICAgW3ByZXZJZDogc3RyaW5nXTogc3RyaW5nO1xuICB9KSB7XG4gICAgY29uc3QgbmV3Q29kZWJhc2VJZCA9XG4gICAgICBwcmV2SWRUb05ld0lkTWFwW3RoaXMuY2hhbmdlRmllbGRzLmNvZGViYXNlSWRUb0VkaXRUZXh0XTtcblxuICAgIGlmIChuZXdDb2RlYmFzZUlkKSB7XG4gICAgICB0aGlzLmNoYW5nZUZpZWxkcy5jb2RlYmFzZUlkVG9FZGl0VGV4dCA9IG5ld0NvZGViYXNlSWQ7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCB0eXBlIEFueUNoYW5nZUxlZGdlckl0ZW0gPSBDaGFuZ2VMZWRnZXJJdGVtPGFueT47XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqIFVuZG8gQ2hhbmdlIFR5cGVcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5leHBvcnQgaW50ZXJmYWNlIFVuZG9DaGFuZ2VGaWVsZHMge1xuICBjaGFuZ2VUb1VuZG86IEFueUNoYW5nZUxlZGdlckl0ZW07XG4gIG1hdGNoaW5nQWN0aXZpdHlGbHVzaGVkPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGNsYXNzIFVuZG9DaGFuZ2UgZXh0ZW5kcyBDaGFuZ2VMZWRnZXJJdGVtPFVuZG9DaGFuZ2VGaWVsZHM+IHtcbiAgY29uc3RydWN0b3IoY2hhbmdlRmllbGRzOiBVbmRvQ2hhbmdlRmllbGRzLCBpZD86IHN0cmluZykge1xuICAgIHN1cGVyKENoYW5nZVR5cGUuVU5ETywgJ1VuZG8nLCBjaGFuZ2VGaWVsZHMsIGlkKTtcblxuICAgIGlmIChjaGFuZ2VGaWVsZHMuY2hhbmdlVG9VbmRvPy5jYW5JbnN0YW50VXBkYXRlV2hpbGVGbHVzaGluZykge1xuICAgICAgdGhpcy5jYW5JbnN0YW50VXBkYXRlV2hpbGVGbHVzaGluZyA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHByZXBhcmVBcGlSZXF1ZXN0KFxuICAgIGNhbnZhc0lkOiBzdHJpbmcsXG4gICAgdHJlZUVsZW1lbnRMb29rdXA6IHsgW2NvZGViYXNlSWQ6IHN0cmluZ106IGFueSB9LFxuICApIHtcbiAgICByZXR1cm4ge1xuICAgICAgdXJsUGF0aDogYGNhbnZhc2VzLyR7Y2FudmFzSWR9L3BhcnNlQW5kTXV0YXRlL2FjdGl2aXRpZXMvdW5kb0NoYW5nZVRvRmlsZXNgLFxuICAgICAgYm9keToge30sXG4gICAgfTtcbiAgfVxuXG4gIHB1YmxpYyBhcHBseUNvZGViYXNlSWRDaGFuZ2VzKHByZXZJZFRvTmV3SWRNYXA6IHtcbiAgICBbcHJldklkOiBzdHJpbmddOiBzdHJpbmc7XG4gIH0pIHtcbiAgICAvLyBEbyBub3RoaW5nXG4gIH1cbn1cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogUmVkbyBDaGFuZ2UgVHlwZVxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbmV4cG9ydCBpbnRlcmZhY2UgUmVkb0NoYW5nZUZpZWxkcyB7XG4gIGNoYW5nZVRvUmVkbzogQW55Q2hhbmdlTGVkZ2VySXRlbTtcbn1cblxuZXhwb3J0IGNsYXNzIFJlZG9DaGFuZ2UgZXh0ZW5kcyBDaGFuZ2VMZWRnZXJJdGVtPFJlZG9DaGFuZ2VGaWVsZHM+IHtcbiAgY29uc3RydWN0b3IoY2hhbmdlRmllbGRzOiBSZWRvQ2hhbmdlRmllbGRzLCBpZD86IHN0cmluZykge1xuICAgIHN1cGVyKENoYW5nZVR5cGUuUkVETywgJ1JlZG8nLCBjaGFuZ2VGaWVsZHMsIGlkKTtcblxuICAgIGlmIChjaGFuZ2VGaWVsZHMuY2hhbmdlVG9SZWRvPy5jYW5JbnN0YW50VXBkYXRlV2hpbGVGbHVzaGluZykge1xuICAgICAgdGhpcy5jYW5JbnN0YW50VXBkYXRlV2hpbGVGbHVzaGluZyA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHByZXBhcmVBcGlSZXF1ZXN0KFxuICAgIGNhbnZhc0lkOiBzdHJpbmcsXG4gICAgdHJlZUVsZW1lbnRMb29rdXA6IHsgW2NvZGViYXNlSWQ6IHN0cmluZ106IGFueSB9LFxuICApIHtcbiAgICByZXR1cm4ge1xuICAgICAgdXJsUGF0aDogYGNhbnZhc2VzLyR7Y2FudmFzSWR9L3BhcnNlQW5kTXV0YXRlL2FjdGl2aXRpZXMvcmVkb0NoYW5nZVRvRmlsZXNgLFxuICAgICAgYm9keToge30sXG4gICAgfTtcbiAgfVxuXG4gIHB1YmxpYyBhcHBseUNvZGViYXNlSWRDaGFuZ2VzKHByZXZJZFRvTmV3SWRNYXA6IHtcbiAgICBbcHJldklkOiBzdHJpbmddOiBzdHJpbmc7XG4gIH0pIHtcbiAgICAvLyBEbyBub3RoaW5nXG4gIH1cbn1cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogVXBkYXRlIGNsYXNzIGNoYW5nZVxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlQ2xhc3Nlc0NoYW5nZUZpZWxkcyB7XG4gIGNvZGViYXNlSWRUb1VwZGF0ZUNsYXNzOiBzdHJpbmc7XG5cbiAgbmV3Q2xhc3Nlczogc3RyaW5nW107XG4gIG9sZENsYXNzZXM6IHN0cmluZ1tdOyAvLyBGb3IgdW5kb1xuXG4gIC8vIEludm9sdmVkIGNsYXNzZXMgKG1heSBuZWVkZWQgdG8gc3Vic3RpdHV0ZSBmb3IgVGFpbHdpbmQgSklUKVxuICAvLyBUT0RPKG5oYW50aGFpKTogU2hvdWxkIHJlbmFtZSB0aGlzIHRvIHNvbWUgYmV0dGVyIG5hbWluZ1xuICBpbnZvbHZlZENsYXNzZXM6IHsgdGFpbHdpbmQ6IHN0cmluZzsgY3NzOiBzdHJpbmcgfVtdO1xuXG4gIGlzSW5zdGFudENoYW5nZU9ubHk/OiBib29sZWFuO1xufVxuXG5leHBvcnQgY2xhc3MgVXBkYXRlQ2xhc3Nlc0NoYW5nZSBleHRlbmRzIENoYW5nZUxlZGdlckl0ZW08VXBkYXRlQ2xhc3Nlc0NoYW5nZUZpZWxkcz4ge1xuICBjb25zdHJ1Y3RvcihjaGFuZ2VGaWVsZHM6IFVwZGF0ZUNsYXNzZXNDaGFuZ2VGaWVsZHMsIGlkPzogc3RyaW5nKSB7XG4gICAgc3VwZXIoQ2hhbmdlVHlwZS5VUERBVEVfQ0xBU1NFUywgJ1VwZGF0ZSBDbGFzc2VzJywgY2hhbmdlRmllbGRzLCBpZCk7XG5cbiAgICB0aGlzLmNhbkluc3RhbnRVcGRhdGVXaGlsZUZsdXNoaW5nID0gdHJ1ZTtcbiAgfVxuXG4gIHB1YmxpYyBwcmVwYXJlQXBpUmVxdWVzdChcbiAgICBjYW52YXNJZDogc3RyaW5nLFxuICAgIHRyZWVFbGVtZW50TG9va3VwOiB7IFtjb2RlYmFzZUlkOiBzdHJpbmddOiBhbnkgfSxcbiAgKSB7XG4gICAgY29uc3QgeyBjb2RlYmFzZUlkVG9VcGRhdGVDbGFzcywgbmV3Q2xhc3Nlcywgb2xkQ2xhc3NlcywgaW52b2x2ZWRDbGFzc2VzIH0gPVxuICAgICAgdGhpcy5jaGFuZ2VGaWVsZHM7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdXJsUGF0aDogYGNhbnZhc2VzLyR7Y2FudmFzSWR9L3BhcnNlQW5kTXV0YXRlL211dGF0ZS91cGRhdGVDbGFzc2VzYCxcbiAgICAgIGJvZHk6IHtcbiAgICAgICAgcmVhY3RFbGVtZW50OiB0cmVlRWxlbWVudExvb2t1cFtjb2RlYmFzZUlkVG9VcGRhdGVDbGFzc10sXG4gICAgICAgIG5ld0NsYXNzZXMsXG4gICAgICAgIG9sZENsYXNzZXMsXG4gICAgICAgIGludm9sdmVkQ2xhc3NlcyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIHB1YmxpYyBhcHBseUNvZGViYXNlSWRDaGFuZ2VzKHByZXZJZFRvTmV3SWRNYXA6IHtcbiAgICBbcHJldklkOiBzdHJpbmddOiBzdHJpbmc7XG4gIH0pIHtcbiAgICBjb25zdCBuZXdDb2RlYmFzZUlkID1cbiAgICAgIHByZXZJZFRvTmV3SWRNYXBbdGhpcy5jaGFuZ2VGaWVsZHMuY29kZWJhc2VJZFRvVXBkYXRlQ2xhc3NdO1xuXG4gICAgaWYgKG5ld0NvZGViYXNlSWQpIHtcbiAgICAgIHRoaXMuY2hhbmdlRmllbGRzLmNvZGViYXNlSWRUb1VwZGF0ZUNsYXNzID0gbmV3Q29kZWJhc2VJZDtcbiAgICB9XG4gIH1cbn1cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogVW5rbm93biBDaGFuZ2UgVHlwZVxuICpcbiAqIFRoaXMgY2hhbmdlIHR5cGUgaXMgY3JlYXRlZCBmcm9tIHRoZSBhY3Rpdml0eSBzdHJlYW0gd2hlbiB0aGUgY2hhbmdlXG4gKiBsZWRnZXIgZ29lcyBvdXQgb2Ygc3luYyB3aXRoIGl0LiBUaGlzIGFsbG93cyB0aGUgdXNlciB0byBzdGlsbCB1bmRvXG4gKiB0aGF0IGNoYW5nZS5cbiAqXG4gKiBUaGlzIGNhbiBoYXBwZW4gaWYgZm9yIGV4YW1wbGUgYSBjYW52YXMgaXMgYmVpbmcgc2hhcmVkIGFuZCBhbm90aGVyXG4gKiB1c2VyIG1ha2VzIGEgY2hhbmdlIGluIGJldHdlZW4gdGhpcyB1c2VycycgY2hhbmdlc1xuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbmV4cG9ydCBpbnRlcmZhY2UgVW5rbm93bkNoYW5nZUZpZWxkcyB7fVxuXG5leHBvcnQgY2xhc3MgVW5rbm93bkNoYW5nZSBleHRlbmRzIENoYW5nZUxlZGdlckl0ZW08VW5rbm93bkNoYW5nZUZpZWxkcz4ge1xuICBjb25zdHJ1Y3RvcihjaGFuZ2VGaWVsZHM6IFVua25vd25DaGFuZ2VGaWVsZHMsIGlkPzogc3RyaW5nKSB7XG4gICAgc3VwZXIoQ2hhbmdlVHlwZS5VTktOT1dOLCAnJywgY2hhbmdlRmllbGRzLCBpZCk7XG4gICAgLy8gRG8gbm90IHByb2Nlc3MgdW5rbm93biBjaGFuZ2VzXG4gICAgdGhpcy5tYXJrUHJvY2Vzc2VkU3VjY2VlZGVkKCk7XG4gICAgdGhpcy5kb05vdFNlbmRJbnN0YW50VXBkYXRlKCk7XG4gIH1cblxuICBwdWJsaWMgcHJlcGFyZUFwaVJlcXVlc3QoXG4gICAgY2FudmFzSWQ6IHN0cmluZyxcbiAgICB0cmVlRWxlbWVudExvb2t1cDogeyBbY29kZWJhc2VJZDogc3RyaW5nXTogYW55IH0sXG4gICkge1xuICAgIHRocm93IEVycm9yKCdVbnN1cHBvcnRlZCBvcGVyYXRpb24nKTtcblxuICAgIC8vIEZvciB0eXBpbmdcbiAgICByZXR1cm4ge1xuICAgICAgdXJsUGF0aDogYGAsXG4gICAgICBib2R5OiB7fSxcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIGFwcGx5Q29kZWJhc2VJZENoYW5nZXMocHJldklkVG9OZXdJZE1hcDoge1xuICAgIFtwcmV2SWQ6IHN0cmluZ106IHN0cmluZztcbiAgfSkge1xuICAgIC8vIERvIG5vdGhpbmdcbiAgfVxufVxuXG4vKipcbiAqIFdoZW4gc2VyaWFsaXppbmcgYSBjaGFuZ2UgbGVkZ2VyIGl0ZW0gdG8gYSBwbGFpbiBKUyBvYmplY3QsIHRoZSBjbGFzcyBmdW5jdGlvbnNcbiAqIGFyZSBsb3N0LiBUaGlzIHJlY3JlYXRlcyB0aGUgY2hhbmdlIGl0ZW0gdGhhdCB3YXMgbG9zdFxuICovXG5leHBvcnQgY29uc3QgcmVjb25zdHJ1Y3RDaGFuZ2VMZWRnZXJDbGFzcyA9IChwbGFpbkpzT2JqZWN0OiB7XG4gIFtrZXk6IHN0cmluZ106IGFueTtcbn0pOiBBbnlDaGFuZ2VMZWRnZXJJdGVtIHwgbnVsbCA9PiB7XG4gIGlmICghcGxhaW5Kc09iamVjdCB8fCAhcGxhaW5Kc09iamVjdC50eXBlKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCBjaGFuZ2VUeXBlID0gcGxhaW5Kc09iamVjdC50eXBlIGFzIENoYW5nZVR5cGU7XG4gIGNvbnN0IGNoYW5nZUZpZWxkcyA9IHBsYWluSnNPYmplY3QuY2hhbmdlRmllbGRzO1xuICBjb25zdCBpZCA9IHBsYWluSnNPYmplY3QuaWQ7XG5cbiAgY29uc3QgZ2V0Q2hhbmdlRm9yVHlwZSA9ICgpID0+IHtcbiAgICBzd2l0Y2ggKGNoYW5nZVR5cGUpIHtcbiAgICAgIGNhc2UgQ2hhbmdlVHlwZS5TVFlMSU5HOlxuICAgICAgICByZXR1cm4gbmV3IFN0eWxpbmdDaGFuZ2UoY2hhbmdlRmllbGRzLCBpZCk7XG4gICAgICBjYXNlIENoYW5nZVR5cGUuQUREX0pTWDpcbiAgICAgICAgcmV0dXJuIG5ldyBBZGRKc3hDaGFuZ2UoY2hhbmdlRmllbGRzLCBpZCk7XG4gICAgICBjYXNlIENoYW5nZVR5cGUuUkVNT1ZFX0pTWDpcbiAgICAgICAgcmV0dXJuIG5ldyBSZW1vdmVKc3hDaGFuZ2UoY2hhbmdlRmllbGRzLCBpZCk7XG4gICAgICBjYXNlIENoYW5nZVR5cGUuTU9WRV9KU1g6XG4gICAgICAgIHJldHVybiBuZXcgTW92ZUpzeENoYW5nZShjaGFuZ2VGaWVsZHMsIGlkKTtcbiAgICAgIGNhc2UgQ2hhbmdlVHlwZS5DSEFOR0VfUFJPUDpcbiAgICAgICAgcmV0dXJuIG5ldyBDaGFuZ2VQcm9wQ2hhbmdlKGNoYW5nZUZpZWxkcywgaWQpO1xuICAgICAgY2FzZSBDaGFuZ2VUeXBlLkFERF9DTEFTUzpcbiAgICAgICAgcmV0dXJuIG5ldyBBZGRDbGFzc0NoYW5nZShjaGFuZ2VGaWVsZHMsIGlkKTtcbiAgICAgIGNhc2UgQ2hhbmdlVHlwZS5SRU1PVkVfQ0xBU1M6XG4gICAgICAgIHJldHVybiBuZXcgUmVtb3ZlQ2xhc3NDaGFuZ2UoY2hhbmdlRmllbGRzLCBpZCk7XG4gICAgICBjYXNlIENoYW5nZVR5cGUuVVBEQVRFX0NMQVNTRVM6XG4gICAgICAgIHJldHVybiBuZXcgVXBkYXRlQ2xhc3Nlc0NoYW5nZShjaGFuZ2VGaWVsZHMsIGlkKTtcbiAgICAgIGNhc2UgQ2hhbmdlVHlwZS5XUkFQX0RJVjpcbiAgICAgICAgcmV0dXJuIG5ldyBXcmFwRGl2Q2hhbmdlKGNoYW5nZUZpZWxkcywgaWQpO1xuICAgICAgY2FzZSBDaGFuZ2VUeXBlLkNIQU5HRV9UQUc6XG4gICAgICAgIHJldHVybiBuZXcgQ2hhbmdlVGFnQ2hhbmdlKGNoYW5nZUZpZWxkcywgaWQpO1xuICAgICAgY2FzZSBDaGFuZ2VUeXBlLkRVUExJQ0FURTpcbiAgICAgICAgcmV0dXJuIG5ldyBEdXBsaWNhdGVDaGFuZ2UoY2hhbmdlRmllbGRzLCBpZCk7XG4gICAgICBjYXNlIENoYW5nZVR5cGUuRURJVF9URVhUOlxuICAgICAgICByZXR1cm4gbmV3IEVkaXRUZXh0Q2hhbmdlKGNoYW5nZUZpZWxkcywgaWQpO1xuICAgICAgY2FzZSBDaGFuZ2VUeXBlLlVORE86XG4gICAgICAgIGNoYW5nZUZpZWxkcy5jaGFuZ2VUb1VuZG8gPSByZWNvbnN0cnVjdENoYW5nZUxlZGdlckNsYXNzKFxuICAgICAgICAgIGNoYW5nZUZpZWxkcy5jaGFuZ2VUb1VuZG8sXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBuZXcgVW5kb0NoYW5nZShjaGFuZ2VGaWVsZHMsIGlkKTtcbiAgICAgIGNhc2UgQ2hhbmdlVHlwZS5SRURPOlxuICAgICAgICBjaGFuZ2VGaWVsZHMuY2hhbmdlVG9SZWRvID0gcmVjb25zdHJ1Y3RDaGFuZ2VMZWRnZXJDbGFzcyhcbiAgICAgICAgICBjaGFuZ2VGaWVsZHMuY2hhbmdlVG9SZWRvLFxuICAgICAgICApO1xuICAgICAgICByZXR1cm4gbmV3IFJlZG9DaGFuZ2UoY2hhbmdlRmllbGRzLCBpZCk7XG4gICAgICBjYXNlIENoYW5nZVR5cGUuVU5LTk9XTjpcbiAgICAgICAgcmV0dXJuIG5ldyBVbmtub3duQ2hhbmdlKGNoYW5nZUZpZWxkcywgaWQpO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIGNoYW5nZSB0eXBlOiAke2NoYW5nZVR5cGV9YCk7XG4gICAgfVxuICB9O1xuXG4gIC8vIFNldCBhbGwgdGhlIG90aGVyIGZpZWxkcyBvbiB0aGUgY2hhbmdlIG9iamVjdFxuICBjb25zdCBjaGFuZ2UgPSBnZXRDaGFuZ2VGb3JUeXBlKCk7XG4gIE9iamVjdC5rZXlzKHBsYWluSnNPYmplY3QpLmZvckVhY2goKGtleTogc3RyaW5nKSA9PiB7XG4gICAgaWYgKFsndHlwZScsICdjaGFuZ2VGaWVsZHMnLCAnaWQnXS5pbmNsdWRlcyhrZXkpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGNoYW5nZVtrZXldID0gcGxhaW5Kc09iamVjdFtrZXldO1xuICB9KTtcblxuICByZXR1cm4gY2hhbmdlO1xufTtcbiJdfQ==