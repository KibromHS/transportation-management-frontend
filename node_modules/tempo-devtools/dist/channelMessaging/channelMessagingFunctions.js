"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.initChannelMessagingFunctions = void 0;
const identifierUtils_1 = require("./identifierUtils");
const sessionStorageUtils_1 = require("./sessionStorageUtils");
const navTreeUtils_1 = require("./navTreeUtils");
// @ts-ignore
const jquery_1 = __importDefault(require("jquery"));
const lodash_1 = __importDefault(require("lodash"));
const outlineUtils_1 = require("./outlineUtils");
const cssFunctions_1 = require("./cssFunctions");
const constantsAndTypes_1 = require("./constantsAndTypes");
const changeItemFunctions_1 = require("./changeItemFunctions");
const resqUtils_1 = require("./resqUtils");
const tempoElement_1 = require("./tempoElement");
const editTextUtils_1 = require("./editTextUtils");
const DebounceExecutor_1 = require("../utils/DebounceExecutor");
const domUtils_1 = require("./domUtils");
const PIXELS_TO_MOVE_BEFORE_DRAG = 20;
const IMMEDIATELY_REMOVE_POINTER_LOCK = 'IMMEDIATELY_REMOVE_POINTER_LOCK';
const LAST_NAV_TREE_REFRESH_TIME = 'LAST_NAV_TREE_REFRESH_TIME';
// TODO: Change all of this to be a react wrapper library
const initChannelMessagingFunctions = () => {
    (0, changeItemFunctions_1.resetIntermediateClassesForSliderInstantUpdate)();
    // All processes that involves updating the UI should use this runner to avoid triggering a cascade of updates
    let globalUIUpdateRunner = domUtils_1.defaultUIUpdateRunner;
    // @ts-ignore
    String.prototype.hashCode = function () {
        var hash = 0, i, chr;
        if (this.length === 0)
            return hash;
        for (i = 0; i < this.length; i++) {
            chr = this.charCodeAt(i);
            hash = (hash << 5) - hash + chr;
            hash |= 0; // Convert to 32bit integer
        }
        return hash;
    };
    // We want to make event listeners non-passive, and to do so have to check
    // that browsers support EventListenerOptions in the first place.
    // https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener#Safely_detecting_option_support
    let passiveSupported = false;
    const makePassiveEventOption = () => {
        try {
            const options = {
                get passive() {
                    // This function will be called when the browser
                    //   attempts to access the passive property.
                    passiveSupported = true;
                    return false;
                },
            };
            return options;
        }
        catch (err) {
            passiveSupported = false;
            return passiveSupported;
        }
    };
    /**
     * Taken from: https://stackoverflow.com/questions/3219758/detect-changes-in-the-dom
     *
     * Returns the function to disconnect the observer
     */
    const observeDOM = (function () {
        // @ts-ignore
        var MutationObserver = 
        // @ts-ignore
        window.MutationObserver || window.WebKitMutationObserver;
        return function (objs, callback) {
            const filteredObjs = objs.filter((obj) => obj && obj.nodeType === 1);
            if (filteredObjs.length === 0) {
                return domUtils_1.defaultUIUpdateRunner;
            }
            var mutationObserver;
            const uiUpdateRunner = (innerScope) => {
                // Pause the observer
                if (mutationObserver) {
                    mutationObserver.disconnect();
                }
                innerScope();
                // Resume the observer
                if (mutationObserver) {
                    filteredObjs.forEach((obj) => {
                        mutationObserver.observe(obj, {
                            childList: true,
                            subtree: true,
                            attributes: true,
                            attributeOldValue: true,
                        });
                    });
                }
            };
            if (MutationObserver) {
                mutationObserver = new MutationObserver(callback);
                filteredObjs.forEach((obj) => {
                    // have the observer observe foo for changes in children
                    mutationObserver.observe(obj, {
                        childList: true,
                        subtree: true,
                        attributes: true,
                        attributeOldValue: true,
                    });
                });
            }
            // browser support fallback
            // @ts-ignore
            else if (window.addEventListener) {
                filteredObjs.forEach((obj) => {
                    obj.addEventListener('DOMNodeInserted', callback, false);
                    obj.addEventListener('DOMNodeRemoved', callback, false);
                });
            }
            return uiUpdateRunner;
        };
    })();
    /**
     * When selecting in normal mode (not meta key), can select one level down, a sibling
     * or a parent of the selected element
     */
    const getSelectableNavNode = (e) => {
        const selectedElementKey = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.SELECTED_ELEMENT_KEY);
        const selectedElement = tempoElement_1.TempoElement.fromKey(selectedElementKey);
        const elementKeyToNavNode = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.ELEMENT_KEY_TO_NAV_NODE);
        // Move up the tree until you find the first valid nav node
        let firstNavNode = null;
        let searchNode = e.target;
        while (searchNode && !firstNavNode) {
            firstNavNode =
                elementKeyToNavNode[(0, identifierUtils_1.getElementKeyFromNode)(searchNode) || ''];
            searchNode = searchNode.parentElement;
        }
        if (!firstNavNode) {
            return constantsAndTypes_1.SELECT_OR_HOVER_STORYBOARD;
        }
        const isNavNodeMatch = (navTreeNode) => {
            var _a, _b, _c, _d;
            if (selectedElement.isEmpty()) {
                // This function cannot be called if there is no selected element, see code logic below the function
                throw Error('No selected element when isNavNodeMatch called');
            }
            if (!navTreeNode) {
                return false;
            }
            // If there is no codebase ID it should not be selectable as there is nothing we can do with it
            if (!navTreeNode.tempoElement.codebaseId.startsWith('tempo-') ||
                navTreeNode.tempoElement.codebaseId === navTreeUtils_1.SKIP_ROOT_CODEBASE_ID) {
                return false;
            }
            // If it matches, we already passed all possible children, so re-select it
            if (selectedElement.isEqual(navTreeNode.tempoElement)) {
                return true;
            }
            // Any parent is ok to select
            if (navTreeNode.tempoElement.isParentOf(selectedElement)) {
                return true;
            }
            // Check parents
            // Pick the first parent with a codebase ID
            let parent = navTreeNode.parent;
            while (parent && !parent.tempoElement.codebaseId.startsWith('tempo-')) {
                parent = parent.parent;
            }
            // One level down
            if ((_a = parent === null || parent === void 0 ? void 0 : parent.tempoElement) === null || _a === void 0 ? void 0 : _a.isEqual(selectedElement)) {
                return true;
            }
            // Sibling of any parent
            const selectedNode = elementKeyToNavNode[selectedElement.getKey()];
            if (selectedNode &&
                ((_d = (_c = (_b = navTreeNode.parent) === null || _b === void 0 ? void 0 : _b.children) === null || _c === void 0 ? void 0 : _c.includes) === null || _d === void 0 ? void 0 : _d.call(_c, selectedNode))) {
                return true;
            }
            return false;
        };
        let foundNavNode = null;
        let searchNavNode = firstNavNode;
        while (searchNavNode) {
            if (!selectedElement.isEmpty() && !selectedElement.isStoryboard()) {
                // If there is a selected element key loop from this element up the stack to find the element that is the direct child
                // of the expected selected element, so that you can only hover one level deeper than you've selected
                if (isNavNodeMatch(searchNavNode)) {
                    foundNavNode = searchNavNode;
                    // Exit the loop as we found the node that matches
                    break;
                }
            }
            else {
                // If there is no selected element key, or the selection is the storyboard itself, loop up to the top-most element with a codebase ID
                if (searchNavNode.tempoElement.codebaseId &&
                    searchNavNode.tempoElement.codebaseId.startsWith('tempo-')) {
                    foundNavNode = searchNavNode;
                    // Note: we do not exit the loop here as we want to keep searching for the top-most element
                }
            }
            searchNavNode = searchNavNode.parent;
        }
        return foundNavNode || null;
    };
    const onPointerOver = (e, parentPort, storyboardId, selectBottomMostElement) => {
        const passedThrough = passThroughEventsIfNeeded(e, parentPort, storyboardId);
        const editingTextInfo = (0, editTextUtils_1.getEditingInfo)();
        // Allow on pointer over events if editing (so we can click out)
        if (e.altKey || (passedThrough && !editingTextInfo)) {
            return;
        }
        if ((0, sessionStorageUtils_1.getMemoryStorageItem)('mouseDragContext')) {
            return;
        }
        const currentHoveredKey = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.HOVERED_ELEMENT_KEY);
        const elementKeyToNavNode = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.ELEMENT_KEY_TO_NAV_NODE) || {};
        let hoveredNavNode;
        if (e.metaKey || e.ctrlKey || selectBottomMostElement) {
            const elementKey = (0, identifierUtils_1.getElementKeyFromNode)(e.target);
            hoveredNavNode = elementKeyToNavNode[elementKey];
            // Special case -> this is the top-most node so it should trigger a hover on the storyboard
            if (!hoveredNavNode && e.target.parentNode === document.body) {
                hoveredNavNode = constantsAndTypes_1.SELECT_OR_HOVER_STORYBOARD;
            }
        }
        else {
            hoveredNavNode = getSelectableNavNode(e);
        }
        const currentSelectedKey = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.SELECTED_ELEMENT_KEY);
        const currentSelectedElement = tempoElement_1.TempoElement.fromKey(currentSelectedKey);
        // If the user is holding shift, only allow selecting siblings
        if (e.shiftKey && hoveredNavNode && currentSelectedKey) {
            // Trying to select the entire storyboard, allow only if the other selected element is also a storyboard
            if (typeof hoveredNavNode === 'string' &&
                !currentSelectedElement.isStoryboard()) {
                hoveredNavNode = null;
            }
            if (typeof hoveredNavNode !== 'string' &&
                !(hoveredNavNode === null || hoveredNavNode === void 0 ? void 0 : hoveredNavNode.tempoElement.isSiblingOf(currentSelectedElement))) {
                hoveredNavNode = null;
            }
        }
        if (!hoveredNavNode) {
            if (currentHoveredKey !== null) {
                (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.HOVERED_ELEMENT_KEY, null);
                parentPort.postMessage({
                    id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.HOVERED_ELEMENT_KEY,
                    elementKey: null,
                });
                (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
            }
            return;
        }
        if (typeof hoveredNavNode === 'string') {
            if (hoveredNavNode === constantsAndTypes_1.SELECT_OR_HOVER_STORYBOARD) {
                const storyboardKey = tempoElement_1.TempoElement.forStoryboard(storyboardId).getKey();
                if (currentHoveredKey !== storyboardKey) {
                    (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.HOVERED_ELEMENT_KEY, storyboardKey);
                    parentPort.postMessage({
                        id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.HOVERED_ELEMENT_KEY,
                        elementKey: storyboardKey,
                    });
                    (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
                }
            }
            return;
        }
        const tempoElementKey = hoveredNavNode.tempoElement.getKey();
        if (currentHoveredKey !== tempoElementKey) {
            parentPort.postMessage({
                id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.HOVERED_ELEMENT_KEY,
                elementKey: tempoElementKey,
            });
            (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.HOVERED_ELEMENT_KEY, tempoElementKey);
            (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
        }
    };
    const clearHoveredElements = (parentPort, storyboardId) => {
        const currentHoveredKey = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.HOVERED_ELEMENT_KEY);
        if (!currentHoveredKey) {
            return;
        }
        parentPort.postMessage({
            id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.HOVERED_ELEMENT_KEY,
            elementKey: null,
        });
        (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.HOVERED_ELEMENT_KEY, null);
        (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
    };
    const onPointerMove = (e, parentPort, storyboardId) => __awaiter(void 0, void 0, void 0, function* () {
        var _a;
        passThroughEventsIfNeeded(e, parentPort, storyboardId);
        // If no buttons are pressed the drag end event may not have correctly triggered
        // reset the drag state
        let mouseDragData = (0, sessionStorageUtils_1.getMemoryStorageItem)('mouseDragContext');
        if (!e.buttons && mouseDragData) {
            (0, sessionStorageUtils_1.setMemoryStorageItem)('mouseDragContext', null);
            if (mouseDragData === null || mouseDragData === void 0 ? void 0 : mouseDragData.dragging) {
                parentPort.postMessage({
                    id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.DRAG_CANCEL_EVENT,
                    event: {},
                });
            }
            mouseDragData = null;
        }
        const importantFields = {
            pageX: e.pageX,
            pageY: e.pageY,
            clientX: e.clientX,
            clientY: e.clientY,
        };
        (0, sessionStorageUtils_1.setMemoryStorageItem)('mousePos', importantFields);
        parentPort.postMessage({
            id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.MOUSE_MOVE_EVENT,
            event: importantFields,
        });
        if (mouseDragData && !mouseDragData.dragging) {
            const zoomPerc = (0, sessionStorageUtils_1.getMemoryStorageItem)('zoomPerc') || 1;
            const totalMovementPixels = Math.abs(mouseDragData.pageX - e.pageX) +
                Math.abs(mouseDragData.pageY - e.pageY);
            // Start the drag event if the user has moved enough
            if (totalMovementPixels >= PIXELS_TO_MOVE_BEFORE_DRAG / zoomPerc) {
                // Reselect the parent if there was one to select
                if (mouseDragData.parentSelectedElementKey) {
                    const elementKeyToNavNode = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.ELEMENT_KEY_TO_NAV_NODE) || {};
                    const navNodeToSelect = elementKeyToNavNode[mouseDragData.parentSelectedElementKey];
                    if (navNodeToSelect) {
                        parentPort.postMessage({
                            id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.SELECTED_ELEMENT_KEY,
                            elementKey: mouseDragData.parentSelectedElementKey,
                            outerHTML: (_a = (0, jquery_1.default)(`.${identifierUtils_1.ELEMENT_KEY_PREFIX}${mouseDragData.parentSelectedElementKey}`).get(0)) === null || _a === void 0 ? void 0 : _a.outerHTML,
                        });
                        (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.SELECTED_ELEMENT_KEY, mouseDragData.parentSelectedElementKey);
                    }
                }
                const aiContextSelection = (0, sessionStorageUtils_1.getMemoryStorageItem)('aiContext');
                // Don't enable dragging if the AI context is enabled
                if (!aiContextSelection) {
                    (0, sessionStorageUtils_1.setMemoryStorageItem)('mouseDragContext', Object.assign(Object.assign({}, mouseDragData), { dragging: true }));
                    const selectedElementKey = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.SELECTED_ELEMENT_KEY);
                    const selectedElement = (0, jquery_1.default)(`.${identifierUtils_1.ELEMENT_KEY_PREFIX}${selectedElementKey}`).get(0);
                    // Trigger the drag start event
                    parentPort.postMessage({
                        id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.DRAG_START_EVENT,
                        event: mouseDragData,
                        outerHTML: selectedElement === null || selectedElement === void 0 ? void 0 : selectedElement.outerHTML,
                    });
                    const bodyObject = (0, jquery_1.default)('body').get(0);
                    // HACK: March 8, 2024
                    // Without this workaround events stay inside the iframe so it's not possible to
                    // track mouse movements outside the iframe when clicking & dragging.
                    // Set the pointer lock and immediately remove it so that
                    // the events start to propagate upwards in the outer application.
                    (0, sessionStorageUtils_1.setMemoryStorageItem)(IMMEDIATELY_REMOVE_POINTER_LOCK, true);
                    yield (bodyObject === null || bodyObject === void 0 ? void 0 : bodyObject.requestPointerLock());
                }
            }
        }
        if ((0, sessionStorageUtils_1.getMemoryStorageItem)('mouseDragContext')) {
            (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
        }
    });
    const getParentDomElementForNavNode = (navNode) => {
        if (!navNode) {
            return null;
        }
        if (!(navNode === null || navNode === void 0 ? void 0 : navNode.isComponent)) {
            const childDomElement = (0, jquery_1.default)(`.${identifierUtils_1.ELEMENT_KEY_PREFIX}${navNode.tempoElement.getKey()}`).get(0);
            return childDomElement === null || childDomElement === void 0 ? void 0 : childDomElement.parentElement;
        }
        // This is the list of real DOM elements that are at the top level of this component
        const elementKeyToLookupList = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.ELEMENT_KEY_TO_LOOKUP_LIST) || {};
        const lookupList = elementKeyToLookupList[navNode.tempoElement.getKey()] || [];
        let childDomElement;
        lookupList.forEach((lookupElementKey) => {
            if (childDomElement) {
                return;
            }
            childDomElement = (0, jquery_1.default)(`.${identifierUtils_1.ELEMENT_KEY_PREFIX}${lookupElementKey}`).get(0);
        });
        return childDomElement === null || childDomElement === void 0 ? void 0 : childDomElement.parentElement;
    };
    const onPointerDown = (e, parentPort, storyboardId) => {
        // This variable determines which button was used
        // 1 -> left, 2 -> middle, 3 -> right
        if (e.which !== 1) {
            return;
        }
        // Allow the edit dynamic text button to be clicked
        if ((0, identifierUtils_1.hasClass)(e.target, identifierUtils_1.EDIT_TEXT_BUTTON)) {
            return;
        }
        const passedThrough = passThroughEventsIfNeeded(e, parentPort, storyboardId);
        if (passedThrough) {
            return;
        }
        const selectedElementKey = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.SELECTED_ELEMENT_KEY);
        const selectedElement = tempoElement_1.TempoElement.fromKey(selectedElementKey);
        const selectedNavNode = onSelectElement(e, parentPort, storyboardId);
        const useSelectedIfDragging = !selectedElement.isEmpty() &&
            selectedElement.isParentOf(selectedNavNode === null || selectedNavNode === void 0 ? void 0 : selectedNavNode.tempoElement);
        let offsetX, offsetY;
        if (selectedNavNode === null || selectedNavNode === void 0 ? void 0 : selectedNavNode.pageBoundingBox) {
            offsetX =
                selectedNavNode.pageBoundingBox.pageX +
                    selectedNavNode.pageBoundingBox.width / 2 -
                    e.pageX;
            offsetY =
                selectedNavNode.pageBoundingBox.pageY +
                    selectedNavNode.pageBoundingBox.height / 2 -
                    e.pageY;
        }
        const importantFields = {
            pageX: e.pageX,
            pageY: e.pageY,
            // The difference between where the user clicked and the center of the element
            offsetX,
            offsetY,
            // Used to reselect the parent if the user starts to move
            parentSelectedElementKey: useSelectedIfDragging
                ? selectedElementKey
                : null,
        };
        const elementKeyToNavNode = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.ELEMENT_KEY_TO_NAV_NODE) || {};
        // Get the parent element (actual DOM element) that this node is being dragged inside
        // To do this pick one child element that is being dragged (can be multiple children if the node being dragged is a component),
        // and get its parent in the DOM
        const navNodeToUseForDragging = useSelectedIfDragging
            ? elementKeyToNavNode[selectedElementKey]
            : selectedNavNode;
        const parentDomElement = getParentDomElementForNavNode(navNodeToUseForDragging);
        if (parentDomElement) {
            importantFields['selectedParentDisplay'] = (0, cssFunctions_1.cssEval)(parentDomElement, 'display');
            importantFields['selectedParentFlexDirection'] = (0, cssFunctions_1.cssEval)(parentDomElement, 'flex-direction');
        }
        const aiContextSelection = (0, sessionStorageUtils_1.getMemoryStorageItem)('aiContext');
        // Don't enable dragging if the AI context is enabled
        if (!aiContextSelection) {
            (0, sessionStorageUtils_1.setMemoryStorageItem)('mouseDragContext', importantFields);
        }
        (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
    };
    const onPointerUp = (e, parentPort, storyboardId) => {
        passThroughEventsIfNeeded(e, parentPort, storyboardId);
        const mouseDragData = (0, sessionStorageUtils_1.getMemoryStorageItem)('mouseDragContext');
        (0, sessionStorageUtils_1.setMemoryStorageItem)('mouseDragContext', null);
        if (mouseDragData === null || mouseDragData === void 0 ? void 0 : mouseDragData.dragging) {
            parentPort.postMessage({
                id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.DRAG_END_EVENT,
                event: {},
            });
        }
        (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
    };
    const onSelectElement = (e, parentPort, storyboardId) => {
        var _a, _b, _c;
        const driveModeEnabled = !!(0, sessionStorageUtils_1.getSessionStorageItem)('driveModeEnabled', storyboardId);
        if (driveModeEnabled) {
            return null;
        }
        const elementKeyToNavNode = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.ELEMENT_KEY_TO_NAV_NODE) || {};
        let selectedNavNode;
        if (e.metaKey || e.ctrlKey) {
            const elementKey = (0, identifierUtils_1.getElementKeyFromNode)(e.target);
            selectedNavNode = elementKeyToNavNode[elementKey];
            // Special case -> this is the top-most node so it should trigger a select on the storyboard
            if (!selectedNavNode && e.target.parentNode === document.body) {
                selectedNavNode = constantsAndTypes_1.SELECT_OR_HOVER_STORYBOARD;
            }
        }
        else {
            selectedNavNode = getSelectableNavNode(e);
        }
        const currentSelectedElementKey = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.SELECTED_ELEMENT_KEY);
        // If this is not a valid nav node, it's not something we track - deselect all
        if (!selectedNavNode) {
            if (currentSelectedElementKey) {
                parentPort.postMessage({
                    id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.SELECTED_ELEMENT_KEY,
                    elementKey: null,
                });
                (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.SELECTED_ELEMENT_KEY, null);
                (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
            }
            return null;
        }
        const currentSelectedElement = tempoElement_1.TempoElement.fromKey(currentSelectedElementKey);
        const currentMultiSelectedKeys = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.MULTI_SELECTED_ELEMENT_KEYS) || [];
        let newSelectedElement = typeof selectedNavNode === 'string'
            ? tempoElement_1.TempoElement.forStoryboard(storyboardId)
            : selectedNavNode.tempoElement;
        let newMultiSelectKeys = [];
        // If the user is holding shift, check if we can multi-select (something has to be already selected)
        // Note: this logic generally matches the logic in the iframe slice on tempo-web
        if (e.shiftKey && currentSelectedElementKey) {
            // First check if we are deselecting
            const elementToDeselect = currentMultiSelectedKeys
                .map((elementKey) => tempoElement_1.TempoElement.fromKey(elementKey))
                .find((element) => {
                return (element.isParentOf(newSelectedElement) ||
                    element.isEqual(newSelectedElement));
            });
            if (elementToDeselect) {
                newMultiSelectKeys = currentMultiSelectedKeys.filter((elementKey) => {
                    return elementKey !== elementToDeselect.getKey();
                });
                // Pick a new element to be the main selected element
                // Note, if the length is 1, there is logic further down to handle that case explicitly (to exit multiselect mode)
                if (elementToDeselect.isEqual(currentSelectedElement) &&
                    newMultiSelectKeys.length > 1) {
                    parentPort.postMessage({
                        id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.SELECTED_ELEMENT_KEY,
                        elementKey: newMultiSelectKeys[0],
                        outerHTML: (_a = (0, jquery_1.default)(`.${identifierUtils_1.ELEMENT_KEY_PREFIX}${newMultiSelectKeys[0]}`).get(0)) === null || _a === void 0 ? void 0 : _a.outerHTML,
                    });
                    (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.SELECTED_ELEMENT_KEY, newMultiSelectKeys[0]);
                }
                // Check if we can add this element
            }
            else if (currentSelectedElement.isSiblingOf(newSelectedElement)) {
                if (currentMultiSelectedKeys === null || currentMultiSelectedKeys === void 0 ? void 0 : currentMultiSelectedKeys.length) {
                    newMultiSelectKeys = currentMultiSelectedKeys.concat([
                        newSelectedElement.getKey(),
                    ]);
                }
                else {
                    newMultiSelectKeys = [
                        currentSelectedElementKey,
                        newSelectedElement.getKey(),
                    ];
                }
            }
            else {
                // This case the user is trying to multiselect but it's not something that's allowed, just return but don't make any changes
                return null;
            }
        }
        // In multiselect mode, set the necessary values
        if (newMultiSelectKeys.length > 1) {
            parentPort.postMessage({
                id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.MULTI_SELECTED_ELEMENT_KEYS,
                elementKeys: newMultiSelectKeys,
                outerHTMLs: newMultiSelectKeys === null || newMultiSelectKeys === void 0 ? void 0 : newMultiSelectKeys.map((elementKey) => { var _a; return (_a = (0, jquery_1.default)(`.${identifierUtils_1.ELEMENT_KEY_PREFIX}${elementKey}`).get(0)) === null || _a === void 0 ? void 0 : _a.outerHTML; }),
            });
            (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.MULTI_SELECTED_ELEMENT_KEYS, newMultiSelectKeys);
            (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
            (0, editTextUtils_1.teardownEditableText)(parentPort, storyboardId);
            return null; // Cannot perform regular actions on any particular node
        }
        // Special case - multiselecting but deselecting down to 1, stop the multiselect mode
        if (newMultiSelectKeys.length === 1) {
            newSelectedElement = tempoElement_1.TempoElement.fromKey(newMultiSelectKeys[0]);
        }
        const clearMultiSelectState = () => {
            // Not multi-selecting, so clear the multiselect state
            // Want to do this after setting the selected element to prevent flashing
            parentPort.postMessage({
                id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.MULTI_SELECTED_ELEMENT_KEYS,
                elementKeys: [],
                outerHTMLs: [],
            });
            (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.MULTI_SELECTED_ELEMENT_KEYS, null);
        };
        // Selecting the storyboard from within
        if (newSelectedElement.isStoryboard()) {
            if (newSelectedElement.getKey() !== currentSelectedElementKey) {
                parentPort.postMessage({
                    id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.SELECTED_ELEMENT_KEY,
                    elementKey: newSelectedElement.getKey(),
                    outerHTML: (_b = (0, jquery_1.default)(`.${identifierUtils_1.ELEMENT_KEY_PREFIX}${newSelectedElement.getKey()}`).get(0)) === null || _b === void 0 ? void 0 : _b.outerHTML,
                });
                (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.SELECTED_ELEMENT_KEY, newSelectedElement.getKey());
                (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
            }
            (0, editTextUtils_1.teardownEditableText)(parentPort, storyboardId);
            clearMultiSelectState();
            return null;
        }
        if ((0, editTextUtils_1.currentlyEditing)()) {
            const editingInfo = (0, editTextUtils_1.getEditingInfo)();
            if ((editingInfo === null || editingInfo === void 0 ? void 0 : editingInfo.key) !== currentSelectedElementKey) {
                (0, editTextUtils_1.teardownEditableText)(parentPort, storyboardId);
            }
            clearMultiSelectState();
            return null;
        }
        e.preventDefault();
        e.stopPropagation();
        if ((0, editTextUtils_1.canEditText)(newSelectedElement) &&
            newSelectedElement.getKey() === currentSelectedElementKey) {
            (0, editTextUtils_1.setupEditableText)(newSelectedElement, parentPort, storyboardId);
        }
        if (newSelectedElement.getKey() === currentSelectedElementKey) {
            clearMultiSelectState();
            return selectedNavNode;
        }
        parentPort.postMessage({
            id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.SELECTED_ELEMENT_KEY,
            elementKey: newSelectedElement.getKey(),
            outerHTML: (_c = (0, jquery_1.default)(`.${identifierUtils_1.ELEMENT_KEY_PREFIX}${newSelectedElement.getKey()}`).get(0)) === null || _c === void 0 ? void 0 : _c.outerHTML,
        });
        (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.SELECTED_ELEMENT_KEY, newSelectedElement.getKey());
        (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
        clearMultiSelectState();
        return selectedNavNode;
    };
    /**
     * Returns if events were passed through
     */
    const passThroughEventsIfNeeded = (e, parentPort, storyboardId) => {
        var _a, _b;
        const driveModeEnabled = !!(0, sessionStorageUtils_1.getSessionStorageItem)('driveModeEnabled', storyboardId);
        const editingTextInfo = (0, editTextUtils_1.getEditingInfo)();
        if (driveModeEnabled || editingTextInfo) {
            return true;
        }
        (_a = e === null || e === void 0 ? void 0 : e.preventDefault) === null || _a === void 0 ? void 0 : _a.call(e);
        (_b = e === null || e === void 0 ? void 0 : e.stopPropagation) === null || _b === void 0 ? void 0 : _b.call(e);
        return false;
    };
    const onClickElementContextMenu = (e, parentPort, storyboardId) => {
        var _a;
        const passedThrough = passThroughEventsIfNeeded(e, parentPort, storyboardId);
        if (passedThrough) {
            return;
        }
        e.preventDefault();
        e.stopPropagation();
        // Mouse down is called when a user clicks the context menu, but not mouse up, so clear the mouse down
        (0, sessionStorageUtils_1.setMemoryStorageItem)('mouseDragContext', null);
        const elementKeyToNavNode = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.ELEMENT_KEY_TO_NAV_NODE) || {};
        let requestedNavNode;
        if (e.metaKey || e.ctrlKey) {
            const elementKey = (0, identifierUtils_1.getElementKeyFromNode)(e.target);
            requestedNavNode = elementKeyToNavNode[elementKey];
            // Special case -> this is the top-most node so it should trigger a context menu on the storyboard
            if (!requestedNavNode && e.target.parentNode === document.body) {
                requestedNavNode = constantsAndTypes_1.SELECT_OR_HOVER_STORYBOARD;
            }
        }
        else {
            requestedNavNode = getSelectableNavNode(e);
        }
        const currentSelectedElementKey = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.SELECTED_ELEMENT_KEY);
        const currentMultiSelectedKeys = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.MULTI_SELECTED_ELEMENT_KEYS);
        if (!requestedNavNode || typeof requestedNavNode === 'string') {
            if (requestedNavNode === constantsAndTypes_1.SELECT_OR_HOVER_STORYBOARD &&
                !(currentMultiSelectedKeys === null || currentMultiSelectedKeys === void 0 ? void 0 : currentMultiSelectedKeys.length)) {
                const storyboardKey = tempoElement_1.TempoElement.forStoryboard(storyboardId).getKey();
                if (currentSelectedElementKey === storyboardKey) {
                    return;
                }
                parentPort.postMessage({
                    id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.SELECTED_ELEMENT_KEY,
                    elementKey: storyboardKey,
                });
                (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.SELECTED_ELEMENT_KEY, storyboardKey);
                (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
            }
            return;
        }
        let contextRequestedElementKey = null;
        const selectedElementKey = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.SELECTED_ELEMENT_KEY);
        const selectedElement = tempoElement_1.TempoElement.fromKey(selectedElementKey);
        // Don't select any children as the user might be right clicking a node they selected
        if (!requestedNavNode.tempoElement.isEqual(selectedElement) &&
            !selectedElement.isParentOf(requestedNavNode.tempoElement) &&
            !(currentMultiSelectedKeys === null || currentMultiSelectedKeys === void 0 ? void 0 : currentMultiSelectedKeys.length) // Also don't select anything new if in multiselect mode
        ) {
            contextRequestedElementKey = requestedNavNode.tempoElement.getKey();
            parentPort.postMessage({
                id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.SELECTED_ELEMENT_KEY,
                elementKey: contextRequestedElementKey,
                outerHTML: (_a = (0, jquery_1.default)(`.${identifierUtils_1.ELEMENT_KEY_PREFIX}${contextRequestedElementKey}`).get(0)) === null || _a === void 0 ? void 0 : _a.outerHTML,
            });
            (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.SELECTED_ELEMENT_KEY, contextRequestedElementKey);
            (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
        }
        const importantFields = {
            clientX: e.clientX,
            clientY: e.clientY,
        };
        parentPort.postMessage({
            id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.CONTEXT_REQUESTED,
            event: importantFields,
        });
    };
    const buildAndSendNavTree = (parentPort, storyboardId, treeElementLookup, scopeLookup, storyboardComponentElement) => {
        let treeElements = treeElementLookup;
        if (!treeElements) {
            treeElements = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.TREE_ELEMENT_LOOKUP) || {};
        }
        let scopes = scopeLookup;
        if (!scopes) {
            scopes = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.SCOPE_LOOKUP) || {};
        }
        let storyboardComponent = storyboardComponentElement;
        if (storyboardComponentElement === 'EXPLICIT_NONE') {
            storyboardComponent = null;
        }
        else if (!storyboardComponent) {
            storyboardComponent = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.STORYBOARD_COMPONENT) || {};
        }
        const rootReactElement = (0, resqUtils_1.getRootReactElement)();
        const reactTree = (0, resqUtils_1.buildNodeTree)(rootReactElement, null);
        const lookupIdToReactTreeMap = {};
        (0, resqUtils_1.buildTreeLookupMap)(reactTree, lookupIdToReactTreeMap);
        const knownComponentNames = new Set();
        const knownComponentInstanceNames = new Set();
        if (treeElements) {
            Object.values(treeElements).forEach((treeElement) => {
                if (treeElement.type === 'component' ||
                    treeElement.type === 'storybook-component') {
                    knownComponentNames.add(treeElement.componentName);
                }
                if (treeElement.type === 'component-instance') {
                    knownComponentInstanceNames.add(treeElement.componentName);
                }
            });
        }
        const elementKeyToLookupList = {};
        const elementKeyToNavNode = {};
        const builtNavTree = (0, navTreeUtils_1.buildNavForNode)(storyboardId, undefined, (0, jquery_1.default)('body').get(0), '', 'root', scopes, treeElements, lookupIdToReactTreeMap, knownComponentNames, knownComponentInstanceNames, elementKeyToLookupList, elementKeyToNavNode);
        (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.ELEMENT_KEY_TO_LOOKUP_LIST, elementKeyToLookupList);
        (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.CURRENT_NAV_TREE, builtNavTree);
        (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.ELEMENT_KEY_TO_NAV_NODE, elementKeyToNavNode);
        (0, resqUtils_1.clearLookupsFromTree)(reactTree);
        parentPort.postMessage({
            id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.NAV_TREE,
            navTree: builtNavTree,
            outerHtml: document.documentElement.outerHTML,
        });
        // Run callbacks
        (0, navTreeUtils_1.runNavTreeBuiltCallbacks)();
    };
    const onFlushStart = () => {
        // Find all instant update styling classes to delete
        const classesToDelete = [];
        (0, jquery_1.default)(`*[class*=${identifierUtils_1.TEMPO_INSTANT_UPDATE_STYLING_PREFIX}]`).each((i, element) => {
            const classes = (element.getAttribute('class') || '').split(' ');
            classes.forEach((className) => {
                if (className.startsWith(identifierUtils_1.TEMPO_INSTANT_UPDATE_STYLING_PREFIX)) {
                    classesToDelete.push(className);
                }
            });
        });
        (0, jquery_1.default)(`*[${identifierUtils_1.TEMPO_DELETE_AFTER_REFRESH}=true]`).attr(identifierUtils_1.TEMPO_QUEUE_DELETE_AFTER_HOT_RELOAD, 'true');
        // Clear the add class instant update queue as those items will be applied in the hot reload
        (0, sessionStorageUtils_1.setMemoryStorageItem)(changeItemFunctions_1.ADD_CLASS_INSTANT_UPDATE_QUEUE, []);
        (0, sessionStorageUtils_1.setMemoryStorageItem)('POST_HOT_RELOAD_CLEAR', {
            classesToDelete,
        });
    };
    const clearInstantUpdatesAndSendNavTree = (parentPort, storyboardId) => {
        globalUIUpdateRunner(() => {
            (0, sessionStorageUtils_1.setMemoryStorageItem)(LAST_NAV_TREE_REFRESH_TIME, new Date());
            const { classesToDelete } = (0, sessionStorageUtils_1.getMemoryStorageItem)('POST_HOT_RELOAD_CLEAR') || {};
            // Delete all instant update changed elements
            (0, jquery_1.default)(`*[${identifierUtils_1.TEMPO_QUEUE_DELETE_AFTER_HOT_RELOAD}=true]`).remove();
            // Clear the added display nones
            (0, jquery_1.default)(`.${identifierUtils_1.TEMPO_DISPLAY_NONE_UNTIL_REFRESH_CLASS}`).removeClass(identifierUtils_1.TEMPO_DISPLAY_NONE_UNTIL_REFRESH_CLASS);
            (0, jquery_1.default)(`*[${identifierUtils_1.TEMPO_INSTANT_UPDATE}=true]`).removeAttr(identifierUtils_1.TEMPO_INSTANT_UPDATE);
            (0, jquery_1.default)(`*[${identifierUtils_1.TEMPO_DO_NOT_SHOW_IN_NAV_UNTIL_REFRESH}=true]`).removeAttr(identifierUtils_1.TEMPO_DO_NOT_SHOW_IN_NAV_UNTIL_REFRESH);
            (0, jquery_1.default)(`.${changeItemFunctions_1.TEMPORARY_STYLING_CLASS_NAME}`).removeClass(changeItemFunctions_1.TEMPORARY_STYLING_CLASS_NAME);
            // Any classes marked to delete before the hot reload
            classesToDelete === null || classesToDelete === void 0 ? void 0 : classesToDelete.forEach((cls) => {
                (0, jquery_1.default)(`.${cls}`).removeClass(cls);
            });
            const newAddClassQueue = (0, sessionStorageUtils_1.getMemoryStorageItem)(changeItemFunctions_1.ADD_CLASS_INSTANT_UPDATE_QUEUE) || [];
            // Any attributes that start with the styling prefix leftover mean that the class needs to be re-applied
            // these are classes that were added in instant updates while the hot reload was in progress
            newAddClassQueue.forEach((item) => {
                if (!item) {
                    return;
                }
                const { codebaseId, className } = item;
                if (codebaseId && className) {
                    (0, jquery_1.default)(`.${codebaseId}`).attr(identifierUtils_1.TEMPO_INSTANT_UPDATE, 'true');
                    (0, jquery_1.default)(`.${codebaseId}`).addClass(className);
                }
            });
        });
        // Rebuild the nav tree on DOM changed after some time has passed
        // this gives the react fiber time to be fully reconciled
        try {
            setTimeout(() => {
                globalUIUpdateRunner(() => {
                    buildAndSendNavTree(parentPort, storyboardId);
                    (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
                });
            }, 300);
        }
        catch (e) {
            console.error('ERROR: Could not re-create nav tree on DOM change, ' + e);
        }
    };
    const onDOMChanged = ({ mutations, parentPort, storyboardId, fromNextJsLoader, }) => {
        var _a;
        // Udpate the href in the parent container
        if ((0, sessionStorageUtils_1.getMemoryStorageItem)('href') !== window.location.href) {
            parentPort.postMessage({
                id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.LATEST_HREF,
                href: window.location.href,
            });
            (0, sessionStorageUtils_1.setMemoryStorageItem)('href', window.location.href);
        }
        // Check if we should refresh the nav tree
        let refreshNavTree = false;
        if (fromNextJsLoader) {
            // From the nextjs loader, refresh when the loader gets hidden (means refresh is done)
            const mutationTarget = (_a = mutations === null || mutations === void 0 ? void 0 : mutations[0]) === null || _a === void 0 ? void 0 : _a.target;
            if (mutationTarget && mutationTarget.id === 'container') {
                const currentlyHotReloading = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.HOT_RELOADING);
                if (mutationTarget.classList.contains('visible')) {
                    (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.HOT_RELOADING, true);
                }
                else {
                    (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.HOT_RELOADING, false);
                    refreshNavTree = true;
                }
            }
        }
        else {
            mutations.forEach((e) => {
                if (refreshNavTree) {
                    return;
                }
                // If the class attribute has changed on an element we have to reparse the nav tree to add the element key
                if (e.type === 'attributes' &&
                    e.attributeName === 'class' &&
                    e.target &&
                    !(0, outlineUtils_1.isNodeOutline)(e.target) &&
                    !(0, identifierUtils_1.isMovingElement)(e.target) &&
                    // And not a script
                    // Bug found on Oct 8, 2024, for some reason the script kept triggering a reload
                    !e.target.tagName.toLowerCase().includes('script')) {
                    const elementKey = (0, identifierUtils_1.getElementKeyFromNode)(e.target);
                    const uniqueLookup = (0, identifierUtils_1.getUniqueLookupFromNode)(e.target);
                    // An element which doesn't have an element key has changed
                    if (!elementKey && !uniqueLookup && !(0, identifierUtils_1.isElementInSvg)(e.target)) {
                        refreshNavTree = true;
                    }
                    return;
                }
                [e.addedNodes, e.removedNodes].forEach((nodeList) => {
                    if (refreshNavTree) {
                        return;
                    }
                    if (!nodeList) {
                        return;
                    }
                    nodeList.forEach((node) => {
                        if (!(0, outlineUtils_1.isNodeOutline)(node) && !(0, identifierUtils_1.isMovingElement)(node)) {
                            refreshNavTree = true;
                            return;
                        }
                    });
                });
            });
        }
        if (!refreshNavTree) {
            return;
        }
        // In these cases we don't want to trigger a nav tree refresh right away
        // since the hot reload may not have happened yet. So we set a timeout and only
        // trigger a nav tree refresh if another one hasn't happened in between
        if (fromNextJsLoader) {
            const triggerTime = new Date();
            setTimeout(() => {
                const lastRefreshTime = (0, sessionStorageUtils_1.getMemoryStorageItem)(LAST_NAV_TREE_REFRESH_TIME);
                // Don't re-clear and send if another refresh has happened in the meantime
                if (!lastRefreshTime || lastRefreshTime < triggerTime) {
                    clearInstantUpdatesAndSendNavTree(parentPort, storyboardId);
                }
            }, 1000);
            return;
        }
        clearInstantUpdatesAndSendNavTree(parentPort, storyboardId);
    };
    const onWheel = (e, parentPort, storyboardId) => {
        const passedThrough = passThroughEventsIfNeeded(e, parentPort, storyboardId);
        const isScrollShortcut = e.altKey;
        const isZoomShortcut = e.ctrlKey || e.metaKey;
        // If the user wants to scroll (either by being in drive mode, or by holding alt)
        // and they aren't trying to zoom, fallback to default behaviour.
        if (!isZoomShortcut && (passedThrough || isScrollShortcut)) {
            return;
        }
        e.preventDefault();
        e.stopPropagation();
        const importantFields = {
            deltaX: e.deltaX,
            deltaY: e.deltaY,
            wheelDelta: e.wheelDelta,
            x: e.x,
            y: e.y,
            altKey: e.altKey,
            ctrlKey: e.ctrlKey,
            shiftKey: e.shiftKey,
            metaKey: e.metaKey,
        };
        parentPort.postMessage({
            id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.WHEEL_EVENT,
            event: importantFields,
        });
    };
    const activeElementMetadata = () => {
        const activeElement = document.activeElement;
        let tagName, isContentEditable, elementType;
        if (activeElement) {
            tagName = activeElement.tagName;
            if (activeElement instanceof HTMLElement) {
                isContentEditable = activeElement.isContentEditable;
            }
            if (activeElement instanceof HTMLInputElement) {
                elementType = activeElement.type;
            }
        }
        return {
            tagName: tagName,
            isContentEditable: isContentEditable,
            elementType: elementType,
        };
    };
    const onKeyDown = (e, parentPort) => {
        parentPort.postMessage({
            id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.KEY_DOWN_EVENT,
            event: {
                key: e.key,
                metaKey: e.metaKey,
                shiftKey: e.shiftKey,
                ctrlKey: e.ctrlKey,
                activeElement: Object.assign({}, activeElementMetadata()),
            },
        });
    };
    const onKeyUp = (e, parentPort) => {
        parentPort.postMessage({
            id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.KEY_UP_EVENT,
            event: {
                key: e.key,
                metaKey: e.metaKey,
                shiftKey: e.shiftKey,
                ctrlKey: e.ctrlKey,
                activeElement: Object.assign({}, activeElementMetadata()),
            },
        });
    };
    const throttledUpdateOutlines = lodash_1.default.throttle((parentPort, storyboardId) => (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId), 15);
    const onScroll = (e, parentPort, storyboardId) => {
        throttledUpdateOutlines(parentPort, storyboardId);
    };
    // Need to register functions on the window for channel messaging to use them
    // @ts-ignore
    window.initProject = (parentPort, storyboardId, treeElementLookup, scopeLookup, storyboardComponentElement, options = {}, storyboardType, savedComponentFilename, originalStoryboardUrl) => {
        const passive = makePassiveEventOption();
        passive['capture'] = true;
        const body$ = (0, jquery_1.default)('body');
        (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.TREE_ELEMENT_LOOKUP, treeElementLookup);
        (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.SCOPE_LOOKUP, scopeLookup);
        if (storyboardComponentElement) {
            (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.STORYBOARD_COMPONENT, storyboardComponentElement);
        }
        (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.STORYBOARD_TYPE, storyboardType);
        (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.SAVED_STORYBOARD_COMPONENT_FILENAME, savedComponentFilename);
        // The URL that was originally loaded for this storyboard, it may be different from href
        // if the user navigated away to a new route
        if (originalStoryboardUrl) {
            (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.ORIGINAL_STORYBOARD_URL, originalStoryboardUrl);
        }
        // Clear iframe outlines
        (0, sessionStorageUtils_1.removeMemoryStorageItem)(sessionStorageUtils_1.SELECTED_ELEMENT_KEY);
        (0, sessionStorageUtils_1.removeMemoryStorageItem)(sessionStorageUtils_1.HOVERED_ELEMENT_KEY);
        (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
        // Register event listeners
        const bodyObject = body$.get(0);
        bodyObject === null || bodyObject === void 0 ? void 0 : bodyObject.addEventListener('click', (e) => {
            passThroughEventsIfNeeded(e, parentPort, storyboardId);
        }, passive);
        bodyObject === null || bodyObject === void 0 ? void 0 : bodyObject.addEventListener('pointerover', (e) => {
            onPointerOver(e, parentPort, storyboardId);
        }, passive);
        bodyObject === null || bodyObject === void 0 ? void 0 : bodyObject.addEventListener('pointerdown', (e) => {
            onPointerDown(e, parentPort, storyboardId);
        }, passive);
        bodyObject === null || bodyObject === void 0 ? void 0 : bodyObject.addEventListener('pointerup', (e) => {
            onPointerUp(e, parentPort, storyboardId);
        }, passive);
        bodyObject === null || bodyObject === void 0 ? void 0 : bodyObject.addEventListener('pointermove', (e) => {
            onPointerMove(e, parentPort, storyboardId);
        }, passive);
        bodyObject === null || bodyObject === void 0 ? void 0 : bodyObject.addEventListener('pointerleave', (e) => {
            passThroughEventsIfNeeded(e, parentPort, storyboardId);
        }, passive);
        bodyObject === null || bodyObject === void 0 ? void 0 : bodyObject.addEventListener('contextmenu', (e) => {
            onClickElementContextMenu(e, parentPort, storyboardId);
        }, passive);
        bodyObject === null || bodyObject === void 0 ? void 0 : bodyObject.addEventListener('dblclick', (e) => {
            passThroughEventsIfNeeded(e, parentPort, storyboardId);
        }, passive);
        bodyObject === null || bodyObject === void 0 ? void 0 : bodyObject.addEventListener('mouseover', (e) => {
            passThroughEventsIfNeeded(e, parentPort, storyboardId);
        }, passive);
        bodyObject === null || bodyObject === void 0 ? void 0 : bodyObject.addEventListener('mouseout', (e) => {
            passThroughEventsIfNeeded(e, parentPort, storyboardId);
        }, passive);
        bodyObject === null || bodyObject === void 0 ? void 0 : bodyObject.addEventListener('mousemove', (e) => {
            passThroughEventsIfNeeded(e, parentPort, storyboardId);
        }, passive);
        bodyObject === null || bodyObject === void 0 ? void 0 : bodyObject.addEventListener('mousedown', (e) => {
            passThroughEventsIfNeeded(e, parentPort, storyboardId);
        }, passive);
        bodyObject === null || bodyObject === void 0 ? void 0 : bodyObject.addEventListener('mouseup', (e) => {
            passThroughEventsIfNeeded(e, parentPort, storyboardId);
        }, passive);
        bodyObject === null || bodyObject === void 0 ? void 0 : bodyObject.addEventListener('wheel', (e) => {
            onWheel(e, parentPort, storyboardId);
        }, passive);
        bodyObject === null || bodyObject === void 0 ? void 0 : bodyObject.addEventListener('keydown', (e) => {
            onKeyDown(e, parentPort);
        }, passive);
        bodyObject === null || bodyObject === void 0 ? void 0 : bodyObject.addEventListener('keyup', (e) => {
            onKeyUp(e, parentPort);
        }, passive);
        window.addEventListener('scroll', (e) => {
            onScroll(e, parentPort, storyboardId);
        }, passive);
        // Hack: this is used to
        document.addEventListener('pointerlockchange', () => {
            if (document.pointerLockElement &&
                (0, sessionStorageUtils_1.getMemoryStorageItem)(IMMEDIATELY_REMOVE_POINTER_LOCK)) {
                document.exitPointerLock();
                (0, sessionStorageUtils_1.setMemoryStorageItem)(IMMEDIATELY_REMOVE_POINTER_LOCK, false);
            }
        }, false);
        const debounceExecutor = new DebounceExecutor_1.DebounceExecutor();
        const objsToObserve = [bodyObject];
        const nextBuildWatcher = document.getElementById('__next-build-watcher');
        if (nextBuildWatcher && nextBuildWatcher.shadowRoot) {
            // If this is NextJS, also listen to the shadow root of the __next-build-watcher
            // This triggeres the onDOMChanged when the hot reload symbol shows up
            objsToObserve.push(...Array.from(nextBuildWatcher.shadowRoot.children));
        }
        globalUIUpdateRunner = observeDOM(objsToObserve, (e) => {
            debounceExecutor.schedule(() => {
                onDOMChanged({
                    mutations: e,
                    parentPort,
                    storyboardId,
                });
            });
        });
        if (options.driveModeEnabled) {
            enableDriveMode(parentPort, storyboardId);
        }
        else {
            disableDriveMode(parentPort, storyboardId);
        }
        if (options.aiContextSelection) {
            (0, sessionStorageUtils_1.setMemoryStorageItem)('aiContext', true);
            (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
        }
        else {
            (0, sessionStorageUtils_1.setMemoryStorageItem)('aiContext', false);
            (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
        }
        // Build the Nav Tree and send it back
        try {
            globalUIUpdateRunner(() => {
                buildAndSendNavTree(parentPort, storyboardId, treeElementLookup, scopeLookup, storyboardComponentElement || 'EXPLICIT_NONE');
            });
        }
        catch (e) {
            console.log(e);
            console.error('Error building nav tree: ' + e);
        }
    };
    const enableDriveMode = (parentPort, storyboardId) => {
        // @ts-ignore
        if (!(0, sessionStorageUtils_1.getSessionStorageItem)('driveModeEnabled', storyboardId)) {
            // @ts-ignore
            (0, sessionStorageUtils_1.setSessionStorageItem)('driveModeEnabled', 'enabled', storyboardId);
            clearHoveredElements(parentPort, storyboardId);
            (0, outlineUtils_1.clearAllOutlines)();
        }
        (0, jquery_1.default)('body').css('cursor', '');
    };
    const disableDriveMode = (parentPort, storyboardId) => {
        // @ts-ignore
        if ((0, sessionStorageUtils_1.getSessionStorageItem)('driveModeEnabled', storyboardId)) {
            // @ts-ignore
            (0, sessionStorageUtils_1.removeSessionStorageItem)('driveModeEnabled', storyboardId);
            (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
            clearHoveredElements(parentPort, storyboardId);
        }
        (0, jquery_1.default)('body').attr('style', function (i, s) {
            return (s || '') + 'cursor: default !important;';
        });
    };
    // @ts-ignore
    window.enableDriveMode = (parentPort, storyboardId) => {
        enableDriveMode(parentPort, storyboardId);
    };
    // @ts-ignore
    window.disableDriveMode = (parentPort, storyboardId) => {
        disableDriveMode(parentPort, storyboardId);
    };
    // @ts-ignore
    window.setNewLookups = (parentPort, storyboardId, treeElementLookup, scopeLookup) => {
        const prevTreeElemntLookup = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.TREE_ELEMENT_LOOKUP) || {};
        const prevScopeLookup = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.SCOPE_LOOKUP) || {};
        const newTreeElements = Object.assign({}, prevTreeElemntLookup);
        // Delete any tree elements that were set to nul
        Object.keys(treeElementLookup).forEach((key) => {
            if (treeElementLookup[key]) {
                newTreeElements[key] = treeElementLookup[key];
            }
            else if (newTreeElements[key]) {
                delete newTreeElements[key];
            }
        });
        const newScopes = Object.assign({}, prevScopeLookup);
        // Delete any scopes that were set to nul
        Object.keys(scopeLookup).forEach((key) => {
            if (scopeLookup[key]) {
                newScopes[key] = scopeLookup[key];
            }
            else if (newScopes[key]) {
                delete newScopes[key];
            }
        });
        (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.TREE_ELEMENT_LOOKUP, newTreeElements);
        (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.SCOPE_LOOKUP, newScopes);
    };
    // @ts-ignore
    window.setHoveredElement = (parentPort, storyboardId, elementKey) => {
        const driveModeEnabled = !!(0, sessionStorageUtils_1.getSessionStorageItem)('driveModeEnabled', storyboardId);
        if (driveModeEnabled) {
            return;
        }
        const prevHoveredElementKey = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.HOVERED_ELEMENT_KEY);
        if (prevHoveredElementKey === elementKey) {
            return;
        }
        if (elementKey) {
            (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.HOVERED_ELEMENT_KEY, elementKey);
        }
        else {
            (0, sessionStorageUtils_1.removeMemoryStorageItem)(sessionStorageUtils_1.HOVERED_ELEMENT_KEY);
        }
        (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
    };
    // @ts-ignore
    window.setSelectedElement = (parentPort, storyboardId, elementKey) => {
        var _a, _b;
        const prevSelectedElementKey = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.SELECTED_ELEMENT_KEY);
        if (prevSelectedElementKey === elementKey) {
            return;
        }
        if (elementKey) {
            const tempoElement = tempoElement_1.TempoElement.fromKey(elementKey);
            let elementKeyToExtract = elementKey;
            if (tempoElement.isStoryboard(storyboardId)) {
                // Pass back the outerHTML of the top level node
                const topLevelNode = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.CURRENT_NAV_TREE);
                const topLevelElementKey = (_a = topLevelNode === null || topLevelNode === void 0 ? void 0 : topLevelNode.tempoElement) === null || _a === void 0 ? void 0 : _a.getKey();
                if (topLevelElementKey) {
                    elementKeyToExtract = topLevelElementKey;
                }
            }
            // Send back the message just to set the outerHTML only
            parentPort.postMessage({
                id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.SELECTED_ELEMENT_KEY,
                doNotSetElementKey: true,
                outerHTML: (_b = (0, jquery_1.default)(`.${identifierUtils_1.ELEMENT_KEY_PREFIX}${elementKeyToExtract}`).get(0)) === null || _b === void 0 ? void 0 : _b.outerHTML,
            });
            (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.SELECTED_ELEMENT_KEY, elementKey);
        }
        else {
            parentPort.postMessage({
                id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.SELECTED_ELEMENT_KEY,
                doNotSetElementKey: true,
                outerHTML: null,
            });
            (0, sessionStorageUtils_1.removeMemoryStorageItem)(sessionStorageUtils_1.SELECTED_ELEMENT_KEY);
        }
        (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
    };
    // @ts-ignore
    window.setMultiselectedElementKeys = (parentPort, storyboardId, elementKeys) => {
        const prevMultiSelectedElementKeys = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.MULTI_SELECTED_ELEMENT_KEYS);
        const prevSet = new Set(prevMultiSelectedElementKeys || []);
        const newSet = new Set(elementKeys || []);
        const setsEqual = prevSet.size === newSet.size &&
            [...prevSet].every((value) => newSet.has(value));
        if (setsEqual) {
            return;
        }
        if (elementKeys) {
            (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.MULTI_SELECTED_ELEMENT_KEYS, elementKeys);
            parentPort.postMessage({
                id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.MULTI_SELECTED_ELEMENT_KEYS,
                doNotSetElementKeys: true,
                outerHTMLs: elementKeys === null || elementKeys === void 0 ? void 0 : elementKeys.map((elementKey) => { var _a; return (_a = (0, jquery_1.default)(`.${identifierUtils_1.ELEMENT_KEY_PREFIX}${elementKey}`).get(0)) === null || _a === void 0 ? void 0 : _a.outerHTML; }),
            });
        }
        else {
            (0, sessionStorageUtils_1.removeMemoryStorageItem)(sessionStorageUtils_1.MULTI_SELECTED_ELEMENT_KEYS);
            parentPort.postMessage({
                id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.MULTI_SELECTED_ELEMENT_KEYS,
                doNotSetElementKeys: true,
                outerHTMLs: [],
            });
        }
        (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
    };
    // @ts-ignore
    window.processRulesForSelectedElement = (parentPort, storyboardId, cssElementLookup, selectedElementKey) => {
        (0, cssFunctions_1.processRulesForSelectedElement)(parentPort, cssElementLookup, selectedElementKey);
    };
    // @ts-ignore
    window.setModifiersForSelectedElement = (parentPort, storyboardId, modifiers, selectedElementKey) => {
        (0, cssFunctions_1.setModifiersForSelectedElement)(parentPort, modifiers, selectedElementKey);
    };
    // @ts-ignore
    window.getCssEvals = (parentPort, storyboardId, selectedElementKey) => {
        (0, cssFunctions_1.getCssEvals)(parentPort, selectedElementKey);
    };
    // @ts-ignore
    window.ruleMatchesElement = (parentPort, storyboardId, messageId, rule, selectedElementKey) => {
        (0, cssFunctions_1.ruleMatchesElement)(parentPort, messageId, rule, selectedElementKey);
    };
    // @ts-ignore
    window.getElementClassList = (parentPort, storyboardId, selectedElementKey) => {
        (0, cssFunctions_1.getElementClassList)(parentPort, selectedElementKey);
    };
    // @ts-ignore
    window.applyChangeItemToDocument = (parentPort, storyboardId, changeItem) => __awaiter(void 0, void 0, void 0, function* () {
        const { sendNewNavTree } = (0, changeItemFunctions_1.applyChangeItemToDocument)(parentPort, storyboardId, changeItem);
        // Update the nav tree & outlines
        if (sendNewNavTree) {
            buildAndSendNavTree(parentPort, storyboardId);
        }
        (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
    });
    // @ts-ignore
    window.updateCodebaseIds = (parentPort, storyboardId, prevIdToNewIdMap, newTreeElementLookup, newScopeLookup) => {
        const sendNewNavTree = (0, changeItemFunctions_1.updateCodebaseIds)(parentPort, prevIdToNewIdMap, true);
        if (sendNewNavTree) {
            buildAndSendNavTree(parentPort, storyboardId, newTreeElementLookup, newScopeLookup);
        }
        (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
    };
    // @ts-ignore
    window.dispatchEvent = (parentPort, storyboardId, eventName, eventDetails) => {
        const event = new CustomEvent(eventName, Object.assign({}, eventDetails));
        document.dispatchEvent(event);
    };
    // @ts-ignore
    window.updateOutlines = (parentPort, storyboardId) => {
        (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
    };
    // @ts-ignore
    window.goBack = (parentPort, storyboardId) => {
        if (document.referrer !== '') {
            window.history.back();
        }
    };
    // @ts-ignore
    window.goForward = (parentPort, storyboardId) => {
        window.history.forward();
    };
    // @ts-ignore
    window.refresh = (parentPort, storyboardId) => {
        window.location.reload();
    };
    // @ts-ignore
    window.syntheticMouseOver = (parentPort, storyboardId, coords, dontHoverInsideSelected, selectBottomMostElement) => {
        const target = document.elementFromPoint(coords.x, coords.y);
        // If this is true we don't want to trigger a hover event inside a selected element, instead just set hovering on the selected element
        if (dontHoverInsideSelected) {
            const selectedElementKey = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.SELECTED_ELEMENT_KEY);
            const selectedElement = tempoElement_1.TempoElement.fromKey(selectedElementKey);
            if (!selectedElement.isEmpty()) {
                const selectedDomElement = document.querySelector(`.${identifierUtils_1.ELEMENT_KEY_PREFIX}${selectedElementKey}`);
                if (selectedDomElement === null || selectedDomElement === void 0 ? void 0 : selectedDomElement.contains(target)) {
                    onPointerOver({ target: selectedDomElement }, parentPort, storyboardId);
                    return;
                }
            }
        }
        onPointerOver({ target }, parentPort, storyboardId, selectBottomMostElement);
    };
    // @ts-ignore
    window.syntheticMouseMove = (parentPort, storyboardId, syntheticEvent) => {
        const eventWithClient = Object.assign(Object.assign({}, syntheticEvent), { pageX: syntheticEvent.clientX +
                (document.documentElement.scrollLeft || document.body.scrollLeft), pageY: syntheticEvent.clientY +
                (document.documentElement.scrollTop || document.body.scrollTop) });
        onPointerMove(eventWithClient, parentPort, storyboardId);
    };
    // @ts-ignore
    window.syntheticMouseUp = (parentPort, storyboardId, syntheticEvent) => {
        onPointerUp(syntheticEvent, parentPort, storyboardId);
    };
    // @ts-ignore
    window.clearHoveredOutlines = (parentPort, storyboardId) => {
        if ((0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.HOVERED_ELEMENT_KEY)) {
            clearHoveredElements(parentPort, storyboardId);
        }
    };
    // @ts-ignore
    window.setZoomPerc = (parentPort, storyboardId, zoomPerc) => {
        (0, sessionStorageUtils_1.setMemoryStorageItem)('zoomPerc', zoomPerc.toString());
        (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
    };
    // @ts-ignore
    window.setAiContext = (parentPort, storyboardId, aiContext) => {
        (0, sessionStorageUtils_1.setMemoryStorageItem)('aiContext', !!aiContext);
        (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
    };
    // @ts-ignore
    window.tempMoveElement = (parentPort, storyboardId, nodeToMoveElementKey, newIndex) => {
        var _a, _b, _c, _d, _e;
        const elementKeyToNavNode = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.ELEMENT_KEY_TO_NAV_NODE) || {};
        const navNodeToMove = elementKeyToNavNode[nodeToMoveElementKey];
        if (!navNodeToMove) {
            return;
        }
        const nodeToMoveElement = tempoElement_1.TempoElement.fromKey(nodeToMoveElementKey);
        const domElementsToMove = [];
        // In components, there may be multiple elements that need to be moved, the eleemntKeyToLookupList
        // are all the real DOM elements in a component
        // For non-components, the eleemntKeyToLookupList points to a list of itself
        const elementKeyToLookupList = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.ELEMENT_KEY_TO_LOOKUP_LIST) || {};
        const lookupList = elementKeyToLookupList[navNodeToMove.tempoElement.getKey()] || [];
        lookupList.forEach((lookupElementKey) => {
            domElementsToMove.push((0, jquery_1.default)('body').find(`.${identifierUtils_1.ELEMENT_KEY_PREFIX}${lookupElementKey}`).get(0));
        });
        const parentDomElement = (_a = domElementsToMove[0]) === null || _a === void 0 ? void 0 : _a.parentElement;
        const parentNavNode = navNodeToMove.parent;
        if (parentDomElement && parentNavNode) {
            const currentIndex = (_b = parentNavNode === null || parentNavNode === void 0 ? void 0 : parentNavNode.children) === null || _b === void 0 ? void 0 : _b.indexOf(navNodeToMove);
            const numChildren = (_c = parentNavNode === null || parentNavNode === void 0 ? void 0 : parentNavNode.children) === null || _c === void 0 ? void 0 : _c.length;
            if (currentIndex !== newIndex) {
                Array.from(parentDomElement.children).forEach((child) => {
                    (0, jquery_1.default)(child).attr(identifierUtils_1.TEMPO_INSTANT_UPDATE, 'true');
                });
                (0, jquery_1.default)(parentDomElement).attr(identifierUtils_1.TEMPO_INSTANT_UPDATE, 'true');
                if (newIndex === numChildren - 1) {
                    domElementsToMove.forEach((element) => {
                        element.parentElement.appendChild(element);
                    });
                }
                else {
                    // If the current index is before the new index then we need to adjust by 1 to account for the shift in indices
                    const beforeNode = currentIndex > newIndex
                        ? parentNavNode === null || parentNavNode === void 0 ? void 0 : parentNavNode.children[newIndex]
                        : parentNavNode === null || parentNavNode === void 0 ? void 0 : parentNavNode.children[newIndex + 1];
                    const lookupListForBefore = elementKeyToLookupList[(_d = beforeNode === null || beforeNode === void 0 ? void 0 : beforeNode.tempoElement) === null || _d === void 0 ? void 0 : _d.getKey()] || [];
                    if (!lookupListForBefore.length) {
                        console.log('Cannot find element to insert before in lookup list');
                        return;
                    }
                    const beforeDomElement = (0, jquery_1.default)('body')
                        .find(`.${identifierUtils_1.ELEMENT_KEY_PREFIX}${lookupListForBefore[0]}`)
                        .get(0);
                    if (!beforeDomElement) {
                        console.log('Cannot find element to insert before');
                        return;
                    }
                    domElementsToMove.forEach((element) => {
                        element.parentElement.insertBefore(element, beforeDomElement);
                    });
                }
                // Update the selected element key to the new expected one (note if moving there is no hovered element key)
                // This also assumes the nodeToMoveElementKey is the selected element key
                const elementToMoveSegments = nodeToMoveElement.uniquePath.split('-');
                const newSelectedUniquePath = elementToMoveSegments
                    .slice(0, elementToMoveSegments.length - 1)
                    .join('-') + `-${newIndex}`;
                const newSelectedElementKey = new tempoElement_1.TempoElement(nodeToMoveElement.codebaseId, nodeToMoveElement.storyboardId, newSelectedUniquePath).getKey();
                // Update the nav tree which also sets the element key on all the elements, need to do this before
                // updating the selected element key
                buildAndSendNavTree(parentPort, storyboardId);
                // Codebase ID doesn't change
                parentPort.postMessage({
                    id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.SELECTED_ELEMENT_KEY,
                    elementKey: newSelectedElementKey,
                    outerHTML: (_e = (0, jquery_1.default)(`.${identifierUtils_1.ELEMENT_KEY_PREFIX}${newSelectedElementKey}`).get(0)) === null || _e === void 0 ? void 0 : _e.outerHTML,
                });
                (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.SELECTED_ELEMENT_KEY, newSelectedElementKey);
                (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
            }
        }
    };
    // @ts-ignore
    window.tempAddDiv = (parentPort, storyboardId, parentCodebaseId, indexInParent, width, height) => {
        const element = (0, jquery_1.default)(`.${identifierUtils_1.TEMPO_INSTANT_DIV_DRAW_CLASS}`);
        if (element.length) {
            element.css('width', width);
            element.css('height', height);
        }
        else {
            let parent = (0, jquery_1.default)(`.${parentCodebaseId}`);
            if (!parent.length) {
                parent = (0, jquery_1.default)('body');
            }
            parent.each((index, item) => {
                const newElement = (0, jquery_1.default)(`<div class="${identifierUtils_1.TEMPO_INSTANT_DIV_DRAW_CLASS}" ${identifierUtils_1.TEMPO_DELETE_AFTER_INSTANT_UPDATE}="true" ${identifierUtils_1.TEMPO_DELETE_AFTER_REFRESH}="true" ${identifierUtils_1.TEMPO_INSTANT_UPDATE}="true"></div>`);
                const childAtIndex = (0, jquery_1.default)(item).children().eq(indexInParent);
                if (childAtIndex === null || childAtIndex === void 0 ? void 0 : childAtIndex.length) {
                    childAtIndex.before(newElement);
                }
                else {
                    (0, jquery_1.default)(item).append(newElement);
                }
            });
            // Update the nav tree
            buildAndSendNavTree(parentPort, storyboardId);
        }
        (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
    };
    // @ts-ignore
    window.tempMoveToNewParent = (parentPort, storyboardId, indicatorWidth, indicatorHeight, newPositionX, newPositionY, parentElementKey, clear) => {
        (0, jquery_1.default)(`.${identifierUtils_1.TEMPO_MOVE_BETWEEN_PARENTS_OUTLINE}`).remove();
        if (clear) {
            return;
        }
        const newElement = document.createElement('div');
        newElement.classList.add(identifierUtils_1.TEMPO_MOVE_BETWEEN_PARENTS_OUTLINE);
        newElement.setAttribute(identifierUtils_1.TEMPO_INSTANT_UPDATE, 'true'); // Add so it doesn't trigger new nav tree building
        newElement.style.width = indicatorWidth + 'px';
        newElement.style.height = indicatorHeight + 'px';
        newElement.style.left = newPositionX + 'px';
        newElement.style.top = newPositionY + 'px';
        newElement.style.position = 'fixed';
        newElement.style.pointerEvents = 'none';
        newElement.style.zIndex = '2000000004';
        newElement.style.boxSizing = 'border-box';
        newElement.style.cursor = 'default !important';
        newElement.style.backgroundColor = outlineUtils_1.PRIMARY_OUTLINE_COLOUR;
        const body = document.getElementsByTagName('body')[0];
        body.appendChild(newElement);
        const parentDomElement = (0, jquery_1.default)(`.${identifierUtils_1.ELEMENT_KEY_PREFIX}${parentElementKey}`).get(0);
        if (parentDomElement) {
            const boundingRect = parentDomElement.getBoundingClientRect();
            const parentOutline = (0, outlineUtils_1.getOutlineElement)(parentPort, outlineUtils_1.OutlineType.PRIMARY, boundingRect.left, boundingRect.top, boundingRect.width, boundingRect.height);
            parentOutline.classList.remove(identifierUtils_1.OUTLINE_CLASS);
            parentOutline.classList.add(identifierUtils_1.TEMPO_MOVE_BETWEEN_PARENTS_OUTLINE);
            parentOutline.setAttribute(identifierUtils_1.TEMPO_INSTANT_UPDATE, 'true'); // Add so it doesn't trigger new nav tree building
            body.appendChild(parentOutline);
        }
    };
    // @ts-ignore
    window.checkIfHydrationError = (parentPort, storyboardId) => {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q;
        let errorDescr, errorLabel, errorBody, hasError;
        if (window.location.href.includes('framework=VITE')) {
            // @ts-ignore
            const errorPortal = (_a = document.getElementsByTagName('vite-error-overlay')[0]) === null || _a === void 0 ? void 0 : _a.shadowRoot;
            errorDescr = 'A Vite Error Occurred';
            errorLabel =
                (_d = (_c = (_b = errorPortal === null || errorPortal === void 0 ? void 0 : errorPortal.querySelectorAll) === null || _b === void 0 ? void 0 : _b.call(errorPortal, '.file-link')) === null || _c === void 0 ? void 0 : _c[0]) === null || _d === void 0 ? void 0 : _d.innerHTML;
            errorBody = (_g = (_f = (_e = errorPortal === null || errorPortal === void 0 ? void 0 : errorPortal.querySelectorAll) === null || _e === void 0 ? void 0 : _e.call(errorPortal, '.message')) === null || _f === void 0 ? void 0 : _f[0]) === null || _g === void 0 ? void 0 : _g.innerHTML;
            hasError = Boolean(errorLabel || errorBody);
        }
        else {
            // @ts-ignore
            const errorPortal = (_h = document.getElementsByTagName('nextjs-portal')[0]) === null || _h === void 0 ? void 0 : _h.shadowRoot;
            errorDescr = (_k = (_j = errorPortal === null || errorPortal === void 0 ? void 0 : errorPortal.getElementById) === null || _j === void 0 ? void 0 : _j.call(errorPortal, 'nextjs__container_errors_desc')) === null || _k === void 0 ? void 0 : _k.innerHTML;
            errorLabel = (_m = (_l = errorPortal === null || errorPortal === void 0 ? void 0 : errorPortal.getElementById) === null || _l === void 0 ? void 0 : _l.call(errorPortal, 'nextjs__container_errors_label')) === null || _m === void 0 ? void 0 : _m.innerHTML;
            errorBody = (_q = (_p = (_o = errorPortal === null || errorPortal === void 0 ? void 0 : errorPortal.querySelectorAll) === null || _o === void 0 ? void 0 : _o.call(errorPortal, '.nextjs-container-errors-body')) === null || _p === void 0 ? void 0 : _p[0]) === null || _q === void 0 ? void 0 : _q.innerHTML;
            hasError = Boolean(errorDescr);
        }
        // Check if the contents of the hydration container contain the text "Hydration failed"
        if (hasError) {
            if (errorDescr === null || errorDescr === void 0 ? void 0 : errorDescr.includes('Hydration failed')) {
                parentPort.postMessage({
                    id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.LATEST_HYDRATION_ERROR_STATUS,
                    status: constantsAndTypes_1.STORYBOARD_HYDRATION_STATUS.ERROR,
                    errorDescr,
                    errorLabel,
                    errorBody,
                });
            }
            else {
                parentPort.postMessage({
                    id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.LATEST_HYDRATION_ERROR_STATUS,
                    status: constantsAndTypes_1.STORYBOARD_HYDRATION_STATUS.OTHER_ERROR,
                    errorDescr,
                    errorLabel,
                    errorBody,
                });
            }
        }
        else {
            parentPort.postMessage({
                id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.LATEST_HYDRATION_ERROR_STATUS,
                status: constantsAndTypes_1.STORYBOARD_HYDRATION_STATUS.NO_ERROR,
            });
        }
    };
    // @ts-ignore
    window.triggerDragStart = (parentPort, storyboardId) => {
        const selectedElementKey = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.SELECTED_ELEMENT_KEY);
        const elementKeyToNavNode = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.ELEMENT_KEY_TO_NAV_NODE) || {};
        // Something has to be selected to trigger a drag start
        if (!selectedElementKey) {
            return;
        }
        const draggedNavNode = elementKeyToNavNode[selectedElementKey];
        const parentDomElement = getParentDomElementForNavNode(draggedNavNode);
        const selectedElement = (0, jquery_1.default)(`.${identifierUtils_1.ELEMENT_KEY_PREFIX}${selectedElementKey}`).get(0);
        const mouseDragContext = {
            // Start off screen, this will get updated by onMouseMove
            pageX: -10000,
            pageY: -10000,
            // The difference between where the user clicked and the center of the element
            offsetX: 0,
            offsetY: 0,
            dragging: true,
            selectedParentDisplay: (0, cssFunctions_1.cssEval)(parentDomElement, 'display'),
            selectedParentFlexDirection: (0, cssFunctions_1.cssEval)(parentDomElement, 'flex-direction'),
        };
        (0, sessionStorageUtils_1.setMemoryStorageItem)('mouseDragContext', mouseDragContext);
        // Trigger the drag start event
        parentPort.postMessage({
            id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.DRAG_START_EVENT,
            event: mouseDragContext,
            outerHTML: selectedElement === null || selectedElement === void 0 ? void 0 : selectedElement.outerHTML,
        });
        (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
    };
    // @ts-ignore
    window.triggerDragCancel = (parentPort, storyboardId) => {
        (0, sessionStorageUtils_1.setMemoryStorageItem)('mouseDragContext', null);
        parentPort.postMessage({
            id: constantsAndTypes_1.FIXED_IFRAME_MESSAGE_IDS.DRAG_CANCEL_EVENT,
            event: {},
        });
        (0, outlineUtils_1.updateOutlines)(parentPort, storyboardId);
    };
    // @ts-ignore
    window.setIsFlushing = (parentPort, storyboardId, isFlushing) => {
        const wasFlushing = (0, sessionStorageUtils_1.getMemoryStorageItem)(sessionStorageUtils_1.IS_FLUSHING);
        (0, sessionStorageUtils_1.setMemoryStorageItem)(sessionStorageUtils_1.IS_FLUSHING, isFlushing);
        if (isFlushing && !wasFlushing) {
            onFlushStart();
        }
    };
};
exports.initChannelMessagingFunctions = initChannelMessagingFunctions;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhbm5lbE1lc3NhZ2luZ0Z1bmN0aW9ucy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jaGFubmVsTWVzc2FnaW5nL2NoYW5uZWxNZXNzYWdpbmdGdW5jdGlvbnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsdURBa0IyQjtBQUMzQiwrREFxQitCO0FBQy9CLGlEQUt3QjtBQUV4QixhQUFhO0FBQ2Isb0RBQXVCO0FBQ3ZCLG9EQUF1QjtBQUN2QixpREFPd0I7QUFDeEIsaURBT3dCO0FBQ3hCLDJEQUk2QjtBQUM3QiwrREFNK0I7QUFDL0IsMkNBS3FCO0FBQ3JCLGlEQUE4QztBQUs5QyxtREFNeUI7QUFDekIsZ0VBQTZEO0FBQzdELHlDQUFtRTtBQUNuRSxNQUFNLDBCQUEwQixHQUFHLEVBQUUsQ0FBQztBQUV0QyxNQUFNLCtCQUErQixHQUFHLGlDQUFpQyxDQUFDO0FBRTFFLE1BQU0sMEJBQTBCLEdBQUcsNEJBQTRCLENBQUM7QUFFaEUseURBQXlEO0FBRWxELE1BQU0sNkJBQTZCLEdBQUcsR0FBRyxFQUFFO0lBQ2hELElBQUEsb0VBQThDLEdBQUUsQ0FBQztJQUVqRCw4R0FBOEc7SUFDOUcsSUFBSSxvQkFBb0IsR0FBRyxnQ0FBcUIsQ0FBQztJQUVqRCxhQUFhO0lBQ2IsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEdBQUc7UUFDMUIsSUFBSSxJQUFJLEdBQUcsQ0FBQyxFQUNWLENBQUMsRUFDRCxHQUFHLENBQUM7UUFDTixJQUFJLElBQUksQ0FBQyxNQUFNLEtBQUssQ0FBQztZQUFFLE9BQU8sSUFBSSxDQUFDO1FBQ25DLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUNoQyxHQUFHLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN6QixJQUFJLEdBQUcsQ0FBQyxJQUFJLElB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LFVBQVUsQ0FBRSxnQkFBZ0IsQ0FDMUIsVUFBVSxFQUNWLENBQUMsQ0FBTSxFQUFFLEVBQUU7WUFDVCx5QkFBeUIsQ0FBQyxDQUFDLEVBQUUsVUFBVSxFQUFFLFlBQVksQ0FBQyxDQUFDO1FBQ3pELENBQUMsRUFDRCxPQUFPLENBQ1IsQ0FBQztRQUVGLFVBQVUsYUFBVixVQUFVLHVCQUFWLFVBQVUsQ0FBRSxnQkFBZ0IsQ0FDMUIsV0FBVyxFQUNYLENBQUMsQ0FBTSxFQUFFLEVBQUU7WUFDVCx5QkFBeUIsQ0FBQyxDQUFDLEVBQUUsVUFBVSxFQUFFLFlBQVksQ0FBQyxDQUFDO1FBQ3pELENBQUMsRUFDRCxPQUFPLENBQ1IsQ0FBQztRQUNGLFVBQVUsYUFBVixVQUFVLHVCQUFWLFVBQVUsQ0FBRSxnQkFBZ0IsQ0FDMUIsVUFBVSxFQUNWLENBQUMsQ0FBTSxFQUFFLEVBQUU7WUFDVCx5QkFBeUIsQ0FBQyxDQUFDLEVBQUUsVUFBVSxFQUFFLFlBQVksQ0FBQyxDQUFDO1FBQ3pELENBQUMsRUFDRCxPQUFPLENBQ1IsQ0FBQztRQUNGLFVBQVUsYUFBVixVQUFVLHVCQUFWLFVBQVUsQ0FBRSxnQkFBZ0IsQ0FDMUIsV0FBVyxFQUNYLENBQUMsQ0FBTSxFQUFFLEVBQUU7WUFDVCx5QkFBeUIsQ0FBQyxDQUFDLEVBQUUsVUFBVSxFQUFFLFlBQVksQ0FBQyxDQUFDO1FBQ3pELENBQUMsRUFDRCxPQUFPLENBQ1IsQ0FBQztRQUNGLFVBQVUsYUFBVixVQUFVLHVCQUFWLFVBQVUsQ0FBRSxnQkFBZ0IsQ0FDMUIsV0FBVyxFQUNYLENBQUMsQ0FBTSxFQUFFLEVBQUU7WUFDVCx5QkFBeUIsQ0FBQyxDQUFDLEVBQUUsVUFBVSxFQUFFLFlBQVksQ0FBQyxDQUFDO1FBQ3pELENBQUMsRUFDRCxPQUFPLENBQ1IsQ0FBQztRQUNGLFVBQVUsYUFBVixVQUFVLHVCQUFWLFVBQVUsQ0FBRSxnQkFBZ0IsQ0FDMUIsU0FBUyxFQUNULENBQUMsQ0FBTSxFQUFFLEVBQUU7WUFDVCx5QkFBeUIsQ0FBQyxDQUFDLEVBQUUsVUFBVSxFQUFF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Iiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgZ2V0VW5pcXVlTG9va3VwRnJvbU5vZGUsXG4gIGlzTW92aW5nRWxlbWVudCxcbiAgVEVNUE9fREVMRVRFX0FGVEVSX1JFRlJFU0gsXG4gIFRFTVBPX0lOU1RBTlRfVVBEQVRFLFxuICBURU1QT19JTlNUQU5UX0RJVl9EUkFXX0NMQVNTLFxuICBURU1QT19NT1ZFX0JFVFdFRU5fUEFSRU5UU19PVVRMSU5FLFxuICBPVVRMSU5FX0NMQVNTLFxuICBURU1QT19ESVNQTEFZX05PTkVfVU5USUxfUkVGUkVTSF9DTEFTUyxcbiAgZ2V0RWxlbWVudEtleUZyb21Ob2RlLFxuICBFTEVNRU5UX0tFWV9QUkVGSVgsXG4gIFRFTVBPX0RPX05PVF9TSE9XX0lOX05BVl9VTlRJTF9SRUZSRVNILFxuICBURU1QT19JTlNUQU5UX1VQREFURV9TVFlMSU5HX1BSRUZJWCxcbiAgRURJVF9URVhUX0JVVFRPTixcbiAgaGFzQ2xhc3MsXG4gIFRFTVBPX1FVRVVFX0RFTEVURV9BRlRFUl9IT1RfUkVMT0FELFxuICBURU1QT19ERUxFVEVfQUZURVJfSU5TVEFOVF9VUERBVEUsXG4gIGlzRWxlbWVudEluU3ZnLFxufSBmcm9tICcuL2lkZW50aWZpZXJVdGlscyc7XG5pbXBvcnQge1xuICBDVVJSRU5UX05BVl9UUkVFLFxuICBIT1ZFUkVEX0VMRU1FTlRfS0VZLFxuICBTQVZFRF9TVE9SWUJPQVJEX0NPTVBPTkVOVF9GSUxFTkFNRSxcbiAgU0NPUEVfTE9PS1VQLFxuICBTRUxFQ1RFRF9FTEVNRU5UX0tFWSxcbiAgU1RPUllCT0FSRF9DT01QT05FTlQsXG4gIFNUT1JZQk9BUkRfVFlQRSxcbiAgVFJFRV9FTEVNRU5UX0xPT0tVUCxcbiAgRUxFTUVOVF9LRVlfVE9fTE9PS1VQX0xJU1QsXG4gIEVMRU1FTlRfS0VZX1RPX05BVl9OT0RFLFxuICBnZXRNZW1vcnlTdG9yYWdlSXRlbSxcbiAgZ2V0U2Vzc2lvblN0b3JhZ2VJdGVtLFxuICByZW1vdmVNZW1vcnlTdG9yYWdlSXRlbSxcbiAgcmVtb3ZlU2Vzc2lvblN0b3JhZ2VJdGVtLFxuICBzZXRNZW1vcnlTdG9yYWdlSXRlbSxcbiAgc2V0U2Vzc2lvblN0b3JhZ2VJdGVtLFxuICBNVUxUSV9TRUxFQ1RFRF9FTEVNRU5UX0tFWVMsXG4gIEhPVF9SRUxPQURJTkcsXG4gIElTX0ZMVVNISU5HLFxuICBPUklHSU5BTF9TVE9SWUJPQVJEX1VSTCxcbn0gZnJvbSAnLi9zZXNzaW9uU3RvcmFnZVV0aWxzJztcbmltcG9ydCB7XG4gIE5hdlRyZWVOb2RlLFxuICBTS0lQX1JPT1RfQ09ERUJBU0VfSUQsXG4gIGJ1aWxkTmF2Rm9yTm9kZSxcbiAgcnVuTmF2VHJlZUJ1aWx0Q2FsbGJhY2tzLFxufSBmcm9tICcuL25hdlRyZWVVdGlscyc7XG5cbi8vIEB0cy1pZ25vcmVcbmltcG9ydCAkIGZyb20gJ2pxdWVyeSc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHtcbiAgT3V0bGluZVR5cGUsXG4gIFBSSU1BUllfT1VUTElORV9DT0xPVVIsXG4gIGNsZWFyQWxsT3V0bGluZXMsXG4gIGdldE91dGxpbmVFbGVtZW50LFxuICBpc05vZGVPdXRsaW5lLFxuICB1cGRhdGVPdXRsaW5lcyxcbn0gZnJvbSAnLi9vdXRsaW5lVXRpbHMnO1xuaW1wb3J0IHtcbiAgY3NzRXZhbCxcbiAgZ2V0Q3NzRXZhbHMsXG4gIGdldEVsZW1lbnRDbGFzc0xpc3QsXG4gIHByb2Nlc3NSdWxlc0ZvclNlbGVjdGVkRWxlbWVudCxcbiAgcnVsZU1hdGNoZXNFbGVtZW50LFxuICBzZXRNb2RpZmllcnNGb3JTZWxlY3RlZEVsZW1lbnQsXG59IGZyb20gJy4vY3NzRnVuY3Rpb25zJztcbmltcG9ydCB7XG4gIEZJWEVEX0lGUkFNRV9NRVNTQUdFX0lEUyxcbiAgU0VMRUNUX09SX0hPVkVSX1NUT1JZQk9BUkQsXG4gIFNUT1JZQk9BUkRfSFlEUkFUSU9OX1NUQVRVUyxcbn0gZnJvbSAnLi9jb25zdGFudHNBbmRUeXBlcyc7XG5pbXBvcnQge1xuICBBRERfQ0xBU1NfSU5TVEFOVF9VUERBVEVfUVVFVUUsXG4gIFRFTVBPUkFSWV9TVFlMSU5HX0NMQVNTX05BTUUsXG4gIGFwcGx5Q2hhbmdlSXRlbVRvRG9jdW1lbnQsXG4gIHJlc2V0SW50ZXJtZWRpYXRlQ2xhc3Nlc0ZvclNsaWRlckluc3RhbnRVcGRhdGUsXG4gIHVwZGF0ZUNvZGViYXNlSWRzLFxufSBmcm9tICcuL2NoYW5nZUl0ZW1GdW5jdGlvbnMnO1xuaW1wb3J0IHtcbiAgYnVpbGROb2RlVHJlZSxcbiAgYnVpbGRUcmVlTG9va3VwTWFwLFxuICBjbGVhckxvb2t1cHNGcm9tVHJlZSxcbiAgZ2V0Um9vdFJlYWN0RWxlbWVudCxcbn0gZnJvbSAnLi9yZXNxVXRpbHMnO1xuaW1wb3J0IHsgVGVtcG9FbGVtZW50IH0gZnJvbSAnLi90ZW1wb0VsZW1lbnQnO1xuaW1wb3J0IHtcbiAgQW55Q2hhbmdlTGVkZ2VySXRlbSxcbiAgcmVjb25zdHJ1Y3RDaGFuZ2VMZWRnZXJDbGFzcyxcbn0gZnJvbSAnLi9jaGFuZ2VMZWRnZXJUeXBlcyc7XG5pbXBvcnQge1xuICBjYW5FZGl0VGV4dCxcbiAgY3VycmVudGx5RWRpdGluZyxcbiAgZ2V0RWRpdGluZ0luZm8sXG4gIHNldHVwRWRpdGFibGVUZXh0LFxuICB0ZWFyZG93bkVkaXRhYmxlVGV4dCxcbn0gZnJvbSAnLi9lZGl0VGV4dFV0aWxzJztcbmltcG9ydCB7IERlYm91bmNlRXhlY3V0b3IgfSBmcm9tICcuLi91dGlscy9EZWJvdW5jZUV4ZWN1dG9yJztcbmltcG9ydCB7IGRlZmF1bHRVSVVwZGF0ZVJ1bm5lciwgVUlVcGRhdGVSdW5uZXIgfSBmcm9tICcuL2RvbVV0aWxzJztcbmNvbnN0IFBJWEVMU19UT19NT1ZFX0JFRk9SRV9EUkFHID0gMjA7XG5cbmNvbnN0IElNTUVESUFURUxZX1JFTU9WRV9QT0lOVEVSX0xPQ0sgPSAnSU1NRURJQVRFTFlfUkVNT1ZFX1BPSU5URVJfTE9DSyc7XG5cbmNvbnN0IExBU1RfTkFWX1RSRUVfUkVGUkVTSF9USU1FID0gJ0xBU1RfTkFWX1RSRUVfUkVGUkVTSF9USU1FJztcblxuLy8gVE9ETzogQ2hhbmdlIGFsbCBvZiB0aGlzIHRvIGJlIGEgcmVhY3Qgd3JhcHBlciBsaWJyYXJ5XG5cbmV4cG9ydCBjb25zdCBpbml0Q2hhbm5lbE1lc3NhZ2luZ0Z1bmN0aW9ucyA9ICgpID0+IHtcbiAgcmVzZXRJbnRlcm1lZGlhdGVDbGFzc2VzRm9yU2xpZGVySW5zdGFudFVwZGF0ZSgpO1xuXG4gIC8vIEFsbCBwcm9jZXNzZXMgdGhhdCBpbnZvbHZlcyB1cGRhdGluZyB0aGUgVUkgc2hvdWxkIHVzZSB0aGlzIHJ1bm5lciB0byBhdm9pZCB0cmlnZ2VyaW5nIGEgY2FzY2FkZSBvZiB1cGRhdGVzXG4gIGxldCBnbG9iYWxVSVVwZGF0ZVJ1bm5lciA9IGRlZmF1bHRVSVVwZGF0ZVJ1bm5lcjtcblxuICAvLyBAdHMtaWdub3JlXG4gIFN0cmluZy5wcm90b3R5cGUuaGFzaENvZGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGhhc2ggPSAwLFxuICAgICAgaSxcbiAgICAgIGNocjtcbiAgICBpZiAodGhpcy5sZW5ndGggPT09IDApIHJldHVybiBoYXNoO1xuICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjaHIgPSB0aGlzLmNoYXJDb2RlQXQoaSk7XG4gICAgICBoYXNoID0gKGhhc2ggPDwgNSkgLSBoYXNoICsgY2hyO1xuICAgICAgaGFzaCB8PSAwOyAvLyBDb252ZXJ0IHRvIDMyYml0IGludGVnZXJcbiAgICB9XG4gICAgcmV0dXJuIGhhc2g7XG4gIH07XG5cbiAgLy8gV2Ugd2FudCB0byBtYWtlIGV2ZW50IGxpc3RlbmVycyBub24tcGFzc2l2ZSwgYW5kIHRvIGRvIHNvIGhhdmUgdG8gY2hlY2tcbiAgLy8gdGhhdCBicm93c2VycyBzdXBwb3J0IEV2ZW50TGlzdGVuZXJPcHRpb25zIGluIHRoZSBmaXJzdCBwbGFjZS5cbiAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0V2ZW50VGFyZ2V0L2FkZEV2ZW50TGlzdGVuZXIjU2FmZWx5X2RldGVjdGluZ19vcHRpb25fc3VwcG9ydFxuICBsZXQgcGFzc2l2ZVN1cHBvcnRlZCA9IGZhbHNlO1xuXG4gIGNvbnN0IG1ha2VQYXNzaXZlRXZlbnRPcHRpb24gPSAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgIGdldCBwYXNzaXZlKCkge1xuICAgICAgICAgIC8vIFRoaXMgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgd2hlbiB0aGUgYnJvd3NlclxuICAgICAgICAgIC8vICAgYXR0ZW1wdHMgdG8gYWNjZXNzIHRoZSBwYXNzaXZlIHByb3BlcnR5LlxuICAgICAgICAgIHBhc3NpdmVTdXBwb3J0ZWQgPSB0cnVlO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBvcHRpb25zO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgcGFzc2l2ZVN1cHBvcnRlZCA9IGZhbHNlO1xuICAgICAgcmV0dXJuIHBhc3NpdmVTdXBwb3J0ZWQ7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBUYWtlbiBmcm9tOiBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8zMjE5NzU4L2RldGVjdC1jaGFuZ2VzLWluLXRoZS1kb21cbiAgICpcbiAgICogUmV0dXJucyB0aGUgZnVuY3Rpb24gdG8gZGlzY29ubmVjdCB0aGUgb2JzZXJ2ZXJcbiAgICovXG4gIGNvbnN0IG9ic2VydmVET00gPSAoZnVuY3Rpb24gKCkge1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICB2YXIgTXV0YXRpb25PYnNlcnZlciA9XG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICB3aW5kb3cuTXV0YXRpb25PYnNlcnZlciB8fCB3aW5kb3cuV2ViS2l0TXV0YXRpb25PYnNlcnZlcjtcblxuICAgIHJldHVybiBmdW5jdGlvbiAob2JqczogSFRNTEVsZW1lbnRbXSwgY2FsbGJhY2s6IChtdXRhdGlvbnM6IGFueSkgPT4gdm9pZCkge1xuICAgICAgY29uc3QgZmlsdGVyZWRPYmpzID0gb2Jqcy5maWx0ZXIoKG9iaikgPT4gb2JqICYmIG9iai5ub2RlVHlwZSA9PT0gMSk7XG5cbiAgICAgIGlmIChmaWx0ZXJlZE9ianMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBkZWZhdWx0VUlVcGRhdGVSdW5uZXI7XG4gICAgICB9XG5cbiAgICAgIHZhciBtdXRhdGlvbk9ic2VydmVyOiBNdXRhdGlvbk9ic2VydmVyO1xuXG4gICAgICBjb25zdCB1aVVwZGF0ZVJ1bm5lciA9IChpbm5lclNjb3BlOiAoKSA9PiB2b2lkKSA9PiB7XG4gICAgICAgIC8vIFBhdXNlIHRoZSBvYnNlcnZlclxuICAgICAgICBpZiAobXV0YXRpb25PYnNlcnZlcikge1xuICAgICAgICAgIG11dGF0aW9uT2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaW5uZXJTY29wZSgpO1xuXG4gICAgICAgIC8vIFJlc3VtZSB0aGUgb2JzZXJ2ZXJcbiAgICAgICAgaWYgKG11dGF0aW9uT2JzZXJ2ZXIpIHtcbiAgICAgICAgICBmaWx0ZXJlZE9ianMuZm9yRWFjaCgob2JqKSA9PiB7XG4gICAgICAgICAgICBtdXRhdGlvbk9ic2VydmVyLm9ic2VydmUob2JqLCB7XG4gICAgICAgICAgICAgIGNoaWxkTGlzdDogdHJ1ZSxcbiAgICAgICAgICAgICAgc3VidHJlZTogdHJ1ZSxcbiAgICAgICAgICAgICAgYXR0cmlidXRlczogdHJ1ZSxcbiAgICAgICAgICAgICAgYXR0cmlidXRlT2xkVmFsdWU6IHRydWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgaWYgKE11dGF0aW9uT2JzZXJ2ZXIpIHtcbiAgICAgICAgbXV0YXRpb25PYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGNhbGxiYWNrKTtcblxuICAgICAgICBmaWx0ZXJlZE9ianMuZm9yRWFjaCgob2JqKSA9PiB7XG4gICAgICAgICAgLy8gaGF2ZSB0aGUgb2JzZXJ2ZXIgb2JzZXJ2ZSBmb28gZm9yIGNoYW5nZXMgaW4gY2hpbGRyZW5cbiAgICAgICAgICBtdXRhdGlvbk9ic2VydmVyLm9ic2VydmUob2JqLCB7XG4gICAgICAgICAgICBjaGlsZExpc3Q6IHRydWUsXG4gICAgICAgICAgICBzdWJ0cmVlOiB0cnVlLFxuICAgICAgICAgICAgYXR0cmlidXRlczogdHJ1ZSxcbiAgICAgICAgICAgIGF0dHJpYnV0ZU9sZFZhbHVlOiB0cnVlLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gYnJvd3NlciBzdXBwb3J0IGZhbGxiYWNrXG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICBlbHNlIGlmICh3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcikge1xuICAgICAgICBmaWx0ZXJlZE9ianMuZm9yRWFjaCgob2JqKSA9PiB7XG4gICAgICAgICAgb2JqLmFkZEV2ZW50TGlzdGVuZXIoJ0RPTU5vZGVJbnNlcnRlZCcsIGNhbGxiYWNrLCBmYWxzZSk7XG4gICAgICAgICAgb2JqLmFkZEV2ZW50TGlzdGVuZXIoJ0RPTU5vZGVSZW1vdmVkJywgY2FsbGJhY2ssIGZhbHNlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB1aVVwZGF0ZVJ1bm5lcjtcbiAgICB9O1xuICB9KSgpO1xuXG4gIC8qKlxuICAgKiBXaGVuIHNlbGVjdGluZyBpbiBub3JtYWwgbW9kZSAobm90IG1ldGEga2V5KSwgY2FuIHNlbGVjdCBvbmUgbGV2ZWwgZG93biwgYSBzaWJsaW5nXG4gICAqIG9yIGEgcGFyZW50IG9mIHRoZSBzZWxlY3RlZCBlbGVtZW50XG4gICAqL1xuICBjb25zdCBnZXRTZWxlY3RhYmxlTmF2Tm9kZSA9IChlOiBhbnkpOiBOYXZUcmVlTm9kZSB8IG51bGwgfCBzdHJpbmcgPT4ge1xuICAgIGNvbnN0IHNlbGVjdGVkRWxlbWVudEtleTogc3RyaW5nID1cbiAgICAgIGdldE1lbW9yeVN0b3JhZ2VJdGVtKFNFTEVDVEVEX0VMRU1FTlRfS0VZKTtcbiAgICBjb25zdCBzZWxlY3RlZEVsZW1lbnQgPSBUZW1wb0VsZW1lbnQuZnJvbUtleShzZWxlY3RlZEVsZW1lbnRLZXkpO1xuXG4gICAgY29uc3QgZWxlbWVudEtleVRvTmF2Tm9kZSA9IGdldE1lbW9yeVN0b3JhZ2VJdGVtKEVMRU1FTlRfS0VZX1RPX05BVl9OT0RFKTtcblxuICAgIC8vIE1vdmUgdXAgdGhlIHRyZWUgdW50aWwgeW91IGZpbmQgdGhlIGZpcnN0IHZhbGlkIG5hdiBub2RlXG4gICAgbGV0IGZpcnN0TmF2Tm9kZTogTmF2VHJlZU5vZGUgfCBudWxsID0gbnVsbDtcbiAgICBsZXQgc2VhcmNoTm9kZSA9IGUudGFyZ2V0O1xuICAgIHdoaWxlIChzZWFyY2hOb2RlICYmICFmaXJzdE5hdk5vZGUpIHtcbiAgICAgIGZpcnN0TmF2Tm9kZSA9XG4gICAgICAgIGVsZW1lbnRLZXlUb05hdk5vZGVbZ2V0RWxlbWVudEtleUZyb21Ob2RlKHNlYXJjaE5vZGUpIHx8ICcnXTtcbiAgICAgIHNlYXJjaE5vZGUgPSBzZWFyY2hOb2RlLnBhcmVudEVsZW1lbnQ7XG4gICAgfVxuXG4gICAgaWYgKCFmaXJzdE5hdk5vZGUpIHtcbiAgICAgIHJldHVybiBTRUxFQ1RfT1JfSE9WRVJfU1RPUllCT0FSRDtcbiAgICB9XG5cbiAgICBjb25zdCBpc05hdk5vZGVNYXRjaCA9IChuYXZUcmVlTm9kZTogTmF2VHJlZU5vZGUpOiBib29sZWFuID0+IHtcbiAgICAgIGlmIChzZWxlY3RlZEVsZW1lbnQuaXNFbXB0eSgpKSB7XG4gICAgICAgIC8vIFRoaXMgZnVuY3Rpb24gY2Fubm90IGJlIGNhbGxlZCBpZiB0aGVyZSBpcyBubyBzZWxlY3RlZCBlbGVtZW50LCBzZWUgY29kZSBsb2dpYyBiZWxvdyB0aGUgZnVuY3Rpb25cbiAgICAgICAgdGhyb3cgRXJyb3IoJ05vIHNlbGVjdGVkIGVsZW1lbnQgd2hlbiBpc05hdk5vZGVNYXRjaCBjYWxsZWQnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFuYXZUcmVlTm9kZSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIC8vIElmIHRoZXJlIGlzIG5vIGNvZGViYXNlIElEIGl0IHNob3VsZCBub3QgYmUgc2VsZWN0YWJsZSBhcyB0aGVyZSBpcyBub3RoaW5nIHdlIGNhbiBkbyB3aXRoIGl0XG4gICAgICBpZiAoXG4gICAgICAgICFuYXZUcmVlTm9kZS50ZW1wb0VsZW1lbnQuY29kZWJhc2VJZC5zdGFydHNXaXRoKCd0ZW1wby0nKSB8fFxuICAgICAgICBuYXZUcmVlTm9kZS50ZW1wb0VsZW1lbnQuY29kZWJhc2VJZCA9PT0gU0tJUF9ST09UX0NPREVCQVNFX0lEXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICAvLyBJZiBpdCBtYXRjaGVzLCB3ZSBhbHJlYWR5IHBhc3NlZCBhbGwgcG9zc2libGUgY2hpbGRyZW4sIHNvIHJlLXNlbGVjdCBpdFxuICAgICAgaWYgKHNlbGVjdGVkRWxlbWVudC5pc0VxdWFsKG5hdlRyZWVOb2RlLnRlbXBvRWxlbWVudCkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIC8vIEFueSBwYXJlbnQgaXMgb2sgdG8gc2VsZWN0XG4gICAgICBpZiAobmF2VHJlZU5vZGUudGVtcG9FbGVtZW50LmlzUGFyZW50T2Yoc2VsZWN0ZWRFbGVtZW50KSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgcGFyZW50c1xuICAgICAgLy8gUGljayB0aGUgZmlyc3QgcGFyZW50IHdpdGggYSBjb2RlYmFzZSBJRFxuICAgICAgbGV0IHBhcmVudCA9IG5hdlRyZWVOb2RlLnBhcmVudDtcbiAgICAgIHdoaWxlIChwYXJlbnQgJiYgIXBhcmVudC50ZW1wb0VsZW1lbnQuY29kZWJhc2VJZC5zdGFydHNXaXRoKCd0ZW1wby0nKSkge1xuICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50O1xuICAgICAgfVxuXG4gICAgICAvLyBPbmUgbGV2ZWwgZG93blxuICAgICAgaWYgKHBhcmVudD8udGVtcG9FbGVtZW50Py5pc0VxdWFsKHNlbGVjdGVkRWxlbWVudCkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIC8vIFNpYmxpbmcgb2YgYW55IHBhcmVudFxuICAgICAgY29uc3Qgc2VsZWN0ZWROb2RlID0gZWxlbWVudEtleVRvTmF2Tm9kZVtzZWxlY3RlZEVsZW1lbnQuZ2V0S2V5KCldO1xuICAgICAgaWYgKFxuICAgICAgICBzZWxlY3RlZE5vZGUgJiZcbiAgICAgICAgbmF2VHJlZU5vZGUucGFyZW50Py5jaGlsZHJlbj8uaW5jbHVkZXM/LihzZWxlY3RlZE5vZGUpXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuXG4gICAgbGV0IGZvdW5kTmF2Tm9kZTogTmF2VHJlZU5vZGUgfCBudWxsID0gbnVsbDtcbiAgICBsZXQgc2VhcmNoTmF2Tm9kZTogTmF2VHJlZU5vZGUgfCB1bmRlZmluZWQgPSBmaXJzdE5hdk5vZGU7XG5cbiAgICB3aGlsZSAoc2VhcmNoTmF2Tm9kZSkge1xuICAgICAgaWYgKCFzZWxlY3RlZEVsZW1lbnQuaXNFbXB0eSgpICYmICFzZWxlY3RlZEVsZW1lbnQuaXNTdG9yeWJvYXJkKCkpIHtcbiAgICAgICAgLy8gSWYgdGhlcmUgaXMgYSBzZWxlY3RlZCBlbGVtZW50IGtleSBsb29wIGZyb20gdGhpcyBlbGVtZW50IHVwIHRoZSBzdGFjayB0byBmaW5kIHRoZSBlbGVtZW50IHRoYXQgaXMgdGhlIGRpcmVjdCBjaGlsZFxuICAgICAgICAvLyBvZiB0aGUgZXhwZWN0ZWQgc2VsZWN0ZWQgZWxlbWVudCwgc28gdGhhdCB5b3UgY2FuIG9ubHkgaG92ZXIgb25lIGxldmVsIGRlZXBlciB0aGFuIHlvdSd2ZSBzZWxlY3RlZFxuICAgICAgICBpZiAoaXNOYXZOb2RlTWF0Y2goc2VhcmNoTmF2Tm9kZSkpIHtcbiAgICAgICAgICBmb3VuZE5hdk5vZGUgPSBzZWFyY2hOYXZOb2RlO1xuICAgICAgICAgIC8vIEV4aXQgdGhlIGxvb3AgYXMgd2UgZm91bmQgdGhlIG5vZGUgdGhhdCBtYXRjaGVzXG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIElmIHRoZXJlIGlzIG5vIHNlbGVjdGVkIGVsZW1lbnQga2V5LCBvciB0aGUgc2VsZWN0aW9uIGlzIHRoZSBzdG9yeWJvYXJkIGl0c2VsZiwgbG9vcCB1cCB0byB0aGUgdG9wLW1vc3QgZWxlbWVudCB3aXRoIGEgY29kZWJhc2UgSURcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHNlYXJjaE5hdk5vZGUudGVtcG9FbGVtZW50LmNvZGViYXNlSWQgJiZcbiAgICAgICAgICBzZWFyY2hOYXZOb2RlLnRlbXBvRWxlbWVudC5jb2RlYmFzZUlkLnN0YXJ0c1dpdGgoJ3RlbXBvLScpXG4gICAgICAgICkge1xuICAgICAgICAgIGZvdW5kTmF2Tm9kZSA9IHNlYXJjaE5hdk5vZGU7XG4gICAgICAgICAgLy8gTm90ZTogd2UgZG8gbm90IGV4aXQgdGhlIGxvb3AgaGVyZSBhcyB3ZSB3YW50IHRvIGtlZXAgc2VhcmNoaW5nIGZvciB0aGUgdG9wLW1vc3QgZWxlbWVudFxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHNlYXJjaE5hdk5vZGUgPSBzZWFyY2hOYXZOb2RlLnBhcmVudDtcbiAgICB9XG5cbiAgICByZXR1cm4gZm91bmROYXZOb2RlIHx8IG51bGw7XG4gIH07XG5cbiAgY29uc3Qgb25Qb2ludGVyT3ZlciA9IChcbiAgICBlOiBhbnksXG4gICAgcGFyZW50UG9ydDogYW55LFxuICAgIHN0b3J5Ym9hcmRJZDogc3RyaW5nLFxuICAgIHNlbGVjdEJvdHRvbU1vc3RFbGVtZW50PzogYm9vbGVhbixcbiAgKSA9PiB7XG4gICAgY29uc3QgcGFzc2VkVGhyb3VnaCA9IHBhc3NUaHJvdWdoRXZlbnRzSWZOZWVkZWQoXG4gICAgICBlLFxuICAgICAgcGFyZW50UG9ydCxcbiAgICAgIHN0b3J5Ym9hcmRJZCxcbiAgICApO1xuICAgIGNvbnN0IGVkaXRpbmdUZXh0SW5mbyA9IGdldEVkaXRpbmdJbmZvKCk7XG5cbiAgICAvLyBBbGxvdyBvbiBwb2ludGVyIG92ZXIgZXZlbnRzIGlmIGVkaXRpbmcgKHNvIHdlIGNhbiBjbGljayBvdXQpXG4gICAgaWYgKGUuYWx0S2V5IHx8IChwYXNzZWRUaHJvdWdoICYmICFlZGl0aW5nVGV4dEluZm8pKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGdldE1lbW9yeVN0b3JhZ2VJdGVtKCdtb3VzZURyYWdDb250ZXh0JykpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50SG92ZXJlZEtleSA9IGdldE1lbW9yeVN0b3JhZ2VJdGVtKEhPVkVSRURfRUxFTUVOVF9LRVkpO1xuXG4gICAgY29uc3QgZWxlbWVudEtleVRvTmF2Tm9kZSA9XG4gICAgICBnZXRNZW1vcnlTdG9yYWdlSXRlbShFTEVNRU5UX0tFWV9UT19OQVZfTk9ERSkgfHwge307XG5cbiAgICBsZXQgaG92ZXJlZE5hdk5vZGU6IE5hdlRyZWVOb2RlIHwgbnVsbCB8IHN0cmluZztcbiAgICBpZiAoZS5tZXRhS2V5IHx8IGUuY3RybEtleSB8fCBzZWxlY3RCb3R0b21Nb3N0RWxlbWVudCkge1xuICAgICAgY29uc3QgZWxlbWVudEtleTogYW55ID0gZ2V0RWxlbWVudEtleUZyb21Ob2RlKGUudGFyZ2V0KTtcbiAgICAgIGhvdmVyZWROYXZOb2RlID0gZWxlbWVudEtleVRvTmF2Tm9kZVtlbGVtZW50S2V5XTtcblxuICAgICAgLy8gU3BlY2lhbCBjYXNlIC0+IHRoaXMgaXMgdGhlIHRvcC1tb3N0IG5vZGUgc28gaXQgc2hvdWxkIHRyaWdnZXIgYSBob3ZlciBvbiB0aGUgc3Rvcnlib2FyZFxuICAgICAgaWYgKCFob3ZlcmVkTmF2Tm9kZSAmJiBlLnRhcmdldC5wYXJlbnROb2RlID09PSBkb2N1bWVudC5ib2R5KSB7XG4gICAgICAgIGhvdmVyZWROYXZOb2RlID0gU0VMRUNUX09SX0hPVkVSX1NUT1JZQk9BUkQ7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGhvdmVyZWROYXZOb2RlID0gZ2V0U2VsZWN0YWJsZU5hdk5vZGUoZSk7XG4gICAgfVxuXG4gICAgY29uc3QgY3VycmVudFNlbGVjdGVkS2V5ID0gZ2V0TWVtb3J5U3RvcmFnZUl0ZW0oU0VMRUNURURfRUxFTUVOVF9LRVkpO1xuICAgIGNvbnN0IGN1cnJlbnRTZWxlY3RlZEVsZW1lbnQgPSBUZW1wb0VsZW1lbnQuZnJvbUtleShjdXJyZW50U2VsZWN0ZWRLZXkpO1xuXG4gICAgLy8gSWYgdGhlIHVzZXIgaXMgaG9sZGluZyBzaGlmdCwgb25seSBhbGxvdyBzZWxlY3Rpbmcgc2libGluZ3NcbiAgICBpZiAoZS5zaGlmdEtleSAmJiBob3ZlcmVkTmF2Tm9kZSAmJiBjdXJyZW50U2VsZWN0ZWRLZXkpIHtcbiAgICAgIC8vIFRyeWluZyB0byBzZWxlY3QgdGhlIGVudGlyZSBzdG9yeWJvYXJkLCBhbGxvdyBvbmx5IGlmIHRoZSBvdGhlciBzZWxlY3RlZCBlbGVtZW50IGlzIGFsc28gYSBzdG9yeWJvYXJkXG4gICAgICBpZiAoXG4gICAgICAgIHR5cGVvZiBob3ZlcmVkTmF2Tm9kZSA9PT0gJ3N0cmluZycgJiZcbiAgICAgICAgIWN1cnJlbnRTZWxlY3RlZEVsZW1lbnQuaXNTdG9yeWJvYXJkKClcbiAgICAgICkge1xuICAgICAgICBob3ZlcmVkTmF2Tm9kZSA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgdHlwZW9mIGhvdmVyZWROYXZOb2RlICE9PSAnc3RyaW5nJyAmJlxuICAgICAgICAhaG92ZXJlZE5hdk5vZGU/LnRlbXBvRWxlbWVudC5pc1NpYmxpbmdPZihjdXJyZW50U2VsZWN0ZWRFbGVtZW50KVxuICAgICAgKSB7XG4gICAgICAgIGhvdmVyZWROYXZOb2RlID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIWhvdmVyZWROYXZOb2RlKSB7XG4gICAgICBpZiAoY3VycmVudEhvdmVyZWRLZXkgIT09IG51bGwpIHtcbiAgICAgICAgc2V0TWVtb3J5U3RvcmFnZUl0ZW0oSE9WRVJFRF9FTEVNRU5UX0tFWSwgbnVsbCk7XG4gICAgICAgIHBhcmVudFBvcnQucG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgIGlkOiBGSVhFRF9JRlJBTUVfTUVTU0FHRV9JRFMuSE9WRVJFRF9FTEVNRU5UX0tFWSxcbiAgICAgICAgICBlbGVtZW50S2V5OiBudWxsLFxuICAgICAgICB9KTtcblxuICAgICAgICB1cGRhdGVPdXRsaW5lcyhwYXJlbnRQb3J0LCBzdG9yeWJvYXJkSWQpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBob3ZlcmVkTmF2Tm9kZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGlmIChob3ZlcmVkTmF2Tm9kZSA9PT0gU0VMRUNUX09SX0hPVkVSX1NUT1JZQk9BUkQpIHtcbiAgICAgICAgY29uc3Qgc3Rvcnlib2FyZEtleSA9IFRlbXBvRWxlbWVudC5mb3JTdG9yeWJvYXJkKHN0b3J5Ym9hcmRJZCkuZ2V0S2V5KCk7XG5cbiAgICAgICAgaWYgKGN1cnJlbnRIb3ZlcmVkS2V5ICE9PSBzdG9yeWJvYXJkS2V5KSB7XG4gICAgICAgICAgc2V0TWVtb3J5U3RvcmFnZUl0ZW0oSE9WRVJFRF9FTEVNRU5UX0tFWSwgc3Rvcnlib2FyZEtleSk7XG5cbiAgICAgICAgICBwYXJlbnRQb3J0LnBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgIGlkOiBGSVhFRF9JRlJBTUVfTUVTU0FHRV9JRFMuSE9WRVJFRF9FTEVNRU5UX0tFWSxcbiAgICAgICAgICAgIGVsZW1lbnRLZXk6IHN0b3J5Ym9hcmRLZXksXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICB1cGRhdGVPdXRsaW5lcyhwYXJlbnRQb3J0LCBzdG9yeWJvYXJkSWQpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB0ZW1wb0VsZW1lbnRLZXkgPSBob3ZlcmVkTmF2Tm9kZS50ZW1wb0VsZW1lbnQuZ2V0S2V5KCk7XG5cbiAgICBpZiAoY3VycmVudEhvdmVyZWRLZXkgIT09IHRlbXBvRWxlbWVudEtleSkge1xuICAgICAgcGFyZW50UG9ydC5wb3N0TWVzc2FnZSh7XG4gICAgICAgIGlkOiBGSVhFRF9JRlJBTUVfTUVTU0FHRV9JRFMuSE9WRVJFRF9FTEVNRU5UX0tFWSxcbiAgICAgICAgZWxlbWVudEtleTogdGVtcG9FbGVtZW50S2V5LFxuICAgICAgfSk7XG4gICAgICBzZXRNZW1vcnlTdG9yYWdlSXRlbShIT1ZFUkVEX0VMRU1FTlRfS0VZLCB0ZW1wb0VsZW1lbnRLZXkpO1xuICAgICAgdXBkYXRlT3V0bGluZXMocGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgY2xlYXJIb3ZlcmVkRWxlbWVudHMgPSAocGFyZW50UG9ydDogYW55LCBzdG9yeWJvYXJkSWQ6IHN0cmluZykgPT4ge1xuICAgIGNvbnN0IGN1cnJlbnRIb3ZlcmVkS2V5ID0gZ2V0TWVtb3J5U3RvcmFnZUl0ZW0oSE9WRVJFRF9FTEVNRU5UX0tFWSk7XG5cbiAgICBpZiAoIWN1cnJlbnRIb3ZlcmVkS2V5KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgcGFyZW50UG9ydC5wb3N0TWVzc2FnZSh7XG4gICAgICBpZDogRklYRURfSUZSQU1FX01FU1NBR0VfSURTLkhPVkVSRURfRUxFTUVOVF9LRVksXG4gICAgICBlbGVtZW50S2V5OiBudWxsLFxuICAgIH0pO1xuICAgIHNldE1lbW9yeVN0b3JhZ2VJdGVtKEhPVkVSRURfRUxFTUVOVF9LRVksIG51bGwpO1xuXG4gICAgdXBkYXRlT3V0bGluZXMocGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgfTtcblxuICBjb25zdCBvblBvaW50ZXJNb3ZlID0gYXN5bmMgKFxuICAgIGU6IGFueSxcbiAgICBwYXJlbnRQb3J0OiBhbnksXG4gICAgc3Rvcnlib2FyZElkOiBzdHJpbmcsXG4gICkgPT4ge1xuICAgIHBhc3NUaHJvdWdoRXZlbnRzSWZOZWVkZWQoZSwgcGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcblxuICAgIC8vIElmIG5vIGJ1dHRvbnMgYXJlIHByZXNzZWQgdGhlIGRyYWcgZW5kIGV2ZW50IG1heSBub3QgaGF2ZSBjb3JyZWN0bHkgdHJpZ2dlcmVkXG4gICAgLy8gcmVzZXQgdGhlIGRyYWcgc3RhdGVcbiAgICBsZXQgbW91c2VEcmFnRGF0YSA9IGdldE1lbW9yeVN0b3JhZ2VJdGVtKCdtb3VzZURyYWdDb250ZXh0Jyk7XG4gICAgaWYgKCFlLmJ1dHRvbnMgJiYgbW91c2VEcmFnRGF0YSkge1xuICAgICAgc2V0TWVtb3J5U3RvcmFnZUl0ZW0oJ21vdXNlRHJhZ0NvbnRleHQnLCBudWxsKTtcblxuICAgICAgaWYgKG1vdXNlRHJhZ0RhdGE/LmRyYWdnaW5nKSB7XG4gICAgICAgIHBhcmVudFBvcnQucG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgIGlkOiBGSVhFRF9JRlJBTUVfTUVTU0FHRV9JRFMuRFJBR19DQU5DRUxfRVZFTlQsXG4gICAgICAgICAgZXZlbnQ6IHt9LFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgbW91c2VEcmFnRGF0YSA9IG51bGw7XG4gICAgfVxuXG4gICAgY29uc3QgaW1wb3J0YW50RmllbGRzID0ge1xuICAgICAgcGFnZVg6IGUucGFnZVgsXG4gICAgICBwYWdlWTogZS5wYWdlWSxcblxuICAgICAgY2xpZW50WDogZS5jbGllbnRYLFxuICAgICAgY2xpZW50WTogZS5jbGllbnRZLFxuICAgIH07XG5cbiAgICBzZXRNZW1vcnlTdG9yYWdlSXRlbSgnbW91c2VQb3MnLCBpbXBvcnRhbnRGaWVsZHMpO1xuXG4gICAgcGFyZW50UG9ydC5wb3N0TWVzc2FnZSh7XG4gICAgICBpZDogRklYRURfSUZSQU1FX01FU1NBR0VfSURTLk1PVVNFX01PVkVfRVZFTlQsXG4gICAgICBldmVudDogaW1wb3J0YW50RmllbGRzLFxuICAgIH0pO1xuXG4gICAgaWYgKG1vdXNlRHJhZ0RhdGEgJiYgIW1vdXNlRHJhZ0RhdGEuZHJhZ2dpbmcpIHtcbiAgICAgIGNvbnN0IHpvb21QZXJjID0gZ2V0TWVtb3J5U3RvcmFnZUl0ZW0oJ3pvb21QZXJjJykgfHwgMTtcblxuICAgICAgY29uc3QgdG90YWxNb3ZlbWVudFBpeGVscyA9XG4gICAgICAgIE1hdGguYWJzKG1vdXNlRHJhZ0RhdGEucGFnZVggLSBlLnBhZ2VYKSArXG4gICAgICAgIE1hdGguYWJzKG1vdXNlRHJhZ0RhdGEucGFnZVkgLSBlLnBhZ2VZKTtcbiAgICAgIC8vIFN0YXJ0IHRoZSBkcmFnIGV2ZW50IGlmIHRoZSB1c2VyIGhhcyBtb3ZlZCBlbm91Z2hcbiAgICAgIGlmICh0b3RhbE1vdmVtZW50UGl4ZWxzID49IFBJWEVMU19UT19NT1ZFX0JFRk9SRV9EUkFHIC8gem9vbVBlcmMpIHtcbiAgICAgICAgLy8gUmVzZWxlY3QgdGhlIHBhcmVudCBpZiB0aGVyZSB3YXMgb25lIHRvIHNlbGVjdFxuICAgICAgICBpZiAobW91c2VEcmFnRGF0YS5wYXJlbnRTZWxlY3RlZEVsZW1lbnRLZXkpIHtcbiAgICAgICAgICBjb25zdCBlbGVtZW50S2V5VG9OYXZOb2RlID1cbiAgICAgICAgICAgIGdldE1lbW9yeVN0b3JhZ2VJdGVtKEVMRU1FTlRfS0VZX1RPX05BVl9OT0RFKSB8fCB7fTtcbiAgICAgICAgICBjb25zdCBuYXZOb2RlVG9TZWxlY3QgPVxuICAgICAgICAgICAgZWxlbWVudEtleVRvTmF2Tm9kZVttb3VzZURyYWdEYXRhLnBhcmVudFNlbGVjdGVkRWxlbWVudEtleV07XG5cbiAgICAgICAgICBpZiAobmF2Tm9kZVRvU2VsZWN0KSB7XG4gICAgICAgICAgICBwYXJlbnRQb3J0LnBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgICAgaWQ6IEZJWEVEX0lGUkFNRV9NRVNTQUdFX0lEUy5TRUxFQ1RFRF9FTEVNRU5UX0tFWSxcbiAgICAgICAgICAgICAgZWxlbWVudEtleTogbW91c2VEcmFnRGF0YS5wYXJlbnRTZWxlY3RlZEVsZW1lbnRLZXksXG4gICAgICAgICAgICAgIG91dGVySFRNTDogJChcbiAgICAgICAgICAgICAgICBgLiR7RUxFTUVOVF9LRVlfUFJFRklYfSR7bW91c2VEcmFnRGF0YS5wYXJlbnRTZWxlY3RlZEVsZW1lbnRLZXl9YCxcbiAgICAgICAgICAgICAgKS5nZXQoMCk/Lm91dGVySFRNTCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc2V0TWVtb3J5U3RvcmFnZUl0ZW0oXG4gICAgICAgICAgICAgIFNFTEVDVEVEX0VMRU1FTlRfS0VZLFxuICAgICAgICAgICAgICBtb3VzZURyYWdEYXRhLnBhcmVudFNlbGVjdGVkRWxlbWVudEtleSxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYWlDb250ZXh0U2VsZWN0aW9uID0gZ2V0TWVtb3J5U3RvcmFnZUl0ZW0oJ2FpQ29udGV4dCcpO1xuXG4gICAgICAgIC8vIERvbid0IGVuYWJsZSBkcmFnZ2luZyBpZiB0aGUgQUkgY29udGV4dCBpcyBlbmFibGVkXG4gICAgICAgIGlmICghYWlDb250ZXh0U2VsZWN0aW9uKSB7XG4gICAgICAgICAgc2V0TWVtb3J5U3RvcmFnZUl0ZW0oJ21vdXNlRHJhZ0NvbnRleHQnLCB7XG4gICAgICAgICAgICAuLi5tb3VzZURyYWdEYXRhLFxuICAgICAgICAgICAgZHJhZ2dpbmc6IHRydWUsXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBjb25zdCBzZWxlY3RlZEVsZW1lbnRLZXkgPSBnZXRNZW1vcnlTdG9yYWdlSXRlbShTRUxFQ1RFRF9FTEVNRU5UX0tFWSk7XG4gICAgICAgICAgY29uc3Qgc2VsZWN0ZWRFbGVtZW50ID0gJChcbiAgICAgICAgICAgIGAuJHtFTEVNRU5UX0tFWV9QUkVGSVh9JHtzZWxlY3RlZEVsZW1lbnRLZXl9YCxcbiAgICAgICAgICApLmdldCgwKTtcblxuICAgICAgICAgIC8vIFRyaWdnZXIgdGhlIGRyYWcgc3RhcnQgZXZlbnRcbiAgICAgICAgICBwYXJlbnRQb3J0LnBvc3RNZXNzYWdlKHtcbiAgICAgICAgICAgIGlkOiBGSVhFRF9JRlJBTUVfTUVTU0FHRV9JRFMuRFJBR19TVEFSVF9FVkVOVCxcbiAgICAgICAgICAgIGV2ZW50OiBtb3VzZURyYWdEYXRhLFxuICAgICAgICAgICAgb3V0ZXJIVE1MOiBzZWxlY3RlZEVsZW1lbnQ/Lm91dGVySFRNTCxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGNvbnN0IGJvZHlPYmplY3QgPSAkKCdib2R5JykuZ2V0KDApO1xuXG4gICAgICAgICAgLy8gSEFDSzogTWFyY2ggOCwgMjAyNFxuICAgICAgICAgIC8vIFdpdGhvdXQgdGhpcyB3b3JrYXJvdW5kIGV2ZW50cyBzdGF5IGluc2lkZSB0aGUgaWZyYW1lIHNvIGl0J3Mgbm90IHBvc3NpYmxlIHRvXG4gICAgICAgICAgLy8gdHJhY2sgbW91c2UgbW92ZW1lbnRzIG91dHNpZGUgdGhlIGlmcmFtZSB3aGVuIGNsaWNraW5nICYgZHJhZ2dpbmcuXG4gICAgICAgICAgLy8gU2V0IHRoZSBwb2ludGVyIGxvY2sgYW5kIGltbWVkaWF0ZWx5IHJlbW92ZSBpdCBzbyB0aGF0XG4gICAgICAgICAgLy8gdGhlIGV2ZW50cyBzdGFydCB0byBwcm9wYWdhdGUgdXB3YXJkcyBpbiB0aGUgb3V0ZXIgYXBwbGljYXRpb24uXG4gICAgICAgICAgc2V0TWVtb3J5U3RvcmFnZUl0ZW0oSU1NRURJQVRFTFlfUkVNT1ZFX1BPSU5URVJfTE9DSywgdHJ1ZSk7XG4gICAgICAgICAgYXdhaXQgYm9keU9iamVjdD8ucmVxdWVzdFBvaW50ZXJMb2NrKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoZ2V0TWVtb3J5U3RvcmFnZUl0ZW0oJ21vdXNlRHJhZ0NvbnRleHQnKSkge1xuICAgICAgdXBkYXRlT3V0bGluZXMocGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZ2V0UGFyZW50RG9tRWxlbWVudEZvck5hdk5vZGUgPSAobmF2Tm9kZTogTmF2VHJlZU5vZGUpID0+IHtcbiAgICBpZiAoIW5hdk5vZGUpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGlmICghbmF2Tm9kZT8uaXNDb21wb25lbnQpIHtcbiAgICAgIGNvbnN0IGNoaWxkRG9tRWxlbWVudCA9ICQoXG4gICAgICAgIGAuJHtFTEVNRU5UX0tFWV9QUkVGSVh9JHtuYXZOb2RlLnRlbXBvRWxlbWVudC5nZXRLZXkoKX1gLFxuICAgICAgKS5nZXQoMCk7XG4gICAgICByZXR1cm4gY2hpbGREb21FbGVtZW50Py5wYXJlbnRFbGVtZW50O1xuICAgIH1cblxuICAgIC8vIFRoaXMgaXMgdGhlIGxpc3Qgb2YgcmVhbCBET00gZWxlbWVudHMgdGhhdCBhcmUgYXQgdGhlIHRvcCBsZXZlbCBvZiB0aGlzIGNvbXBvbmVudFxuICAgIGNvbnN0IGVsZW1lbnRLZXlUb0xvb2t1cExpc3Q6IGFueSA9XG4gICAgICBnZXRNZW1vcnlTdG9yYWdlSXRlbShFTEVNRU5UX0tFWV9UT19MT09LVVBfTElTVCkgfHwge307XG5cbiAgICBjb25zdCBsb29rdXBMaXN0ID1cbiAgICAgIGVsZW1lbnRLZXlUb0xvb2t1cExpc3RbbmF2Tm9kZS50ZW1wb0VsZW1lbnQuZ2V0S2V5KCldIHx8IFtdO1xuICAgIGxldCBjaGlsZERvbUVsZW1lbnQ6IGFueTtcbiAgICBsb29rdXBMaXN0LmZvckVhY2goKGxvb2t1cEVsZW1lbnRLZXk6IHN0cmluZykgPT4ge1xuICAgICAgaWYgKGNoaWxkRG9tRWxlbWVudCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNoaWxkRG9tRWxlbWVudCA9ICQoYC4ke0VMRU1FTlRfS0VZX1BSRUZJWH0ke2xvb2t1cEVsZW1lbnRLZXl9YCkuZ2V0KDApO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGNoaWxkRG9tRWxlbWVudD8ucGFyZW50RWxlbWVudDtcbiAgfTtcblxuICBjb25zdCBvblBvaW50ZXJEb3duID0gKGU6IGFueSwgcGFyZW50UG9ydDogYW55LCBzdG9yeWJvYXJkSWQ6IHN0cmluZykgPT4ge1xuICAgIC8vIFRoaXMgdmFyaWFibGUgZGV0ZXJtaW5lcyB3aGljaCBidXR0b24gd2FzIHVzZWRcbiAgICAvLyAxIC0+IGxlZnQsIDIgLT4gbWlkZGxlLCAzIC0+IHJpZ2h0XG4gICAgaWYgKGUud2hpY2ggIT09IDEpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBBbGxvdyB0aGUgZWRpdCBkeW5hbWljIHRleHQgYnV0dG9uIHRvIGJlIGNsaWNrZWRcbiAgICBpZiAoaGFzQ2xhc3MoZS50YXJnZXQsIEVESVRfVEVYVF9CVVRUT04pKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgcGFzc2VkVGhyb3VnaCA9IHBhc3NUaHJvdWdoRXZlbnRzSWZOZWVkZWQoXG4gICAgICBlLFxuICAgICAgcGFyZW50UG9ydCxcbiAgICAgIHN0b3J5Ym9hcmRJZCxcbiAgICApO1xuICAgIGlmIChwYXNzZWRUaHJvdWdoKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3Qgc2VsZWN0ZWRFbGVtZW50S2V5ID0gZ2V0TWVtb3J5U3RvcmFnZUl0ZW0oU0VMRUNURURfRUxFTUVOVF9LRVkpO1xuICAgIGNvbnN0IHNlbGVjdGVkRWxlbWVudCA9IFRlbXBvRWxlbWVudC5mcm9tS2V5KHNlbGVjdGVkRWxlbWVudEtleSk7XG4gICAgY29uc3Qgc2VsZWN0ZWROYXZOb2RlID0gb25TZWxlY3RFbGVtZW50KGUsIHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG5cbiAgICBjb25zdCB1c2VTZWxlY3RlZElmRHJhZ2dpbmcgPVxuICAgICAgIXNlbGVjdGVkRWxlbWVudC5pc0VtcHR5KCkgJiZcbiAgICAgIHNlbGVjdGVkRWxlbWVudC5pc1BhcmVudE9mKHNlbGVjdGVkTmF2Tm9kZT8udGVtcG9FbGVtZW50KTtcblxuICAgIGxldCBvZmZzZXRYLCBvZmZzZXRZO1xuXG4gICAgaWYgKHNlbGVjdGVkTmF2Tm9kZT8ucGFnZUJvdW5kaW5nQm94KSB7XG4gICAgICBvZmZzZXRYID1cbiAgICAgICAgc2VsZWN0ZWROYXZOb2RlLnBhZ2VCb3VuZGluZ0JveC5wYWdlWCArXG4gICAgICAgIHNlbGVjdGVkTmF2Tm9kZS5wYWdlQm91bmRpbmdCb3gud2lkdGggLyAyIC1cbiAgICAgICAgZS5wYWdlWDtcbiAgICAgIG9mZnNldFkgPVxuICAgICAgICBzZWxlY3RlZE5hdk5vZGUucGFnZUJvdW5kaW5nQm94LnBhZ2VZICtcbiAgICAgICAgc2VsZWN0ZWROYXZOb2RlLnBhZ2VCb3VuZGluZ0JveC5oZWlnaHQgLyAyIC1cbiAgICAgICAgZS5wYWdlWTtcbiAgICB9XG5cbiAgICBjb25zdCBpbXBvcnRhbnRGaWVsZHM6IGFueSA9IHtcbiAgICAgIHBhZ2VYOiBlLnBhZ2VYLFxuICAgICAgcGFnZVk6IGUucGFnZVksXG5cbiAgICAgIC8vIFRoZSBkaWZmZXJlbmNlIGJldHdlZW4gd2hlcmUgdGhlIHVzZXIgY2xpY2tlZCBhbmQgdGhlIGNlbnRlciBvZiB0aGUgZWxlbWVudFxuICAgICAgb2Zmc2V0WCxcbiAgICAgIG9mZnNldFksXG5cbiAgICAgIC8vIFVzZWQgdG8gcmVzZWxlY3QgdGhlIHBhcmVudCBpZiB0aGUgdXNlciBzdGFydHMgdG8gbW92ZVxuICAgICAgcGFyZW50U2VsZWN0ZWRFbGVtZW50S2V5OiB1c2VTZWxlY3RlZElmRHJhZ2dpbmdcbiAgICAgICAgPyBzZWxlY3RlZEVsZW1lbnRLZXlcbiAgICAgICAgOiBudWxsLFxuICAgIH07XG5cbiAgICBjb25zdCBlbGVtZW50S2V5VG9OYXZOb2RlID1cbiAgICAgIGdldE1lbW9yeVN0b3JhZ2VJdGVtKEVMRU1FTlRfS0VZX1RPX05BVl9OT0RFKSB8fCB7fTtcblxuICAgIC8vIEdldCB0aGUgcGFyZW50IGVsZW1lbnQgKGFjdHVhbCBET00gZWxlbWVudCkgdGhhdCB0aGlzIG5vZGUgaXMgYmVpbmcgZHJhZ2dlZCBpbnNpZGVcbiAgICAvLyBUbyBkbyB0aGlzIHBpY2sgb25lIGNoaWxkIGVsZW1lbnQgdGhhdCBpcyBiZWluZyBkcmFnZ2VkIChjYW4gYmUgbXVsdGlwbGUgY2hpbGRyZW4gaWYgdGhlIG5vZGUgYmVpbmcgZHJhZ2dlZCBpcyBhIGNvbXBvbmVudCksXG4gICAgLy8gYW5kIGdldCBpdHMgcGFyZW50IGluIHRoZSBET01cbiAgICBjb25zdCBuYXZOb2RlVG9Vc2VGb3JEcmFnZ2luZyA9IHVzZVNlbGVjdGVkSWZEcmFnZ2luZ1xuICAgICAgPyBlbGVtZW50S2V5VG9OYXZOb2RlW3NlbGVjdGVkRWxlbWVudEtleV1cbiAgICAgIDogc2VsZWN0ZWROYXZOb2RlO1xuXG4gICAgY29uc3QgcGFyZW50RG9tRWxlbWVudCA9IGdldFBhcmVudERvbUVsZW1lbnRGb3JOYXZOb2RlKFxuICAgICAgbmF2Tm9kZVRvVXNlRm9yRHJhZ2dpbmcsXG4gICAgKTtcblxuICAgIGlmIChwYXJlbnREb21FbGVtZW50KSB7XG4gICAgICBpbXBvcnRhbnRGaWVsZHNbJ3NlbGVjdGVkUGFyZW50RGlzcGxheSddID0gY3NzRXZhbChcbiAgICAgICAgcGFyZW50RG9tRWxlbWVudCxcbiAgICAgICAgJ2Rpc3BsYXknLFxuICAgICAgKTtcbiAgICAgIGltcG9ydGFudEZpZWxkc1snc2VsZWN0ZWRQYXJlbnRGbGV4RGlyZWN0aW9uJ10gPSBjc3NFdmFsKFxuICAgICAgICBwYXJlbnREb21FbGVtZW50LFxuICAgICAgICAnZmxleC1kaXJlY3Rpb24nLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBhaUNvbnRleHRTZWxlY3Rpb24gPSBnZXRNZW1vcnlTdG9yYWdlSXRlbSgnYWlDb250ZXh0Jyk7XG5cbiAgICAvLyBEb24ndCBlbmFibGUgZHJhZ2dpbmcgaWYgdGhlIEFJIGNvbnRleHQgaXMgZW5hYmxlZFxuICAgIGlmICghYWlDb250ZXh0U2VsZWN0aW9uKSB7XG4gICAgICBzZXRNZW1vcnlTdG9yYWdlSXRlbSgnbW91c2VEcmFnQ29udGV4dCcsIGltcG9ydGFudEZpZWxkcyk7XG4gICAgfVxuXG4gICAgdXBkYXRlT3V0bGluZXMocGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgfTtcblxuICBjb25zdCBvblBvaW50ZXJVcCA9IChlOiBhbnksIHBhcmVudFBvcnQ6IGFueSwgc3Rvcnlib2FyZElkOiBzdHJpbmcpID0+IHtcbiAgICBwYXNzVGhyb3VnaEV2ZW50c0lmTmVlZGVkKGUsIHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG5cbiAgICBjb25zdCBtb3VzZURyYWdEYXRhID0gZ2V0TWVtb3J5U3RvcmFnZUl0ZW0oJ21vdXNlRHJhZ0NvbnRleHQnKTtcblxuICAgIHNldE1lbW9yeVN0b3JhZ2VJdGVtKCdtb3VzZURyYWdDb250ZXh0JywgbnVsbCk7XG5cbiAgICBpZiAobW91c2VEcmFnRGF0YT8uZHJhZ2dpbmcpIHtcbiAgICAgIHBhcmVudFBvcnQucG9zdE1lc3NhZ2Uoe1xuICAgICAgICBpZDogRklYRURfSUZSQU1FX01FU1NBR0VfSURTLkRSQUdfRU5EX0VWRU5ULFxuICAgICAgICBldmVudDoge30sXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB1cGRhdGVPdXRsaW5lcyhwYXJlbnRQb3J0LCBzdG9yeWJvYXJkSWQpO1xuICB9O1xuXG4gIGNvbnN0IG9uU2VsZWN0RWxlbWVudCA9IChcbiAgICBlOiBhbnksXG4gICAgcGFyZW50UG9ydDogYW55LFxuICAgIHN0b3J5Ym9hcmRJZDogc3RyaW5nLFxuICApOiBOYXZUcmVlTm9kZSB8IG51bGwgPT4ge1xuICAgIGNvbnN0IGRyaXZlTW9kZUVuYWJsZWQgPSAhIWdldFNlc3Npb25TdG9yYWdlSXRlbShcbiAgICAgICdkcml2ZU1vZGVFbmFibGVkJyxcbiAgICAgIHN0b3J5Ym9hcmRJZCxcbiAgICApO1xuXG4gICAgaWYgKGRyaXZlTW9kZUVuYWJsZWQpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IGVsZW1lbnRLZXlUb05hdk5vZGUgPVxuICAgICAgZ2V0TWVtb3J5U3RvcmFnZUl0ZW0oRUxFTUVOVF9LRVlfVE9fTkFWX05PREUpIHx8IHt9O1xuXG4gICAgbGV0IHNlbGVjdGVkTmF2Tm9kZTogTmF2VHJlZU5vZGUgfCBudWxsIHwgc3RyaW5nO1xuICAgIGlmIChlLm1ldGFLZXkgfHwgZS5jdHJsS2V5KSB7XG4gICAgICBjb25zdCBlbGVtZW50S2V5OiBhbnkgPSBnZXRFbGVtZW50S2V5RnJvbU5vZGUoZS50YXJnZXQpO1xuICAgICAgc2VsZWN0ZWROYXZOb2RlID0gZWxlbWVudEtleVRvTmF2Tm9kZVtlbGVtZW50S2V5XTtcblxuICAgICAgLy8gU3BlY2lhbCBjYXNlIC0+IHRoaXMgaXMgdGhlIHRvcC1tb3N0IG5vZGUgc28gaXQgc2hvdWxkIHRyaWdnZXIgYSBzZWxlY3Qgb24gdGhlIHN0b3J5Ym9hcmRcbiAgICAgIGlmICghc2VsZWN0ZWROYXZOb2RlICYmIGUudGFyZ2V0LnBhcmVudE5vZGUgPT09IGRvY3VtZW50LmJvZHkpIHtcbiAgICAgICAgc2VsZWN0ZWROYXZOb2RlID0gU0VMRUNUX09SX0hPVkVSX1NUT1JZQk9BUkQ7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGVjdGVkTmF2Tm9kZSA9IGdldFNlbGVjdGFibGVOYXZOb2RlKGUpO1xuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRTZWxlY3RlZEVsZW1lbnRLZXkgPVxuICAgICAgZ2V0TWVtb3J5U3RvcmFnZUl0ZW0oU0VMRUNURURfRUxFTUVOVF9LRVkpO1xuXG4gICAgLy8gSWYgdGhpcyBpcyBub3QgYSB2YWxpZCBuYXYgbm9kZSwgaXQncyBub3Qgc29tZXRoaW5nIHdlIHRyYWNrIC0gZGVzZWxlY3QgYWxsXG4gICAgaWYgKCFzZWxlY3RlZE5hdk5vZGUpIHtcbiAgICAgIGlmIChjdXJyZW50U2VsZWN0ZWRFbGVtZW50S2V5KSB7XG4gICAgICAgIHBhcmVudFBvcnQucG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgIGlkOiBGSVhFRF9JRlJBTUVfTUVTU0FHRV9JRFMuU0VMRUNURURfRUxFTUVOVF9LRVksXG4gICAgICAgICAgZWxlbWVudEtleTogbnVsbCxcbiAgICAgICAgfSk7XG4gICAgICAgIHNldE1lbW9yeVN0b3JhZ2VJdGVtKFNFTEVDVEVEX0VMRU1FTlRfS0VZLCBudWxsKTtcblxuICAgICAgICB1cGRhdGVPdXRsaW5lcyhwYXJlbnRQb3J0LCBzdG9yeWJvYXJkSWQpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50U2VsZWN0ZWRFbGVtZW50ID0gVGVtcG9FbGVtZW50LmZyb21LZXkoXG4gICAgICBjdXJyZW50U2VsZWN0ZWRFbGVtZW50S2V5LFxuICAgICk7XG4gICAgY29uc3QgY3VycmVudE11bHRpU2VsZWN0ZWRLZXlzOiBzdHJpbmdbXSA9XG4gICAgICBnZXRNZW1vcnlTdG9yYWdlSXRlbShNVUxUSV9TRUxFQ1RFRF9FTEVNRU5UX0tFWVMpIHx8IFtdO1xuXG4gICAgbGV0IG5ld1NlbGVjdGVkRWxlbWVudCA9XG4gICAgICB0eXBlb2Ygc2VsZWN0ZWROYXZOb2RlID09PSAnc3RyaW5nJ1xuICAgICAgICA/IFRlbXBvRWxlbWVudC5mb3JTdG9yeWJvYXJkKHN0b3J5Ym9hcmRJZClcbiAgICAgICAgOiBzZWxlY3RlZE5hdk5vZGUudGVtcG9FbGVtZW50O1xuICAgIGxldCBuZXdNdWx0aVNlbGVjdEtleXM6IHN0cmluZ1tdID0gW107XG5cbiAgICAvLyBJZiB0aGUgdXNlciBpcyBob2xkaW5nIHNoaWZ0LCBjaGVjayBpZiB3ZSBjYW4gbXVsdGktc2VsZWN0IChzb21ldGhpbmcgaGFzIHRvIGJlIGFscmVhZHkgc2VsZWN0ZWQpXG4gICAgLy8gTm90ZTogdGhpcyBsb2dpYyBnZW5lcmFsbHkgbWF0Y2hlcyB0aGUgbG9naWMgaW4gdGhlIGlmcmFtZSBzbGljZSBvbiB0ZW1wby13ZWJcbiAgICBpZiAoZS5zaGlmdEtleSAmJiBjdXJyZW50U2VsZWN0ZWRFbGVtZW50S2V5KSB7XG4gICAgICAvLyBGaXJzdCBjaGVjayBpZiB3ZSBhcmUgZGVzZWxlY3RpbmdcbiAgICAgIGNvbnN0IGVsZW1lbnRUb0Rlc2VsZWN0ID0gY3VycmVudE11bHRpU2VsZWN0ZWRLZXlzXG4gICAgICAgIC5tYXAoKGVsZW1lbnRLZXk6IHN0cmluZykgPT4gVGVtcG9FbGVtZW50LmZyb21LZXkoZWxlbWVudEtleSkpXG4gICAgICAgIC5maW5kKChlbGVtZW50OiBUZW1wb0VsZW1lbnQpID0+IHtcbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgZWxlbWVudC5pc1BhcmVudE9mKG5ld1NlbGVjdGVkRWxlbWVudCkgfHxcbiAgICAgICAgICAgIGVsZW1lbnQuaXNFcXVhbChuZXdTZWxlY3RlZEVsZW1lbnQpXG4gICAgICAgICAgKTtcbiAgICAgICAgfSk7XG5cbiAgICAgIGlmIChlbGVtZW50VG9EZXNlbGVjdCkge1xuICAgICAgICBuZXdNdWx0aVNlbGVjdEtleXMgPSBjdXJyZW50TXVsdGlTZWxlY3RlZEtleXMuZmlsdGVyKFxuICAgICAgICAgIChlbGVtZW50S2V5OiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50S2V5ICE9PSBlbGVtZW50VG9EZXNlbGVjdC5nZXRLZXkoKTtcbiAgICAgICAgICB9LFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIFBpY2sgYSBuZXcgZWxlbWVudCB0byBiZSB0aGUgbWFpbiBzZWxlY3RlZCBlbGVtZW50XG4gICAgICAgIC8vIE5vdGUsIGlmIHRoZSBsZW5ndGggaXMgMSwgdGhlcmUgaXMgbG9naWMgZnVydGhlciBkb3duIHRvIGhhbmRsZSB0aGF0IGNhc2UgZXhwbGljaXRseSAodG8gZXhpdCBtdWx0aXNlbGVjdCBtb2RlKVxuICAgICAgICBpZiAoXG4gICAgICAgICAgZWxlbWVudFRvRGVzZWxlY3QuaXNFcXVhbChjdXJyZW50U2VsZWN0ZWRFbGVtZW50KSAmJlxuICAgICAgICAgIG5ld011bHRpU2VsZWN0S2V5cy5sZW5ndGggPiAxXG4gICAgICAgICkge1xuICAgICAgICAgIHBhcmVudFBvcnQucG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgICAgaWQ6IEZJWEVEX0lGUkFNRV9NRVNTQUdFX0lEUy5TRUxFQ1RFRF9FTEVNRU5UX0tFWSxcbiAgICAgICAgICAgIGVsZW1lbnRLZXk6IG5ld011bHRpU2VsZWN0S2V5c1swXSxcbiAgICAgICAgICAgIG91dGVySFRNTDogJChgLiR7RUxFTUVOVF9LRVlfUFJFRklYfSR7bmV3TXVsdGlTZWxlY3RLZXlzWzBdfWApLmdldChcbiAgICAgICAgICAgICAgMCxcbiAgICAgICAgICAgICk/Lm91dGVySFRNTCxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBzZXRNZW1vcnlTdG9yYWdlSXRlbShTRUxFQ1RFRF9FTEVNRU5UX0tFWSwgbmV3TXVsdGlTZWxlY3RLZXlzWzBdKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBDaGVjayBpZiB3ZSBjYW4gYWRkIHRoaXMgZWxlbWVudFxuICAgICAgfSBlbHNlIGlmIChjdXJyZW50U2VsZWN0ZWRFbGVtZW50LmlzU2libGluZ09mKG5ld1NlbGVjdGVkRWxlbWVudCkpIHtcbiAgICAgICAgaWYgKGN1cnJlbnRNdWx0aVNlbGVjdGVkS2V5cz8ubGVuZ3RoKSB7XG4gICAgICAgICAgbmV3TXVsdGlTZWxlY3RLZXlzID0gY3VycmVudE11bHRpU2VsZWN0ZWRLZXlzLmNvbmNhdChbXG4gICAgICAgICAgICBuZXdTZWxlY3RlZEVsZW1lbnQuZ2V0S2V5KCksXG4gICAgICAgICAgXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbmV3TXVsdGlTZWxlY3RLZXlzID0gW1xuICAgICAgICAgICAgY3VycmVudFNlbGVjdGVkRWxlbWVudEtleSxcbiAgICAgICAgICAgIG5ld1NlbGVjdGVkRWxlbWVudC5nZXRLZXkoKSxcbiAgICAgICAgICBdO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBUaGlzIGNhc2UgdGhlIHVzZXIgaXMgdHJ5aW5nIHRvIG11bHRpc2VsZWN0IGJ1dCBpdCdzIG5vdCBzb21ldGhpbmcgdGhhdCdzIGFsbG93ZWQsIGp1c3QgcmV0dXJuIGJ1dCBkb24ndCBtYWtlIGFueSBjaGFuZ2VzXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEluIG11bHRpc2VsZWN0IG1vZGUsIHNldCB0aGUgbmVjZXNzYXJ5IHZhbHVlc1xuICAgIGlmIChuZXdNdWx0aVNlbGVjdEtleXMubGVuZ3RoID4gMSkge1xuICAgICAgcGFyZW50UG9ydC5wb3N0TWVzc2FnZSh7XG4gICAgICAgIGlkOiBGSVhFRF9JRlJBTUVfTUVTU0FHRV9JRFMuTVVMVElfU0VMRUNURURfRUxFTUVOVF9LRVlTLFxuICAgICAgICBlbGVtZW50S2V5czogbmV3TXVsdGlTZWxlY3RLZXlzLFxuICAgICAgICBvdXRlckhUTUxzOiBuZXdNdWx0aVNlbGVjdEtleXM/Lm1hcChcbiAgICAgICAgICAoZWxlbWVudEtleSkgPT5cbiAgICAgICAgICAgICQoYC4ke0VMRU1FTlRfS0VZX1BSRUZJWH0ke2VsZW1lbnRLZXl9YCkuZ2V0KDApPy5vdXRlckhUTUwsXG4gICAgICAgICksXG4gICAgICB9KTtcbiAgICAgIHNldE1lbW9yeVN0b3JhZ2VJdGVtKE1VTFRJX1NFTEVDVEVEX0VMRU1FTlRfS0VZUywgbmV3TXVsdGlTZWxlY3RLZXlzKTtcbiAgICAgIHVwZGF0ZU91dGxpbmVzKHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG5cbiAgICAgIHRlYXJkb3duRWRpdGFibGVUZXh0KHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG4gICAgICByZXR1cm4gbnVsbDsgLy8gQ2Fubm90IHBlcmZvcm0gcmVndWxhciBhY3Rpb25zIG9uIGFueSBwYXJ0aWN1bGFyIG5vZGVcbiAgICB9XG5cbiAgICAvLyBTcGVjaWFsIGNhc2UgLSBtdWx0aXNlbGVjdGluZyBidXQgZGVzZWxlY3RpbmcgZG93biB0byAxLCBzdG9wIHRoZSBtdWx0aXNlbGVjdCBtb2RlXG4gICAgaWYgKG5ld011bHRpU2VsZWN0S2V5cy5sZW5ndGggPT09IDEpIHtcbiAgICAgIG5ld1NlbGVjdGVkRWxlbWVudCA9IFRlbXBvRWxlbWVudC5mcm9tS2V5KG5ld011bHRpU2VsZWN0S2V5c1swXSk7XG4gICAgfVxuXG4gICAgY29uc3QgY2xlYXJNdWx0aVNlbGVjdFN0YXRlID0gKCkgPT4ge1xuICAgICAgLy8gTm90IG11bHRpLXNlbGVjdGluZywgc28gY2xlYXIgdGhlIG11bHRpc2VsZWN0IHN0YXRlXG4gICAgICAvLyBXYW50IHRvIGRvIHRoaXMgYWZ0ZXIgc2V0dGluZyB0aGUgc2VsZWN0ZWQgZWxlbWVudCB0byBwcmV2ZW50IGZsYXNoaW5nXG4gICAgICBwYXJlbnRQb3J0LnBvc3RNZXNzYWdlKHtcbiAgICAgICAgaWQ6IEZJWEVEX0lGUkFNRV9NRVNTQUdFX0lEUy5NVUxUSV9TRUxFQ1RFRF9FTEVNRU5UX0tFWVMsXG4gICAgICAgIGVsZW1lbnRLZXlzOiBbXSxcbiAgICAgICAgb3V0ZXJIVE1MczogW10sXG4gICAgICB9KTtcbiAgICAgIHNldE1lbW9yeVN0b3JhZ2VJdGVtKE1VTFRJX1NFTEVDVEVEX0VMRU1FTlRfS0VZUywgbnVsbCk7XG4gICAgfTtcblxuICAgIC8vIFNlbGVjdGluZyB0aGUgc3Rvcnlib2FyZCBmcm9tIHdpdGhpblxuICAgIGlmIChuZXdTZWxlY3RlZEVsZW1lbnQuaXNTdG9yeWJvYXJkKCkpIHtcbiAgICAgIGlmIChuZXdTZWxlY3RlZEVsZW1lbnQuZ2V0S2V5KCkgIT09IGN1cnJlbnRTZWxlY3RlZEVsZW1lbnRLZXkpIHtcbiAgICAgICAgcGFyZW50UG9ydC5wb3N0TWVzc2FnZSh7XG4gICAgICAgICAgaWQ6IEZJWEVEX0lGUkFNRV9NRVNTQUdFX0lEUy5TRUxFQ1RFRF9FTEVNRU5UX0tFWSxcbiAgICAgICAgICBlbGVtZW50S2V5OiBuZXdTZWxlY3RlZEVsZW1lbnQuZ2V0S2V5KCksXG4gICAgICAgICAgb3V0ZXJIVE1MOiAkKFxuICAgICAgICAgICAgYC4ke0VMRU1FTlRfS0VZX1BSRUZJWH0ke25ld1NlbGVjdGVkRWxlbWVudC5nZXRLZXkoKX1gLFxuICAgICAgICAgICkuZ2V0KDApPy5vdXRlckhUTUwsXG4gICAgICAgIH0pO1xuICAgICAgICBzZXRNZW1vcnlTdG9yYWdlSXRlbShTRUxFQ1RFRF9FTEVNRU5UX0tFWSwgbmV3U2VsZWN0ZWRFbGVtZW50LmdldEtleSgpKTtcblxuICAgICAgICB1cGRhdGVPdXRsaW5lcyhwYXJlbnRQb3J0LCBzdG9yeWJvYXJkSWQpO1xuICAgICAgfVxuXG4gICAgICB0ZWFyZG93bkVkaXRhYmxlVGV4dChwYXJlbnRQb3J0LCBzdG9yeWJvYXJkSWQpO1xuICAgICAgY2xlYXJNdWx0aVNlbGVjdFN0YXRlKCk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBpZiAoY3VycmVudGx5RWRpdGluZygpKSB7XG4gICAgICBjb25zdCBlZGl0aW5nSW5mbyA9IGdldEVkaXRpbmdJbmZvKCk7XG5cbiAgICAgIGlmIChlZGl0aW5nSW5mbz8ua2V5ICE9PSBjdXJyZW50U2VsZWN0ZWRFbGVtZW50S2V5KSB7XG4gICAgICAgIHRlYXJkb3duRWRpdGFibGVUZXh0KHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG4gICAgICB9XG5cbiAgICAgIGNsZWFyTXVsdGlTZWxlY3RTdGF0ZSgpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICBpZiAoXG4gICAgICBjYW5FZGl0VGV4dChuZXdTZWxlY3RlZEVsZW1lbnQpICYmXG4gICAgICBuZXdTZWxlY3RlZEVsZW1lbnQuZ2V0S2V5KCkgPT09IGN1cnJlbnRTZWxlY3RlZEVsZW1lbnRLZXlcbiAgICApIHtcbiAgICAgIHNldHVwRWRpdGFibGVUZXh0KG5ld1NlbGVjdGVkRWxlbWVudCwgcGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgICB9XG5cbiAgICBpZiAobmV3U2VsZWN0ZWRFbGVtZW50LmdldEtleSgpID09PSBjdXJyZW50U2VsZWN0ZWRFbGVtZW50S2V5KSB7XG4gICAgICBjbGVhck11bHRpU2VsZWN0U3RhdGUoKTtcbiAgICAgIHJldHVybiBzZWxlY3RlZE5hdk5vZGUgYXMgTmF2VHJlZU5vZGU7XG4gICAgfVxuXG4gICAgcGFyZW50UG9ydC5wb3N0TWVzc2FnZSh7XG4gICAgICBpZDogRklYRURfSUZSQU1FX01FU1NBR0VfSURTLlNFTEVDVEVEX0VMRU1FTlRfS0VZLFxuICAgICAgZWxlbWVudEtleTogbmV3U2VsZWN0ZWRFbGVtZW50LmdldEtleSgpLFxuICAgICAgb3V0ZXJIVE1MOiAkKGAuJHtFTEVNRU5UX0tFWV9QUkVGSVh9JHtuZXdTZWxlY3RlZEVsZW1lbnQuZ2V0S2V5KCl9YCkuZ2V0KFxuICAgICAgICAwLFxuICAgICAgKT8ub3V0ZXJIVE1MLFxuICAgIH0pO1xuICAgIHNldE1lbW9yeVN0b3JhZ2VJdGVtKFNFTEVDVEVEX0VMRU1FTlRfS0VZLCBuZXdTZWxlY3RlZEVsZW1lbnQuZ2V0S2V5KCkpO1xuICAgIHVwZGF0ZU91dGxpbmVzKHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG4gICAgY2xlYXJNdWx0aVNlbGVjdFN0YXRlKCk7XG4gICAgcmV0dXJuIHNlbGVjdGVkTmF2Tm9kZSBhcyBOYXZUcmVlTm9kZTtcbiAgfTtcblxuICAvKipcbiAgICogUmV0dXJucyBpZiBldmVudHMgd2VyZSBwYXNzZWQgdGhyb3VnaFxuICAgKi9cbiAgY29uc3QgcGFzc1Rocm91Z2hFdmVudHNJZk5lZWRlZCA9IChcbiAgICBlOiBhbnksXG4gICAgcGFyZW50UG9ydDogYW55LFxuICAgIHN0b3J5Ym9hcmRJZDogc3RyaW5nLFxuICApOiBib29sZWFuID0+IHtcbiAgICBjb25zdCBkcml2ZU1vZGVFbmFibGVkID0gISFnZXRTZXNzaW9uU3RvcmFnZUl0ZW0oXG4gICAgICAnZHJpdmVNb2RlRW5hYmxlZCcsXG4gICAgICBzdG9yeWJvYXJkSWQsXG4gICAgKTtcbiAgICBjb25zdCBlZGl0aW5nVGV4dEluZm8gPSBnZXRFZGl0aW5nSW5mbygpO1xuXG4gICAgaWYgKGRyaXZlTW9kZUVuYWJsZWQgfHwgZWRpdGluZ1RleHRJbmZvKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBlPy5wcmV2ZW50RGVmYXVsdD8uKCk7XG4gICAgZT8uc3RvcFByb3BhZ2F0aW9uPy4oKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgY29uc3Qgb25DbGlja0VsZW1lbnRDb250ZXh0TWVudSA9IChcbiAgICBlOiBhbnksXG4gICAgcGFyZW50UG9ydDogYW55LFxuICAgIHN0b3J5Ym9hcmRJZDogc3RyaW5nLFxuICApID0+IHtcbiAgICBjb25zdCBwYXNzZWRUaHJvdWdoID0gcGFzc1Rocm91Z2hFdmVudHNJZk5lZWRlZChcbiAgICAgIGUsXG4gICAgICBwYXJlbnRQb3J0LFxuICAgICAgc3Rvcnlib2FyZElkLFxuICAgICk7XG4gICAgaWYgKHBhc3NlZFRocm91Z2gpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgIC8vIE1vdXNlIGRvd24gaXMgY2FsbGVkIHdoZW4gYSB1c2VyIGNsaWNrcyB0aGUgY29udGV4dCBtZW51LCBidXQgbm90IG1vdXNlIHVwLCBzbyBjbGVhciB0aGUgbW91c2UgZG93blxuICAgIHNldE1lbW9yeVN0b3JhZ2VJdGVtKCdtb3VzZURyYWdDb250ZXh0JywgbnVsbCk7XG5cbiAgICBjb25zdCBlbGVtZW50S2V5VG9OYXZOb2RlID1cbiAgICAgIGdldE1lbW9yeVN0b3JhZ2VJdGVtKEVMRU1FTlRfS0VZX1RPX05BVl9OT0RFKSB8fCB7fTtcblxuICAgIGxldCByZXF1ZXN0ZWROYXZOb2RlOiBOYXZUcmVlTm9kZSB8IG51bGwgfCBzdHJpbmc7XG4gICAgaWYgKGUubWV0YUtleSB8fCBlLmN0cmxLZXkpIHtcbiAgICAgIGNvbnN0IGVsZW1lbnRLZXk6IGFueSA9IGdldEVsZW1lbnRLZXlGcm9tTm9kZShlLnRhcmdldCk7XG4gICAgICByZXF1ZXN0ZWROYXZOb2RlID0gZWxlbWVudEtleVRvTmF2Tm9kZVtlbGVtZW50S2V5XTtcblxuICAgICAgLy8gU3BlY2lhbCBjYXNlIC0+IHRoaXMgaXMgdGhlIHRvcC1tb3N0IG5vZGUgc28gaXQgc2hvdWxkIHRyaWdnZXIgYSBjb250ZXh0IG1lbnUgb24gdGhlIHN0b3J5Ym9hcmRcbiAgICAgIGlmICghcmVxdWVzdGVkTmF2Tm9kZSAmJiBlLnRhcmdldC5wYXJlbnROb2RlID09PSBkb2N1bWVudC5ib2R5KSB7XG4gICAgICAgIHJlcXVlc3RlZE5hdk5vZGUgPSBTRUxFQ1RfT1JfSE9WRVJfU1RPUllCT0FSRDtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmVxdWVzdGVkTmF2Tm9kZSA9IGdldFNlbGVjdGFibGVOYXZOb2RlKGUpO1xuICAgIH1cblxuICAgIGNvbnN0IGN1cnJlbnRTZWxlY3RlZEVsZW1lbnRLZXkgPVxuICAgICAgZ2V0TWVtb3J5U3RvcmFnZUl0ZW0oU0VMRUNURURfRUxFTUVOVF9LRVkpO1xuICAgIGNvbnN0IGN1cnJlbnRNdWx0aVNlbGVjdGVkS2V5cyA9IGdldE1lbW9yeVN0b3JhZ2VJdGVtKFxuICAgICAgTVVMVElfU0VMRUNURURfRUxFTUVOVF9LRVlTLFxuICAgICk7XG5cbiAgICBpZiAoIXJlcXVlc3RlZE5hdk5vZGUgfHwgdHlwZW9mIHJlcXVlc3RlZE5hdk5vZGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICBpZiAoXG4gICAgICAgIHJlcXVlc3RlZE5hdk5vZGUgPT09IFNFTEVDVF9PUl9IT1ZFUl9TVE9SWUJPQVJEICYmXG4gICAgICAgICFjdXJyZW50TXVsdGlTZWxlY3RlZEtleXM/Lmxlbmd0aFxuICAgICAgKSB7XG4gICAgICAgIGNvbnN0IHN0b3J5Ym9hcmRLZXkgPSBUZW1wb0VsZW1lbnQuZm9yU3Rvcnlib2FyZChzdG9yeWJvYXJkSWQpLmdldEtleSgpO1xuXG4gICAgICAgIGlmIChjdXJyZW50U2VsZWN0ZWRFbGVtZW50S2V5ID09PSBzdG9yeWJvYXJkS2V5KSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgcGFyZW50UG9ydC5wb3N0TWVzc2FnZSh7XG4gICAgICAgICAgaWQ6IEZJWEVEX0lGUkFNRV9NRVNTQUdFX0lEUy5TRUxFQ1RFRF9FTEVNRU5UX0tFWSxcbiAgICAgICAgICBlbGVtZW50S2V5OiBzdG9yeWJvYXJkS2V5LFxuICAgICAgICB9KTtcbiAgICAgICAgc2V0TWVtb3J5U3RvcmFnZUl0ZW0oU0VMRUNURURfRUxFTUVOVF9LRVksIHN0b3J5Ym9hcmRLZXkpO1xuXG4gICAgICAgIHVwZGF0ZU91dGxpbmVzKHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IGNvbnRleHRSZXF1ZXN0ZWRFbGVtZW50S2V5OiBzdHJpbmcgfCBudWxsID0gbnVsbDtcblxuICAgIGNvbnN0IHNlbGVjdGVkRWxlbWVudEtleSA9IGdldE1lbW9yeVN0b3JhZ2VJdGVtKFNFTEVDVEVEX0VMRU1FTlRfS0VZKTtcbiAgICBjb25zdCBzZWxlY3RlZEVsZW1lbnQgPSBUZW1wb0VsZW1lbnQuZnJvbUtleShzZWxlY3RlZEVsZW1lbnRLZXkpO1xuXG4gICAgLy8gRG9uJ3Qgc2VsZWN0IGFueSBjaGlsZHJlbiBhcyB0aGUgdXNlciBtaWdodCBiZSByaWdodCBjbGlja2luZyBhIG5vZGUgdGhleSBzZWxlY3RlZFxuICAgIGlmIChcbiAgICAgICFyZXF1ZXN0ZWROYXZOb2RlLnRlbXBvRWxlbWVudC5pc0VxdWFsKHNlbGVjdGVkRWxlbWVudCkgJiZcbiAgICAgICFzZWxlY3RlZEVsZW1lbnQuaXNQYXJlbnRPZihyZXF1ZXN0ZWROYXZOb2RlLnRlbXBvRWxlbWVudCkgJiZcbiAgICAgICFjdXJyZW50TXVsdGlTZWxlY3RlZEtleXM/Lmxlbmd0aCAvLyBBbHNvIGRvbid0IHNlbGVjdCBhbnl0aGluZyBuZXcgaWYgaW4gbXVsdGlzZWxlY3QgbW9kZVxuICAgICkge1xuICAgICAgY29udGV4dFJlcXVlc3RlZEVsZW1lbnRLZXkgPSByZXF1ZXN0ZWROYXZOb2RlLnRlbXBvRWxlbWVudC5nZXRLZXkoKTtcblxuICAgICAgcGFyZW50UG9ydC5wb3N0TWVzc2FnZSh7XG4gICAgICAgIGlkOiBGSVhFRF9JRlJBTUVfTUVTU0FHRV9JRFMuU0VMRUNURURfRUxFTUVOVF9LRVksXG4gICAgICAgIGVsZW1lbnRLZXk6IGNvbnRleHRSZXF1ZXN0ZWRFbGVtZW50S2V5LFxuICAgICAgICBvdXRlckhUTUw6ICQoYC4ke0VMRU1FTlRfS0VZX1BSRUZJWH0ke2NvbnRleHRSZXF1ZXN0ZWRFbGVtZW50S2V5fWApLmdldChcbiAgICAgICAgICAwLFxuICAgICAgICApPy5vdXRlckhUTUwsXG4gICAgICB9KTtcbiAgICAgIHNldE1lbW9yeVN0b3JhZ2VJdGVtKFNFTEVDVEVEX0VMRU1FTlRfS0VZLCBjb250ZXh0UmVxdWVzdGVkRWxlbWVudEtleSk7XG4gICAgICB1cGRhdGVPdXRsaW5lcyhwYXJlbnRQb3J0LCBzdG9yeWJvYXJkSWQpO1xuICAgIH1cblxuICAgIGNvbnN0IGltcG9ydGFudEZpZWxkcyA9IHtcbiAgICAgIGNsaWVudFg6IGUuY2xpZW50WCxcbiAgICAgIGNsaWVudFk6IGUuY2xpZW50WSxcbiAgICB9O1xuXG4gICAgcGFyZW50UG9ydC5wb3N0TWVzc2FnZSh7XG4gICAgICBpZDogRklYRURfSUZSQU1FX01FU1NBR0VfSURTLkNPTlRFWFRfUkVRVUVTVEVELFxuICAgICAgZXZlbnQ6IGltcG9ydGFudEZpZWxkcyxcbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCBidWlsZEFuZFNlbmROYXZUcmVlID0gKFxuICAgIHBhcmVudFBvcnQ6IGFueSxcbiAgICBzdG9yeWJvYXJkSWQ6IHN0cmluZyxcbiAgICB0cmVlRWxlbWVudExvb2t1cD86IGFueSxcbiAgICBzY29wZUxvb2t1cD86IGFueSxcbiAgICBzdG9yeWJvYXJkQ29tcG9uZW50RWxlbWVudD86IGFueSxcbiAgKSA9PiB7XG4gICAgbGV0IHRyZWVFbGVtZW50cyA9IHRyZWVFbGVtZW50TG9va3VwO1xuICAgIGlmICghdHJlZUVsZW1lbnRzKSB7XG4gICAgICB0cmVlRWxlbWVudHMgPSBnZXRNZW1vcnlTdG9yYWdlSXRlbShUUkVFX0VMRU1FTlRfTE9PS1VQKSB8fCB7fTtcbiAgICB9XG5cbiAgICBsZXQgc2NvcGVzID0gc2NvcGVMb29rdXA7XG4gICAgaWYgKCFzY29wZXMpIHtcbiAgICAgIHNjb3BlcyA9IGdldE1lbW9yeVN0b3JhZ2VJdGVtKFNDT1BFX0xPT0tVUCkgfHwge307XG4gICAgfVxuXG4gICAgbGV0IHN0b3J5Ym9hcmRDb21wb25lbnQgPSBzdG9yeWJvYXJkQ29tcG9uZW50RWxlbWVudDtcbiAgICBpZiAoc3Rvcnlib2FyZENvbXBvbmVudEVsZW1lbnQgPT09ICdFWFBMSUNJVF9OT05FJykge1xuICAgICAgc3Rvcnlib2FyZENvbXBvbmVudCA9IG51bGw7XG4gICAgfSBlbHNlIGlmICghc3Rvcnlib2FyZENvbXBvbmVudCkge1xuICAgICAgc3Rvcnlib2FyZENvbXBvbmVudCA9IGdldE1lbW9yeVN0b3JhZ2VJdGVtKFNUT1JZQk9BUkRfQ09NUE9ORU5UKSB8fCB7fTtcbiAgICB9XG5cbiAgICBjb25zdCByb290UmVhY3RFbGVtZW50ID0gZ2V0Um9vdFJlYWN0RWxlbWVudCgpO1xuXG4gICAgY29uc3QgcmVhY3RUcmVlID0gYnVpbGROb2RlVHJlZShyb290UmVhY3RFbGVtZW50LCBudWxsKTtcbiAgICBjb25zdCBsb29rdXBJZFRvUmVhY3RUcmVlTWFwID0ge307XG4gICAgYnVpbGRUcmVlTG9va3VwTWFwKHJlYWN0VHJlZSwgbG9va3VwSWRUb1JlYWN0VHJlZU1hcCk7XG5cbiAgICBjb25zdCBrbm93bkNvbXBvbmVudE5hbWVzID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgY29uc3Qga25vd25Db21wb25lbnRJbnN0YW5jZU5hbWVzID0gbmV3IFNldDxzdHJpbmc+KCk7XG5cbiAgICBpZiAodHJlZUVsZW1lbnRzKSB7XG4gICAgICBPYmplY3QudmFsdWVzKHRyZWVFbGVtZW50cykuZm9yRWFjaCgodHJlZUVsZW1lbnQ6IGFueSkgPT4ge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgdHJlZUVsZW1lbnQudHlwZSA9PT0gJ2NvbXBvbmVudCcgfHxcbiAgICAgICAgICB0cmVlRWxlbWVudC50eXBlID09PSAnc3Rvcnlib29rLWNvbXBvbmVudCdcbiAgICAgICAgKSB7XG4gICAgICAgICAga25vd25Db21wb25lbnROYW1lcy5hZGQodHJlZUVsZW1lbnQuY29tcG9uZW50TmFtZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHJlZUVsZW1lbnQudHlwZSA9PT0gJ2NvbXBvbmVudC1pbnN0YW5jZScpIHtcbiAgICAgICAgICBrbm93bkNvbXBvbmVudEluc3RhbmNlTmFtZXMuYWRkKHRyZWVFbGVtZW50LmNvbXBvbmVudE5hbWUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBlbGVtZW50S2V5VG9Mb29rdXBMaXN0ID0ge307XG4gICAgY29uc3QgZWxlbWVudEtleVRvTmF2Tm9kZSA9IHt9O1xuXG4gICAgY29uc3QgYnVpbHROYXZUcmVlID0gYnVpbGROYXZGb3JOb2RlKFxuICAgICAgc3Rvcnlib2FyZElkLFxuICAgICAgdW5kZWZpbmVkLFxuICAgICAgJCgnYm9keScpLmdldCgwKSxcbiAgICAgICcnLFxuICAgICAgJ3Jvb3QnLFxuICAgICAgc2NvcGVzLFxuICAgICAgdHJlZUVsZW1lbnRzLFxuICAgICAgbG9va3VwSWRUb1JlYWN0VHJlZU1hcCxcbiAgICAgIGtub3duQ29tcG9uZW50TmFtZXMsXG4gICAgICBrbm93bkNvbXBvbmVudEluc3RhbmNlTmFtZXMsXG4gICAgICBlbGVtZW50S2V5VG9Mb29rdXBMaXN0LFxuICAgICAgZWxlbWVudEtleVRvTmF2Tm9kZSxcbiAgICApO1xuXG4gICAgc2V0TWVtb3J5U3RvcmFnZUl0ZW0oRUxFTUVOVF9LRVlfVE9fTE9PS1VQX0xJU1QsIGVsZW1lbnRLZXlUb0xvb2t1cExpc3QpO1xuXG4gICAgc2V0TWVtb3J5U3RvcmFnZUl0ZW0oQ1VSUkVOVF9OQVZfVFJFRSwgYnVpbHROYXZUcmVlKTtcblxuICAgIHNldE1lbW9yeVN0b3JhZ2VJdGVtKEVMRU1FTlRfS0VZX1RPX05BVl9OT0RFLCBlbGVtZW50S2V5VG9OYXZOb2RlKTtcblxuICAgIGNsZWFyTG9va3Vwc0Zyb21UcmVlKHJlYWN0VHJlZSk7XG5cbiAgICBwYXJlbnRQb3J0LnBvc3RNZXNzYWdlKHtcbiAgICAgIGlkOiBGSVhFRF9JRlJBTUVfTUVTU0FHRV9JRFMuTkFWX1RSRUUsXG4gICAgICBuYXZUcmVlOiBidWlsdE5hdlRyZWUsXG4gICAgICBvdXRlckh0bWw6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vdXRlckhUTUwsXG4gICAgfSk7XG5cbiAgICAvLyBSdW4gY2FsbGJhY2tzXG4gICAgcnVuTmF2VHJlZUJ1aWx0Q2FsbGJhY2tzKCk7XG4gIH07XG5cbiAgY29uc3Qgb25GbHVzaFN0YXJ0ID0gKCkgPT4ge1xuICAgIC8vIEZpbmQgYWxsIGluc3RhbnQgdXBkYXRlIHN0eWxpbmcgY2xhc3NlcyB0byBkZWxldGVcbiAgICBjb25zdCBjbGFzc2VzVG9EZWxldGU6IHN0cmluZ1tdID0gW107XG4gICAgJChgKltjbGFzcyo9JHtURU1QT19JTlNUQU5UX1VQREFURV9TVFlMSU5HX1BSRUZJWH1dYCkuZWFjaCgoaSwgZWxlbWVudCkgPT4ge1xuICAgICAgY29uc3QgY2xhc3NlcyA9IChlbGVtZW50LmdldEF0dHJpYnV0ZSgnY2xhc3MnKSB8fCAnJykuc3BsaXQoJyAnKTtcbiAgICAgIGNsYXNzZXMuZm9yRWFjaCgoY2xhc3NOYW1lKSA9PiB7XG4gICAgICAgIGlmIChjbGFzc05hbWUuc3RhcnRzV2l0aChURU1QT19JTlNUQU5UX1VQREFURV9TVFlMSU5HX1BSRUZJWCkpIHtcbiAgICAgICAgICBjbGFzc2VzVG9EZWxldGUucHVzaChjbGFzc05hbWUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgICQoYCpbJHtURU1QT19ERUxFVEVfQUZURVJfUkVGUkVTSH09dHJ1ZV1gKS5hdHRyKFxuICAgICAgVEVNUE9fUVVFVUVfREVMRVRFX0FGVEVSX0hPVF9SRUxPQUQsXG4gICAgICAndHJ1ZScsXG4gICAgKTtcblxuICAgIC8vIENsZWFyIHRoZSBhZGQgY2xhc3MgaW5zdGFudCB1cGRhdGUgcXVldWUgYXMgdGhvc2UgaXRlbXMgd2lsbCBiZSBhcHBsaWVkIGluIHRoZSBob3QgcmVsb2FkXG4gICAgc2V0TWVtb3J5U3RvcmFnZUl0ZW0oQUREX0NMQVNTX0lOU1RBTlRfVVBEQVRFX1FVRVVFLCBbXSk7XG5cbiAgICBzZXRNZW1vcnlTdG9yYWdlSXRlbSgnUE9TVF9IT1RfUkVMT0FEX0NMRUFSJywge1xuICAgICAgY2xhc3Nlc1RvRGVsZXRlLFxuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IGNsZWFySW5zdGFudFVwZGF0ZXNBbmRTZW5kTmF2VHJlZSA9IChcbiAgICBwYXJlbnRQb3J0OiBhbnksXG4gICAgc3Rvcnlib2FyZElkOiBzdHJpbmcsXG4gICkgPT4ge1xuICAgIGdsb2JhbFVJVXBkYXRlUnVubmVyKCgpID0+IHtcbiAgICAgIHNldE1lbW9yeVN0b3JhZ2VJdGVtKExBU1RfTkFWX1RSRUVfUkVGUkVTSF9USU1FLCBuZXcgRGF0ZSgpKTtcblxuICAgICAgY29uc3QgeyBjbGFzc2VzVG9EZWxldGUgfSA9XG4gICAgICAgIGdldE1lbW9yeVN0b3JhZ2VJdGVtKCdQT1NUX0hPVF9SRUxPQURfQ0xFQVInKSB8fCB7fTtcblxuICAgICAgLy8gRGVsZXRlIGFsbCBpbnN0YW50IHVwZGF0ZSBjaGFuZ2VkIGVsZW1lbnRzXG4gICAgICAkKGAqWyR7VEVNUE9fUVVFVUVfREVMRVRFX0FGVEVSX0hPVF9SRUxPQUR9PXRydWVdYCkucmVtb3ZlKCk7XG5cbiAgICAgIC8vIENsZWFyIHRoZSBhZGRlZCBkaXNwbGF5IG5vbmVzXG4gICAgICAkKGAuJHtURU1QT19ESVNQTEFZX05PTkVfVU5USUxfUkVGUkVTSF9DTEFTU31gKS5yZW1vdmVDbGFzcyhcbiAgICAgICAgVEVNUE9fRElTUExBWV9OT05FX1VOVElMX1JFRlJFU0hfQ0xBU1MsXG4gICAgICApO1xuICAgICAgJChgKlske1RFTVBPX0lOU1RBTlRfVVBEQVRFfT10cnVlXWApLnJlbW92ZUF0dHIoVEVNUE9fSU5TVEFOVF9VUERBVEUpO1xuICAgICAgJChgKlske1RFTVBPX0RPX05PVF9TSE9XX0lOX05BVl9VTlRJTF9SRUZSRVNIfT10cnVlXWApLnJlbW92ZUF0dHIoXG4gICAgICAgIFRFTVBPX0RPX05PVF9TSE9XX0lOX05BVl9VTlRJTF9SRUZSRVNILFxuICAgICAgKTtcblxuICAgICAgJChgLiR7VEVNUE9SQVJZX1NUWUxJTkdfQ0xBU1NfTkFNRX1gKS5yZW1vdmVDbGFzcyhcbiAgICAgICAgVEVNUE9SQVJZX1NUWUxJTkdfQ0xBU1NfTkFNRSxcbiAgICAgICk7XG5cbiAgICAgIC8vIEFueSBjbGFzc2VzIG1hcmtlZCB0byBkZWxldGUgYmVmb3JlIHRoZSBob3QgcmVsb2FkXG4gICAgICBjbGFzc2VzVG9EZWxldGU/LmZvckVhY2goKGNsczogc3RyaW5nKSA9PiB7XG4gICAgICAgICQoYC4ke2Nsc31gKS5yZW1vdmVDbGFzcyhjbHMpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IG5ld0FkZENsYXNzUXVldWUgPVxuICAgICAgICBnZXRNZW1vcnlTdG9yYWdlSXRlbShBRERfQ0xBU1NfSU5TVEFOVF9VUERBVEVfUVVFVUUpIHx8IFtdO1xuXG4gICAgICAvLyBBbnkgYXR0cmlidXRlcyB0aGF0IHN0YXJ0IHdpdGggdGhlIHN0eWxpbmcgcHJlZml4IGxlZnRvdmVyIG1lYW4gdGhhdCB0aGUgY2xhc3MgbmVlZHMgdG8gYmUgcmUtYXBwbGllZFxuICAgICAgLy8gdGhlc2UgYXJlIGNsYXNzZXMgdGhhdCB3ZXJlIGFkZGVkIGluIGluc3RhbnQgdXBkYXRlcyB3aGlsZSB0aGUgaG90IHJlbG9hZCB3YXMgaW4gcHJvZ3Jlc3NcbiAgICAgIG5ld0FkZENsYXNzUXVldWUuZm9yRWFjaCgoaXRlbTogYW55KSA9PiB7XG4gICAgICAgIGlmICghaXRlbSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHsgY29kZWJhc2VJZCwgY2xhc3NOYW1lIH0gPSBpdGVtO1xuICAgICAgICBpZiAoY29kZWJhc2VJZCAmJiBjbGFzc05hbWUpIHtcbiAgICAgICAgICAkKGAuJHtjb2RlYmFzZUlkfWApLmF0dHIoVEVNUE9fSU5TVEFOVF9VUERBVEUsICd0cnVlJyk7XG5cbiAgICAgICAgICAkKGAuJHtjb2RlYmFzZUlkfWApLmFkZENsYXNzKGNsYXNzTmFtZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gUmVidWlsZCB0aGUgbmF2IHRyZWUgb24gRE9NIGNoYW5nZWQgYWZ0ZXIgc29tZSB0aW1lIGhhcyBwYXNzZWRcbiAgICAvLyB0aGlzIGdpdmVzIHRoZSByZWFjdCBmaWJlciB0aW1lIHRvIGJlIGZ1bGx5IHJlY29uY2lsZWRcbiAgICB0cnkge1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGdsb2JhbFVJVXBkYXRlUnVubmVyKCgpID0+IHtcbiAgICAgICAgICBidWlsZEFuZFNlbmROYXZUcmVlKHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG4gICAgICAgICAgdXBkYXRlT3V0bGluZXMocGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgICAgICAgfSk7XG4gICAgICB9LCAzMDApO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0VSUk9SOiBDb3VsZCBub3QgcmUtY3JlYXRlIG5hdiB0cmVlIG9uIERPTSBjaGFuZ2UsICcgKyBlKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3Qgb25ET01DaGFuZ2VkID0gKHtcbiAgICBtdXRhdGlvbnMsXG4gICAgcGFyZW50UG9ydCxcbiAgICBzdG9yeWJvYXJkSWQsXG4gICAgZnJvbU5leHRKc0xvYWRlcixcbiAgfToge1xuICAgIG11dGF0aW9uczogYW55W107XG4gICAgcGFyZW50UG9ydDogYW55O1xuICAgIHN0b3J5Ym9hcmRJZDogc3RyaW5nO1xuXG4gICAgLy8gSWYgc2V0IHRvIHRydWUgdGhpcyBpcyBjYWxsZWQgZnJvbSB0aGUgc2hhZG93IHJvb3QgZm9yIHRoZSBuZXh0anMgYnVpbGQgd2F0Y2hlciAodGhlIHNwaW5uaW5nIHRyaWFuZ2xlKVxuICAgIGZyb21OZXh0SnNMb2FkZXI/OiBib29sZWFuO1xuICB9KSA9PiB7XG4gICAgLy8gVWRwYXRlIHRoZSBocmVmIGluIHRoZSBwYXJlbnQgY29udGFpbmVyXG4gICAgaWYgKGdldE1lbW9yeVN0b3JhZ2VJdGVtKCdocmVmJykgIT09IHdpbmRvdy5sb2NhdGlvbi5ocmVmKSB7XG4gICAgICBwYXJlbnRQb3J0LnBvc3RNZXNzYWdlKHtcbiAgICAgICAgaWQ6IEZJWEVEX0lGUkFNRV9NRVNTQUdFX0lEUy5MQVRFU1RfSFJFRixcbiAgICAgICAgaHJlZjogd2luZG93LmxvY2F0aW9uLmhyZWYsXG4gICAgICB9KTtcbiAgICAgIHNldE1lbW9yeVN0b3JhZ2VJdGVtKCdocmVmJywgd2luZG93LmxvY2F0aW9uLmhyZWYpO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGlmIHdlIHNob3VsZCByZWZyZXNoIHRoZSBuYXYgdHJlZVxuICAgIGxldCByZWZyZXNoTmF2VHJlZSA9IGZhbHNlO1xuICAgIGlmIChmcm9tTmV4dEpzTG9hZGVyKSB7XG4gICAgICAvLyBGcm9tIHRoZSBuZXh0anMgbG9hZGVyLCByZWZyZXNoIHdoZW4gdGhlIGxvYWRlciBnZXRzIGhpZGRlbiAobWVhbnMgcmVmcmVzaCBpcyBkb25lKVxuICAgICAgY29uc3QgbXV0YXRpb25UYXJnZXQgPSBtdXRhdGlvbnM/LlswXT8udGFyZ2V0O1xuICAgICAgaWYgKG11dGF0aW9uVGFyZ2V0ICYmIG11dGF0aW9uVGFyZ2V0LmlkID09PSAnY29udGFpbmVyJykge1xuICAgICAgICBjb25zdCBjdXJyZW50bHlIb3RSZWxvYWRpbmcgPSBnZXRNZW1vcnlTdG9yYWdlSXRlbShIT1RfUkVMT0FESU5HKTtcblxuICAgICAgICBpZiAobXV0YXRpb25UYXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCd2aXNpYmxlJykpIHtcbiAgICAgICAgICBzZXRNZW1vcnlTdG9yYWdlSXRlbShIT1RfUkVMT0FESU5HLCB0cnVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzZXRNZW1vcnlTdG9yYWdlSXRlbShIT1RfUkVMT0FESU5HLCBmYWxzZSk7XG4gICAgICAgICAgcmVmcmVzaE5hdlRyZWUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIG11dGF0aW9ucy5mb3JFYWNoKChlOiBhbnkpID0+IHtcbiAgICAgICAgaWYgKHJlZnJlc2hOYXZUcmVlKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSWYgdGhlIGNsYXNzIGF0dHJpYnV0ZSBoYXMgY2hhbmdlZCBvbiBhbiBlbGVtZW50IHdlIGhhdmUgdG8gcmVwYXJzZSB0aGUgbmF2IHRyZWUgdG8gYWRkIHRoZSBlbGVtZW50IGtleVxuICAgICAgICBpZiAoXG4gICAgICAgICAgZS50eXBlID09PSAnYXR0cmlidXRlcycgJiZcbiAgICAgICAgICBlLmF0dHJpYnV0ZU5hbWUgPT09ICdjbGFzcycgJiZcbiAgICAgICAgICBlLnRhcmdldCAmJlxuICAgICAgICAgICFpc05vZGVPdXRsaW5lKGUudGFyZ2V0KSAmJlxuICAgICAgICAgICFpc01vdmluZ0VsZW1lbnQoZS50YXJnZXQpICYmXG4gICAgICAgICAgLy8gQW5kIG5vdCBhIHNjcmlwdFxuICAgICAgICAgIC8vIEJ1ZyBmb3VuZCBvbiBPY3QgOCwgMjAyNCwgZm9yIHNvbWUgcmVhc29uIHRoZSBzY3JpcHQga2VwdCB0cmlnZ2VyaW5nIGEgcmVsb2FkXG4gICAgICAgICAgIWUudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnc2NyaXB0JylcbiAgICAgICAgKSB7XG4gICAgICAgICAgY29uc3QgZWxlbWVudEtleSA9IGdldEVsZW1lbnRLZXlGcm9tTm9kZShlLnRhcmdldCk7XG4gICAgICAgICAgY29uc3QgdW5pcXVlTG9va3VwID0gZ2V0VW5pcXVlTG9va3VwRnJvbU5vZGUoZS50YXJnZXQpO1xuICAgICAgICAgIC8vIEFuIGVsZW1lbnQgd2hpY2ggZG9lc24ndCBoYXZlIGFuIGVsZW1lbnQga2V5IGhhcyBjaGFuZ2VkXG4gICAgICAgICAgaWYgKCFlbGVtZW50S2V5ICYmICF1bmlxdWVMb29rdXAgJiYgIWlzRWxlbWVudEluU3ZnKGUudGFyZ2V0KSkge1xuICAgICAgICAgICAgcmVmcmVzaE5hdlRyZWUgPSB0cnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIFtlLmFkZGVkTm9kZXMsIGUucmVtb3ZlZE5vZGVzXS5mb3JFYWNoKChub2RlTGlzdCkgPT4ge1xuICAgICAgICAgIGlmIChyZWZyZXNoTmF2VHJlZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICghbm9kZUxpc3QpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBub2RlTGlzdC5mb3JFYWNoKChub2RlOiBhbnkpID0+IHtcbiAgICAgICAgICAgIGlmICghaXNOb2RlT3V0bGluZShub2RlKSAmJiAhaXNNb3ZpbmdFbGVtZW50KG5vZGUpKSB7XG4gICAgICAgICAgICAgIHJlZnJlc2hOYXZUcmVlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmICghcmVmcmVzaE5hdlRyZWUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBJbiB0aGVzZSBjYXNlcyB3ZSBkb24ndCB3YW50IHRvIHRyaWdnZXIgYSBuYXYgdHJlZSByZWZyZXNoIHJpZ2h0IGF3YXlcbiAgICAvLyBzaW5jZSB0aGUgaG90IHJlbG9hZCBtYXkgbm90IGhhdmUgaGFwcGVuZWQgeWV0LiBTbyB3ZSBzZXQgYSB0aW1lb3V0IGFuZCBvbmx5XG4gICAgLy8gdHJpZ2dlciBhIG5hdiB0cmVlIHJlZnJlc2ggaWYgYW5vdGhlciBvbmUgaGFzbid0IGhhcHBlbmVkIGluIGJldHdlZW5cbiAgICBpZiAoZnJvbU5leHRKc0xvYWRlcikge1xuICAgICAgY29uc3QgdHJpZ2dlclRpbWUgPSBuZXcgRGF0ZSgpO1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGNvbnN0IGxhc3RSZWZyZXNoVGltZSA9IGdldE1lbW9yeVN0b3JhZ2VJdGVtKFxuICAgICAgICAgIExBU1RfTkFWX1RSRUVfUkVGUkVTSF9USU1FLFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIERvbid0IHJlLWNsZWFyIGFuZCBzZW5kIGlmIGFub3RoZXIgcmVmcmVzaCBoYXMgaGFwcGVuZWQgaW4gdGhlIG1lYW50aW1lXG4gICAgICAgIGlmICghbGFzdFJlZnJlc2hUaW1lIHx8IGxhc3RSZWZyZXNoVGltZSA8IHRyaWdnZXJUaW1lKSB7XG4gICAgICAgICAgY2xlYXJJbnN0YW50VXBkYXRlc0FuZFNlbmROYXZUcmVlKHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG4gICAgICAgIH1cbiAgICAgIH0sIDEwMDApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNsZWFySW5zdGFudFVwZGF0ZXNBbmRTZW5kTmF2VHJlZShwYXJlbnRQb3J0LCBzdG9yeWJvYXJkSWQpO1xuICB9O1xuXG4gIGNvbnN0IG9uV2hlZWwgPSAoZTogYW55LCBwYXJlbnRQb3J0OiBhbnksIHN0b3J5Ym9hcmRJZDogc3RyaW5nKSA9PiB7XG4gICAgY29uc3QgcGFzc2VkVGhyb3VnaCA9IHBhc3NUaHJvdWdoRXZlbnRzSWZOZWVkZWQoXG4gICAgICBlLFxuICAgICAgcGFyZW50UG9ydCxcbiAgICAgIHN0b3J5Ym9hcmRJZCxcbiAgICApO1xuXG4gICAgY29uc3QgaXNTY3JvbGxTaG9ydGN1dCA9IGUuYWx0S2V5O1xuICAgIGNvbnN0IGlzWm9vbVNob3J0Y3V0ID0gZS5jdHJsS2V5IHx8IGUubWV0YUtleTtcblxuICAgIC8vIElmIHRoZSB1c2VyIHdhbnRzIHRvIHNjcm9sbCAoZWl0aGVyIGJ5IGJlaW5nIGluIGRyaXZlIG1vZGUsIG9yIGJ5IGhvbGRpbmcgYWx0KVxuICAgIC8vIGFuZCB0aGV5IGFyZW4ndCB0cnlpbmcgdG8gem9vbSwgZmFsbGJhY2sgdG8gZGVmYXVsdCBiZWhhdmlvdXIuXG4gICAgaWYgKCFpc1pvb21TaG9ydGN1dCAmJiAocGFzc2VkVGhyb3VnaCB8fCBpc1Njcm9sbFNob3J0Y3V0KSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgY29uc3QgaW1wb3J0YW50RmllbGRzID0ge1xuICAgICAgZGVsdGFYOiBlLmRlbHRhWCxcbiAgICAgIGRlbHRhWTogZS5kZWx0YVksXG4gICAgICB3aGVlbERlbHRhOiBlLndoZWVsRGVsdGEsXG4gICAgICB4OiBlLngsXG4gICAgICB5OiBlLnksXG4gICAgICBhbHRLZXk6IGUuYWx0S2V5LFxuICAgICAgY3RybEtleTogZS5jdHJsS2V5LFxuICAgICAgc2hpZnRLZXk6IGUuc2hpZnRLZXksXG4gICAgICBtZXRhS2V5OiBlLm1ldGFLZXksXG4gICAgfTtcblxuICAgIHBhcmVudFBvcnQucG9zdE1lc3NhZ2Uoe1xuICAgICAgaWQ6IEZJWEVEX0lGUkFNRV9NRVNTQUdFX0lEUy5XSEVFTF9FVkVOVCxcbiAgICAgIGV2ZW50OiBpbXBvcnRhbnRGaWVsZHMsXG4gICAgfSk7XG4gIH07XG5cbiAgY29uc3QgYWN0aXZlRWxlbWVudE1ldGFkYXRhID0gKCkgPT4ge1xuICAgIGNvbnN0IGFjdGl2ZUVsZW1lbnQgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuICAgIGxldCB0YWdOYW1lLCBpc0NvbnRlbnRFZGl0YWJsZSwgZWxlbWVudFR5cGU7XG5cbiAgICBpZiAoYWN0aXZlRWxlbWVudCkge1xuICAgICAgdGFnTmFtZSA9IGFjdGl2ZUVsZW1lbnQudGFnTmFtZTtcblxuICAgICAgaWYgKGFjdGl2ZUVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkge1xuICAgICAgICBpc0NvbnRlbnRFZGl0YWJsZSA9IGFjdGl2ZUVsZW1lbnQuaXNDb250ZW50RWRpdGFibGU7XG4gICAgICB9XG5cbiAgICAgIGlmIChhY3RpdmVFbGVtZW50IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkge1xuICAgICAgICBlbGVtZW50VHlwZSA9IGFjdGl2ZUVsZW1lbnQudHlwZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdGFnTmFtZTogdGFnTmFtZSxcbiAgICAgIGlzQ29udGVudEVkaXRhYmxlOiBpc0NvbnRlbnRFZGl0YWJsZSxcbiAgICAgIGVsZW1lbnRUeXBlOiBlbGVtZW50VHlwZSxcbiAgICB9O1xuICB9O1xuXG4gIGNvbnN0IG9uS2V5RG93biA9IChlOiBhbnksIHBhcmVudFBvcnQ6IGFueSkgPT4ge1xuICAgIHBhcmVudFBvcnQucG9zdE1lc3NhZ2Uoe1xuICAgICAgaWQ6IEZJWEVEX0lGUkFNRV9NRVNTQUdFX0lEUy5LRVlfRE9XTl9FVkVOVCxcbiAgICAgIGV2ZW50OiB7XG4gICAgICAgIGtleTogZS5rZXksXG4gICAgICAgIG1ldGFLZXk6IGUubWV0YUtleSxcbiAgICAgICAgc2hpZnRLZXk6IGUuc2hpZnRLZXksXG4gICAgICAgIGN0cmxLZXk6IGUuY3RybEtleSxcbiAgICAgICAgYWN0aXZlRWxlbWVudDoge1xuICAgICAgICAgIC4uLmFjdGl2ZUVsZW1lbnRNZXRhZGF0YSgpLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCBvbktleVVwID0gKGU6IGFueSwgcGFyZW50UG9ydDogYW55KSA9PiB7XG4gICAgcGFyZW50UG9ydC5wb3N0TWVzc2FnZSh7XG4gICAgICBpZDogRklYRURfSUZSQU1FX01FU1NBR0VfSURTLktFWV9VUF9FVkVOVCxcbiAgICAgIGV2ZW50OiB7XG4gICAgICAgIGtleTogZS5rZXksXG4gICAgICAgIG1ldGFLZXk6IGUubWV0YUtleSxcbiAgICAgICAgc2hpZnRLZXk6IGUuc2hpZnRLZXksXG4gICAgICAgIGN0cmxLZXk6IGUuY3RybEtleSxcbiAgICAgICAgYWN0aXZlRWxlbWVudDoge1xuICAgICAgICAgIC4uLmFjdGl2ZUVsZW1lbnRNZXRhZGF0YSgpLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCB0aHJvdHRsZWRVcGRhdGVPdXRsaW5lcyA9IF8udGhyb3R0bGUoXG4gICAgKHBhcmVudFBvcnQ6IGFueSwgc3Rvcnlib2FyZElkOiBzdHJpbmcpID0+XG4gICAgICB1cGRhdGVPdXRsaW5lcyhwYXJlbnRQb3J0LCBzdG9yeWJvYXJkSWQpLFxuICAgIDE1LFxuICApO1xuXG4gIGNvbnN0IG9uU2Nyb2xsID0gKGU6IGFueSwgcGFyZW50UG9ydDogYW55LCBzdG9yeWJvYXJkSWQ6IHN0cmluZykgPT4ge1xuICAgIHRocm90dGxlZFVwZGF0ZU91dGxpbmVzKHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG4gIH07XG5cbiAgLy8gTmVlZCB0byByZWdpc3RlciBmdW5jdGlvbnMgb24gdGhlIHdpbmRvdyBmb3IgY2hhbm5lbCBtZXNzYWdpbmcgdG8gdXNlIHRoZW1cbiAgLy8gQHRzLWlnbm9yZVxuICB3aW5kb3cuaW5pdFByb2plY3QgPSAoXG4gICAgcGFyZW50UG9ydDogYW55LFxuICAgIHN0b3J5Ym9hcmRJZDogc3RyaW5nLFxuICAgIHRyZWVFbGVtZW50TG9va3VwOiB7fSxcbiAgICBzY29wZUxvb2t1cDoge30sXG4gICAgc3Rvcnlib2FyZENvbXBvbmVudEVsZW1lbnQ/OiBhbnksXG4gICAgb3B0aW9uczoge1xuICAgICAgZHJpdmVNb2RlRW5hYmxlZD86IGJvb2xlYW47XG4gICAgICBhaUNvbnRleHRTZWxlY3Rpb24/OiBib29sZWFuO1xuICAgIH0gPSB7fSxcbiAgICBzdG9yeWJvYXJkVHlwZT86IHN0cmluZyxcbiAgICBzYXZlZENvbXBvbmVudEZpbGVuYW1lPzogc3RyaW5nLFxuICAgIG9yaWdpbmFsU3Rvcnlib2FyZFVybD86IHN0cmluZyxcbiAgKSA9PiB7XG4gICAgY29uc3QgcGFzc2l2ZTogYW55ID0gbWFrZVBhc3NpdmVFdmVudE9wdGlvbigpO1xuICAgIHBhc3NpdmVbJ2NhcHR1cmUnXSA9IHRydWU7XG5cbiAgICBjb25zdCBib2R5JCA9ICQoJ2JvZHknKTtcblxuICAgIHNldE1lbW9yeVN0b3JhZ2VJdGVtKFRSRUVfRUxFTUVOVF9MT09LVVAsIHRyZWVFbGVtZW50TG9va3VwKTtcbiAgICBzZXRNZW1vcnlTdG9yYWdlSXRlbShTQ09QRV9MT09LVVAsIHNjb3BlTG9va3VwKTtcblxuICAgIGlmIChzdG9yeWJvYXJkQ29tcG9uZW50RWxlbWVudCkge1xuICAgICAgc2V0TWVtb3J5U3RvcmFnZUl0ZW0oU1RPUllCT0FSRF9DT01QT05FTlQsIHN0b3J5Ym9hcmRDb21wb25lbnRFbGVtZW50KTtcbiAgICB9XG5cbiAgICBzZXRNZW1vcnlTdG9yYWdlSXRlbShTVE9SWUJPQVJEX1RZUEUsIHN0b3J5Ym9hcmRUeXBlKTtcblxuICAgIHNldE1lbW9yeVN0b3JhZ2VJdGVtKFxuICAgICAgU0FWRURfU1RPUllCT0FSRF9DT01QT05FTlRfRklMRU5BTUUsXG4gICAgICBzYXZlZENvbXBvbmVudEZpbGVuYW1lLFxuICAgICk7XG5cbiAgICAvLyBUaGUgVVJMIHRoYXQgd2FzIG9yaWdpbmFsbHkgbG9hZGVkIGZvciB0aGlzIHN0b3J5Ym9hcmQsIGl0IG1heSBiZSBkaWZmZXJlbnQgZnJvbSBocmVmXG4gICAgLy8gaWYgdGhlIHVzZXIgbmF2aWdhdGVkIGF3YXkgdG8gYSBuZXcgcm91dGVcbiAgICBpZiAob3JpZ2luYWxTdG9yeWJvYXJkVXJsKSB7XG4gICAgICBzZXRNZW1vcnlTdG9yYWdlSXRlbShPUklHSU5BTF9TVE9SWUJPQVJEX1VSTCwgb3JpZ2luYWxTdG9yeWJvYXJkVXJsKTtcbiAgICB9XG5cbiAgICAvLyBDbGVhciBpZnJhbWUgb3V0bGluZXNcbiAgICByZW1vdmVNZW1vcnlTdG9yYWdlSXRlbShTRUxFQ1RFRF9FTEVNRU5UX0tFWSk7XG4gICAgcmVtb3ZlTWVtb3J5U3RvcmFnZUl0ZW0oSE9WRVJFRF9FTEVNRU5UX0tFWSk7XG4gICAgdXBkYXRlT3V0bGluZXMocGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcblxuICAgIC8vIFJlZ2lzdGVyIGV2ZW50IGxpc3RlbmVyc1xuICAgIGNvbnN0IGJvZHlPYmplY3QgPSBib2R5JC5nZXQoMCk7XG4gICAgYm9keU9iamVjdD8uYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICdjbGljaycsXG4gICAgICAoZTogYW55KSA9PiB7XG4gICAgICAgIHBhc3NUaHJvdWdoRXZlbnRzSWZOZWVkZWQoZSwgcGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgICAgIH0sXG4gICAgICBwYXNzaXZlLFxuICAgICk7XG4gICAgYm9keU9iamVjdD8uYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICdwb2ludGVyb3ZlcicsXG4gICAgICAoZTogYW55KSA9PiB7XG4gICAgICAgIG9uUG9pbnRlck92ZXIoZSwgcGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgICAgIH0sXG4gICAgICBwYXNzaXZlLFxuICAgICk7XG4gICAgYm9keU9iamVjdD8uYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICdwb2ludGVyZG93bicsXG4gICAgICAoZTogYW55KSA9PiB7XG4gICAgICAgIG9uUG9pbnRlckRvd24oZSwgcGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgICAgIH0sXG4gICAgICBwYXNzaXZlLFxuICAgICk7XG4gICAgYm9keU9iamVjdD8uYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICdwb2ludGVydXAnLFxuICAgICAgKGU6IGFueSkgPT4ge1xuICAgICAgICBvblBvaW50ZXJVcChlLCBwYXJlbnRQb3J0LCBzdG9yeWJvYXJkSWQpO1xuICAgICAgfSxcbiAgICAgIHBhc3NpdmUsXG4gICAgKTtcbiAgICBib2R5T2JqZWN0Py5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgJ3BvaW50ZXJtb3ZlJyxcbiAgICAgIChlOiBhbnkpID0+IHtcbiAgICAgICAgb25Qb2ludGVyTW92ZShlLCBwYXJlbnRQb3J0LCBzdG9yeWJvYXJkSWQpO1xuICAgICAgfSxcbiAgICAgIHBhc3NpdmUsXG4gICAgKTtcbiAgICBib2R5T2JqZWN0Py5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgJ3BvaW50ZXJsZWF2ZScsXG4gICAgICAoZTogYW55KSA9PiB7XG4gICAgICAgIHBhc3NUaHJvdWdoRXZlbnRzSWZOZWVkZWQoZSwgcGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgICAgIH0sXG4gICAgICBwYXNzaXZlLFxuICAgICk7XG4gICAgYm9keU9iamVjdD8uYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICdjb250ZXh0bWVudScsXG4gICAgICAoZTogYW55KSA9PiB7XG4gICAgICAgIG9uQ2xpY2tFbGVtZW50Q29udGV4dE1lbnUoZSwgcGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgICAgIH0sXG4gICAgICBwYXNzaXZlLFxuICAgICk7XG4gICAgYm9keU9iamVjdD8uYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICdkYmxjbGljaycsXG4gICAgICAoZTogYW55KSA9PiB7XG4gICAgICAgIHBhc3NUaHJvdWdoRXZlbnRzSWZOZWVkZWQoZSwgcGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgICAgIH0sXG4gICAgICBwYXNzaXZlLFxuICAgICk7XG5cbiAgICBib2R5T2JqZWN0Py5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgJ21vdXNlb3ZlcicsXG4gICAgICAoZTogYW55KSA9PiB7XG4gICAgICAgIHBhc3NUaHJvdWdoRXZlbnRzSWZOZWVkZWQoZSwgcGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgICAgIH0sXG4gICAgICBwYXNzaXZlLFxuICAgICk7XG4gICAgYm9keU9iamVjdD8uYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICdtb3VzZW91dCcsXG4gICAgICAoZTogYW55KSA9PiB7XG4gICAgICAgIHBhc3NUaHJvdWdoRXZlbnRzSWZOZWVkZWQoZSwgcGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgICAgIH0sXG4gICAgICBwYXNzaXZlLFxuICAgICk7XG4gICAgYm9keU9iamVjdD8uYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICdtb3VzZW1vdmUnLFxuICAgICAgKGU6IGFueSkgPT4ge1xuICAgICAgICBwYXNzVGhyb3VnaEV2ZW50c0lmTmVlZGVkKGUsIHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG4gICAgICB9LFxuICAgICAgcGFzc2l2ZSxcbiAgICApO1xuICAgIGJvZHlPYmplY3Q/LmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICAnbW91c2Vkb3duJyxcbiAgICAgIChlOiBhbnkpID0+IHtcbiAgICAgICAgcGFzc1Rocm91Z2hFdmVudHNJZk5lZWRlZChlLCBwYXJlbnRQb3J0LCBzdG9yeWJvYXJkSWQpO1xuICAgICAgfSxcbiAgICAgIHBhc3NpdmUsXG4gICAgKTtcbiAgICBib2R5T2JqZWN0Py5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgJ21vdXNldXAnLFxuICAgICAgKGU6IGFueSkgPT4ge1xuICAgICAgICBwYXNzVGhyb3VnaEV2ZW50c0lmTmVlZGVkKGUsIHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG4gICAgICB9LFxuICAgICAgcGFzc2l2ZSxcbiAgICApO1xuICAgIGJvZHlPYmplY3Q/LmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICAnd2hlZWwnLFxuICAgICAgKGU6IGFueSkgPT4ge1xuICAgICAgICBvbldoZWVsKGUsIHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG4gICAgICB9LFxuICAgICAgcGFzc2l2ZSxcbiAgICApO1xuXG4gICAgYm9keU9iamVjdD8uYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICdrZXlkb3duJyxcbiAgICAgIChlOiBhbnkpID0+IHtcbiAgICAgICAgb25LZXlEb3duKGUsIHBhcmVudFBvcnQpO1xuICAgICAgfSxcbiAgICAgIHBhc3NpdmUsXG4gICAgKTtcblxuICAgIGJvZHlPYmplY3Q/LmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICAna2V5dXAnLFxuICAgICAgKGU6IGFueSkgPT4ge1xuICAgICAgICBvbktleVVwKGUsIHBhcmVudFBvcnQpO1xuICAgICAgfSxcbiAgICAgIHBhc3NpdmUsXG4gICAgKTtcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgJ3Njcm9sbCcsXG4gICAgICAoZTogYW55KSA9PiB7XG4gICAgICAgIG9uU2Nyb2xsKGUsIHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG4gICAgICB9LFxuICAgICAgcGFzc2l2ZSxcbiAgICApO1xuXG4gICAgLy8gSGFjazogdGhpcyBpcyB1c2VkIHRvXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICdwb2ludGVybG9ja2NoYW5nZScsXG4gICAgICAoKSA9PiB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBkb2N1bWVudC5wb2ludGVyTG9ja0VsZW1lbnQgJiZcbiAgICAgICAgICBnZXRNZW1vcnlTdG9yYWdlSXRlbShJTU1FRElBVEVMWV9SRU1PVkVfUE9JTlRFUl9MT0NLKVxuICAgICAgICApIHtcbiAgICAgICAgICBkb2N1bWVudC5leGl0UG9pbnRlckxvY2soKTtcbiAgICAgICAgICBzZXRNZW1vcnlTdG9yYWdlSXRlbShJTU1FRElBVEVMWV9SRU1PVkVfUE9JTlRFUl9MT0NLLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBmYWxzZSxcbiAgICApO1xuXG4gICAgY29uc3QgZGVib3VuY2VFeGVjdXRvciA9IG5ldyBEZWJvdW5jZUV4ZWN1dG9yKCk7XG5cbiAgICBjb25zdCBvYmpzVG9PYnNlcnZlID0gW2JvZHlPYmplY3QgYXMgSFRNTEVsZW1lbnRdO1xuICAgIGNvbnN0IG5leHRCdWlsZFdhdGNoZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnX19uZXh0LWJ1aWxkLXdhdGNoZXInKTtcbiAgICBpZiAobmV4dEJ1aWxkV2F0Y2hlciAmJiBuZXh0QnVpbGRXYXRjaGVyLnNoYWRvd1Jvb3QpIHtcbiAgICAgIC8vIElmIHRoaXMgaXMgTmV4dEpTLCBhbHNvIGxpc3RlbiB0byB0aGUgc2hhZG93IHJvb3Qgb2YgdGhlIF9fbmV4dC1idWlsZC13YXRjaGVyXG4gICAgICAvLyBUaGlzIHRyaWdnZXJlcyB0aGUgb25ET01DaGFuZ2VkIHdoZW4gdGhlIGhvdCByZWxvYWQgc3ltYm9sIHNob3dzIHVwXG4gICAgICBvYmpzVG9PYnNlcnZlLnB1c2goXG4gICAgICAgIC4uLihBcnJheS5mcm9tKG5leHRCdWlsZFdhdGNoZXIuc2hhZG93Um9vdC5jaGlsZHJlbikgYXMgSFRNTEVsZW1lbnRbXSksXG4gICAgICApO1xuICAgIH1cblxuICAgIGdsb2JhbFVJVXBkYXRlUnVubmVyID0gb2JzZXJ2ZURPTShvYmpzVG9PYnNlcnZlLCAoZTogYW55KSA9PiB7XG4gICAgICBkZWJvdW5jZUV4ZWN1dG9yLnNjaGVkdWxlKCgpID0+IHtcbiAgICAgICAgb25ET01DaGFuZ2VkKHtcbiAgICAgICAgICBtdXRhdGlvbnM6IGUsXG4gICAgICAgICAgcGFyZW50UG9ydCxcbiAgICAgICAgICBzdG9yeWJvYXJkSWQsXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpZiAob3B0aW9ucy5kcml2ZU1vZGVFbmFibGVkKSB7XG4gICAgICBlbmFibGVEcml2ZU1vZGUocGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZGlzYWJsZURyaXZlTW9kZShwYXJlbnRQb3J0LCBzdG9yeWJvYXJkSWQpO1xuICAgIH1cblxuICAgIGlmIChvcHRpb25zLmFpQ29udGV4dFNlbGVjdGlvbikge1xuICAgICAgc2V0TWVtb3J5U3RvcmFnZUl0ZW0oJ2FpQ29udGV4dCcsIHRydWUpO1xuICAgICAgdXBkYXRlT3V0bGluZXMocGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2V0TWVtb3J5U3RvcmFnZUl0ZW0oJ2FpQ29udGV4dCcsIGZhbHNlKTtcbiAgICAgIHVwZGF0ZU91dGxpbmVzKHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG4gICAgfVxuXG4gICAgLy8gQnVpbGQgdGhlIE5hdiBUcmVlIGFuZCBzZW5kIGl0IGJhY2tcbiAgICB0cnkge1xuICAgICAgZ2xvYmFsVUlVcGRhdGVSdW5uZXIoKCkgPT4ge1xuICAgICAgICBidWlsZEFuZFNlbmROYXZUcmVlKFxuICAgICAgICAgIHBhcmVudFBvcnQsXG4gICAgICAgICAgc3Rvcnlib2FyZElkLFxuICAgICAgICAgIHRyZWVFbGVtZW50TG9va3VwLFxuICAgICAgICAgIHNjb3BlTG9va3VwLFxuICAgICAgICAgIHN0b3J5Ym9hcmRDb21wb25lbnRFbGVtZW50IHx8ICdFWFBMSUNJVF9OT05FJyxcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYnVpbGRpbmcgbmF2IHRyZWU6ICcgKyBlKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZW5hYmxlRHJpdmVNb2RlID0gKHBhcmVudFBvcnQ6IGFueSwgc3Rvcnlib2FyZElkOiBzdHJpbmcpID0+IHtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgaWYgKCFnZXRTZXNzaW9uU3RvcmFnZUl0ZW0oJ2RyaXZlTW9kZUVuYWJsZWQnLCBzdG9yeWJvYXJkSWQpKSB7XG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICBzZXRTZXNzaW9uU3RvcmFnZUl0ZW0oJ2RyaXZlTW9kZUVuYWJsZWQnLCAnZW5hYmxlZCcsIHN0b3J5Ym9hcmRJZCk7XG4gICAgICBjbGVhckhvdmVyZWRFbGVtZW50cyhwYXJlbnRQb3J0LCBzdG9yeWJvYXJkSWQpO1xuICAgICAgY2xlYXJBbGxPdXRsaW5lcygpO1xuICAgIH1cblxuICAgICQoJ2JvZHknKS5jc3MoJ2N1cnNvcicsICcnKTtcbiAgfTtcblxuICBjb25zdCBkaXNhYmxlRHJpdmVNb2RlID0gKHBhcmVudFBvcnQ6IGFueSwgc3Rvcnlib2FyZElkOiBzdHJpbmcpID0+IHtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgaWYgKGdldFNlc3Npb25TdG9yYWdlSXRlbSgnZHJpdmVNb2RlRW5hYmxlZCcsIHN0b3J5Ym9hcmRJZCkpIHtcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIHJlbW92ZVNlc3Npb25TdG9yYWdlSXRlbSgnZHJpdmVNb2RlRW5hYmxlZCcsIHN0b3J5Ym9hcmRJZCk7XG4gICAgICB1cGRhdGVPdXRsaW5lcyhwYXJlbnRQb3J0LCBzdG9yeWJvYXJkSWQpO1xuICAgICAgY2xlYXJIb3ZlcmVkRWxlbWVudHMocGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgICB9XG5cbiAgICAkKCdib2R5JykuYXR0cignc3R5bGUnLCBmdW5jdGlvbiAoaSwgcykge1xuICAgICAgcmV0dXJuIChzIHx8ICcnKSArICdjdXJzb3I6IGRlZmF1bHQgIWltcG9ydGFudDsnO1xuICAgIH0pO1xuICB9O1xuXG4gIC8vIEB0cy1pZ25vcmVcbiAgd2luZG93LmVuYWJsZURyaXZlTW9kZSA9IChwYXJlbnRQb3J0OiBhbnksIHN0b3J5Ym9hcmRJZDogc3RyaW5nKSA9PiB7XG4gICAgZW5hYmxlRHJpdmVNb2RlKHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG4gIH07XG5cbiAgLy8gQHRzLWlnbm9yZVxuICB3aW5kb3cuZGlzYWJsZURyaXZlTW9kZSA9IChwYXJlbnRQb3J0OiBhbnksIHN0b3J5Ym9hcmRJZDogc3RyaW5nKSA9PiB7XG4gICAgZGlzYWJsZURyaXZlTW9kZShwYXJlbnRQb3J0LCBzdG9yeWJvYXJkSWQpO1xuICB9O1xuXG4gIC8vIEB0cy1pZ25vcmVcbiAgd2luZG93LnNldE5ld0xvb2t1cHMgPSAoXG4gICAgcGFyZW50UG9ydDogYW55LFxuICAgIHN0b3J5Ym9hcmRJZDogc3RyaW5nLFxuICAgIHRyZWVFbGVtZW50TG9va3VwOiBhbnksXG4gICAgc2NvcGVMb29rdXA6IGFueSxcbiAgKSA9PiB7XG4gICAgY29uc3QgcHJldlRyZWVFbGVtbnRMb29rdXAgPVxuICAgICAgZ2V0TWVtb3J5U3RvcmFnZUl0ZW0oVFJFRV9FTEVNRU5UX0xPT0tVUCkgfHwge307XG5cbiAgICBjb25zdCBwcmV2U2NvcGVMb29rdXAgPSBnZXRNZW1vcnlTdG9yYWdlSXRlbShTQ09QRV9MT09LVVApIHx8IHt9O1xuXG4gICAgY29uc3QgbmV3VHJlZUVsZW1lbnRzOiBhbnkgPSB7XG4gICAgICAuLi5wcmV2VHJlZUVsZW1udExvb2t1cCxcbiAgICB9O1xuXG4gICAgLy8gRGVsZXRlIGFueSB0cmVlIGVsZW1lbnRzIHRoYXQgd2VyZSBzZXQgdG8gbnVsXG4gICAgT2JqZWN0LmtleXModHJlZUVsZW1lbnRMb29rdXApLmZvckVhY2goKGtleTogc3RyaW5nKSA9PiB7XG4gICAgICBpZiAodHJlZUVsZW1lbnRMb29rdXBba2V5XSkge1xuICAgICAgICBuZXdUcmVlRWxlbWVudHNba2V5XSA9IHRyZWVFbGVtZW50TG9va3VwW2tleV07XG4gICAgICB9IGVsc2UgaWYgKG5ld1RyZWVFbGVtZW50c1trZXldKSB7XG4gICAgICAgIGRlbGV0ZSBuZXdUcmVlRWxlbWVudHNba2V5XTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGNvbnN0IG5ld1Njb3BlczogYW55ID0ge1xuICAgICAgLi4ucHJldlNjb3BlTG9va3VwLFxuICAgIH07XG5cbiAgICAvLyBEZWxldGUgYW55IHNjb3BlcyB0aGF0IHdlcmUgc2V0IHRvIG51bFxuICAgIE9iamVjdC5rZXlzKHNjb3BlTG9va3VwKS5mb3JFYWNoKChrZXk6IHN0cmluZykgPT4ge1xuICAgICAgaWYgKHNjb3BlTG9va3VwW2tleV0pIHtcbiAgICAgICAgbmV3U2NvcGVzW2tleV0gPSBzY29wZUxvb2t1cFtrZXldO1xuICAgICAgfSBlbHNlIGlmIChuZXdTY29wZXNba2V5XSkge1xuICAgICAgICBkZWxldGUgbmV3U2NvcGVzW2tleV07XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBzZXRNZW1vcnlTdG9yYWdlSXRlbShUUkVFX0VMRU1FTlRfTE9PS1VQLCBuZXdUcmVlRWxlbWVudHMpO1xuICAgIHNldE1lbW9yeVN0b3JhZ2VJdGVtKFNDT1BFX0xPT0tVUCwgbmV3U2NvcGVzKTtcbiAgfTtcblxuICAvLyBAdHMtaWdub3JlXG4gIHdpbmRvdy5zZXRIb3ZlcmVkRWxlbWVudCA9IChcbiAgICBwYXJlbnRQb3J0OiBhbnksXG4gICAgc3Rvcnlib2FyZElkOiBzdHJpbmcsXG4gICAgZWxlbWVudEtleTogc3RyaW5nLFxuICApID0+IHtcbiAgICBjb25zdCBkcml2ZU1vZGVFbmFibGVkID0gISFnZXRTZXNzaW9uU3RvcmFnZUl0ZW0oXG4gICAgICAnZHJpdmVNb2RlRW5hYmxlZCcsXG4gICAgICBzdG9yeWJvYXJkSWQsXG4gICAgKTtcbiAgICBpZiAoZHJpdmVNb2RlRW5hYmxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHByZXZIb3ZlcmVkRWxlbWVudEtleSA9IGdldE1lbW9yeVN0b3JhZ2VJdGVtKEhPVkVSRURfRUxFTUVOVF9LRVkpO1xuICAgIGlmIChwcmV2SG92ZXJlZEVsZW1lbnRLZXkgPT09IGVsZW1lbnRLZXkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoZWxlbWVudEtleSkge1xuICAgICAgc2V0TWVtb3J5U3RvcmFnZUl0ZW0oSE9WRVJFRF9FTEVNRU5UX0tFWSwgZWxlbWVudEtleSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlbW92ZU1lbW9yeVN0b3JhZ2VJdGVtKEhPVkVSRURfRUxFTUVOVF9LRVkpO1xuICAgIH1cblxuICAgIHVwZGF0ZU91dGxpbmVzKHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG4gIH07XG5cbiAgLy8gQHRzLWlnbm9yZVxuICB3aW5kb3cuc2V0U2VsZWN0ZWRFbGVtZW50ID0gKFxuICAgIHBhcmVudFBvcnQ6IGFueSxcbiAgICBzdG9yeWJvYXJkSWQ6IHN0cmluZyxcbiAgICBlbGVtZW50S2V5OiBzdHJpbmcsXG4gICkgPT4ge1xuICAgIGNvbnN0IHByZXZTZWxlY3RlZEVsZW1lbnRLZXkgPSBnZXRNZW1vcnlTdG9yYWdlSXRlbShTRUxFQ1RFRF9FTEVNRU5UX0tFWSk7XG4gICAgaWYgKHByZXZTZWxlY3RlZEVsZW1lbnRLZXkgPT09IGVsZW1lbnRLZXkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoZWxlbWVudEtleSkge1xuICAgICAgY29uc3QgdGVtcG9FbGVtZW50ID0gVGVtcG9FbGVtZW50LmZyb21LZXkoZWxlbWVudEtleSk7XG4gICAgICBsZXQgZWxlbWVudEtleVRvRXh0cmFjdCA9IGVsZW1lbnRLZXk7XG5cbiAgICAgIGlmICh0ZW1wb0VsZW1lbnQuaXNTdG9yeWJvYXJkKHN0b3J5Ym9hcmRJZCkpIHtcbiAgICAgICAgLy8gUGFzcyBiYWNrIHRoZSBvdXRlckhUTUwgb2YgdGhlIHRvcCBsZXZlbCBub2RlXG4gICAgICAgIGNvbnN0IHRvcExldmVsTm9kZTogTmF2VHJlZU5vZGUgPVxuICAgICAgICAgIGdldE1lbW9yeVN0b3JhZ2VJdGVtKENVUlJFTlRfTkFWX1RSRUUpO1xuICAgICAgICBjb25zdCB0b3BMZXZlbEVsZW1lbnRLZXkgPSB0b3BMZXZlbE5vZGU/LnRlbXBvRWxlbWVudD8uZ2V0S2V5KCk7XG4gICAgICAgIGlmICh0b3BMZXZlbEVsZW1lbnRLZXkpIHtcbiAgICAgICAgICBlbGVtZW50S2V5VG9FeHRyYWN0ID0gdG9wTGV2ZWxFbGVtZW50S2V5O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFNlbmQgYmFjayB0aGUgbWVzc2FnZSBqdXN0IHRvIHNldCB0aGUgb3V0ZXJIVE1MIG9ubHlcbiAgICAgIHBhcmVudFBvcnQucG9zdE1lc3NhZ2Uoe1xuICAgICAgICBpZDogRklYRURfSUZSQU1FX01FU1NBR0VfSURTLlNFTEVDVEVEX0VMRU1FTlRfS0VZLFxuICAgICAgICBkb05vdFNldEVsZW1lbnRLZXk6IHRydWUsXG4gICAgICAgIG91dGVySFRNTDogJChgLiR7RUxFTUVOVF9LRVlfUFJFRklYfSR7ZWxlbWVudEtleVRvRXh0cmFjdH1gKS5nZXQoMClcbiAgICAgICAgICA/Lm91dGVySFRNTCxcbiAgICAgIH0pO1xuICAgICAgc2V0TWVtb3J5U3RvcmFnZUl0ZW0oU0VMRUNURURfRUxFTUVOVF9LRVksIGVsZW1lbnRLZXkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBwYXJlbnRQb3J0LnBvc3RNZXNzYWdlKHtcbiAgICAgICAgaWQ6IEZJWEVEX0lGUkFNRV9NRVNTQUdFX0lEUy5TRUxFQ1RFRF9FTEVNRU5UX0tFWSxcbiAgICAgICAgZG9Ob3RTZXRFbGVtZW50S2V5OiB0cnVlLFxuICAgICAgICBvdXRlckhUTUw6IG51bGwsXG4gICAgICB9KTtcbiAgICAgIHJlbW92ZU1lbW9yeVN0b3JhZ2VJdGVtKFNFTEVDVEVEX0VMRU1FTlRfS0VZKTtcbiAgICB9XG5cbiAgICB1cGRhdGVPdXRsaW5lcyhwYXJlbnRQb3J0LCBzdG9yeWJvYXJkSWQpO1xuICB9O1xuXG4gIC8vIEB0cy1pZ25vcmVcbiAgd2luZG93LnNldE11bHRpc2VsZWN0ZWRFbGVtZW50S2V5cyA9IChcbiAgICBwYXJlbnRQb3J0OiBhbnksXG4gICAgc3Rvcnlib2FyZElkOiBzdHJpbmcsXG4gICAgZWxlbWVudEtleXM6IHN0cmluZ1tdLFxuICApID0+IHtcbiAgICBjb25zdCBwcmV2TXVsdGlTZWxlY3RlZEVsZW1lbnRLZXlzID0gZ2V0TWVtb3J5U3RvcmFnZUl0ZW0oXG4gICAgICBNVUxUSV9TRUxFQ1RFRF9FTEVNRU5UX0tFWVMsXG4gICAgKTtcbiAgICBjb25zdCBwcmV2U2V0ID0gbmV3IFNldChwcmV2TXVsdGlTZWxlY3RlZEVsZW1lbnRLZXlzIHx8IFtdKTtcbiAgICBjb25zdCBuZXdTZXQgPSBuZXcgU2V0KGVsZW1lbnRLZXlzIHx8IFtdKTtcbiAgICBjb25zdCBzZXRzRXF1YWwgPVxuICAgICAgcHJldlNldC5zaXplID09PSBuZXdTZXQuc2l6ZSAmJlxuICAgICAgWy4uLnByZXZTZXRdLmV2ZXJ5KCh2YWx1ZTogYW55KSA9PiBuZXdTZXQuaGFzKHZhbHVlKSk7XG4gICAgaWYgKHNldHNFcXVhbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChlbGVtZW50S2V5cykge1xuICAgICAgc2V0TWVtb3J5U3RvcmFnZUl0ZW0oTVVMVElfU0VMRUNURURfRUxFTUVOVF9LRVlTLCBlbGVtZW50S2V5cyk7XG4gICAgICBwYXJlbnRQb3J0LnBvc3RNZXNzYWdlKHtcbiAgICAgICAgaWQ6IEZJWEVEX0lGUkFNRV9NRVNTQUdFX0lEUy5NVUxUSV9TRUxFQ1RFRF9FTEVNRU5UX0tFWVMsXG4gICAgICAgIGRvTm90U2V0RWxlbWVudEtleXM6IHRydWUsXG4gICAgICAgIG91dGVySFRNTHM6IGVsZW1lbnRLZXlzPy5tYXAoXG4gICAgICAgICAgKGVsZW1lbnRLZXkpID0+XG4gICAgICAgICAgICAkKGAuJHtFTEVNRU5UX0tFWV9QUkVGSVh9JHtlbGVtZW50S2V5fWApLmdldCgwKT8ub3V0ZXJIVE1MLFxuICAgICAgICApLFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlbW92ZU1lbW9yeVN0b3JhZ2VJdGVtKE1VTFRJX1NFTEVDVEVEX0VMRU1FTlRfS0VZUyk7XG4gICAgICBwYXJlbnRQb3J0LnBvc3RNZXNzYWdlKHtcbiAgICAgICAgaWQ6IEZJWEVEX0lGUkFNRV9NRVNTQUdFX0lEUy5NVUxUSV9TRUxFQ1RFRF9FTEVNRU5UX0tFWVMsXG4gICAgICAgIGRvTm90U2V0RWxlbWVudEtleXM6IHRydWUsXG4gICAgICAgIG91dGVySFRNTHM6IFtdLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdXBkYXRlT3V0bGluZXMocGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgfTtcblxuICAvLyBAdHMtaWdub3JlXG4gIHdpbmRvdy5wcm9jZXNzUnVsZXNGb3JTZWxlY3RlZEVsZW1lbnQgPSAoXG4gICAgcGFyZW50UG9ydDogYW55LFxuICAgIHN0b3J5Ym9hcmRJZDogc3RyaW5nLFxuICAgIGNzc0VsZW1lbnRMb29rdXA6IHt9LFxuICAgIHNlbGVjdGVkRWxlbWVudEtleTogc3RyaW5nLFxuICApID0+IHtcbiAgICBwcm9jZXNzUnVsZXNGb3JTZWxlY3RlZEVsZW1lbnQoXG4gICAgICBwYXJlbnRQb3J0LFxuICAgICAgY3NzRWxlbWVudExvb2t1cCxcbiAgICAgIHNlbGVjdGVkRWxlbWVudEtleSxcbiAgICApO1xuICB9O1xuXG4gIC8vIEB0cy1pZ25vcmVcbiAgd2luZG93LnNldE1vZGlmaWVyc0ZvclNlbGVjdGVkRWxlbWVudCA9IChcbiAgICBwYXJlbnRQb3J0OiBhbnksXG4gICAgc3Rvcnlib2FyZElkOiBzdHJpbmcsXG4gICAgbW9kaWZpZXJzOiBhbnksXG4gICAgc2VsZWN0ZWRFbGVtZW50S2V5OiBzdHJpbmcsXG4gICkgPT4ge1xuICAgIHNldE1vZGlmaWVyc0ZvclNlbGVjdGVkRWxlbWVudChwYXJlbnRQb3J0LCBtb2RpZmllcnMsIHNlbGVjdGVkRWxlbWVudEtleSk7XG4gIH07XG5cbiAgLy8gQHRzLWlnbm9yZVxuICB3aW5kb3cuZ2V0Q3NzRXZhbHMgPSAoXG4gICAgcGFyZW50UG9ydDogYW55LFxuICAgIHN0b3J5Ym9hcmRJZDogc3RyaW5nLFxuICAgIHNlbGVjdGVkRWxlbWVudEtleTogc3RyaW5nLFxuICApID0+IHtcbiAgICBnZXRDc3NFdmFscyhwYXJlbnRQb3J0LCBzZWxlY3RlZEVsZW1lbnRLZXkpO1xuICB9O1xuXG4gIC8vIEB0cy1pZ25vcmVcbiAgd2luZG93LnJ1bGVNYXRjaGVzRWxlbWVudCA9IChcbiAgICBwYXJlbnRQb3J0OiBhbnksXG4gICAgc3Rvcnlib2FyZElkOiBzdHJpbmcsXG4gICAgbWVzc2FnZUlkOiBzdHJpbmcsXG4gICAgcnVsZTogc3RyaW5nLFxuICAgIHNlbGVjdGVkRWxlbWVudEtleTogc3RyaW5nLFxuICApID0+IHtcbiAgICBydWxlTWF0Y2hlc0VsZW1lbnQocGFyZW50UG9ydCwgbWVzc2FnZUlkLCBydWxlLCBzZWxlY3RlZEVsZW1lbnRLZXkpO1xuICB9O1xuXG4gIC8vIEB0cy1pZ25vcmVcbiAgd2luZG93LmdldEVsZW1lbnRDbGFzc0xpc3QgPSAoXG4gICAgcGFyZW50UG9ydDogYW55LFxuICAgIHN0b3J5Ym9hcmRJZDogc3RyaW5nLFxuICAgIHNlbGVjdGVkRWxlbWVudEtleTogc3RyaW5nLFxuICApID0+IHtcbiAgICBnZXRFbGVtZW50Q2xhc3NMaXN0KHBhcmVudFBvcnQsIHNlbGVjdGVkRWxlbWVudEtleSk7XG4gIH07XG5cbiAgLy8gQHRzLWlnbm9yZVxuICB3aW5kb3cuYXBwbHlDaGFuZ2VJdGVtVG9Eb2N1bWVudCA9IGFzeW5jIChcbiAgICBwYXJlbnRQb3J0OiBhbnksXG4gICAgc3Rvcnlib2FyZElkOiBzdHJpbmcsXG4gICAgY2hhbmdlSXRlbTogQW55Q2hhbmdlTGVkZ2VySXRlbSxcbiAgKSA9PiB7XG4gICAgY29uc3QgeyBzZW5kTmV3TmF2VHJlZSB9ID0gYXBwbHlDaGFuZ2VJdGVtVG9Eb2N1bWVudChcbiAgICAgIHBhcmVudFBvcnQsXG4gICAgICBzdG9yeWJvYXJkSWQsXG4gICAgICBjaGFuZ2VJdGVtLFxuICAgICk7XG5cbiAgICAvLyBVcGRhdGUgdGhlIG5hdiB0cmVlICYgb3V0bGluZXNcbiAgICBpZiAoc2VuZE5ld05hdlRyZWUpIHtcbiAgICAgIGJ1aWxkQW5kU2VuZE5hdlRyZWUocGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgICB9XG4gICAgdXBkYXRlT3V0bGluZXMocGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgfTtcblxuICAvLyBAdHMtaWdub3JlXG4gIHdpbmRvdy51cGRhdGVDb2RlYmFzZUlkcyA9IChcbiAgICBwYXJlbnRQb3J0OiBhbnksXG4gICAgc3Rvcnlib2FyZElkOiBzdHJpbmcsXG4gICAgcHJldklkVG9OZXdJZE1hcDogeyBbcHJldkNvZGViYXNlSWQ6IHN0cmluZ106IHN0cmluZyB9LFxuICAgIG5ld1RyZWVFbGVtZW50TG9va3VwOiBhbnksXG4gICAgbmV3U2NvcGVMb29rdXA6IGFueSxcbiAgKSA9PiB7XG4gICAgY29uc3Qgc2VuZE5ld05hdlRyZWUgPSB1cGRhdGVDb2RlYmFzZUlkcyhcbiAgICAgIHBhcmVudFBvcnQsXG4gICAgICBwcmV2SWRUb05ld0lkTWFwLFxuICAgICAgdHJ1ZSxcbiAgICApO1xuXG4gICAgaWYgKHNlbmROZXdOYXZUcmVlKSB7XG4gICAgICBidWlsZEFuZFNlbmROYXZUcmVlKFxuICAgICAgICBwYXJlbnRQb3J0LFxuICAgICAgICBzdG9yeWJvYXJkSWQsXG4gICAgICAgIG5ld1RyZWVFbGVtZW50TG9va3VwLFxuICAgICAgICBuZXdTY29wZUxvb2t1cCxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdXBkYXRlT3V0bGluZXMocGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgfTtcblxuICAvLyBAdHMtaWdub3JlXG4gIHdpbmRvdy5kaXNwYXRjaEV2ZW50ID0gKFxuICAgIHBhcmVudFBvcnQ6IGFueSxcbiAgICBzdG9yeWJvYXJkSWQ6IHN0cmluZyxcbiAgICBldmVudE5hbWU6IHN0cmluZyxcbiAgICBldmVudERldGFpbHM6IGFueSxcbiAgKSA9PiB7XG4gICAgY29uc3QgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoZXZlbnROYW1lLCB7XG4gICAgICAuLi5ldmVudERldGFpbHMsXG4gICAgfSk7XG4gICAgZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChldmVudCk7XG4gIH07XG5cbiAgLy8gQHRzLWlnbm9yZVxuICB3aW5kb3cudXBkYXRlT3V0bGluZXMgPSAocGFyZW50UG9ydDogYW55LCBzdG9yeWJvYXJkSWQ6IHN0cmluZykgPT4ge1xuICAgIHVwZGF0ZU91dGxpbmVzKHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG4gIH07XG5cbiAgLy8gQHRzLWlnbm9yZVxuICB3aW5kb3cuZ29CYWNrID0gKHBhcmVudFBvcnQ6IGFueSwgc3Rvcnlib2FyZElkOiBzdHJpbmcpID0+IHtcbiAgICBpZiAoZG9jdW1lbnQucmVmZXJyZXIgIT09ICcnKSB7XG4gICAgICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7XG4gICAgfVxuICB9O1xuXG4gIC8vIEB0cy1pZ25vcmVcbiAgd2luZG93LmdvRm9yd2FyZCA9IChwYXJlbnRQb3J0OiBhbnksIHN0b3J5Ym9hcmRJZDogc3RyaW5nKSA9PiB7XG4gICAgd2luZG93Lmhpc3RvcnkuZm9yd2FyZCgpO1xuICB9O1xuXG4gIC8vIEB0cy1pZ25vcmVcbiAgd2luZG93LnJlZnJlc2ggPSAocGFyZW50UG9ydDogYW55LCBzdG9yeWJvYXJkSWQ6IHN0cmluZykgPT4ge1xuICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgfTtcblxuICAvLyBAdHMtaWdub3JlXG4gIHdpbmRvdy5zeW50aGV0aWNNb3VzZU92ZXIgPSAoXG4gICAgcGFyZW50UG9ydDogYW55LFxuICAgIHN0b3J5Ym9hcmRJZDogc3RyaW5nLFxuICAgIGNvb3JkczogYW55LFxuICAgIGRvbnRIb3Zlckluc2lkZVNlbGVjdGVkOiBib29sZWFuLFxuICAgIHNlbGVjdEJvdHRvbU1vc3RFbGVtZW50OiBib29sZWFuLFxuICApID0+IHtcbiAgICBjb25zdCB0YXJnZXQgPSBkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KGNvb3Jkcy54LCBjb29yZHMueSk7XG5cbiAgICAvLyBJZiB0aGlzIGlzIHRydWUgd2UgZG9uJ3Qgd2FudCB0byB0cmlnZ2VyIGEgaG92ZXIgZXZlbnQgaW5zaWRlIGEgc2VsZWN0ZWQgZWxlbWVudCwgaW5zdGVhZCBqdXN0IHNldCBob3ZlcmluZyBvbiB0aGUgc2VsZWN0ZWQgZWxlbWVudFxuICAgIGlmIChkb250SG92ZXJJbnNpZGVTZWxlY3RlZCkge1xuICAgICAgY29uc3Qgc2VsZWN0ZWRFbGVtZW50S2V5ID0gZ2V0TWVtb3J5U3RvcmFnZUl0ZW0oU0VMRUNURURfRUxFTUVOVF9LRVkpO1xuICAgICAgY29uc3Qgc2VsZWN0ZWRFbGVtZW50ID0gVGVtcG9FbGVtZW50LmZyb21LZXkoc2VsZWN0ZWRFbGVtZW50S2V5KTtcblxuICAgICAgaWYgKCFzZWxlY3RlZEVsZW1lbnQuaXNFbXB0eSgpKSB7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkRG9tRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgYC4ke0VMRU1FTlRfS0VZX1BSRUZJWH0ke3NlbGVjdGVkRWxlbWVudEtleX1gLFxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChzZWxlY3RlZERvbUVsZW1lbnQ/LmNvbnRhaW5zKHRhcmdldCkpIHtcbiAgICAgICAgICBvblBvaW50ZXJPdmVyKFxuICAgICAgICAgICAgeyB0YXJnZXQ6IHNlbGVjdGVkRG9tRWxlbWVudCB9LFxuICAgICAgICAgICAgcGFyZW50UG9ydCxcbiAgICAgICAgICAgIHN0b3J5Ym9hcmRJZCxcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIG9uUG9pbnRlck92ZXIoXG4gICAgICB7IHRhcmdldCB9LFxuICAgICAgcGFyZW50UG9ydCxcbiAgICAgIHN0b3J5Ym9hcmRJZCxcbiAgICAgIHNlbGVjdEJvdHRvbU1vc3RFbGVtZW50LFxuICAgICk7XG4gIH07XG5cbiAgLy8gQHRzLWlnbm9yZVxuICB3aW5kb3cuc3ludGhldGljTW91c2VNb3ZlID0gKFxuICAgIHBhcmVudFBvcnQ6IGFueSxcbiAgICBzdG9yeWJvYXJkSWQ6IHN0cmluZyxcbiAgICBzeW50aGV0aWNFdmVudDoge1xuICAgICAgY2xpZW50WDogbnVtYmVyO1xuICAgICAgY2xpZW50WTogbnVtYmVyO1xuICAgICAgYnV0dG9ucz86IG51bWJlcjtcbiAgICB9LFxuICApID0+IHtcbiAgICBjb25zdCBldmVudFdpdGhDbGllbnQgPSB7XG4gICAgICAuLi5zeW50aGV0aWNFdmVudCxcbiAgICAgIHBhZ2VYOlxuICAgICAgICBzeW50aGV0aWNFdmVudC5jbGllbnRYICtcbiAgICAgICAgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0IHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdCksXG4gICAgICBwYWdlWTpcbiAgICAgICAgc3ludGhldGljRXZlbnQuY2xpZW50WSArXG4gICAgICAgIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wIHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wKSxcbiAgICB9O1xuXG4gICAgb25Qb2ludGVyTW92ZShldmVudFdpdGhDbGllbnQsIHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG4gIH07XG5cbiAgLy8gQHRzLWlnbm9yZVxuICB3aW5kb3cuc3ludGhldGljTW91c2VVcCA9IChcbiAgICBwYXJlbnRQb3J0OiBhbnksXG4gICAgc3Rvcnlib2FyZElkOiBzdHJpbmcsXG4gICAgc3ludGhldGljRXZlbnQ6IGFueSxcbiAgKSA9PiB7XG4gICAgb25Qb2ludGVyVXAoc3ludGhldGljRXZlbnQsIHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG4gIH07XG5cbiAgLy8gQHRzLWlnbm9yZVxuICB3aW5kb3cuY2xlYXJIb3ZlcmVkT3V0bGluZXMgPSAocGFyZW50UG9ydDogYW55LCBzdG9yeWJvYXJkSWQ6IHN0cmluZykgPT4ge1xuICAgIGlmIChnZXRNZW1vcnlTdG9yYWdlSXRlbShIT1ZFUkVEX0VMRU1FTlRfS0VZKSkge1xuICAgICAgY2xlYXJIb3ZlcmVkRWxlbWVudHMocGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgICB9XG4gIH07XG5cbiAgLy8gQHRzLWlnbm9yZVxuICB3aW5kb3cuc2V0Wm9vbVBlcmMgPSAoXG4gICAgcGFyZW50UG9ydDogYW55LFxuICAgIHN0b3J5Ym9hcmRJZDogc3RyaW5nLFxuICAgIHpvb21QZXJjOiBudW1iZXIsXG4gICkgPT4ge1xuICAgIHNldE1lbW9yeVN0b3JhZ2VJdGVtKCd6b29tUGVyYycsIHpvb21QZXJjLnRvU3RyaW5nKCkpO1xuICAgIHVwZGF0ZU91dGxpbmVzKHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG4gIH07XG5cbiAgLy8gQHRzLWlnbm9yZVxuICB3aW5kb3cuc2V0QWlDb250ZXh0ID0gKFxuICAgIHBhcmVudFBvcnQ6IGFueSxcbiAgICBzdG9yeWJvYXJkSWQ6IHN0cmluZyxcbiAgICBhaUNvbnRleHQ6IGJvb2xlYW4sXG4gICkgPT4ge1xuICAgIHNldE1lbW9yeVN0b3JhZ2VJdGVtKCdhaUNvbnRleHQnLCAhIWFpQ29udGV4dCk7XG4gICAgdXBkYXRlT3V0bGluZXMocGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgfTtcblxuICAvLyBAdHMtaWdub3JlXG4gIHdpbmRvdy50ZW1wTW92ZUVsZW1lbnQgPSAoXG4gICAgcGFyZW50UG9ydDogYW55LFxuICAgIHN0b3J5Ym9hcmRJZDogc3RyaW5nLFxuICAgIG5vZGVUb01vdmVFbGVtZW50S2V5OiBzdHJpbmcsXG4gICAgbmV3SW5kZXg6IG51bWJlcixcbiAgKSA9PiB7XG4gICAgY29uc3QgZWxlbWVudEtleVRvTmF2Tm9kZSA9XG4gICAgICBnZXRNZW1vcnlTdG9yYWdlSXRlbShFTEVNRU5UX0tFWV9UT19OQVZfTk9ERSkgfHwge307XG5cbiAgICBjb25zdCBuYXZOb2RlVG9Nb3ZlID0gZWxlbWVudEtleVRvTmF2Tm9kZVtub2RlVG9Nb3ZlRWxlbWVudEtleV07XG4gICAgaWYgKCFuYXZOb2RlVG9Nb3ZlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3Qgbm9kZVRvTW92ZUVsZW1lbnQgPSBUZW1wb0VsZW1lbnQuZnJvbUtleShub2RlVG9Nb3ZlRWxlbWVudEtleSk7XG5cbiAgICBjb25zdCBkb21FbGVtZW50c1RvTW92ZTogYW55W10gPSBbXTtcbiAgICAvLyBJbiBjb21wb25lbnRzLCB0aGVyZSBtYXkgYmUgbXVsdGlwbGUgZWxlbWVudHMgdGhhdCBuZWVkIHRvIGJlIG1vdmVkLCB0aGUgZWxlZW1udEtleVRvTG9va3VwTGlzdFxuICAgIC8vIGFyZSBhbGwgdGhlIHJlYWwgRE9NIGVsZW1lbnRzIGluIGEgY29tcG9uZW50XG4gICAgLy8gRm9yIG5vbi1jb21wb25lbnRzLCB0aGUgZWxlZW1udEtleVRvTG9va3VwTGlzdCBwb2ludHMgdG8gYSBsaXN0IG9mIGl0c2VsZlxuICAgIGNvbnN0IGVsZW1lbnRLZXlUb0xvb2t1cExpc3Q6IGFueSA9XG4gICAgICBnZXRNZW1vcnlTdG9yYWdlSXRlbShFTEVNRU5UX0tFWV9UT19MT09LVVBfTElTVCkgfHwge307XG4gICAgY29uc3QgbG9va3VwTGlzdCA9XG4gICAgICBlbGVtZW50S2V5VG9Mb29rdXBMaXN0W25hdk5vZGVUb01vdmUudGVtcG9FbGVtZW50LmdldEtleSgpXSB8fCBbXTtcbiAgICBsb29rdXBMaXN0LmZvckVhY2goKGxvb2t1cEVsZW1lbnRLZXk6IHN0cmluZykgPT4ge1xuICAgICAgZG9tRWxlbWVudHNUb01vdmUucHVzaChcbiAgICAgICAgJCgnYm9keScpLmZpbmQoYC4ke0VMRU1FTlRfS0VZX1BSRUZJWH0ke2xvb2t1cEVsZW1lbnRLZXl9YCkuZ2V0KDApLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHBhcmVudERvbUVsZW1lbnQgPSBkb21FbGVtZW50c1RvTW92ZVswXT8ucGFyZW50RWxlbWVudDtcbiAgICBjb25zdCBwYXJlbnROYXZOb2RlID0gbmF2Tm9kZVRvTW92ZS5wYXJlbnQ7XG5cbiAgICBpZiAocGFyZW50RG9tRWxlbWVudCAmJiBwYXJlbnROYXZOb2RlKSB7XG4gICAgICBjb25zdCBjdXJyZW50SW5kZXggPSBwYXJlbnROYXZOb2RlPy5jaGlsZHJlbj8uaW5kZXhPZihuYXZOb2RlVG9Nb3ZlKTtcbiAgICAgIGNvbnN0IG51bUNoaWxkcmVuID0gcGFyZW50TmF2Tm9kZT8uY2hpbGRyZW4/Lmxlbmd0aDtcblxuICAgICAgaWYgKGN1cnJlbnRJbmRleCAhPT0gbmV3SW5kZXgpIHtcbiAgICAgICAgQXJyYXkuZnJvbShwYXJlbnREb21FbGVtZW50LmNoaWxkcmVuKS5mb3JFYWNoKChjaGlsZDogYW55KSA9PiB7XG4gICAgICAgICAgJChjaGlsZCkuYXR0cihURU1QT19JTlNUQU5UX1VQREFURSwgJ3RydWUnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJChwYXJlbnREb21FbGVtZW50KS5hdHRyKFRFTVBPX0lOU1RBTlRfVVBEQVRFLCAndHJ1ZScpO1xuXG4gICAgICAgIGlmIChuZXdJbmRleCA9PT0gbnVtQ2hpbGRyZW4gLSAxKSB7XG4gICAgICAgICAgZG9tRWxlbWVudHNUb01vdmUuZm9yRWFjaCgoZWxlbWVudDogYW55KSA9PiB7XG4gICAgICAgICAgICBlbGVtZW50LnBhcmVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gSWYgdGhlIGN1cnJlbnQgaW5kZXggaXMgYmVmb3JlIHRoZSBuZXcgaW5kZXggdGhlbiB3ZSBuZWVkIHRvIGFkanVzdCBieSAxIHRvIGFjY291bnQgZm9yIHRoZSBzaGlmdCBpbiBpbmRpY2VzXG4gICAgICAgICAgY29uc3QgYmVmb3JlTm9kZSA9XG4gICAgICAgICAgICBjdXJyZW50SW5kZXggPiBuZXdJbmRleFxuICAgICAgICAgICAgICA/IHBhcmVudE5hdk5vZGU/LmNoaWxkcmVuW25ld0luZGV4XVxuICAgICAgICAgICAgICA6IHBhcmVudE5hdk5vZGU/LmNoaWxkcmVuW25ld0luZGV4ICsgMV07XG4gICAgICAgICAgY29uc3QgbG9va3VwTGlzdEZvckJlZm9yZSA9XG4gICAgICAgICAgICBlbGVtZW50S2V5VG9Mb29rdXBMaXN0W2JlZm9yZU5vZGU/LnRlbXBvRWxlbWVudD8uZ2V0S2V5KCldIHx8IFtdO1xuXG4gICAgICAgICAgaWYgKCFsb29rdXBMaXN0Rm9yQmVmb3JlLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0Nhbm5vdCBmaW5kIGVsZW1lbnQgdG8gaW5zZXJ0IGJlZm9yZSBpbiBsb29rdXAgbGlzdCcpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IGJlZm9yZURvbUVsZW1lbnQgPSAkKCdib2R5JylcbiAgICAgICAgICAgIC5maW5kKGAuJHtFTEVNRU5UX0tFWV9QUkVGSVh9JHtsb29rdXBMaXN0Rm9yQmVmb3JlWzBdfWApXG4gICAgICAgICAgICAuZ2V0KDApO1xuXG4gICAgICAgICAgaWYgKCFiZWZvcmVEb21FbGVtZW50KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQ2Fubm90IGZpbmQgZWxlbWVudCB0byBpbnNlcnQgYmVmb3JlJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgZG9tRWxlbWVudHNUb01vdmUuZm9yRWFjaCgoZWxlbWVudDogYW55KSA9PiB7XG4gICAgICAgICAgICBlbGVtZW50LnBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKGVsZW1lbnQsIGJlZm9yZURvbUVsZW1lbnQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIHRoZSBzZWxlY3RlZCBlbGVtZW50IGtleSB0byB0aGUgbmV3IGV4cGVjdGVkIG9uZSAobm90ZSBpZiBtb3ZpbmcgdGhlcmUgaXMgbm8gaG92ZXJlZCBlbGVtZW50IGtleSlcbiAgICAgICAgLy8gVGhpcyBhbHNvIGFzc3VtZXMgdGhlIG5vZGVUb01vdmVFbGVtZW50S2V5IGlzIHRoZSBzZWxlY3RlZCBlbGVtZW50IGtleVxuICAgICAgICBjb25zdCBlbGVtZW50VG9Nb3ZlU2VnbWVudHMgPSBub2RlVG9Nb3ZlRWxlbWVudC51bmlxdWVQYXRoLnNwbGl0KCctJyk7XG4gICAgICAgIGNvbnN0IG5ld1NlbGVjdGVkVW5pcXVlUGF0aCA9XG4gICAgICAgICAgZWxlbWVudFRvTW92ZVNlZ21lbnRzXG4gICAgICAgICAgICAuc2xpY2UoMCwgZWxlbWVudFRvTW92ZVNlZ21lbnRzLmxlbmd0aCAtIDEpXG4gICAgICAgICAgICAuam9pbignLScpICsgYC0ke25ld0luZGV4fWA7XG5cbiAgICAgICAgY29uc3QgbmV3U2VsZWN0ZWRFbGVtZW50S2V5ID0gbmV3IFRlbXBvRWxlbWVudChcbiAgICAgICAgICBub2RlVG9Nb3ZlRWxlbWVudC5jb2RlYmFzZUlkLFxuICAgICAgICAgIG5vZGVUb01vdmVFbGVtZW50LnN0b3J5Ym9hcmRJZCxcbiAgICAgICAgICBuZXdTZWxlY3RlZFVuaXF1ZVBhdGgsXG4gICAgICAgICkuZ2V0S2V5KCk7XG5cbiAgICAgICAgLy8gVXBkYXRlIHRoZSBuYXYgdHJlZSB3aGljaCBhbHNvIHNldHMgdGhlIGVsZW1lbnQga2V5IG9uIGFsbCB0aGUgZWxlbWVudHMsIG5lZWQgdG8gZG8gdGhpcyBiZWZvcmVcbiAgICAgICAgLy8gdXBkYXRpbmcgdGhlIHNlbGVjdGVkIGVsZW1lbnQga2V5XG4gICAgICAgIGJ1aWxkQW5kU2VuZE5hdlRyZWUocGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcblxuICAgICAgICAvLyBDb2RlYmFzZSBJRCBkb2Vzbid0IGNoYW5nZVxuICAgICAgICBwYXJlbnRQb3J0LnBvc3RNZXNzYWdlKHtcbiAgICAgICAgICBpZDogRklYRURfSUZSQU1FX01FU1NBR0VfSURTLlNFTEVDVEVEX0VMRU1FTlRfS0VZLFxuICAgICAgICAgIGVsZW1lbnRLZXk6IG5ld1NlbGVjdGVkRWxlbWVudEtleSxcbiAgICAgICAgICBvdXRlckhUTUw6ICQoYC4ke0VMRU1FTlRfS0VZX1BSRUZJWH0ke25ld1NlbGVjdGVkRWxlbWVudEtleX1gKS5nZXQoMClcbiAgICAgICAgICAgID8ub3V0ZXJIVE1MLFxuICAgICAgICB9KTtcbiAgICAgICAgc2V0TWVtb3J5U3RvcmFnZUl0ZW0oU0VMRUNURURfRUxFTUVOVF9LRVksIG5ld1NlbGVjdGVkRWxlbWVudEtleSk7XG5cbiAgICAgICAgdXBkYXRlT3V0bGluZXMocGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgLy8gQHRzLWlnbm9yZVxuICB3aW5kb3cudGVtcEFkZERpdiA9IChcbiAgICBwYXJlbnRQb3J0OiBhbnksXG4gICAgc3Rvcnlib2FyZElkOiBzdHJpbmcsXG4gICAgcGFyZW50Q29kZWJhc2VJZDogc3RyaW5nLFxuICAgIGluZGV4SW5QYXJlbnQ6IG51bWJlcixcbiAgICB3aWR0aDogbnVtYmVyLFxuICAgIGhlaWdodDogbnVtYmVyLFxuICApID0+IHtcbiAgICBjb25zdCBlbGVtZW50ID0gJChgLiR7VEVNUE9fSU5TVEFOVF9ESVZfRFJBV19DTEFTU31gKTtcbiAgICBpZiAoZWxlbWVudC5sZW5ndGgpIHtcbiAgICAgIGVsZW1lbnQuY3NzKCd3aWR0aCcsIHdpZHRoKTtcbiAgICAgIGVsZW1lbnQuY3NzKCdoZWlnaHQnLCBoZWlnaHQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgcGFyZW50ID0gJChgLiR7cGFyZW50Q29kZWJhc2VJZH1gKTtcbiAgICAgIGlmICghcGFyZW50Lmxlbmd0aCkge1xuICAgICAgICBwYXJlbnQgPSAkKCdib2R5Jyk7XG4gICAgICB9XG5cbiAgICAgIHBhcmVudC5lYWNoKChpbmRleDogYW55LCBpdGVtOiBhbnkpID0+IHtcbiAgICAgICAgY29uc3QgbmV3RWxlbWVudCA9ICQoXG4gICAgICAgICAgYDxkaXYgY2xhc3M9XCIke1RFTVBPX0lOU1RBTlRfRElWX0RSQVdfQ0xBU1N9XCIgJHtURU1QT19ERUxFVEVfQUZURVJfSU5TVEFOVF9VUERBVEV9PVwidHJ1ZVwiICR7VEVNUE9fREVMRVRFX0FGVEVSX1JFRlJFU0h9PVwidHJ1ZVwiICR7VEVNUE9fSU5TVEFOVF9VUERBVEV9PVwidHJ1ZVwiPjwvZGl2PmAsXG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgY2hpbGRBdEluZGV4ID0gJChpdGVtKS5jaGlsZHJlbigpLmVxKGluZGV4SW5QYXJlbnQpO1xuICAgICAgICBpZiAoY2hpbGRBdEluZGV4Py5sZW5ndGgpIHtcbiAgICAgICAgICBjaGlsZEF0SW5kZXguYmVmb3JlKG5ld0VsZW1lbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICQoaXRlbSkuYXBwZW5kKG5ld0VsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgLy8gVXBkYXRlIHRoZSBuYXYgdHJlZVxuICAgICAgYnVpbGRBbmRTZW5kTmF2VHJlZShwYXJlbnRQb3J0LCBzdG9yeWJvYXJkSWQpO1xuICAgIH1cblxuICAgIHVwZGF0ZU91dGxpbmVzKHBhcmVudFBvcnQsIHN0b3J5Ym9hcmRJZCk7XG4gIH07XG5cbiAgLy8gQHRzLWlnbm9yZVxuICB3aW5kb3cudGVtcE1vdmVUb05ld1BhcmVudCA9IChcbiAgICBwYXJlbnRQb3J0OiBhbnksXG4gICAgc3Rvcnlib2FyZElkOiBzdHJpbmcsXG4gICAgaW5kaWNhdG9yV2lkdGg6IG51bWJlcixcbiAgICBpbmRpY2F0b3JIZWlnaHQ6IG51bWJlcixcbiAgICBuZXdQb3NpdGlvblg6IG51bWJlcixcbiAgICBuZXdQb3NpdGlvblk6IG51bWJlcixcbiAgICBwYXJlbnRFbGVtZW50S2V5OiBzdHJpbmcsXG4gICAgY2xlYXI6IGJvb2xlYW4sXG4gICkgPT4ge1xuICAgICQoYC4ke1RFTVBPX01PVkVfQkVUV0VFTl9QQVJFTlRTX09VVExJTkV9YCkucmVtb3ZlKCk7XG5cbiAgICBpZiAoY2xlYXIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBuZXdFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgbmV3RWxlbWVudC5jbGFzc0xpc3QuYWRkKFRFTVBPX01PVkVfQkVUV0VFTl9QQVJFTlRTX09VVExJTkUpO1xuICAgIG5ld0VsZW1lbnQuc2V0QXR0cmlidXRlKFRFTVBPX0lOU1RBTlRfVVBEQVRFLCAndHJ1ZScpOyAvLyBBZGQgc28gaXQgZG9lc24ndCB0cmlnZ2VyIG5ldyBuYXYgdHJlZSBidWlsZGluZ1xuXG4gICAgbmV3RWxlbWVudC5zdHlsZS53aWR0aCA9IGluZGljYXRvcldpZHRoICsgJ3B4JztcbiAgICBuZXdFbGVtZW50LnN0eWxlLmhlaWdodCA9IGluZGljYXRvckhlaWdodCArICdweCc7XG4gICAgbmV3RWxlbWVudC5zdHlsZS5sZWZ0ID0gbmV3UG9zaXRpb25YICsgJ3B4JztcbiAgICBuZXdFbGVtZW50LnN0eWxlLnRvcCA9IG5ld1Bvc2l0aW9uWSArICdweCc7XG4gICAgbmV3RWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdmaXhlZCc7XG4gICAgbmV3RWxlbWVudC5zdHlsZS5wb2ludGVyRXZlbnRzID0gJ25vbmUnO1xuICAgIG5ld0VsZW1lbnQuc3R5bGUuekluZGV4ID0gJzIwMDAwMDAwMDQnO1xuICAgIG5ld0VsZW1lbnQuc3R5bGUuYm94U2l6aW5nID0gJ2JvcmRlci1ib3gnO1xuICAgIG5ld0VsZW1lbnQuc3R5bGUuY3Vyc29yID0gJ2RlZmF1bHQgIWltcG9ydGFudCc7XG4gICAgbmV3RWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBQUklNQVJZX09VVExJTkVfQ09MT1VSO1xuXG4gICAgY29uc3QgYm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdib2R5JylbMF07XG4gICAgYm9keS5hcHBlbmRDaGlsZChuZXdFbGVtZW50KTtcblxuICAgIGNvbnN0IHBhcmVudERvbUVsZW1lbnQgPSAkKGAuJHtFTEVNRU5UX0tFWV9QUkVGSVh9JHtwYXJlbnRFbGVtZW50S2V5fWApLmdldChcbiAgICAgIDAsXG4gICAgKTtcblxuICAgIGlmIChwYXJlbnREb21FbGVtZW50KSB7XG4gICAgICBjb25zdCBib3VuZGluZ1JlY3QgPSBwYXJlbnREb21FbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgY29uc3QgcGFyZW50T3V0bGluZSA9IGdldE91dGxpbmVFbGVtZW50KFxuICAgICAgICBwYXJlbnRQb3J0LFxuICAgICAgICBPdXRsaW5lVHlwZS5QUklNQVJZLFxuICAgICAgICBib3VuZGluZ1JlY3QubGVmdCxcbiAgICAgICAgYm91bmRpbmdSZWN0LnRvcCxcbiAgICAgICAgYm91bmRpbmdSZWN0LndpZHRoLFxuICAgICAgICBib3VuZGluZ1JlY3QuaGVpZ2h0LFxuICAgICAgKTtcblxuICAgICAgcGFyZW50T3V0bGluZS5jbGFzc0xpc3QucmVtb3ZlKE9VVExJTkVfQ0xBU1MpO1xuICAgICAgcGFyZW50T3V0bGluZS5jbGFzc0xpc3QuYWRkKFRFTVBPX01PVkVfQkVUV0VFTl9QQVJFTlRTX09VVExJTkUpO1xuICAgICAgcGFyZW50T3V0bGluZS5zZXRBdHRyaWJ1dGUoVEVNUE9fSU5TVEFOVF9VUERBVEUsICd0cnVlJyk7IC8vIEFkZCBzbyBpdCBkb2Vzbid0IHRyaWdnZXIgbmV3IG5hdiB0cmVlIGJ1aWxkaW5nXG4gICAgICBib2R5LmFwcGVuZENoaWxkKHBhcmVudE91dGxpbmUpO1xuICAgIH1cbiAgfTtcblxuICAvLyBAdHMtaWdub3JlXG4gIHdpbmRvdy5jaGVja0lmSHlkcmF0aW9uRXJyb3IgPSAocGFyZW50UG9ydDogYW55LCBzdG9yeWJvYXJkSWQ6IHN0cmluZykgPT4ge1xuICAgIGxldCBlcnJvckRlc2NyLCBlcnJvckxhYmVsLCBlcnJvckJvZHksIGhhc0Vycm9yO1xuICAgIGlmICh3aW5kb3cubG9jYXRpb24uaHJlZi5pbmNsdWRlcygnZnJhbWV3b3JrPVZJVEUnKSkge1xuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgY29uc3QgZXJyb3JQb3J0YWwgPVxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgndml0ZS1lcnJvci1vdmVybGF5JylbMF0/LnNoYWRvd1Jvb3Q7XG5cbiAgICAgIGVycm9yRGVzY3IgPSAnQSBWaXRlIEVycm9yIE9jY3VycmVkJztcbiAgICAgIGVycm9yTGFiZWwgPVxuICAgICAgICBlcnJvclBvcnRhbD8ucXVlcnlTZWxlY3RvckFsbD8uKCcuZmlsZS1saW5rJyk/LlswXT8uaW5uZXJIVE1MO1xuICAgICAgZXJyb3JCb2R5ID0gZXJyb3JQb3J0YWw/LnF1ZXJ5U2VsZWN0b3JBbGw/LignLm1lc3NhZ2UnKT8uWzBdPy5pbm5lckhUTUw7XG4gICAgICBoYXNFcnJvciA9IEJvb2xlYW4oZXJyb3JMYWJlbCB8fCBlcnJvckJvZHkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICBjb25zdCBlcnJvclBvcnRhbCA9XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCduZXh0anMtcG9ydGFsJylbMF0/LnNoYWRvd1Jvb3Q7XG4gICAgICBlcnJvckRlc2NyID0gZXJyb3JQb3J0YWw/LmdldEVsZW1lbnRCeUlkPy4oXG4gICAgICAgICduZXh0anNfX2NvbnRhaW5lcl9lcnJvcnNfZGVzYycsXG4gICAgICApPy5pbm5lckhUTUw7XG4gICAgICBlcnJvckxhYmVsID0gZXJyb3JQb3J0YWw/LmdldEVsZW1lbnRCeUlkPy4oXG4gICAgICAgICduZXh0anNfX2NvbnRhaW5lcl9lcnJvcnNfbGFiZWwnLFxuICAgICAgKT8uaW5uZXJIVE1MO1xuICAgICAgZXJyb3JCb2R5ID0gZXJyb3JQb3J0YWw/LnF1ZXJ5U2VsZWN0b3JBbGw/LihcbiAgICAgICAgJy5uZXh0anMtY29udGFpbmVyLWVycm9ycy1ib2R5JyxcbiAgICAgICk/LlswXT8uaW5uZXJIVE1MO1xuICAgICAgaGFzRXJyb3IgPSBCb29sZWFuKGVycm9yRGVzY3IpO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGlmIHRoZSBjb250ZW50cyBvZiB0aGUgaHlkcmF0aW9uIGNvbnRhaW5lciBjb250YWluIHRoZSB0ZXh0IFwiSHlkcmF0aW9uIGZhaWxlZFwiXG4gICAgaWYgKGhhc0Vycm9yKSB7XG4gICAgICBpZiAoZXJyb3JEZXNjcj8uaW5jbHVkZXMoJ0h5ZHJhdGlvbiBmYWlsZWQnKSkge1xuICAgICAgICBwYXJlbnRQb3J0LnBvc3RNZXNzYWdlKHtcbiAgICAgICAgICBpZDogRklYRURfSUZSQU1FX01FU1NBR0VfSURTLkxBVEVTVF9IWURSQVRJT05fRVJST1JfU1RBVFVTLFxuICAgICAgICAgIHN0YXR1czogU1RPUllCT0FSRF9IWURSQVRJT05fU1RBVFVTLkVSUk9SLFxuICAgICAgICAgIGVycm9yRGVzY3IsXG4gICAgICAgICAgZXJyb3JMYWJlbCxcbiAgICAgICAgICBlcnJvckJvZHksXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcGFyZW50UG9ydC5wb3N0TWVzc2FnZSh7XG4gICAgICAgICAgaWQ6IEZJWEVEX0lGUkFNRV9NRVNTQUdFX0lEUy5MQVRFU1RfSFlEUkFUSU9OX0VSUk9SX1NUQVRVUyxcbiAgICAgICAgICBzdGF0dXM6IFNUT1JZQk9BUkRfSFlEUkFUSU9OX1NUQVRVUy5PVEhFUl9FUlJPUixcbiAgICAgICAgICBlcnJvckRlc2NyLFxuICAgICAgICAgIGVycm9yTGFiZWwsXG4gICAgICAgICAgZXJyb3JCb2R5LFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcGFyZW50UG9ydC5wb3N0TWVzc2FnZSh7XG4gICAgICAgIGlkOiBGSVhFRF9JRlJBTUVfTUVTU0FHRV9JRFMuTEFURVNUX0hZRFJBVElPTl9FUlJPUl9TVEFUVVMsXG4gICAgICAgIHN0YXR1czogU1RPUllCT0FSRF9IWURSQVRJT05fU1RBVFVTLk5PX0VSUk9SLFxuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIC8vIEB0cy1pZ25vcmVcbiAgd2luZG93LnRyaWdnZXJEcmFnU3RhcnQgPSAocGFyZW50UG9ydDogYW55LCBzdG9yeWJvYXJkSWQ6IHN0cmluZykgPT4ge1xuICAgIGNvbnN0IHNlbGVjdGVkRWxlbWVudEtleSA9IGdldE1lbW9yeVN0b3JhZ2VJdGVtKFNFTEVDVEVEX0VMRU1FTlRfS0VZKTtcbiAgICBjb25zdCBlbGVtZW50S2V5VG9OYXZOb2RlID1cbiAgICAgIGdldE1lbW9yeVN0b3JhZ2VJdGVtKEVMRU1FTlRfS0VZX1RPX05BVl9OT0RFKSB8fCB7fTtcblxuICAgIC8vIFNvbWV0aGluZyBoYXMgdG8gYmUgc2VsZWN0ZWQgdG8gdHJpZ2dlciBhIGRyYWcgc3RhcnRcbiAgICBpZiAoIXNlbGVjdGVkRWxlbWVudEtleSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGRyYWdnZWROYXZOb2RlID0gZWxlbWVudEtleVRvTmF2Tm9kZVtzZWxlY3RlZEVsZW1lbnRLZXldO1xuXG4gICAgY29uc3QgcGFyZW50RG9tRWxlbWVudCA9IGdldFBhcmVudERvbUVsZW1lbnRGb3JOYXZOb2RlKGRyYWdnZWROYXZOb2RlKTtcblxuICAgIGNvbnN0IHNlbGVjdGVkRWxlbWVudCA9ICQoXG4gICAgICBgLiR7RUxFTUVOVF9LRVlfUFJFRklYfSR7c2VsZWN0ZWRFbGVtZW50S2V5fWAsXG4gICAgKS5nZXQoMCk7XG5cbiAgICBjb25zdCBtb3VzZURyYWdDb250ZXh0OiBhbnkgPSB7XG4gICAgICAvLyBTdGFydCBvZmYgc2NyZWVuLCB0aGlzIHdpbGwgZ2V0IHVwZGF0ZWQgYnkgb25Nb3VzZU1vdmVcbiAgICAgIHBhZ2VYOiAtMTAwMDAsXG4gICAgICBwYWdlWTogLTEwMDAwLFxuXG4gICAgICAvLyBUaGUgZGlmZmVyZW5jZSBiZXR3ZWVuIHdoZXJlIHRoZSB1c2VyIGNsaWNrZWQgYW5kIHRoZSBjZW50ZXIgb2YgdGhlIGVsZW1lbnRcbiAgICAgIG9mZnNldFg6IDAsXG4gICAgICBvZmZzZXRZOiAwLFxuXG4gICAgICBkcmFnZ2luZzogdHJ1ZSxcblxuICAgICAgc2VsZWN0ZWRQYXJlbnREaXNwbGF5OiBjc3NFdmFsKHBhcmVudERvbUVsZW1lbnQsICdkaXNwbGF5JyksXG4gICAgICBzZWxlY3RlZFBhcmVudEZsZXhEaXJlY3Rpb246IGNzc0V2YWwocGFyZW50RG9tRWxlbWVudCwgJ2ZsZXgtZGlyZWN0aW9uJyksXG4gICAgfTtcblxuICAgIHNldE1lbW9yeVN0b3JhZ2VJdGVtKCdtb3VzZURyYWdDb250ZXh0JywgbW91c2VEcmFnQ29udGV4dCk7XG5cbiAgICAvLyBUcmlnZ2VyIHRoZSBkcmFnIHN0YXJ0IGV2ZW50XG4gICAgcGFyZW50UG9ydC5wb3N0TWVzc2FnZSh7XG4gICAgICBpZDogRklYRURfSUZSQU1FX01FU1NBR0VfSURTLkRSQUdfU1RBUlRfRVZFTlQsXG4gICAgICBldmVudDogbW91c2VEcmFnQ29udGV4dCxcbiAgICAgIG91dGVySFRNTDogc2VsZWN0ZWRFbGVtZW50Py5vdXRlckhUTUwsXG4gICAgfSk7XG5cbiAgICB1cGRhdGVPdXRsaW5lcyhwYXJlbnRQb3J0LCBzdG9yeWJvYXJkSWQpO1xuICB9O1xuXG4gIC8vIEB0cy1pZ25vcmVcbiAgd2luZG93LnRyaWdnZXJEcmFnQ2FuY2VsID0gKHBhcmVudFBvcnQ6IGFueSwgc3Rvcnlib2FyZElkOiBzdHJpbmcpID0+IHtcbiAgICBzZXRNZW1vcnlTdG9yYWdlSXRlbSgnbW91c2VEcmFnQ29udGV4dCcsIG51bGwpO1xuXG4gICAgcGFyZW50UG9ydC5wb3N0TWVzc2FnZSh7XG4gICAgICBpZDogRklYRURfSUZSQU1FX01FU1NBR0VfSURTLkRSQUdfQ0FOQ0VMX0VWRU5ULFxuICAgICAgZXZlbnQ6IHt9LFxuICAgIH0pO1xuXG4gICAgdXBkYXRlT3V0bGluZXMocGFyZW50UG9ydCwgc3Rvcnlib2FyZElkKTtcbiAgfTtcblxuICAvLyBAdHMtaWdub3JlXG4gIHdpbmRvdy5zZXRJc0ZsdXNoaW5nID0gKFxuICAgIHBhcmVudFBvcnQ6IGFueSxcbiAgICBzdG9yeWJvYXJkSWQ6IHN0cmluZyxcbiAgICBpc0ZsdXNoaW5nOiBib29sZWFuLFxuICApID0+IHtcbiAgICBjb25zdCB3YXNGbHVzaGluZyA9IGdldE1lbW9yeVN0b3JhZ2VJdGVtKElTX0ZMVVNISU5HKTtcblxuICAgIHNldE1lbW9yeVN0b3JhZ2VJdGVtKElTX0ZMVVNISU5HLCBpc0ZsdXNoaW5nKTtcblxuICAgIGlmIChpc0ZsdXNoaW5nICYmICF3YXNGbHVzaGluZykge1xuICAgICAgb25GbHVzaFN0YXJ0KCk7XG4gICAgfVxuICB9O1xufTtcbiJdfQ==